(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{1416:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var o=n(5),r=n(9),a=n(7),i=n(8),s=n(3),c=n(1),m=n(122),l=(n(1606),n(0));function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(s.a)(e);if(t){var r=Object(s.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(i.a)(this,n)}}var d=function(e){Object(a.a)(n,e);var t=u(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(r.a)(n,[{key:"render",value:function(){var e=this.props.onRef;return Object(l.b)("div",{className:"Comments-pattern-loading",ref:e},Object(l.b)(m.a,null))}}]),n}(c.PureComponent)},1417:function(e,t,n){"use strict";n.d(t,"a",(function(){return v}));var o=n(5),r=n(9),a=n(7),i=n(8),s=n(3),c=n(13),m=n(1),l=n(6),u=n.n(l),d=n(11),p=n(0);function f(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(s.a)(e);if(t){var r=Object(s.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(i.a)(this,n)}}var b=function(e){Object(a.a)(n,e);var t=f(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).handleClick=function(){var t=e.props;(0,t.onSelect)(t.page)},e}return Object(r.a)(n,[{key:"render",value:function(){var e=this.props,t=e.text,n=e.isCurrent,o=e.className;return Object(p.b)(d.c,{preset:d.b.Plain,className:u()("PaginationButton",{"PaginationButton--current":n},o),onClick:this.handleClick,disabled:n},t)}}]),n}(m.Component);n(1605);function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(s.a)(e);if(t){var r=Object(s.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(i.a)(this,n)}}var C=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Array.from({length:t},(function(t,n){return n+e}))},v=function(e){Object(a.a)(n,e);var t=h(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(r.a)(n,[{key:"render",value:function(){var e,t=this.props,n=t.onSelect,o=t.className,r=t.clickCallback,a=this.props.current,i=this.props.total,s=r&&(e=r,function(){e.apply(void 0,arguments)})||n,m=function(e,t){var n="...";return t<=5?C(1,t):e>t-3?[1,n].concat(Object(c.a)(C(t-3,3)),[t]):e<=3?[1].concat(Object(c.a)(C(2,3)),[n,t]):[1,n].concat(Object(c.a)(C(e-Math.floor(1.5),3)),[n,t])}(a,i);return Object(p.b)("div",{className:u()("Pagination",o)},a>1&&a<=i&&Object(p.b)(b,{className:"PaginationButton-prev",onSelect:s,text:"上一页",page:a-1}),m.map((function(e,t){return"number"==typeof e?Object(p.b)(b,{onSelect:s,text:e,page:e,key:t,isCurrent:a===e}):Object(p.b)("button",{disabled:!0,key:t,className:"PaginationButton PaginationButton--ellipsis"},e)})),a>0&&a<i&&Object(p.b)(b,{className:"PaginationButton-next",onSelect:s,text:"下一页",page:a+1}))}}]),n}(m.Component);v.defaultProps={current:1,total:1,onSelect:function(){}}},1418:function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var o=n(14),r=n(1),a=n.n(r),i=n(167),s=n(17),c=function(e){return a.a.createElement(s.a,e,a.a.createElement("path",{d:"M12 11l-3.716 3.782a.758.758 0 0 1-1.064 0 .738.738 0 0 1 0-1.052l4.249-4.512a.758.758 0 0 1 1.064 0l4.246 4.512a.738.738 0 0 1 0 1.052.757.757 0 0 1-1.063 0L12.002 11z",fillRule:"evenodd"}))};c.defaultProps={name:"ArrowUp"};var m=c,l=n(92),u=n.n(l),d=(n(1607),n(0));function p(e){var t=e.onClick,n=e.commentsElRef,r=a.a.useState(!1),s=Object(o.a)(r,2),c=s[0],l=s[1],p=a.a.useState(0),f=Object(o.a)(p,2),b=f[0],h=f[1];return a.a.useEffect((function(){var e=n.current;if(e){var t=e.getBoundingClientRect().right;h(t-16)}}),[n]),a.a.useEffect((function(){var e=u()((function(){var e=n.current;if(e){var t=window.innerHeight,o=e.getBoundingClientRect(),r=o.top,a=o.bottom,i=o.height;l(i>500&&a>t&&r<0)}}),100);return window.addEventListener("scroll",e),function(){e.cancel(),window.removeEventListener("scroll",e)}}),[n]),Object(i.c)(c,null,{from:{opacity:0,left:b},enter:{opacity:1,left:b},leave:{opacity:0,left:b}}).map((function(e){var n=e.item,o=e.key,r=e.props;return n&&Object(d.b)(i.a.button,{key:o,style:r,onClick:t,className:"CommentCollapseButton"},"收起评论",Object(d.b)(m,{center:!0}))}))}},1605:function(e,t,n){},1606:function(e,t,n){},1607:function(e,t,n){},1608:function(e,t,n){},1609:function(e,t,n){var o=n(688),r=n(272),a=n(395),i=Math.max,s=Math.min;e.exports=function(e,t,n){var c=null==e?0:e.length;if(!c)return-1;var m=c-1;return void 0!==n&&(m=a(n),m=n<0?i(c+m,0):s(m,c-1)),o(e,r(t,3),m,!0)}},1610:function(e,t,n){},1611:function(e,t,n){},1612:function(e,t,n){},1643:function(e,t,n){"use strict";n.r(t);var o=n(15),r=n(23),a=n(5),i=n(9),s=n(7),c=n(8),m=n(3),l=n(1),u=n.n(l),d=n(2),p=n.n(d),f=n(32),b=n(12),h=n(30),C=n(6),v=n.n(C),O=n(305),y=n(1609),j=n.n(y),g=n(65),R=n(1417),P=n(48),k=n(27),I=n(47),N=n(123),w=n(28),D=n(77),L=n(461),S=n(607),F=n(1416),T=n(460),A=n(1418),B=n(471),x=n(4),E=n(11),V=(n(1610),n(0));function M(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(m.a)(e);if(t){var r=Object(m.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(c.a)(this,n)}}var q=function(e){Object(s.a)(n,e);var t=M(n);function n(){var e;Object(a.a)(this,n);for(var o=arguments.length,r=new Array(o),i=0;i<o;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).state={},e.handleClick=function(){var t=e.props,n=t.loadRestComments,o=t.onShowConversation,r=t.comment,a=r.id,i=r.childCommentCount,s=i<=5&&i>2;(s?n:o)({commentId:a}),s&&e.setState(Object(x.a)({},"hide_".concat(a),!0))},e.handleRef=function(t){var n=e.props.onRef;"function"==typeof n&&n(t)},e}return Object(i.a)(n,[{key:"render",value:function(){var e=this.props,t=e.comment,n=t.id,o=t.childCommentCount,r=e.isFetching,a=e.className,i=this.state["hide_".concat(n)],s=o<=5&&o>2?"展开其他 ".concat(o-2," 条回复"):"查看全部 ".concat(o," 条回复");return Object(V.b)("div",{className:a,ref:this.handleRef},!i&&Object(V.b)("div",{className:"CommentMoreReplyButton"},Object(V.b)(E.c,{preset:"plain",onClick:this.handleClick},s)),r&&Object(V.b)(g.a,{className:"CommentMoreReplyButton",small:!0}))}}]),n}(l.Component);q.propTypes={comment:p.a.object.isRequired,isFetching:p.a.bool,onShowConversation:p.a.func,loadRestComments:p.a.func};var _;n(1611);function U(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(m.a)(e);if(t){var r=Object(m.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(c.a)(this,n)}}var W=Object(b.connect)(null,{loadConversation:O.h})(_=function(e){Object(s.a)(n,e);var t=U(n);function n(){var e;Object(a.a)(this,n);for(var o=arguments.length,r=new Array(o),i=0;i<o;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).loadRestComments=function(t){var n=t.commentId;(0,e.props.loadConversation)({id:n,isLoadRest:!0})},e}return Object(i.a)(n,[{key:"render",value:function(){var e=this.props,t=e.parent,n=t.type,o=t.author,r=(o=void 0===o?{isOrg:!1}:o).isOrg,a=e.parent,i=e.commentNeedsReview,s=e.onShowConversation,c=e.status,m=e.onItemLike,u=e.onItemDelete,d=e.onItemCollapse,p=e.onItemDislike,f=e.onItemApprove,b=e.onItemReject,h=e.canOperateItem,C=e.commentPattern,O=e.conversation,y=void 0===O?{}:O,j=e.entities,g=e.byComment,R=e.isReverseAndStatusOpen,P=e.comment,k=e.onReply,I=e.onFeature,N=e.ids,w=e.showCollapsed,D=P.id,L=P.featured,S=P.childComments,F=void 0===S?[]:S,T=P.childCommentCount,A=void 0===T?0:T,x=L?"".concat(D,"_featured"):"".concat(D),E=!L&&N.includes("".concat(D,"_featured")),M=Boolean(F.length)&&!R,_=A<=5&&A>2,U=F.map((function(e){return j.comments[e]})),W=!L&&A>2&&!R,z=(_&&y[D]||{isFetching:!1}).isFetching;return Object(V.b)(l.Fragment,null,Object(V.b)("li",{className:v()({"NestComment--rootCommentNoChild":!M,"NestComment--rootComment":M}),key:x},Object(V.b)(B.a,{key:x,comment:P,status:c,type:n,parent:a,canOperate:h,commentNeedsReview:i,onShowConversation:s,ownerAuthorIsOrg:r,onLike:m,onReply:k,onFeature:I,onDelete:u,onCollapse:d,onDislike:p,onApprove:f,onReject:b,commentPattern:C,rootCommentId:D,byComment:g,isReverseAndStatusOpen:R,hasRecommend:E,showCollapsed:w})),M&&U.map((function(e){var t=e.id,o=e.featured,l=o?"".concat(t,"_featured"):"".concat(t),v=!o&&N.includes("".concat(t,"_featured"));return Object(V.b)("li",{className:"NestComment--child",key:l},Object(V.b)(B.a,{key:l,comment:e,status:c,type:n,parent:a,canOperate:h,commentNeedsReview:i,onShowConversation:s,ownerAuthorIsOrg:r,onLike:m,onReply:k,onFeature:I,onDelete:u,onCollapse:d,onDislike:p,onApprove:f,onReject:b,commentPattern:C,rootCommentId:D,hasRecommend:v,showCollapsed:w}))})),W&&Object(V.b)(q,{comment:P,isFetching:z,onShowConversation:s,loadRestComments:this.loadRestComments}))}}]),n}(l.Component))||_;function z(e){var t=e.id,n=e.replyTo,o=e.isConversation;if(e.isNotification)return{type:"notification"};if(o)return{type:"conversation"};if(!n)return{type:"comment"};var r=n.featured,a=n.replyToAuthor,i=n.id;return t===i&&r?a?{type:"replyToSubFeatured"}:{type:"replyToFeatured"}:t!==i||a?t!==i&&a?{type:"replyToSubCommon"}:{type:"comment"}:{type:"replyToCommon"}}n(1612);function H(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(m.a)(e);if(t){var r=Object(m.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(c.a)(this,n)}}var J=function(e){Object(s.a)(n,e);var t=H(n);function n(){var e;Object(a.a)(this,n);for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];return(e=t.call.apply(t,[this].concat(i))).state={collapsed:!0,current:1},e.commentsWithPaginationElRef=u.a.createRef(),e.load=function(t,n,o){if(!e.props.isFetching&&!e.props.parent.adminClosedComment){var r=t||e.props,a=r.order,i=r.status,s=r.parent,c=s.id,m=s.type,l=r.commentPattern,u=r.needLoadCommentPermission,d=r.loadComments,p=r.notificationId,f=r.loadNotificationComments;if(p)return f(p);u&&e.loadCommentPermission(m,c),d(m,c,{order:a,isPrevious:n,commentPattern:l,status:o?"collapsed":i},o)}},e.addComment=function(t,n,o,r,a){var i=o.rootCommentId,s=o.isConversation,c=e.props,m=c.parent,l=m.id,u=m.type,d=c.commentId,p=c.addComment,f=c.notificationId;return p({parentType:u,parentId:l,content:t,replyTo:n,conversationId:d,rootCommentId:i,isConversation:s,notificationId:f,replyType:z({id:i,replyTo:n,isConversation:s,isNotification:Boolean(f)}).type,useStrictMode:r,enableUnfriendlyCheck:a})},e.featureItem=function(t){(0,e.props.onItemFeature)(t,e.lastFeaturedIndex)},e.handleOpenCollapsed=function(){e.setState({collapsed:!1}),e.load(e.props,!1,!0)},e.handlePageSelect=function(t){var n=e.props.onPaginationClick,o=e.state.current;n&&n(o,t),e.commentsElement.scrollIntoView(),e.setState({current:t}),e.loadByPagination(t)},e.loadByPagination=function(t,n){var o=n||e.props,r=o.order,a=o.status,i=o.parent,s=i.id,c=i.type,m=o.commentPattern,l=o.needLoadCommentPermission,u=o.loadComments;l&&e.loadCommentPermission(c,s),u(c,s,{order:r,isPrevious:!1,status:a,commentPattern:m,current:t})},e.renderComment=function(t){var n=t.id,r=t.featured?"".concat(n,"_featured"):n,a=!e.state.collapsed;return Object(V.b)("ul",{className:"NestComment",key:r},Object(V.b)(W,Object(o.default)({comment:t,onReply:e.addComment,onFeature:e.featureItem,showCollapsed:a},e.props)))},e.renderNormalComments=function(t){var n=e.state.collapsed,o=e.props,r=o.byComment,a=o.lastFeaturedIndex,i=o.parent,s=i.featuredCounts,c=i.commonCounts,m=[],l=s>0;return e.lastFeaturedIndex=0,t.length>0&&t.forEach((function(o,i){if(r||!o.collapsed){var u=t[i-1];o.collapsed&&(u&&u.collapsed||m.push(e.renderCollapsedDivider()),n)||(i===a&&m.push(Object(V.b)("div",{className:"NestComment-nextSiblings--noBorder",key:"NestComment-nextSiblings--noBorder"})),l&&0===i&&-1!==a&&m.push(Object(V.b)("div",{className:"CommentListV2-header-divider",key:"divider-featured"},"精选评论（",s,"）")),m.push(e.renderComment(o)),i===a&&(e.lastFeaturedIndex=i,m.push(Object(V.b)("div",{className:"CommentListV2-header-divider",key:"divider-comment"},"评论（",c,"）"))))}})),m},e.renderCollapsedComments=function(){var t=e.props,n=t.collapsedComments,o=t.isDrained,r=t.parent,a=(r=void 0===r?{}:r).collapsedCounts;return!o||a<=0?[]:n.map((function(t){return e.renderComment(t)}))},e.renderComments=function(t){return t.map(e.renderComment)},e.renderCollapsedDivider=function(){var t=e.props,n=t.isDrained,o=t.parent.collapsedCounts;return!n||o<=0?[]:e.state.collapsed?Object(V.b)("div",{className:"CommentListV2-action",key:"collapsed"},Object(V.b)("div",{className:"CommentListV2-expendCollapseButton"},Object(V.b)("span",{onClick:e.handleOpenCollapsed},Object(P.formatNumber)(o)," 条评论被折叠"),"（",Object(V.b)("a",{href:"//www.zhihu.com/question/52029856/answer/128623557",target:"_blank",rel:"noopener noreferrer"},"为什么？"),"）")):Object(V.b)("div",{className:"CommentListV2-divider",key:"divider-collapsed"},Object(V.b)("div",{className:"CommentListV2-dividerLine"}),Object(V.b)("div",{className:"CommentListV2-dividerText"},Object(P.formatNumber)(o)," 条评论被折叠（",Object(V.b)("a",{href:"//www.zhihu.com/question/52029856/answer/128623557",target:"_blank",rel:"noopener noreferrer"},"为什么？"),"）"))},e.renderCollapsedInfiLoader=function(){var t=e.state.collapsed;if(t)return[];var n=e.props.collapsedInfo,o=void 0===n?{}:n,r=o.isFetching,a=void 0!==r&&r,i=o.isPrevDrained,s=void 0!==i&&i,c=o.isDrained,m=void 0!==c&&c;return Object(V.b)(g.b,{className:"CommentListV2",onRef:function(t){e.listEl=t},isLocal:!0,isLoading:a,isPrevDrained:s,isDrained:m,onLoad:function(n){return e.load(e.props,n,!t)},placeholder:Object(V.b)(g.a,{className:"CommentItem",small:!0})},e.renderCollapsedComments())},e.renderPatternContent=function(t){var n=e.props,o=n.isFetching,r=n.parent.adminClosedComment,a=n.byComment,i=n.status,s=n.order,c=n.totals,m=n.showPackupButton,l=n.handlePackupButton,u=Math.ceil(c/20),d=e.state.current;return r?null:o?Object(V.b)(F.a,null):Object(V.b)("div",{ref:e.commentsWithPaginationElRef},Object(V.b)("div",{className:"CommentListV2"},"normal"===s&&"open"===i?e.renderNormalComments(t):e.renderComments(t)),u>1&&Object(V.b)(R.a,{className:"CommentsV2-pagination",current:d,total:u,onSelect:e.handlePageSelect}),!a&&e.renderCollapsedDivider(),!a&&e.renderCollapsedInfiLoader(),m&&Object(V.b)(A.a,{onClick:l,commentsElRef:e.commentsWithPaginationElRef}))},e.renderModalContent=function(t){var n=e.props,o=n.collapsedInfo,r=n.parent.adminClosedComment,a=n.status,i=n.order,s=n.byComment,c=e.state.collapsed,m=c?e.props:o,l=m.isFetching,u=void 0!==l&&l,d=m.isDrained,p=void 0!==d&&d,f=m.isPrevDrained,b=void 0!==f&&f;return p&&t.length<=0||r?Object(V.b)("div",{className:"CommentsV2-empty"},Object(V.b)(L.d,null,Object(V.b)(L.a,null),Object(V.b)("div",null,"还没有评论"))):Object(V.b)(g.b,{className:"CommentListV2",onRef:function(t){e.listEl=t},isLocal:!0,isLoading:u,isPrevDrained:b,isDrained:p,onLoad:function(t){return e.load(e.props,t,!c)},placeholder:Object(V.b)(g.a,{className:"CommentItemV2",small:!0}),getContainer:function(e){return e}},"normal"===i&&"open"===a?e.renderNormalComments(t):e.renderComments(t),!s&&e.renderCollapsedDivider(),!s&&e.renderCollapsedComments())},e.renderCommentEdit=function(){var t=e.props,n=t.parent,o=n.canComment,r=(o=void 0===o?{status:!0}:o).status,a=o.reason,i=n.author,s=(i=void 0===i?{isOrg:!1}:i).isOrg,c=n.type,m=n.id,l=n.adminClosedComment,u=n.questionType,d=t.byComment,p=t.autoFocus,f=t.commentNeedsReview,b=t.zaInfo,h=l?"当前内容暂时无法评论":a,C=p&&!d;return r&&!l?Object(V.b)(S.a,{className:"CommentsV2-footer",type:c,id:m,commentNeedsReview:f,onSubmit:e.addComment,autoFocus:C,ownerAuthorIsOrg:s,ownerAuthorIsBrand:"commercial"===u,zaInfo:b}):Object(V.b)("div",{className:v()("CommentsV2-disabledText")},Object(V.b)("div",{className:"CommentsV2-disabledReason"},h))},e}return Object(i.a)(n,[{key:"loadCommentPermission",value:function(e,t){var n=this.props,o=n.loadAnswerCommentPermission,r=n.loadArticleCommentPermission;switch(e){case"answer":return o(t);case"article":return r(t);default:return null}}},{key:"componentDidMount",value:function(){var e=this.props,t=e.commentPattern,n=e.parent.adminClosedComment,o=e.stickers,r=e.loadStickers,a=e.getCommentWithPicPermission,i=e.commentWithPicPermission,s=e.currentUser;n||"bottom"!==t||this.loadByPagination(this.state.current),!o.length&&r(),void 0===i.commentWithPic&&s&&a()}},{key:"componentWillReceiveProps",value:function(e){var t=this.props,n=t.order,o=t.status,r=t.targetComment,a=t.commentPattern;n===e.order&&o===e.status||("bottom"===a?(this.setState({current:1}),this.loadByPagination(1,e)):this.load(e),this.setState({collapsed:!0}));var i=e.targetComment;i!==r&&i&&this.setState({collapsed:i.collapsed})}},{key:"componentWillUnmount",value:function(){Object(k.d)(k.b)}},{key:"render",value:function(){var e=this,t=this.props,n=t.className,r=t.comments,a=t.commentPattern,i=t.commentInputPosition,s=t.isAuthor,c=t.parent,m=c.author,l=(m=void 0===m?{isOrg:!1}:m).isOrg,u=c.commentPermission,d=c.reviewingCounts,p=c.commentCount,f=c.adminClosedComment,b=t.totals,h=t.status,C=t.order,O=t.onStatusChange,y=t.onOrderChange,j=t.targetLink,g=t.shouldReverse,R=t.permission.canBrandAdminEdit,P="censor"===u&&(s||R),k=P?{isCommentReviewer:P,onStatusChange:O,status:h,reviewingCounts:d}:{status:h};return Object(V.b)("div",{className:v()("CommentsV2 CommentsV2--withEditor",{"CommentsV2-withPagination":"bottom"===a},n),ref:function(t){e.commentsElement=t}},Object(V.b)(T.a,Object(o.default)({commentCount:void 0!==p?p:b,shouldReverse:g,commentClosed:f,targetLink:j,order:C,onOrderChange:y,commentPattern:a,isOrg:l},k)),"top"===i&&this.renderCommentEdit(),"bottom"===a?this.renderPatternContent(r):this.renderModalContent(r),"bottom"===i&&this.renderCommentEdit())}}]),n}(l.Component);J.propTypes={type:p.a.string,parent:p.a.object.isRequired,targetLink:p.a.node,commentNeedsReview:p.a.bool,byComment:p.a.oneOfType([p.a.number,p.a.string]),commentPattern:p.a.string,commentInputPosition:p.a.oneOf(["top","bottom"]),showPackupButton:p.a.bool,handlePackupButton:p.a.func,onPaginationClick:p.a.func,autoFocus:p.a.bool,shouldReverse:p.a.bool},J.contextTypes={authRequired:p.a.func.isRequired},J.defaultProps={commentInputPosition:"bottom",showPackupButton:!0,autoFocus:!0,shouldReverse:!0};var G,K,Q,X=Object(b.connect)((function(e,t){var n=t.parent,o=t.parent,r=o.type,a=o.id,i=t.status,s=t.order,c=t.byComment,m=t.commentPattern,l=t.notificationId,u=e.entities,d=e.commentsV2,p=d.conversation,f=d.stickers,b=void 0===f?[]:f,h=d.commentWithPicPermission,C=d.notificationsComments,v=d.parent,O=u.comments[c],y=d.pagination;"reviewing"===i&&(y=d.reviewing);var g="reverse"===s&&"open"===i;g&&(y=d.reverse);var R="".concat(r,"_").concat(a),P=[],k=d.collapsed[R]||{};k.ids&&k.ids.length>0&&(P=k.ids.map((function(e){return u.comments[e]}))),l&&(y=C,R=l);var I=y[R]||{isPrevDrained:!1,isFetching:!1,isDrained:!1,ids:[]},N=I.isFetching,L=I.isPrevDrained,S=I.isDrained,F=I.ids,T=I.newIds,A=void 0===T?[]:T,B=I.totals,x="bottom"!==m?F:A,E=x.map((function(e){return u.comments[e]})),V=j()(x,(function(e){return String(e).includes("_featured")}));return{currentUser:Object(w.b)(e),isFetching:N,isPrevDrained:L,isDrained:S,totals:l?E.length:B,collapsedInfo:k,collapsedComments:P,targetComment:O,conversation:p,entities:u,stickers:b,lastFeaturedIndex:V,comments:E,isReverseAndStatusOpen:g,commentWithPicPermission:h,ids:x,parent:Object.assign({},n,v[R]),permission:Object(D.j)(e)}}),{loadComments:O.g,loadConversation:O.h,addComment:O.a,loadStickers:O.k,clearNotification:k.d,getCommentWithPicPermission:O.f,loadNotificationComments:O.j,loadAnswerCommentPermission:I.j,loadArticleCommentPermission:N.b})(J),Y=n(31),Z=n(13),$=n(144),ee=n.n($),te=n(225),ne=n.n(te),oe=n(46),re=n(1314);function ae(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(m.a)(e);if(t){var r=Object(m.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(c.a)(this,n)}}var ie=Object(b.connect)((function(e,t){var n=t.conversationId,o=t.isAnchorComments,r=e.entities.comments,a=e.commentsV2,i=a.conversation,s=a.conversationMore,c=i[n]||{isFetching:!1,isDrained:!1,isPrevDrained:!1,ids:[]},m=c.isFetching,l=c.isDrained,u=c.isPrevDrained,d=c.ids,p=c.totals,f=c.topComments,b=(f=void 0===f?{}:f).paging,h=(b||{}).isEnd,C=s[n]||{isFetching:!1,isDrained:!1,ids:[]},v=C.isFetching,O=C.isDrained,y=C.ids,j=y.map((function(e){return r[e]})),g=d.map((function(e){return r[e]})),R=r["".concat(n,"_featured")]||r[n]||{},P=o?ne()(y.length?[].concat(Object(Z.a)(g.slice(0,4)),Object(Z.a)(j),Object(Z.a)(g.slice(4))):g,"id"):[R].concat(Object(Z.a)(g)),k=b?[].concat(Object(Z.a)(g.slice(0,3)),Object(Z.a)(j)).length:-1;return{isFetching:m,isDrained:l,isPrevDrained:u,totals:p,comments:P,openComment:R,topCommentsPaging:b,isConversationMoreFetching:v,isConversationMoreDrained:h||O,offsetIndex:k}}),{loadConversation:O.h,addComment:O.a,loadMoreAnchorComments:O.i})((Q=K=function(e){Object(s.a)(n,e);var t=ae(n);function n(){var e;Object(a.a)(this,n);for(var o=arguments.length,r=new Array(o),i=0;i<o;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).load=function(){var t=e.props,n=t.isAnchorComments,o=t.conversationId;(0,t.loadConversation)({id:o,isAnchorComments:n})},e.addComment=function(t,n,o){var r=o.rootCommentId,a=o.isConversation,i=e.props,s=i.parent,c=s.type,m=s.id,l=i.conversationId,u=i.addComment,d=i.isAnchorComments;return u({parentType:c,parentId:m,content:t,replyTo:n,conversationId:l,rootCommentId:r,isConversation:a,replyType:z({id:r,replyTo:n,isConversation:a}).type,isAnchorComments:d})},e.loadMoreAnchorComments=function(){var t=e.props,n=t.conversationId,o=t.topCommentsPaging,r=void 0===o?{}:o;(0,t.loadMoreAnchorComments)({conversationId:n,nextUrl:r.next})},e.createOnRef=ee()((function(t){return function(n){var o=e.props.byComment;n&&o&&String(t)===String(o)&&(e.byCommentNode=n)}})),e.scrollToTarget=function(){var t=Object(Y.a)(e),n=t.byCommentNode,o=t.listEl;if(o&&n){var r=n.getBoundingClientRect(),a=r.top,i=r.height,s=o.getBoundingClientRect(),c=s.top,m=s.height;e.listEl.scrollTop+=a-c-(m-i)/2,n.classList.add("CommentItemV2--highlighted"),setTimeout((function(){return n.classList.remove("CommentItemV2--highlighted")}),2e3),n.tabIndex=-1,n.focus()}},e}return Object(i.a)(n,[{key:"componentDidMount",value:function(){this.props.byComment&&this.scrollToTarget()}},{key:"componentDidUpdate",value:function(e){!e.comments.length&&this.props.comments.length&&this.props.byComment&&this.scrollToTarget()}},{key:"render",value:function(){var e=this,t=this.props,n=t.onItemLike,o=t.onItemDelete,r=t.onItemFeature,a=t.onItemApprove,i=t.onItemCollapse,s=t.onItemDislike,c=t.onNavBack,m=t.canOperateItem,d=t.isFetching,p=t.comments,f=void 0===p?[]:p,b=t.commentNeedsReview,h=t.openComment.collapsed,C=t.parent,v=t.commentPattern,O=t.totals,y=t.isDrained,j=t.isPrevDrained,R=t.isConversationMoreFetching,P=t.isConversationMoreDrained,k=t.offsetIndex,I=null;return d&&!f.length?I=Object(V.b)(u.a.Fragment,null,Object(V.b)(g.a,{className:"CommentItemV2",small:!0}),Object(V.b)("div",{className:"CommentsV2-openComment-divider"}),Object(V.b)("div",{className:"CommentsV2-replyNum"},"".concat(O," 条回复"))):f.length&&(I=f.map((function(t,c){return c?P||c!==k||R?R&&c===k?Object(V.b)(l.Fragment,{key:t.id},Object(V.b)(B.a,{key:t.id,onRef:e.createOnRef(t.id),isConversation:!0,commentNeedsReview:b,canOperate:m,parent:C,comment:t,onLike:n,onDelete:o,onFeature:r,onApprove:a,onCollapse:i,onDislike:s,collapsedShown:h,onReply:e.addComment}),Object(V.b)(g.a,{key:"NestCoomment-moreCommentButton-PlaceHolder",className:"NestCoomment-moreCommentButton ",small:!0})):Object(V.b)(B.a,{key:t.id,onRef:e.createOnRef(t.id),isConversation:!0,commentNeedsReview:b,canOperate:m,parent:C,comment:t,onLike:n,onDelete:o,onFeature:r,onApprove:a,onCollapse:i,onDislike:s,collapsedShown:h,onReply:e.addComment}):Object(V.b)(l.Fragment,{key:t.id},Object(V.b)(B.a,{key:t.id,onRef:e.createOnRef(t.id),isConversation:!0,commentNeedsReview:b,canOperate:m,parent:C,comment:t,onLike:n,onDelete:o,onFeature:r,onApprove:a,onCollapse:i,onDislike:s,collapsedShown:h,onReply:e.addComment}),Object(V.b)("div",{key:"NestCoomment-moreCommentButton",preset:"plain",className:"NestCoomment-moreCommentButton",onClick:e.loadMoreAnchorComments},Object(V.b)(re.a,null),Object(V.b)("p",null,"点击查看更多回复"))):Object(V.b)(l.Fragment,{key:t.id},Object(V.b)("div",{className:"CommentsV2-openComment"},Object(V.b)(B.a,{key:t.id,onRef:e.createOnRef(t.id),isConversation:!0,commentNeedsReview:b,canOperate:m,parent:C,comment:t,onLike:n,onDelete:o,onFeature:r,onApprove:a,onCollapse:i,onDislike:s,collapsedShown:h,onReply:e.addComment})),Object(V.b)("div",{className:"CommentsV2-openComment-divider"}),Object(V.b)("div",{key:"".concat(t.id,"-title")},Object(V.b)("div",{className:"CommentsV2-replyNum"},"".concat(O," 条回复"))))}))),"bottom"===v?Object(V.b)(oe.b,{size:"fullPage",onClose:c},Object(V.b)("div",{className:"CommentsV2"},Object(V.b)(T.a,{isConversation:!0,commentPattern:v}),Object(V.b)(g.b,{className:"CommentListV2",onRef:function(t){e.listEl=t},isLocal:!0,isLoading:d,isDrained:y,isPrevDrained:j,onLoad:this.load,placeholder:Object(V.b)(g.a,{className:"CommentItemV2",small:!0}),getContainer:function(e){return e}},I))):Object(V.b)("div",{className:"CommentsV2"},Object(V.b)(T.a,{isConversation:!0,onNavBack:c}),Object(V.b)(g.b,{className:"CommentListV2",onRef:function(t){e.listEl=t},isLocal:!0,isLoading:d,isDrained:y,isPrevDrained:j,onLoad:this.load,placeholder:Object(V.b)(g.a,{className:"CommentItemV2",small:!0}),getContainer:function(e){return e}},I))}}]),n}(l.Component),K.propTypes={conversationId:p.a.oneOfType([p.a.number,p.a.string]),type:p.a.string,parent:p.a.object.isRequired,commentNeedsReview:p.a.bool},K.contextTypes={currentUser:p.a.object,authRequired:p.a.func.isRequired},G=Q))||G;var se=n(66);function ce(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(m.a)(e);if(t){var r=Object(m.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(c.a)(this,n)}}var me=function(e){Object(s.a)(n,e);var t=ce(n);function n(){var e;Object(a.a)(this,n);for(var o=arguments.length,r=new Array(o),i=0;i<o;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).state={openedCommentId:e.props.byComment,isAnchorComments:Boolean(e.props.byComment),status:"open",order:"normal"},e.commentsContainerRef=Object(l.createRef)(),e.showConversation=function(t){var n=t.commentId,o=t.isAnchorComments;e.setState({openedCommentId:n,isAnchorComments:o})},e.showComments=function(){var t=e.props,n=t.byComment,o=t.router;n&&o.replace("".concat(location.pathname).concat(location.search)),e.setState({openedCommentId:null,isAnchorComments:!1})},e.delete=function(t){var n=e.props,o=n.parent;return(0,n.deleteComment)(t,o.type,o.id)},e.feature=function(t){var n=e.props,o=n.parent,r=n.updateCommentFeatureStatus,a=n.notificationId;r({id:e.state.openedCommentId,commentId:t,parentId:o.id,parentType:o.type,notificationId:a})},e.like=function(t,n){var o=e.props,r=o.onItemLike,a=o.updateCommentLikeStatus;r&&r(t,n),a(t)},e.collapse=function(t){var n=e.props,o=n.parent;(0,n.updateCommentCollapsed)(t,o.type,o.id)},e.dislike=function(t){(0,e.props.updateCommentDisliked)(t)},e.approve=function(t){var n=e.props,o=n.parent,r=n.type;(0,n.approveComment)(t,o.type||r,o.id)},e.reject=function(t){var n=e.props,o=n.parent,r=n.type;(0,n.rejectComment)(t,o.type||r,o.id)},e.handleStatusChange=function(t){e.setState({status:t})},e.handleOrderChange=function(t,n){var o=e.props.onOrderChange;o&&o(t,n),e.setState({order:t})},e}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var e=this.props.onMount;e&&e(this.commentsContainerRef.current)}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.containerClassName,a=e.parent,i=e.commentPattern,s=e.type,c=e.parent,m=(c=void 0===c?{}:c).commentPermission,l=c.relationship,u=void 0===l?{}:l,d=c.author,p=void 0===d?{}:d,f=e.needLoadCommentPermission,b=Object(r.a)(e,["className","containerClassName","parent","commentPattern","type","parent","needLoadCommentPermission"]),h=this.context.currentUser,C=void 0===u.isAuthor?h&&p.urlToken&&h.urlToken===p.urlToken:u.isAuthor,O="censor"===m&&!C,y="answer"===s||"article"===s,j=this.state,g=j.openedCommentId,R=j.isAnchorComments,P=j.status,k=j.order,I=g,N=Boolean(g&&"bottom"!==i);return Object(V.b)("div",{className:v()("Comments-container",n),ref:this.commentsContainerRef},Object(V.b)(X,Object(o.default)({className:v()(t,{"CommentsV2--hidden":N})},b,{type:s,order:k,status:P,parent:a,commentPattern:i,commentNeedsReview:O,canOperateItem:y,onShowConversation:this.showConversation,onItemLike:this.like,onItemFeature:this.feature,onItemDelete:this.delete,onItemCollapse:this.collapse,onItemDislike:this.dislike,onItemApprove:this.approve,onItemReject:this.reject,byComment:I,onStatusChange:this.handleStatusChange,onOrderChange:this.handleOrderChange,needLoadCommentPermission:f,isAuthor:C})),g&&Object(V.b)(ie,Object(o.default)({},b,{parent:a,type:s,canOperateItem:y,onItemLike:this.like,onItemFeature:this.feature,onItemDelete:this.delete,onItemCollapse:this.collapse,onItemDislike:this.dislike,onItemApprove:this.approve,onItemReject:this.reject,commentPattern:i,conversationId:g,onNavBack:this.showComments,byComment:I,isAnchorComments:R,commentNeedsReview:O,onShowConversation:this.showConversation})))}}]),n}(l.Component);me.propTypes={type:p.a.string.isRequired,parent:p.a.object.isRequired,onOrderChange:p.a.func,onItemLike:p.a.func,isAuthor:p.a.bool,onMount:p.a.func},me.defaultProps={type:"answer"},me.contextTypes={currentUser:p.a.object,authRequired:p.a.func.isRequired};t.default=Object(h.compose)(Object(se.a)(null),f.withRouter,Object(b.connect)(null,{updateCommentLikeStatus:O.p,updateCommentFeatureStatus:O.o,deleteComment:O.e,updateCommentCollapsed:O.m,updateCommentDisliked:O.n,approveComment:O.b,rejectComment:O.l}))(me)},1647:function(e,t,n){"use strict";n.r(t);var o=n(15),r=n(23),a=n(5),i=n(9),s=n(7),c=n(8),m=n(3),l=n(2),u=n.n(l),d=n(1),p=n.n(d),f=n(12),b=n(6),h=n.n(b),C=n(131),v=n(10),O=n(144),y=n.n(O),j=n(1299),g=n(87),R=n(65),P=n(1417),k=n(11),I=n(48),N=n(98),w=n(27),D=n(47),L=n(123),S=n(461),F=n(469),T=n(468),A=n(1416),B=n(460),x=n(1418),E=(n(1608),n(0));function V(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(m.a)(e);if(t){var r=Object(m.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(c.a)(this,n)}}function M(e,t){switch(e){case"answer":return Object(D.j)(t);case"article":return Object(L.b)(t);default:return null}}var q=function(e){Object(s.a)(n,e);var t=V(n);function n(){var e;Object(a.a)(this,n);for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];return(e=t.call.apply(t,[this].concat(i))).state={collapsed:!0,current:1},e.commentsWithPaginationElRef=p.a.createRef(),e.load=function(t,n,o){if(!e.props.isFetching&&!e.props.parent.adminClosedComment){var r=t||e.props,a=r.order,i=r.byComment,s=r.status,c=r.parent,m=c.id,l=c.type,u=r.dispatch,d=r.commentPattern;if(r.needLoadCommentPermission&&M(l,m)&&u(M(l,m)),o){u(Object(C.e)(l,m,{order:a,isPrevious:n,byComment:i,status:"collapsed",commentPattern:d},!0))}else u(Object(C.e)(l,m,{order:a,isPrevious:n,byComment:i,status:s,commentPattern:d}))}},e.addComment=function(t,n){var o=e.props,r=o.parent,a=r.id,i=r.type,s=o.dispatch,c=[i,a,t];return n&&(c[3]=n.id),s(C.a.apply(void 0,c))},e.featureItem=function(t){e.props.onItemFeature(t,e.lastFeaturedIndex)},e.handleOpenCollapsed=function(){e.setState({collapsed:!1}),e.load(e.props,!1,!0)},e.createOnRef=y()((function(t){return function(n){var o=e.props.byComment;t===Number(o)&&(e.targetCommentEl=n)}})),e.handlePageSelect=function(t){var n=e.props.onPaginationClick,o=e.state.current;n&&n(o,t),e.commentsElement.scrollIntoView(),e.setState({current:t}),e.loadByPagination(t)},e.loadByPagination=function(t,n){var o=n||e.props,r=o.order,a=o.byComment,i=o.status,s=o.parent,c=s.id,m=s.type,l=o.dispatch,u=o.commentPattern;o.needLoadCommentPermission&&M(m,c)&&l(M(m,c)),l(Object(C.e)(m,c,{order:r,isPrevious:!1,byComment:a,status:i,commentPattern:u,current:t}))},e.renderComment=function(t){var n=e.props,o=n.parent,r=o.type,a=o.author,i=(a=void 0===a?{isOrg:!1}:a).isOrg,s=n.isMobile,c=n.parent,m=n.commentNeedsReview,l=n.onShowConversation,u=n.status,d=n.onItemLike,p=n.onItemDelete,f=n.onItemCollapse,b=n.onItemDislike,h=n.onItemApprove,C=n.canOperateItem,v=n.commentPattern;return Object(E.b)(T.a,{key:t.id,isMobile:s,comment:t,onRef:e.createOnRef(t.id),status:u,type:r,parent:c,canOperate:C,commentNeedsReview:m,onShowConversation:l,ownerAuthorIsOrg:i,onLike:d,onReply:e.addComment,onFeature:e.featureItem,onDelete:p,onCollapse:f,onDislike:b,onApprove:h,commentPattern:v})},e.renderNormalComments=function(t){var n=e.state.collapsed,o=e.props.byComment,r=[];if(e.lastFeaturedIndex=0,t.length>0){var a=t[0].featured,i=!1;t.forEach((function(s,c){if(o||!s.collapsed){var m=t[c-1];if(!s.collapsed||(m&&m.collapsed||r.push(e.renderCollapsedDivider()),!n)){r.push(e.renderComment(s));var l=t[c+1];a&&!i&&s.featured&&(!l||!l.featured)&&(i=!0,e.lastFeaturedIndex=c,r.push(Object(E.b)("div",{className:"CommentList-divider",key:"divider-featured"},Object(E.b)("div",{className:"CommentList-dividerLine"}),Object(E.b)("div",{className:"CommentList-dividerText"},"以上为精选评论",Object(E.b)(j.a,{className:"CommentList-questionMark","data-tooltip":"精选评论包含回答作者推荐的评论和部分高赞评论",center:!0,size:16})))))}}}))}return r},e.renderCollapsedComments=function(){var t=[],n=e.props.collapsedComments;return e.state.collapsed||!n||n.length<=0?[]:(t.push(n.map((function(t){return e.renderComment(t)}))),t)},e.renderComments=function(t){return t.map(e.renderComment)},e.renderCollapsedDivider=function(){var t=e.props,n=t.isDrained,o=t.parent.collapsedCounts;return!n||o<=0?[]:e.state.collapsed?Object(E.b)("div",{className:"CommentList-action",key:"collapsed"},Object(E.b)("div",{className:"CommentList-expendCollapseButton"},Object(E.b)("span",{onClick:e.handleOpenCollapsed},Object(I.formatNumber)(o)," 条评论被折叠"),"（",Object(E.b)("a",{href:"//www.zhihu.com/question/52029856/answer/128623557",target:"_blank",rel:"noopener noreferrer"},"为什么？"),"）")):Object(E.b)("div",{className:"CommentList-divider",key:"divider-collapsed"},Object(E.b)("div",{className:"CommentList-dividerLine"}),Object(E.b)("div",{className:"CommentList-dividerText"},Object(I.formatNumber)(o)," 条评论被折叠（",Object(E.b)("a",{href:"//www.zhihu.com/question/52029856/answer/128623557",target:"_blank",rel:"noopener noreferrer"},"为什么？"),"）"))},e.renderCollapsedInfiLoader=function(){var t=e.state.collapsed;if(t)return[];var n=e.props.collapsedInfo,o=(n=void 0===n?{}:n).isFetching,r=n.isPrevDrained,a=n.isDrained;return Object(E.b)(R.b,{className:"CommentList",onRef:function(t){e.listEl=t},isLocal:!0,isLoading:o,isPrevDrained:r,isDrained:a,onLoad:function(n){return e.load(e.props,n,!t)},placeholder:Object(E.b)(R.a,{className:"CommentItem",small:!0})},e.renderCollapsedComments())},e.renderPatternContent=function(t){var n=e.props,o=n.isFetching,r=n.parent.adminClosedComment,a=n.byComment,i=n.status,s=n.order,c=n.totals,m=n.showPackupButton,l=n.handlePackupButton,u=Math.ceil(c/20),d=e.state.current;return r?null:o?Object(E.b)(A.a,null):Object(E.b)("div",{ref:e.commentsWithPaginationElRef},Object(E.b)("div",{className:"CommentList"},"normal"===s&&"open"===i?e.renderNormalComments(t):e.renderComments(t)),u>1&&Object(E.b)(P.a,{className:"comments-pagination",current:d,total:u,onSelect:e.handlePageSelect}),!a&&e.renderCollapsedDivider(),!a&&e.renderCollapsedInfiLoader(),m&&Object(E.b)(x.a,{onClick:l,commentsElRef:e.commentsWithPaginationElRef}))},e.renderModalContent=function(t){var n=e.props,r=n.collapsedInfo,a=n.parent.adminClosedComment,i=n.status,s=n.order,c=n.byComment,m=e.state.collapsed,l=m?e.props:r,u=l.isFetching,d=l.isDrained,p=l.isPrevDrained;if(d&&t.length<=0||a)return Object(E.b)("div",{className:"Comments-empty"},Object(E.b)(S.d,null,Object(E.b)(S.a,null),Object(E.b)("div",null,"还没有评论")));var f={getContainer:function(e){return e}};return Object(E.b)(R.b,Object(o.default)({className:"CommentList",onRef:function(t){e.listEl=t},isLocal:!0,isLoading:u,isPrevDrained:p,isDrained:d,onLoad:function(t){return e.load(e.props,t,!m)},placeholder:Object(E.b)(R.a,{className:"CommentItem",small:!0})},f),"normal"===s&&"open"===i?e.renderNormalComments(t):e.renderComments(t),!c&&e.renderCollapsedDivider(),!c&&e.renderCollapsedComments())},e.renderCommentEdit=function(t){var n=e.props,r=n.parent,a=r.canComment,i=(a=void 0===a?{status:!0}:a).status,s=a.reason,c=r.author,m=(c=void 0===c?{isOrg:!1}:c).isOrg,l=r.type,u=r.id,d=r.adminClosedComment,p=r.questionType,f=n.byComment,b=n.autoFocus,C=n.commentNeedsReview,O=d?"当前内容暂时无法评论":s,y=b&&!f;return i&&!d?Object(E.b)(F.a,Object(o.default)({className:"Comments-".concat("top"===t?"top":"footer"),type:l,id:u,commentNeedsReview:C,onSubmit:e.addComment,autoFocus:y,ownerAuthorIsOrg:m,ownerAuthorIsBrand:"commercial"===p},"top"===t&&{preset:"default",onClick:function(e){v.a.trackEvent(e.target,{id:3905})}})):"top"!==t&&Object(E.b)("div",{className:h()("Comments-disabledText",{"Comments-disabledText--fixed":void 0})},Object(E.b)("div",{className:"Comments-disabledReason"},O))},e.renderBottomButton=function(){var t=e.props.params,n=t.id,o=t.answerId,r=Boolean(o);return Object(E.b)("div",{className:"Comments-footer CommentEditor--normal"},Object(E.b)(k.c,{className:"CommentEditor-startCommentButton",preset:"primary",color:"blue",onClick:function(){return Object(g.b)(Object(N.a)(r?{type:"answer",id:o}:{type:"question",id:n},{utm_content:"comment_area"}),{zaProps:{id:3906}})}},"打开 App 参与站内讨论"))},e}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var e=this.props,t=e.byComment,n=e.commentPattern,o=e.parent.adminClosedComment,r=this.state.current;t&&this.scrollToTarget(),"bottom"!==n||o||this.loadByPagination(r)}},{key:"componentWillReceiveProps",value:function(e){var t=this.props,n=t.order,o=t.status,r=t.targetComment,a=t.commentPattern;n===e.order&&o===e.status||("bottom"===a?(this.setState({current:1}),this.loadByPagination(1,e)):this.load(e),this.setState({collapsed:!0}));var i=e.targetComment;!r&&i&&this.setState({collapsed:!i.collapsed})}},{key:"componentDidUpdate",value:function(e){!e.comments.length&&this.props.comments.length&&this.props.byComment&&this.scrollToTarget()}},{key:"componentWillUnmount",value:function(){this.props.dispatch(Object(w.d)(w.b))}},{key:"scrollToTarget",value:function(){var e=this.targetCommentEl,t=this.listEl;if(t&&e){var n=e.getBoundingClientRect(),o=n.top,r=n.height,a=t.getBoundingClientRect(),i=a.top,s=a.height;this.listEl.scrollTop+=o-i-(s-r)/2,e.classList.add("CommentItem--highlighted"),setTimeout((function(){return e.classList.remove("CommentItem--highlighted")}),2e3),e.tabIndex=-1,e.focus()}}},{key:"render",value:function(){var e=this,t=this.props,n=t.className,r=t.isAuthor,a=t.comments,i=t.commentPattern,s=t.commentInputPosition,c=t.parent,m=c.author,l=(m=void 0===m?{isOrg:!1}:m).isOrg,u=c.commentPermission,d=c.reviewingCounts,p=c.commentCount,f=c.adminClosedComment,b=t.totals,C=t.status,v=t.order,O=t.onStatusChange,y=t.onOrderChange,j=t.targetLink,g=a.filter((function(e){return!e.isDelete})),R="censor"===u&&r,P=R?{isCommentReviewer:R,onStatusChange:O,status:C,reviewingCounts:d}:{status:C},k=h()({Comments:!0,"Comments--withEditor":!0,"Comments-withPagination":"bottom"===i},n);return Object(E.b)("div",{className:k,ref:function(t){e.commentsElement=t}},Object(E.b)(B.a,Object(o.default)({commentCount:void 0!==p?p:b,commentClosed:f,targetLink:j,order:v,onOrderChange:y,commentPattern:i,isOrg:l,options:this.renderCommentEdit("top")},P)),"top"===s&&this.renderCommentEdit(),"bottom"===i?this.renderPatternContent(g):this.renderModalContent(g),"bottom"===s&&this.renderCommentEdit())}}]),n}(d.Component);q.propTypes={type:u.a.string,parent:u.a.object.isRequired,targetLink:u.a.node,commentNeedsReview:u.a.bool,byComment:u.a.oneOfType([u.a.number,u.a.string]),commentPattern:u.a.string,commentInputPosition:u.a.oneOf(["top","bottom"]),showPackupButton:u.a.bool,handlePackupButton:u.a.func,onPaginationClick:u.a.func,autoFocus:u.a.bool},q.contextTypes={authRequired:u.a.func.isRequired},q.defaultProps={commentInputPosition:"bottom",showPackupButton:!0,autoFocus:!0};var _=Object(f.connect)((function(e,t){var n=t.parent,o=t.parent,r=o.type,a=o.id,i=t.status,s=t.order,c=t.byComment,m=t.commentPattern,l=e.entities,u=e.comments,d="".concat(r,"_").concat(a),p=u.parent,f=u.pagination;"reviewing"===i&&(f=u.reviewing),"reverse"===s&&"open"===i&&(f=u.reverse);var b=[],h=u.collapsed[d]||{};h.ids&&h.ids.length>0&&(b=h.ids.map((function(e){return l.comments[e]})));var C=f[d]||{isPrevDrained:!1,isFetching:!1,isDrained:!1,ids:[]},v=C.isFetching,O=C.isPrevDrained,y=C.isDrained,j=C.ids,g=C.newIds,R=void 0===g?[]:g;return{isFetching:v,isPrevDrained:O,isDrained:y,totals:C.totals,comments:("bottom"!==m?j:R).map((function(e){return l.comments[e]})),collapsedInfo:h,collapsedComments:b,targetComment:l.comments[c],parent:Object.assign({},n,p[d])}}))(q),U=n(31),W=n(46);function z(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(m.a)(e);if(t){var r=Object(m.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(c.a)(this,n)}}var H=function(e){Object(s.a)(n,e);var t=z(n);function n(e,o){var r;return Object(a.a)(this,n),(r=t.call(this,e,o)).load=r.load.bind(Object(U.a)(r)),r.addComment=o.authRequired(r.addComment.bind(Object(U.a)(r)),void 0,w.b),r}return Object(i.a)(n,[{key:"componentDidMount",value:function(){this.load()}},{key:"load",value:function(){this.props.dispatch(Object(C.f)(this.props.commentId))}},{key:"addComment",value:function(e,t){var n=this.props,o=n.parent,r=o.type,a=o.id,i=n.commentId,s=n.dispatch,c=[r,a,e,t.id,i];return s(C.a.apply(void 0,c))}},{key:"render",value:function(){var e,t,n,o=this.props,r=o.onItemLike,a=o.onItemDelete,i=o.onItemFeature,s=o.onItemApprove,c=o.onItemCollapse,m=o.onItemDislike,l=o.onNavBack,u=o.canOperateItem,d=o.isFetching,p=o.comments,f=o.commentNeedsReview,b=o.openComment.collapsed,h=o.parent,C=o.parent.canComment,v=(C=void 0===C?{status:!0}:C).status,O=C.reason,y=o.commentPattern,j=o.commentId,g=this.context.currentUser;return Boolean(g&&p.find((function(e){return e.author&&e.author.member.urlToken===g.urlToken})))&&(t=(e=p.filter((function(e){return e.author&&e.author.member.urlToken!==g.urlToken})))[e.length-1]),d&&!p.length?n=Object(E.b)(R.a,{className:"CommentItem",small:!0}):p.length&&(n=p.map((function(e,t){return Object(E.b)(T.a,{key:t,isConversation:!0,commentNeedsReview:f,canOperate:u,parent:h,comment:e,onLike:r,onDelete:a,onFeature:i,onApprove:s,onCollapse:c,onDislike:m,collapsedShown:b})}))),"bottom"===y?Object(E.b)(W.b,{size:"fullPage",onClose:l},Object(E.b)("div",{className:"Comments"},Object(E.b)(B.a,{isConversation:!0,commentPattern:y}),Object(E.b)("div",{className:"CommentList"},n))):Object(E.b)("div",{className:"Comments"},Object(E.b)(B.a,{isConversation:!0,onNavBack:l}),Object(E.b)("div",{className:"CommentList"},n),t&&(v?Object(E.b)(F.a,{id:j,type:"conversation",className:"Comments-footer",replyTo:t,commentNeedsReview:f,onSubmit:this.addComment}):Object(E.b)("div",{className:"Comments-disabledText"},O)))}}]),n}(d.Component);H.propTypes={commentId:u.a.number.isRequired,type:u.a.string,parent:u.a.object.isRequired,commentNeedsReview:u.a.bool},H.contextTypes={currentUser:u.a.object,authRequired:u.a.func.isRequired};var J,G,K,Q=Object(f.connect)((function(e,t){var n=t.commentId,o=e.entities.comments,r=e.comments.conversation[n]||{isFetching:!1,isDrained:!1,ids:[]};return{isFetching:r.isFetching,isDrained:r.isDrained,comments:r.ids.map((function(e){return o[e]})),openComment:o[n]}}))(H),X=n(66);function Y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(m.a)(e);if(t){var r=Object(m.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(c.a)(this,n)}}var Z=Object(X.a)(null)((K=G=function(e){Object(s.a)(n,e);var t=Y(n);function n(e){var o;Object(a.a)(this,n),(o=t.call(this,e)).state={openedCommentId:null,status:"open",order:"normal"},o.like=function(e,t){var n=o.props,r=n.onItemLike,a=n.dispatch;r&&r(e,t),a(Object(C.j)(e))},o.collapse=function(e){var t=o.props,n=t.dispatch,r=t.parent;n(Object(C.g)(e,r.type,r.id))},o.dislike=function(e){return o.props.dispatch(Object(C.h)(e))},o.approve=function(e){var t=o.props,n=t.dispatch,r=t.parent,a=t.type;n(Object(C.b)(e,r.type||a,r.id))},o.handleStatusChange=function(e){o.setState({status:e})},o.handleOrderChange=function(e,t){o.props.onOrderChange&&o.props.onOrderChange(e,t),o.setState({order:e})};var r=e.parent,i=e.dispatch;return o.feature=function(e,t){return i(Object(C.i)(e,r.id,r.type,t))},o.delete=function(e){return i(Object(C.d)(e,r.type,r.id))},o.showConversation=function(e){return o.setState({openedCommentId:e})},o.showComments=function(){return o.setState({openedCommentId:null})},o}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var e=this.props.onMount;e&&e(this.domNode)}},{key:"render",value:function(){var e=this,t=this.props,n=t.className,a=t.containerClassName,i=t.parent,s=t.commentPattern,c=t.type,m=t.parent,l=(m=void 0===m?{}:m).commentPermission,u=m.relationship,d=void 0===u?{}:u,p=m.author,f=void 0===p?{}:p,b=t.needLoadCommentPermission,C=Object(r.a)(t,["className","containerClassName","parent","commentPattern","type","parent","needLoadCommentPermission"]),v=this.context.currentUser,O=void 0===d.isAuthor?v&&f.urlToken&&v.urlToken===f.urlToken:d.isAuthor,y="censor"===l&&!O,j="answer"===c||"article"===c,g=this.state,R=g.openedCommentId,P=g.status,k=g.order,I={commentNeedsReview:y,parent:i,type:c,canOperateItem:j,onShowConversation:this.showConversation,onItemLike:this.like,onItemFeature:this.feature,onItemDelete:this.delete,onItemCollapse:this.collapse,onItemDislike:this.dislike,onItemApprove:this.approve};return Object(E.b)("div",{className:h()("Comments-container",a),ref:function(t){return e.domNode=t}},Object(E.b)(_,Object(o.default)({},C,I,{commentPattern:s,className:h()(n,{"Comments--hidden":R&&"bottom"!==s}),order:k,status:P,onStatusChange:this.handleStatusChange,onOrderChange:this.handleOrderChange,needLoadCommentPermission:b,isAuthor:O})),R&&Object(E.b)(Q,Object(o.default)({},C,I,{commentPattern:s,commentId:R,onNavBack:this.showComments})))}}]),n}(d.Component),G.propTypes={type:u.a.string.isRequired,parent:u.a.object.isRequired,onOrderChange:u.a.func,onItemLike:u.a.func,isAuthor:u.a.bool,onMount:u.a.func},G.defaultProps={type:"answer"},G.contextTypes={currentUser:u.a.object,authRequired:u.a.func.isRequired},J=K))||J;t.default=Object(f.connect)()(Z)}}]);
//# sourceMappingURL=column.comments-modals.3d77931ab52ff3393e1c.js.map