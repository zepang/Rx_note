epx=window.epx||{};epx.uhf=window.epx.uhf||{};epx.uhf.meControl=function(){var init=function(ssoProperties){function CustomEvent(){typeof window.MscomCustomEvent!="undefined"&&window.MscomCustomEvent.apply(this,arguments)}function GetSearchQuery(searchVal){var searchVal=FormatString(searchVal);return cleanedQuery=CleanSearchQuery(searchVal),searchVal}function FormatString(inValue){var newStr;if(typeof inValue=="undefined")return"";else newStr=typeof inValue=="string"?inValue.toLowerCase().trim():inValue.toString().toLowerCase().trim();return newStr.replace(/"/g,"'")}function CleanSearchQuery(searchVal){var cleanedQuery;return cleanedQuery=searchVal.replace(/(<([^>]+)>)/ig,""),cleanedQuery=searchVal.replace(/"/g,"'"),searchVal.replace(/&/g,"+")}var APPLICATION_ID=1,SCOPE_ID=9,MAX_RESULTS=8,MIN_TERM_LENGTH=4,getSuggestUrl=function(text){return"https://services.social.microsoft.com/Search/Data/Terms?"+$.param({t:text,a:APPLICATION_ID,s:SCOPE_ID,m:MAX_RESULTS,mtl:MIN_TERM_LENGTH})},convertMatchToSuggestion=function(match){return{title:match}},getSuggestions=function(data){return!data||!data.Matches?[]:data.Matches.map(convertMatchToSuggestion)},shell=window.msCommonShell,extensibleLinks=[],userData,meControlOptions,wedcsTags,shellOptions;!ssoProperties.createViewProfileText||ssoProperties.signedIn&&extensibleLinks.push({string:ssoProperties.createViewProfileText,onClick:function(){window.location.href=ssoProperties.createViewProfileLink}});ssoProperties.aadEnabled?(userData={idp:!ssoProperties.idp?shell.SupportedAuthIdp.AAD:ssoProperties.idp,authenticatedState:ssoProperties.signedIn?shell.AuthState.SignedIn:shell.AuthState.NotSignedIn},ssoProperties.signedIn&&(ssoProperties.AadMemberName&&ssoProperties.AadMemberName!==":AadMemberName:"?userData.memberName=ssoProperties.AadMemberName:(userData.memberName="",ssoProperties.userHasProfile&&(userData.memberName=ssoProperties.profileText)),ssoProperties.AadDisplayName&&ssoProperties.AadDisplayName!==":AadDisplayName:"?userData.displayName=ssoProperties.AadDisplayName:(userData.displayName="",ssoProperties.userHasProfile&&(userData.displayName=ssoProperties.profileText))),meControlOptions={rpData:{msaInfo:{isSupported:!1,signInUrl:ssoProperties.signInOutUrl,signOutUrl:ssoProperties.signInOutUrl},aadInfo:{isSupported:!0,signInUrl:ssoProperties.signInOutUrl,signOutUrl:ssoProperties.signInOutUrl},preferredIdp:userData.idp},extensibleLinks:extensibleLinks,userData:userData}):(userData={idp:!ssoProperties.idp?shell.SupportedAuthIdp.MSA:ssoProperties.idp,authenticatedState:ssoProperties.signedIn?shell.AuthState.SignedIn:shell.AuthState.NotSignedIn},ssoProperties.signedIn&&(ssoProperties.memberName!==""&&ssoProperties.memberName!==":MsaMemberName:"?(userData.memberName=ssoProperties.MsaMemberName,userData.firstName=ssoProperties.MsaFirstName,userData.lastName=ssoProperties.MsaLastName,userData.cid=ssoProperties.MsaCID):(userData.memberName=" ",userData.firstName="",ssoProperties.userHasProfile&&(userData.firstName=ssoProperties.profileText),userData.cid="ClientId")),meControlOptions={rpData:{msaInfo:{isSupported:!0,signInUrl:ssoProperties.signInOutUrl,signOutUrl:ssoProperties.signInOutUrl},aadInfo:{isSupported:!1,signInUrl:ssoProperties.signInOutUrl,signOutUrl:ssoProperties.signInOutUrl},preferredIdp:userData.idp},extensibleLinks:extensibleLinks,userData:userData});wedcsTags={ContentName:"wcs.cn",TargetUri:"wcs.ct",AreaName:"ms.pgarea",ComponentName:"ms.cmpnm",EventCategory:"wcs.cot",SearchQuery:"ms.searchquery"};shellOptions={events:{onEventLog:function(eventId,dataPoints){eventId.indexOf("MeControl_")>=0&&dataPoints.type&&dataPoints.type=="bici"&&eventId.indexOf("Ready")<0&&CustomEvent(wedcsTags.ContentName,eventId,wedcsTags.TargetUri,dataPoints.destUri,wedcsTags.AreaName,"header",wedcsTags.ComponentName,"MeControl")},onSearch:function(searchForm){var destUri=searchForm.action+"?"+$(searchForm).serialize(),actionName="Search",searchQuery=GetSearchQuery($(searchForm).serialize());CustomEvent(wedcsTags.EventCategory,"4",wedcsTags.ContentName,actionName,wedcsTags.TargetUri,destUri,wedcsTags.AreaName,"header",wedcsTags.SearchQuery,searchQuery)}},searchSuggestCallback:function(query){var text,url,success;if(!query){console.debug("Invalid parameter query passed to search suggestion callback");return}text=query.text;text&&text.length>=MIN_TERM_LENGTH?(url=getSuggestUrl(text),success=function(data){if(data){var suggestions=getSuggestions(data),responseOptions={suggestions:suggestions};query.response(responseOptions)}},$.ajax({url:url,type:"GET",dataType:"jsonp",success:success})):query.response({suggestions:[]})},meControlOptions:meControlOptions};shell.load(shellOptions)};return{init:init}}();