<!DOCTYPE html>
<!-- saved from url=(0043)https://segmentfault.com/a/1190000024453209 -->
<html lang="zh-Hans" class="fontawesome-i2svg-active fontawesome-i2svg-complete"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
            <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
                <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta content="IE=edge, chrome=1" http-equiv="X-UA-Compatible">
    <meta content="webkit" name="renderer">
    <meta content="15317273575564615446375" property="qc:admins">
    <meta content="LkzCRJ7rPEUwt6fVey2vhxiw1vQ" name="alexaVerifyID">
    <meta content="app-id=958101793, app-argument=" name="apple-itunes-app">
                <title>(...) 手把手，搭建前端自动化部署CI / CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否</title>
    
            <meta name="description" content="​ 这个如火如荼的大前端时代，vue、react、angular 、flutter、electron、小程序等技术框架百家争鸣，这些都是我们前端拿来干架吃饭的武器，前端工程化体系也逐渐向小公司小团队普及，做为一个小小前端团队的leader，了解如何去搭建一个基础的前端工程化体系服务环境，来帮助小团队的提高开发体验和提升工作效率，还是有...">
    
            <meta name="keywords" content="前端工程化,自动部署,docker">
    
    <style type="text/css">svg:not(:root).svg-inline--fa {
  overflow: visible;
}

.svg-inline--fa {
  display: inline-block;
  font-size: inherit;
  height: 1em;
  overflow: visible;
  vertical-align: -0.125em;
}
.svg-inline--fa.fa-lg {
  vertical-align: -0.225em;
}
.svg-inline--fa.fa-w-1 {
  width: 0.0625em;
}
.svg-inline--fa.fa-w-2 {
  width: 0.125em;
}
.svg-inline--fa.fa-w-3 {
  width: 0.1875em;
}
.svg-inline--fa.fa-w-4 {
  width: 0.25em;
}
.svg-inline--fa.fa-w-5 {
  width: 0.3125em;
}
.svg-inline--fa.fa-w-6 {
  width: 0.375em;
}
.svg-inline--fa.fa-w-7 {
  width: 0.4375em;
}
.svg-inline--fa.fa-w-8 {
  width: 0.5em;
}
.svg-inline--fa.fa-w-9 {
  width: 0.5625em;
}
.svg-inline--fa.fa-w-10 {
  width: 0.625em;
}
.svg-inline--fa.fa-w-11 {
  width: 0.6875em;
}
.svg-inline--fa.fa-w-12 {
  width: 0.75em;
}
.svg-inline--fa.fa-w-13 {
  width: 0.8125em;
}
.svg-inline--fa.fa-w-14 {
  width: 0.875em;
}
.svg-inline--fa.fa-w-15 {
  width: 0.9375em;
}
.svg-inline--fa.fa-w-16 {
  width: 1em;
}
.svg-inline--fa.fa-w-17 {
  width: 1.0625em;
}
.svg-inline--fa.fa-w-18 {
  width: 1.125em;
}
.svg-inline--fa.fa-w-19 {
  width: 1.1875em;
}
.svg-inline--fa.fa-w-20 {
  width: 1.25em;
}
.svg-inline--fa.fa-pull-left {
  margin-right: 0.3em;
  width: auto;
}
.svg-inline--fa.fa-pull-right {
  margin-left: 0.3em;
  width: auto;
}
.svg-inline--fa.fa-border {
  height: 1.5em;
}
.svg-inline--fa.fa-li {
  width: 2em;
}
.svg-inline--fa.fa-fw {
  width: 1.25em;
}

.fa-layers svg.svg-inline--fa {
  bottom: 0;
  left: 0;
  margin: auto;
  position: absolute;
  right: 0;
  top: 0;
}

.fa-layers {
  display: inline-block;
  height: 1em;
  position: relative;
  text-align: center;
  vertical-align: -0.125em;
  width: 1em;
}
.fa-layers svg.svg-inline--fa {
  -webkit-transform-origin: center center;
          transform-origin: center center;
}

.fa-layers-counter, .fa-layers-text {
  display: inline-block;
  position: absolute;
  text-align: center;
}

.fa-layers-text {
  left: 50%;
  top: 50%;
  -webkit-transform: translate(-50%, -50%);
          transform: translate(-50%, -50%);
  -webkit-transform-origin: center center;
          transform-origin: center center;
}

.fa-layers-counter {
  background-color: #ff253a;
  border-radius: 1em;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  color: #fff;
  height: 1.5em;
  line-height: 1;
  max-width: 5em;
  min-width: 1.5em;
  overflow: hidden;
  padding: 0.25em;
  right: 0;
  text-overflow: ellipsis;
  top: 0;
  -webkit-transform: scale(0.25);
          transform: scale(0.25);
  -webkit-transform-origin: top right;
          transform-origin: top right;
}

.fa-layers-bottom-right {
  bottom: 0;
  right: 0;
  top: auto;
  -webkit-transform: scale(0.25);
          transform: scale(0.25);
  -webkit-transform-origin: bottom right;
          transform-origin: bottom right;
}

.fa-layers-bottom-left {
  bottom: 0;
  left: 0;
  right: auto;
  top: auto;
  -webkit-transform: scale(0.25);
          transform: scale(0.25);
  -webkit-transform-origin: bottom left;
          transform-origin: bottom left;
}

.fa-layers-top-right {
  right: 0;
  top: 0;
  -webkit-transform: scale(0.25);
          transform: scale(0.25);
  -webkit-transform-origin: top right;
          transform-origin: top right;
}

.fa-layers-top-left {
  left: 0;
  right: auto;
  top: 0;
  -webkit-transform: scale(0.25);
          transform: scale(0.25);
  -webkit-transform-origin: top left;
          transform-origin: top left;
}

.fa-lg {
  font-size: 1.3333333333em;
  line-height: 0.75em;
  vertical-align: -0.0667em;
}

.fa-xs {
  font-size: 0.75em;
}

.fa-sm {
  font-size: 0.875em;
}

.fa-1x {
  font-size: 1em;
}

.fa-2x {
  font-size: 2em;
}

.fa-3x {
  font-size: 3em;
}

.fa-4x {
  font-size: 4em;
}

.fa-5x {
  font-size: 5em;
}

.fa-6x {
  font-size: 6em;
}

.fa-7x {
  font-size: 7em;
}

.fa-8x {
  font-size: 8em;
}

.fa-9x {
  font-size: 9em;
}

.fa-10x {
  font-size: 10em;
}

.fa-fw {
  text-align: center;
  width: 1.25em;
}

.fa-ul {
  list-style-type: none;
  margin-left: 2.5em;
  padding-left: 0;
}
.fa-ul > li {
  position: relative;
}

.fa-li {
  left: -2em;
  position: absolute;
  text-align: center;
  width: 2em;
  line-height: inherit;
}

.fa-border {
  border: solid 0.08em #eee;
  border-radius: 0.1em;
  padding: 0.2em 0.25em 0.15em;
}

.fa-pull-left {
  float: left;
}

.fa-pull-right {
  float: right;
}

.fa.fa-pull-left,
.fas.fa-pull-left,
.far.fa-pull-left,
.fal.fa-pull-left,
.fab.fa-pull-left {
  margin-right: 0.3em;
}
.fa.fa-pull-right,
.fas.fa-pull-right,
.far.fa-pull-right,
.fal.fa-pull-right,
.fab.fa-pull-right {
  margin-left: 0.3em;
}

.fa-spin {
  -webkit-animation: fa-spin 2s infinite linear;
          animation: fa-spin 2s infinite linear;
}

.fa-pulse {
  -webkit-animation: fa-spin 1s infinite steps(8);
          animation: fa-spin 1s infinite steps(8);
}

@-webkit-keyframes fa-spin {
  0% {
    -webkit-transform: rotate(0deg);
            transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(360deg);
            transform: rotate(360deg);
  }
}

@keyframes fa-spin {
  0% {
    -webkit-transform: rotate(0deg);
            transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(360deg);
            transform: rotate(360deg);
  }
}
.fa-rotate-90 {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=1)";
  -webkit-transform: rotate(90deg);
          transform: rotate(90deg);
}

.fa-rotate-180 {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2)";
  -webkit-transform: rotate(180deg);
          transform: rotate(180deg);
}

.fa-rotate-270 {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=3)";
  -webkit-transform: rotate(270deg);
          transform: rotate(270deg);
}

.fa-flip-horizontal {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=0, mirror=1)";
  -webkit-transform: scale(-1, 1);
          transform: scale(-1, 1);
}

.fa-flip-vertical {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)";
  -webkit-transform: scale(1, -1);
          transform: scale(1, -1);
}

.fa-flip-both, .fa-flip-horizontal.fa-flip-vertical {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)";
  -webkit-transform: scale(-1, -1);
          transform: scale(-1, -1);
}

:root .fa-rotate-90,
:root .fa-rotate-180,
:root .fa-rotate-270,
:root .fa-flip-horizontal,
:root .fa-flip-vertical,
:root .fa-flip-both {
  -webkit-filter: none;
          filter: none;
}

.fa-stack {
  display: inline-block;
  height: 2em;
  position: relative;
  width: 2.5em;
}

.fa-stack-1x,
.fa-stack-2x {
  bottom: 0;
  left: 0;
  margin: auto;
  position: absolute;
  right: 0;
  top: 0;
}

.svg-inline--fa.fa-stack-1x {
  height: 1em;
  width: 1.25em;
}
.svg-inline--fa.fa-stack-2x {
  height: 2em;
  width: 2.5em;
}

.fa-inverse {
  color: #fff;
}

.sr-only {
  border: 0;
  clip: rect(0, 0, 0, 0);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

.sr-only-focusable:active, .sr-only-focusable:focus {
  clip: auto;
  height: auto;
  margin: 0;
  overflow: visible;
  position: static;
  width: auto;
}

.svg-inline--fa .fa-primary {
  fill: var(--fa-primary-color, currentColor);
  opacity: 1;
  opacity: var(--fa-primary-opacity, 1);
}

.svg-inline--fa .fa-secondary {
  fill: var(--fa-secondary-color, currentColor);
  opacity: 0.4;
  opacity: var(--fa-secondary-opacity, 0.4);
}

.svg-inline--fa.fa-swap-opacity .fa-primary {
  opacity: 0.4;
  opacity: var(--fa-secondary-opacity, 0.4);
}

.svg-inline--fa.fa-swap-opacity .fa-secondary {
  opacity: 1;
  opacity: var(--fa-primary-opacity, 1);
}

.svg-inline--fa mask .fa-primary,
.svg-inline--fa mask .fa-secondary {
  fill: black;
}

.fad.fa-inverse {
  color: #fff;
}</style><link href="https://segmentfault.com/opensearch.xml" rel="search" title="SegmentFault" type="application/opensearchdescription+xml">
    <link rel="shortcut icon" href="https://assets.segmentfault.com/v-5fdaf840/global/img/favicon.ico">
    <link rel="apple-touch-icon" href="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/touch-icon.png">

    <meta content="#00965e" name="msapplication-TileColor">
    <meta name="msapplication-square150x150logo" content="https://assets.segmentfault.com/v-5fdaf840/global/img/static/touch-icon.png">
    <meta content="bcf7fd80dca60d53d46d5b46e1b990ca" name="baidu_union_verify">

        <meta name="sogou_site_verification" content="MKVKCoIjwL">
    <meta name="360-site-verification" content="737314c9bf48873a1a0a22295203d9d1">
    <meta name="msvalidate.01" content="2C018C53297C8388F3E7052F5E9CA6AF">

            <meta name="userId" value="1030000008487499" id="SFUserId">
        <meta name="userRank" value="32" id="SFUserRank">
            <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://segmentfault.com/img/remote/1460000024453212">
    <meta name="twitter:site" content="@segment_fault">
    <meta name="twitter:creator" content="@segmentfault">
    <meta name="twitter:title" content="手把手，搭建前端自动化部署CI / CD 服务 + npm私有库 + 数据 mock 服务">
        <meta name="og:type" content="article">
    <meta name="og:image" content="https://segmentfault.com/img/remote/1460000024453212">
    <meta name="og:title" content="手把手，搭建前端自动化部署CI / CD 服务 + npm私有库 + 数据 mock 服务">
    <link href="https://segmentfault.com/feeds/questions" rel="alternate" title="SegmentFault 最新问题" type="application/atom+xml">
    <link href="https://segmentfault.com/feeds/blogs" rel="alternate" title="SegmentFault 最新文章" type="application/atom+xml">
    
    
    
    
    
            <link rel="stylesheet" href="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/global.css">
        <link rel="stylesheet" href="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/vendors.css">
    
            <link rel="stylesheet" href="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/detail.css">
    
    
    <script src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/osd.js.下载"></script><script src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/f(4).txt"></script><script src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/f(5).txt" id="google_shimpl"></script><script async="" defer="" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/f(6).txt"></script><script async="" defer="" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/fl.js.下载"></script><script async="" defer="" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/spc.php"></script><script type="text/javascript" async="" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/analytics.js.下载"></script><script src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/hm.js.下载"></script><script async="" defer="" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/spcjs.php"></script><script>
var _oa = [], OA_google = true;

function OA_script(src, cb) {
    var s = document.createElement('script'), m = document.getElementsByTagName('script')[0];
    
    if (cb) {
        s.onload = cb;
    }
    
    s.async = 1;
    s.defer = 1;
    s.src = src;
    m.parentNode.insertBefore(s, m);
}

function OA_show(name) {
    _oa.push(name);
    document.write('<div id="OA_holder_' + name + '"></div>');
}

OA_script('https://sponsor.segmentfault.com/spcjs.php?id=1&block=1&repu=32&tag=前端工程化,自动部署,docker&v=5fd9cb14');
</script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
                    <script async="" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/js"></script>
            <script>
          window.dataLayer = window.dataLayer || [];

          function gtag() {
            dataLayer.push(arguments);
          }

          gtag('js', new Date());
          gtag('config', 'UA-918487-8');
                    gtag('set', {'user_id': '1030000008487499'}); // 使用已登录用户 ID 来设置 user_id
                  </script>
    <script src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/katexCssLoader.js.下载"></script><style type="text/css">
/* stylelint-disable font-family-no-missing-generic-family-keyword */
@font-face {
  font-family: 'KaTeX_AMS';
  src: url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_AMS-Regular.woff2) format('woff2'), url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_AMS-Regular.woff) format('woff'), url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_AMS-Regular.ttf) format('truetype');
  font-weight: normal;
  font-style: normal;
}
@font-face {
  font-family: 'KaTeX_Caligraphic';
  src: url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Caligraphic-Bold.woff2) format('woff2'), url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Caligraphic-Bold.woff) format('woff'), url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Caligraphic-Bold.ttf) format('truetype');
  font-weight: bold;
  font-style: normal;
}
@font-face {
  font-family: 'KaTeX_Caligraphic';
  src: url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Caligraphic-Regular.woff2) format('woff2'), url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Caligraphic-Regular.woff) format('woff'), url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Caligraphic-Regular.ttf) format('truetype');
  font-weight: normal;
  font-style: normal;
}
@font-face {
  font-family: 'KaTeX_Fraktur';
  src: url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Fraktur-Bold.woff2) format('woff2'), url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Fraktur-Bold.woff) format('woff'), url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Fraktur-Bold.ttf) format('truetype');
  font-weight: bold;
  font-style: normal;
}
@font-face {
  font-family: 'KaTeX_Fraktur';
  src: url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Fraktur-Regular.woff2) format('woff2'), url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Fraktur-Regular.woff) format('woff'), url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Fraktur-Regular.ttf) format('truetype');
  font-weight: normal;
  font-style: normal;
}
@font-face {
  font-family: 'KaTeX_Main';
  src: url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Main-Bold.woff2) format('woff2'), url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Main-Bold.woff) format('woff'), url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Main-Bold.ttf) format('truetype');
  font-weight: bold;
  font-style: normal;
}
@font-face {
  font-family: 'KaTeX_Main';
  src: url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Main-BoldItalic.woff2) format('woff2'), url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Main-BoldItalic.woff) format('woff'), url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Main-BoldItalic.ttf) format('truetype');
  font-weight: bold;
  font-style: italic;
}
@font-face {
  font-family: 'KaTeX_Main';
  src: url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Main-Italic.woff2) format('woff2'), url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Main-Italic.woff) format('woff'), url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Main-Italic.ttf) format('truetype');
  font-weight: normal;
  font-style: italic;
}
@font-face {
  font-family: 'KaTeX_Main';
  src: url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Main-Regular.woff2) format('woff2'), url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Main-Regular.woff) format('woff'), url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Main-Regular.ttf) format('truetype');
  font-weight: normal;
  font-style: normal;
}
@font-face {
  font-family: 'KaTeX_Math';
  src: url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Math-BoldItalic.woff2) format('woff2'), url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Math-BoldItalic.woff) format('woff'), url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Math-BoldItalic.ttf) format('truetype');
  font-weight: bold;
  font-style: italic;
}
@font-face {
  font-family: 'KaTeX_Math';
  src: url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Math-Italic.woff2) format('woff2'), url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Math-Italic.woff) format('woff'), url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Math-Italic.ttf) format('truetype');
  font-weight: normal;
  font-style: italic;
}
@font-face {
  font-family: 'KaTeX_SansSerif';
  src: url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_SansSerif-Bold.woff2) format('woff2'), url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_SansSerif-Bold.woff) format('woff'), url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_SansSerif-Bold.ttf) format('truetype');
  font-weight: bold;
  font-style: normal;
}
@font-face {
  font-family: 'KaTeX_SansSerif';
  src: url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_SansSerif-Italic.woff2) format('woff2'), url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_SansSerif-Italic.woff) format('woff'), url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_SansSerif-Italic.ttf) format('truetype');
  font-weight: normal;
  font-style: italic;
}
@font-face {
  font-family: 'KaTeX_SansSerif';
  src: url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_SansSerif-Regular.woff2) format('woff2'), url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_SansSerif-Regular.woff) format('woff'), url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_SansSerif-Regular.ttf) format('truetype');
  font-weight: normal;
  font-style: normal;
}
@font-face {
  font-family: 'KaTeX_Script';
  src: url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Script-Regular.woff2) format('woff2'), url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Script-Regular.woff) format('woff'), url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Script-Regular.ttf) format('truetype');
  font-weight: normal;
  font-style: normal;
}
@font-face {
  font-family: 'KaTeX_Size1';
  src: url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Size1-Regular.woff2) format('woff2'), url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Size1-Regular.woff) format('woff'), url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Size1-Regular.ttf) format('truetype');
  font-weight: normal;
  font-style: normal;
}
@font-face {
  font-family: 'KaTeX_Size2';
  src: url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Size2-Regular.woff2) format('woff2'), url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Size2-Regular.woff) format('woff'), url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Size2-Regular.ttf) format('truetype');
  font-weight: normal;
  font-style: normal;
}
@font-face {
  font-family: 'KaTeX_Size3';
  src: url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Size3-Regular.woff2) format('woff2'), url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Size3-Regular.woff) format('woff'), url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Size3-Regular.ttf) format('truetype');
  font-weight: normal;
  font-style: normal;
}
@font-face {
  font-family: 'KaTeX_Size4';
  src: url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Size4-Regular.woff2) format('woff2'), url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Size4-Regular.woff) format('woff'), url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Size4-Regular.ttf) format('truetype');
  font-weight: normal;
  font-style: normal;
}
@font-face {
  font-family: 'KaTeX_Typewriter';
  src: url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Typewriter-Regular.woff2) format('woff2'), url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Typewriter-Regular.woff) format('woff'), url(https://assets.segmentfault.com/v-5fdaf840/global/fonts/katex/KaTeX_Typewriter-Regular.ttf) format('truetype');
  font-weight: normal;
  font-style: normal;
}
.katex {
  font: normal 1.21em KaTeX_Main, Times New Roman, serif;
  line-height: 1.2;
  text-indent: 0;
  text-rendering: auto;
  border-color: currentColor;
}
.katex * {
  -ms-high-contrast-adjust: none !important;
}
.katex .katex-version::after {
  content: "0.12.0";
}
.katex .katex-mathml {
  position: absolute;
  clip: rect(1px, 1px, 1px, 1px);
  padding: 0;
  border: 0;
  height: 1px;
  width: 1px;
  overflow: hidden;
}
.katex .katex-html {
  /* 
ewline is an empty block at top level, between .base elements */
}
.katex .katex-html > .newline {
  display: block;
}
.katex .base {
  position: relative;
  display: inline-block;
  white-space: nowrap;
  width: min-content;
}
.katex .strut {
  display: inline-block;
}
.katex .textbf {
  font-weight: bold;
}
.katex .textit {
  font-style: italic;
}
.katex .textrm {
  font-family: KaTeX_Main;
}
.katex .textsf {
  font-family: KaTeX_SansSerif;
}
.katex .texttt {
  font-family: KaTeX_Typewriter;
}
.katex .mathnormal {
  font-family: KaTeX_Math;
  font-style: italic;
}
.katex .mathit {
  font-family: KaTeX_Main;
  font-style: italic;
}
.katex .mathrm {
  font-style: normal;
}
.katex .mathbf {
  font-family: KaTeX_Main;
  font-weight: bold;
}
.katex .boldsymbol {
  font-family: KaTeX_Math;
  font-weight: bold;
  font-style: italic;
}
.katex .amsrm {
  font-family: KaTeX_AMS;
}
.katex .mathbb,
.katex .textbb {
  font-family: KaTeX_AMS;
}
.katex .mathcal {
  font-family: KaTeX_Caligraphic;
}
.katex .mathfrak,
.katex .textfrak {
  font-family: KaTeX_Fraktur;
}
.katex .mathtt {
  font-family: KaTeX_Typewriter;
}
.katex .mathscr,
.katex .textscr {
  font-family: KaTeX_Script;
}
.katex .mathsf,
.katex .textsf {
  font-family: KaTeX_SansSerif;
}
.katex .mathboldsf,
.katex .textboldsf {
  font-family: KaTeX_SansSerif;
  font-weight: bold;
}
.katex .mathitsf,
.katex .textitsf {
  font-family: KaTeX_SansSerif;
  font-style: italic;
}
.katex .mainrm {
  font-family: KaTeX_Main;
  font-style: normal;
}
.katex .vlist-t {
  display: inline-table;
  table-layout: fixed;
  border-collapse: collapse;
}
.katex .vlist-r {
  display: table-row;
}
.katex .vlist {
  display: table-cell;
  vertical-align: bottom;
  position: relative;
}
.katex .vlist > span {
  display: block;
  height: 0;
  position: relative;
}
.katex .vlist > span > span {
  display: inline-block;
}
.katex .vlist > span > .pstrut {
  overflow: hidden;
  width: 0;
}
.katex .vlist-t2 {
  margin-right: -2px;
}
.katex .vlist-s {
  display: table-cell;
  vertical-align: bottom;
  font-size: 1px;
  width: 2px;
  min-width: 2px;
}
.katex .vbox {
  display: -ms-inline-flexbox;
  display: inline-flex;
  -ms-flex-direction: column;
  flex-direction: column;
  align-items: baseline;
}
.katex .hbox {
  display: -ms-inline-flexbox;
  display: inline-flex;
  -ms-flex-direction: row;
  flex-direction: row;
  width: 100%;
}
.katex .thinbox {
  display: inline-flex;
  flex-direction: row;
  width: 0;
  max-width: 0;
}
.katex .msupsub {
  text-align: left;
}
.katex .mfrac > span > span {
  text-align: center;
}
.katex .mfrac .frac-line {
  display: inline-block;
  width: 100%;
  border-bottom-style: solid;
}
.katex .mfrac .frac-line,
.katex .overline .overline-line,
.katex .underline .underline-line,
.katex .hline,
.katex .hdashline,
.katex .rule {
  min-height: 1px;
}
.katex .mspace {
  display: inline-block;
}
.katex .llap,
.katex .rlap,
.katex .clap {
  width: 0;
  position: relative;
}
.katex .llap > .inner,
.katex .rlap > .inner,
.katex .clap > .inner {
  position: absolute;
}
.katex .llap > .fix,
.katex .rlap > .fix,
.katex .clap > .fix {
  display: inline-block;
}
.katex .llap > .inner {
  right: 0;
}
.katex .rlap > .inner,
.katex .clap > .inner {
  left: 0;
}
.katex .clap > .inner > span {
  margin-left: -50%;
  margin-right: 50%;
}
.katex .rule {
  display: inline-block;
  border: solid 0;
  position: relative;
}
.katex .overline .overline-line,
.katex .underline .underline-line,
.katex .hline {
  display: inline-block;
  width: 100%;
  border-bottom-style: solid;
}
.katex .hdashline {
  display: inline-block;
  width: 100%;
  border-bottom-style: dashed;
}
.katex .sqrt > .root {
  margin-left: 0.27777778em;
  margin-right: -0.55555556em;
}
.katex .sizing.reset-size1.size1,
.katex .fontsize-ensurer.reset-size1.size1 {
  font-size: 1em;
}
.katex .sizing.reset-size1.size2,
.katex .fontsize-ensurer.reset-size1.size2 {
  font-size: 1.2em;
}
.katex .sizing.reset-size1.size3,
.katex .fontsize-ensurer.reset-size1.size3 {
  font-size: 1.4em;
}
.katex .sizing.reset-size1.size4,
.katex .fontsize-ensurer.reset-size1.size4 {
  font-size: 1.6em;
}
.katex .sizing.reset-size1.size5,
.katex .fontsize-ensurer.reset-size1.size5 {
  font-size: 1.8em;
}
.katex .sizing.reset-size1.size6,
.katex .fontsize-ensurer.reset-size1.size6 {
  font-size: 2em;
}
.katex .sizing.reset-size1.size7,
.katex .fontsize-ensurer.reset-size1.size7 {
  font-size: 2.4em;
}
.katex .sizing.reset-size1.size8,
.katex .fontsize-ensurer.reset-size1.size8 {
  font-size: 2.88em;
}
.katex .sizing.reset-size1.size9,
.katex .fontsize-ensurer.reset-size1.size9 {
  font-size: 3.456em;
}
.katex .sizing.reset-size1.size10,
.katex .fontsize-ensurer.reset-size1.size10 {
  font-size: 4.148em;
}
.katex .sizing.reset-size1.size11,
.katex .fontsize-ensurer.reset-size1.size11 {
  font-size: 4.976em;
}
.katex .sizing.reset-size2.size1,
.katex .fontsize-ensurer.reset-size2.size1 {
  font-size: 0.83333333em;
}
.katex .sizing.reset-size2.size2,
.katex .fontsize-ensurer.reset-size2.size2 {
  font-size: 1em;
}
.katex .sizing.reset-size2.size3,
.katex .fontsize-ensurer.reset-size2.size3 {
  font-size: 1.16666667em;
}
.katex .sizing.reset-size2.size4,
.katex .fontsize-ensurer.reset-size2.size4 {
  font-size: 1.33333333em;
}
.katex .sizing.reset-size2.size5,
.katex .fontsize-ensurer.reset-size2.size5 {
  font-size: 1.5em;
}
.katex .sizing.reset-size2.size6,
.katex .fontsize-ensurer.reset-size2.size6 {
  font-size: 1.66666667em;
}
.katex .sizing.reset-size2.size7,
.katex .fontsize-ensurer.reset-size2.size7 {
  font-size: 2em;
}
.katex .sizing.reset-size2.size8,
.katex .fontsize-ensurer.reset-size2.size8 {
  font-size: 2.4em;
}
.katex .sizing.reset-size2.size9,
.katex .fontsize-ensurer.reset-size2.size9 {
  font-size: 2.88em;
}
.katex .sizing.reset-size2.size10,
.katex .fontsize-ensurer.reset-size2.size10 {
  font-size: 3.45666667em;
}
.katex .sizing.reset-size2.size11,
.katex .fontsize-ensurer.reset-size2.size11 {
  font-size: 4.14666667em;
}
.katex .sizing.reset-size3.size1,
.katex .fontsize-ensurer.reset-size3.size1 {
  font-size: 0.71428571em;
}
.katex .sizing.reset-size3.size2,
.katex .fontsize-ensurer.reset-size3.size2 {
  font-size: 0.85714286em;
}
.katex .sizing.reset-size3.size3,
.katex .fontsize-ensurer.reset-size3.size3 {
  font-size: 1em;
}
.katex .sizing.reset-size3.size4,
.katex .fontsize-ensurer.reset-size3.size4 {
  font-size: 1.14285714em;
}
.katex .sizing.reset-size3.size5,
.katex .fontsize-ensurer.reset-size3.size5 {
  font-size: 1.28571429em;
}
.katex .sizing.reset-size3.size6,
.katex .fontsize-ensurer.reset-size3.size6 {
  font-size: 1.42857143em;
}
.katex .sizing.reset-size3.size7,
.katex .fontsize-ensurer.reset-size3.size7 {
  font-size: 1.71428571em;
}
.katex .sizing.reset-size3.size8,
.katex .fontsize-ensurer.reset-size3.size8 {
  font-size: 2.05714286em;
}
.katex .sizing.reset-size3.size9,
.katex .fontsize-ensurer.reset-size3.size9 {
  font-size: 2.46857143em;
}
.katex .sizing.reset-size3.size10,
.katex .fontsize-ensurer.reset-size3.size10 {
  font-size: 2.96285714em;
}
.katex .sizing.reset-size3.size11,
.katex .fontsize-ensurer.reset-size3.size11 {
  font-size: 3.55428571em;
}
.katex .sizing.reset-size4.size1,
.katex .fontsize-ensurer.reset-size4.size1 {
  font-size: 0.625em;
}
.katex .sizing.reset-size4.size2,
.katex .fontsize-ensurer.reset-size4.size2 {
  font-size: 0.75em;
}
.katex .sizing.reset-size4.size3,
.katex .fontsize-ensurer.reset-size4.size3 {
  font-size: 0.875em;
}
.katex .sizing.reset-size4.size4,
.katex .fontsize-ensurer.reset-size4.size4 {
  font-size: 1em;
}
.katex .sizing.reset-size4.size5,
.katex .fontsize-ensurer.reset-size4.size5 {
  font-size: 1.125em;
}
.katex .sizing.reset-size4.size6,
.katex .fontsize-ensurer.reset-size4.size6 {
  font-size: 1.25em;
}
.katex .sizing.reset-size4.size7,
.katex .fontsize-ensurer.reset-size4.size7 {
  font-size: 1.5em;
}
.katex .sizing.reset-size4.size8,
.katex .fontsize-ensurer.reset-size4.size8 {
  font-size: 1.8em;
}
.katex .sizing.reset-size4.size9,
.katex .fontsize-ensurer.reset-size4.size9 {
  font-size: 2.16em;
}
.katex .sizing.reset-size4.size10,
.katex .fontsize-ensurer.reset-size4.size10 {
  font-size: 2.5925em;
}
.katex .sizing.reset-size4.size11,
.katex .fontsize-ensurer.reset-size4.size11 {
  font-size: 3.11em;
}
.katex .sizing.reset-size5.size1,
.katex .fontsize-ensurer.reset-size5.size1 {
  font-size: 0.55555556em;
}
.katex .sizing.reset-size5.size2,
.katex .fontsize-ensurer.reset-size5.size2 {
  font-size: 0.66666667em;
}
.katex .sizing.reset-size5.size3,
.katex .fontsize-ensurer.reset-size5.size3 {
  font-size: 0.77777778em;
}
.katex .sizing.reset-size5.size4,
.katex .fontsize-ensurer.reset-size5.size4 {
  font-size: 0.88888889em;
}
.katex .sizing.reset-size5.size5,
.katex .fontsize-ensurer.reset-size5.size5 {
  font-size: 1em;
}
.katex .sizing.reset-size5.size6,
.katex .fontsize-ensurer.reset-size5.size6 {
  font-size: 1.11111111em;
}
.katex .sizing.reset-size5.size7,
.katex .fontsize-ensurer.reset-size5.size7 {
  font-size: 1.33333333em;
}
.katex .sizing.reset-size5.size8,
.katex .fontsize-ensurer.reset-size5.size8 {
  font-size: 1.6em;
}
.katex .sizing.reset-size5.size9,
.katex .fontsize-ensurer.reset-size5.size9 {
  font-size: 1.92em;
}
.katex .sizing.reset-size5.size10,
.katex .fontsize-ensurer.reset-size5.size10 {
  font-size: 2.30444444em;
}
.katex .sizing.reset-size5.size11,
.katex .fontsize-ensurer.reset-size5.size11 {
  font-size: 2.76444444em;
}
.katex .sizing.reset-size6.size1,
.katex .fontsize-ensurer.reset-size6.size1 {
  font-size: 0.5em;
}
.katex .sizing.reset-size6.size2,
.katex .fontsize-ensurer.reset-size6.size2 {
  font-size: 0.6em;
}
.katex .sizing.reset-size6.size3,
.katex .fontsize-ensurer.reset-size6.size3 {
  font-size: 0.7em;
}
.katex .sizing.reset-size6.size4,
.katex .fontsize-ensurer.reset-size6.size4 {
  font-size: 0.8em;
}
.katex .sizing.reset-size6.size5,
.katex .fontsize-ensurer.reset-size6.size5 {
  font-size: 0.9em;
}
.katex .sizing.reset-size6.size6,
.katex .fontsize-ensurer.reset-size6.size6 {
  font-size: 1em;
}
.katex .sizing.reset-size6.size7,
.katex .fontsize-ensurer.reset-size6.size7 {
  font-size: 1.2em;
}
.katex .sizing.reset-size6.size8,
.katex .fontsize-ensurer.reset-size6.size8 {
  font-size: 1.44em;
}
.katex .sizing.reset-size6.size9,
.katex .fontsize-ensurer.reset-size6.size9 {
  font-size: 1.728em;
}
.katex .sizing.reset-size6.size10,
.katex .fontsize-ensurer.reset-size6.size10 {
  font-size: 2.074em;
}
.katex .sizing.reset-size6.size11,
.katex .fontsize-ensurer.reset-size6.size11 {
  font-size: 2.488em;
}
.katex .sizing.reset-size7.size1,
.katex .fontsize-ensurer.reset-size7.size1 {
  font-size: 0.41666667em;
}
.katex .sizing.reset-size7.size2,
.katex .fontsize-ensurer.reset-size7.size2 {
  font-size: 0.5em;
}
.katex .sizing.reset-size7.size3,
.katex .fontsize-ensurer.reset-size7.size3 {
  font-size: 0.58333333em;
}
.katex .sizing.reset-size7.size4,
.katex .fontsize-ensurer.reset-size7.size4 {
  font-size: 0.66666667em;
}
.katex .sizing.reset-size7.size5,
.katex .fontsize-ensurer.reset-size7.size5 {
  font-size: 0.75em;
}
.katex .sizing.reset-size7.size6,
.katex .fontsize-ensurer.reset-size7.size6 {
  font-size: 0.83333333em;
}
.katex .sizing.reset-size7.size7,
.katex .fontsize-ensurer.reset-size7.size7 {
  font-size: 1em;
}
.katex .sizing.reset-size7.size8,
.katex .fontsize-ensurer.reset-size7.size8 {
  font-size: 1.2em;
}
.katex .sizing.reset-size7.size9,
.katex .fontsize-ensurer.reset-size7.size9 {
  font-size: 1.44em;
}
.katex .sizing.reset-size7.size10,
.katex .fontsize-ensurer.reset-size7.size10 {
  font-size: 1.72833333em;
}
.katex .sizing.reset-size7.size11,
.katex .fontsize-ensurer.reset-size7.size11 {
  font-size: 2.07333333em;
}
.katex .sizing.reset-size8.size1,
.katex .fontsize-ensurer.reset-size8.size1 {
  font-size: 0.34722222em;
}
.katex .sizing.reset-size8.size2,
.katex .fontsize-ensurer.reset-size8.size2 {
  font-size: 0.41666667em;
}
.katex .sizing.reset-size8.size3,
.katex .fontsize-ensurer.reset-size8.size3 {
  font-size: 0.48611111em;
}
.katex .sizing.reset-size8.size4,
.katex .fontsize-ensurer.reset-size8.size4 {
  font-size: 0.55555556em;
}
.katex .sizing.reset-size8.size5,
.katex .fontsize-ensurer.reset-size8.size5 {
  font-size: 0.625em;
}
.katex .sizing.reset-size8.size6,
.katex .fontsize-ensurer.reset-size8.size6 {
  font-size: 0.69444444em;
}
.katex .sizing.reset-size8.size7,
.katex .fontsize-ensurer.reset-size8.size7 {
  font-size: 0.83333333em;
}
.katex .sizing.reset-size8.size8,
.katex .fontsize-ensurer.reset-size8.size8 {
  font-size: 1em;
}
.katex .sizing.reset-size8.size9,
.katex .fontsize-ensurer.reset-size8.size9 {
  font-size: 1.2em;
}
.katex .sizing.reset-size8.size10,
.katex .fontsize-ensurer.reset-size8.size10 {
  font-size: 1.44027778em;
}
.katex .sizing.reset-size8.size11,
.katex .fontsize-ensurer.reset-size8.size11 {
  font-size: 1.72777778em;
}
.katex .sizing.reset-size9.size1,
.katex .fontsize-ensurer.reset-size9.size1 {
  font-size: 0.28935185em;
}
.katex .sizing.reset-size9.size2,
.katex .fontsize-ensurer.reset-size9.size2 {
  font-size: 0.34722222em;
}
.katex .sizing.reset-size9.size3,
.katex .fontsize-ensurer.reset-size9.size3 {
  font-size: 0.40509259em;
}
.katex .sizing.reset-size9.size4,
.katex .fontsize-ensurer.reset-size9.size4 {
  font-size: 0.46296296em;
}
.katex .sizing.reset-size9.size5,
.katex .fontsize-ensurer.reset-size9.size5 {
  font-size: 0.52083333em;
}
.katex .sizing.reset-size9.size6,
.katex .fontsize-ensurer.reset-size9.size6 {
  font-size: 0.5787037em;
}
.katex .sizing.reset-size9.size7,
.katex .fontsize-ensurer.reset-size9.size7 {
  font-size: 0.69444444em;
}
.katex .sizing.reset-size9.size8,
.katex .fontsize-ensurer.reset-size9.size8 {
  font-size: 0.83333333em;
}
.katex .sizing.reset-size9.size9,
.katex .fontsize-ensurer.reset-size9.size9 {
  font-size: 1em;
}
.katex .sizing.reset-size9.size10,
.katex .fontsize-ensurer.reset-size9.size10 {
  font-size: 1.20023148em;
}
.katex .sizing.reset-size9.size11,
.katex .fontsize-ensurer.reset-size9.size11 {
  font-size: 1.43981481em;
}
.katex .sizing.reset-size10.size1,
.katex .fontsize-ensurer.reset-size10.size1 {
  font-size: 0.24108004em;
}
.katex .sizing.reset-size10.size2,
.katex .fontsize-ensurer.reset-size10.size2 {
  font-size: 0.28929605em;
}
.katex .sizing.reset-size10.size3,
.katex .fontsize-ensurer.reset-size10.size3 {
  font-size: 0.33751205em;
}
.katex .sizing.reset-size10.size4,
.katex .fontsize-ensurer.reset-size10.size4 {
  font-size: 0.38572806em;
}
.katex .sizing.reset-size10.size5,
.katex .fontsize-ensurer.reset-size10.size5 {
  font-size: 0.43394407em;
}
.katex .sizing.reset-size10.size6,
.katex .fontsize-ensurer.reset-size10.size6 {
  font-size: 0.48216008em;
}
.katex .sizing.reset-size10.size7,
.katex .fontsize-ensurer.reset-size10.size7 {
  font-size: 0.57859209em;
}
.katex .sizing.reset-size10.size8,
.katex .fontsize-ensurer.reset-size10.size8 {
  font-size: 0.69431051em;
}
.katex .sizing.reset-size10.size9,
.katex .fontsize-ensurer.reset-size10.size9 {
  font-size: 0.83317261em;
}
.katex .sizing.reset-size10.size10,
.katex .fontsize-ensurer.reset-size10.size10 {
  font-size: 1em;
}
.katex .sizing.reset-size10.size11,
.katex .fontsize-ensurer.reset-size10.size11 {
  font-size: 1.19961427em;
}
.katex .sizing.reset-size11.size1,
.katex .fontsize-ensurer.reset-size11.size1 {
  font-size: 0.20096463em;
}
.katex .sizing.reset-size11.size2,
.katex .fontsize-ensurer.reset-size11.size2 {
  font-size: 0.24115756em;
}
.katex .sizing.reset-size11.size3,
.katex .fontsize-ensurer.reset-size11.size3 {
  font-size: 0.28135048em;
}
.katex .sizing.reset-size11.size4,
.katex .fontsize-ensurer.reset-size11.size4 {
  font-size: 0.32154341em;
}
.katex .sizing.reset-size11.size5,
.katex .fontsize-ensurer.reset-size11.size5 {
  font-size: 0.36173633em;
}
.katex .sizing.reset-size11.size6,
.katex .fontsize-ensurer.reset-size11.size6 {
  font-size: 0.40192926em;
}
.katex .sizing.reset-size11.size7,
.katex .fontsize-ensurer.reset-size11.size7 {
  font-size: 0.48231511em;
}
.katex .sizing.reset-size11.size8,
.katex .fontsize-ensurer.reset-size11.size8 {
  font-size: 0.57877814em;
}
.katex .sizing.reset-size11.size9,
.katex .fontsize-ensurer.reset-size11.size9 {
  font-size: 0.69453376em;
}
.katex .sizing.reset-size11.size10,
.katex .fontsize-ensurer.reset-size11.size10 {
  font-size: 0.83360129em;
}
.katex .sizing.reset-size11.size11,
.katex .fontsize-ensurer.reset-size11.size11 {
  font-size: 1em;
}
.katex .delimsizing.size1 {
  font-family: KaTeX_Size1;
}
.katex .delimsizing.size2 {
  font-family: KaTeX_Size2;
}
.katex .delimsizing.size3 {
  font-family: KaTeX_Size3;
}
.katex .delimsizing.size4 {
  font-family: KaTeX_Size4;
}
.katex .delimsizing.mult .delim-size1 > span {
  font-family: KaTeX_Size1;
}
.katex .delimsizing.mult .delim-size4 > span {
  font-family: KaTeX_Size4;
}
.katex .nulldelimiter {
  display: inline-block;
  width: 0.12em;
}
.katex .delimcenter {
  position: relative;
}
.katex .op-symbol {
  position: relative;
}
.katex .op-symbol.small-op {
  font-family: KaTeX_Size1;
}
.katex .op-symbol.large-op {
  font-family: KaTeX_Size2;
}
.katex .op-limits > .vlist-t {
  text-align: center;
}
.katex .accent > .vlist-t {
  text-align: center;
}
.katex .accent .accent-body {
  position: relative;
}
.katex .accent .accent-body:not(.accent-full) {
  width: 0;
}
.katex .overlay {
  display: block;
}
.katex .mtable .vertical-separator {
  display: inline-block;
  min-width: 1px;
}
.katex .mtable .arraycolsep {
  display: inline-block;
}
.katex .mtable .col-align-c > .vlist-t {
  text-align: center;
}
.katex .mtable .col-align-l > .vlist-t {
  text-align: left;
}
.katex .mtable .col-align-r > .vlist-t {
  text-align: right;
}
.katex .svg-align {
  text-align: left;
}
.katex svg {
  display: block;
  position: absolute;
  width: 100%;
  height: inherit;
  fill: currentColor;
  stroke: currentColor;
  fill-rule: nonzero;
  fill-opacity: 1;
  stroke-width: 1;
  stroke-linecap: butt;
  stroke-linejoin: miter;
  stroke-miterlimit: 4;
  stroke-dasharray: none;
  stroke-dashoffset: 0;
  stroke-opacity: 1;
}
.katex svg path {
  stroke: none;
}
.katex img {
  border-style: none;
  min-width: 0;
  min-height: 0;
  max-width: none;
  max-height: none;
}
.katex .stretchy {
  width: 100%;
  display: block;
  position: relative;
  overflow: hidden;
}
.katex .stretchy::before,
.katex .stretchy::after {
  content: "";
}
.katex .hide-tail {
  width: 100%;
  position: relative;
  overflow: hidden;
}
.katex .halfarrow-left {
  position: absolute;
  left: 0;
  width: 50.2%;
  overflow: hidden;
}
.katex .halfarrow-right {
  position: absolute;
  right: 0;
  width: 50.2%;
  overflow: hidden;
}
.katex .brace-left {
  position: absolute;
  left: 0;
  width: 25.1%;
  overflow: hidden;
}
.katex .brace-center {
  position: absolute;
  left: 25%;
  width: 50%;
  overflow: hidden;
}
.katex .brace-right {
  position: absolute;
  right: 0;
  width: 25.1%;
  overflow: hidden;
}
.katex .x-arrow-pad {
  padding: 0 0.5em;
}
.katex .x-arrow,
.katex .mover,
.katex .munder {
  text-align: center;
}
.katex .boxpad {
  padding: 0 0.3em 0 0.3em;
}
.katex .fbox,
.katex .fcolorbox {
  box-sizing: border-box;
  border: 0.04em solid;
}
.katex .cancel-pad {
  padding: 0 0.2em 0 0.2em;
}
.katex .cancel-lap {
  margin-left: -0.2em;
  margin-right: -0.2em;
}
.katex .sout {
  border-bottom-style: solid;
  border-bottom-width: 0.08em;
}
.katex-display {
  display: block;
  margin: 1em 0;
  text-align: center;
}
.katex-display > .katex {
  display: block;
  text-align: center;
  white-space: nowrap;
}
.katex-display > .katex > .katex-html {
  display: block;
  position: relative;
}
.katex-display > .katex > .katex-html > .tag {
  position: absolute;
  right: 0;
}
.katex-display.leqno > .katex > .katex-html > .tag {
  left: 0;
  right: auto;
}
.katex-display.fleqn > .katex {
  text-align: left;
  padding-left: 2em;
}
</style><link rel="preload" href="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/f(7).txt" as="script"><script type="text/javascript" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/f(7).txt"></script><style>._3emE9--dark-theme .-S-tR--ff-downloader{background:rgba(30,30,30,.93);border:1px solid rgba(82,82,82,.54);box-shadow:0 4px 7px rgba(30,30,30,.55);color:#fff}._3emE9--dark-theme .-S-tR--ff-downloader ._6_Mtt--header ._2VdJW--minimize-btn{background:#3d4b52}._3emE9--dark-theme .-S-tR--ff-downloader ._6_Mtt--header ._2VdJW--minimize-btn:hover{background:#131415}._3emE9--dark-theme .-S-tR--ff-downloader ._10vpG--footer{background:rgba(30,30,30,.93)}._2mDEx--white-theme .-S-tR--ff-downloader{background:#fff;border:1px solid rgba(82,82,82,.54);box-shadow:0 4px 7px rgba(30,30,30,.55);color:#314c75}._2mDEx--white-theme .-S-tR--ff-downloader ._6_Mtt--header{font-weight:700}._2mDEx--white-theme .-S-tR--ff-downloader ._2dFLA--container ._2bWNS--notice{border:0;color:rgba(0,0,0,.88)}._2mDEx--white-theme .-S-tR--ff-downloader ._10vpG--footer{background:#fff}.-S-tR--ff-downloader{display:block;overflow:hidden;position:fixed;bottom:20px;right:7.1%;width:330px;height:180px;background:rgba(30,30,30,.93);border-radius:2px;color:#fff;z-index:99999999;border:1px solid rgba(82,82,82,.54);box-shadow:0 4px 7px rgba(30,30,30,.55);transition:.5s}.-S-tR--ff-downloader._3M7UQ--minimize{height:62px}.-S-tR--ff-downloader._3M7UQ--minimize .nxuu4--file-info,.-S-tR--ff-downloader._3M7UQ--minimize ._6_Mtt--header{display:none}.-S-tR--ff-downloader ._6_Mtt--header{padding:10px;font-size:17px;font-family:sans-serif}.-S-tR--ff-downloader ._6_Mtt--header ._2VdJW--minimize-btn{float:right;background:#f1ecec;height:20px;width:20px;text-align:center;padding:2px;margin-top:-10px;cursor:pointer}.-S-tR--ff-downloader ._6_Mtt--header ._2VdJW--minimize-btn:hover{background:#e2dede}.-S-tR--ff-downloader ._13XQ2--error{color:red;padding:10px;font-size:12px;line-height:19px}.-S-tR--ff-downloader ._2dFLA--container{position:relative;height:100%}.-S-tR--ff-downloader ._2dFLA--container .nxuu4--file-info{padding:6px 15px 0;font-family:sans-serif}.-S-tR--ff-downloader ._2dFLA--container .nxuu4--file-info div{margin-bottom:5px;width:100%;overflow:hidden}.-S-tR--ff-downloader ._2dFLA--container ._2bWNS--notice{margin-top:21px;font-size:11px}.-S-tR--ff-downloader ._10vpG--footer{width:100%;bottom:0;position:absolute;font-weight:700}.-S-tR--ff-downloader ._10vpG--footer ._2V73d--loader{-webkit-animation:n0BD1--rotation 3.5s linear forwards;animation:n0BD1--rotation 3.5s linear forwards;position:absolute;top:-120px;left:calc(50% - 35px);border-radius:50%;border:5px solid #fff;border-top-color:#a29bfe;height:70px;width:70px;display:flex;justify-content:center;align-items:center}.-S-tR--ff-downloader ._10vpG--footer ._24wjw--loading-bar{width:100%;height:18px;background:#dfe6e9;border-radius:5px}.-S-tR--ff-downloader ._10vpG--footer ._24wjw--loading-bar ._1FVu9--progress-bar{height:100%;background:#8bc34a;border-radius:5px}.-S-tR--ff-downloader ._10vpG--footer ._2KztS--status{margin-top:10px}.-S-tR--ff-downloader ._10vpG--footer ._2KztS--status ._1XilH--state{float:left;font-size:.9em;letter-spacing:1pt;text-transform:uppercase;width:100px;height:20px;position:relative}.-S-tR--ff-downloader ._10vpG--footer ._2KztS--status ._1jiaj--percentage{float:right}</style></head>
<body data-new-gr-c-s-check-loaded="14.990.0" data-gr-ext-installed=""><div class="custome-alert alert alert-warning topframe text-center my-0 sticky-top d-none rounded-0">
                <span class="alert-content"></span>
                <button type="button" class="close">
                    <span aria-hidden="true">×</span><span class="sr-only">Close</span>
                </button>
            </div>

    <img style="height: 0; width: 0; display: none" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/touch-icon.png">

<div class="d-none d-lg-block text-center" style="display: block;">
    <script type="text/javascript">
        OA_show(5);
    </script><div id="OA_holder_5"><div class="ad-close" style="position: relative;">
<style>#OA_holder_5 a { display: block; }</style><div style="background-color: #082017"><a href="https://sponsor.segmentfault.com/ck.php?oaparams=2__bannerid=441__zoneid=5__cb=e8d5f9711e__oadest=http%3A%2F%2Fsegmentfault.com%2Fa%2F1190000038597979" target="_blank"><img src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/1866acf38c4c2327657613e8933146d6.png" width="970" height="60" alt="" title="" border="0"></a><div id="beacon_e8d5f9711e" style="position: absolute; left: 0px; top: 0px; visibility: hidden;"><img src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/lg.php" width="0" height="0" alt="" style="width: 0px; height: 0px;"></div></div><div class="sflex-center ad-close-div" style="width: 16px; height: 16px; position: absolute; right: 8px; top: 8px; background-color: rgba(0, 0, 0, 0.75); cursor: pointer; pointer-events: none; border-radius: 50%;"><span class="ad-close-span" style="width: 8px; height: 8px; display: block; background-image: url(&quot;data:image/svg+xml,%3Csvg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;8&#39; height=&#39;8&#39;%3E%3Cpath fill=&#39;%23FFF&#39; fill-rule=&#39;evenodd&#39; d=&#39;M6.6667 0L8 1.3333 5.333 4 8 6.6667 6.6667 8 4 5.333 1.3333 8 0 6.6667 2.666 4 0 1.3333 1.3333 0 4 2.667 6.6667 0z&#39;/%3E%3C/svg%3E&quot;); background-repeat: no-repeat; background-position: center center; pointer-events: auto;"></span></div></div>
</div>
</div>
<div id="gridMapHoverBox" style="position:absolute; border: 1px solid #00965e; z-index: 99; font-size: 10px; background:#fff"></div>


<nav id="sf-header" class="navbar navbar-expand-lg navbar-light bg-white shadow-sm sticky-top">
    <div class="container">
        <a class="navbar-brand text-hide sf-header-logo" href="https://segmentfault.com/">SegmentFault</a>

        
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

                <div class="collapse navbar-collapse" id="navbarNavDropdown">
            <ul class="navbar-nav font-weight-bold">
                <li class="nav-item">
                    <a href="https://segmentfault.com/" class="nav-link ">首页</a>
                </li>
                <li class="nav-item">
                    <a href="https://segmentfault.com/questions" class="nav-link ">问答</a>
                </li>
                <li class="nav-item">
                    <a href="https://segmentfault.com/blogs" class="nav-link active">专栏</a>
                </li>
                 <li class="nav-item">
                    <a href="https://segmentfault.com/news" class="nav-link ">资讯</a>
                </li>
                <li class="nav-item">
                    <a href="https://ke.sifou.com/" class="nav-link ">课程</a>
                </li>
                <li class="nav-item">
                    <a href="https://segmentfault.com/events" class="nav-link ">活动</a>
                </li>
                <li class="nav-item dropdown hover-down">
                    <a href="https://segmentfault.com/a/1190000024453209###" id="navbarDiscover" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="nav-link  dropdown-toggle ">发现</a>
                    <div class="dropdown-menu" aria-labelledby="navbarDiscover">
                        <a class="dropdown-item" href="https://segmentfault.com/groups">圈子</a>
                        <a class="dropdown-item" href="https://segmentfault.com/tags">标签</a>
                        <a class="dropdown-item" href="https://segmentfault.com/groups?tab=jobs">酷工作</a>
                        <a class="dropdown-item" href="https://segmentfault.com/users">排行榜</a>
                        <a class="dropdown-item" href="https://segmentfault.com/badges">徽章</a>
                        <a class="dropdown-item" href="https://segmentfault.com/notes">笔记</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="https://docs.segmentfault.com/" target="_blank">开发手册</a>
                        <a class="dropdown-item" href="https://business.segmentfault.com/ads?utm_source=sf-header" target="_blank">广告投放<svg class="svg-inline--fa fa-external-link-square fa-w-14 ml-2 text-warning" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="external-link-square" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M448 80v352c0 26.51-21.49 48-48 48H48c-26.51 0-48-21.49-48-48V80c0-26.51 21.49-48 48-48h352c26.51 0 48 21.49 48 48zm-64 47.111C384 109.929 370.071 96 352.889 96H220.667c-12.887 0-23.333 10.447-23.333 23.334v14.904c0 13.138 10.843 23.686 23.976 23.324l56.002-1.588L69.908 361.908c-7.858 7.802-7.88 20.504-.05 28.334l19.899 19.899c7.83 7.83 20.532 7.808 28.334-.05l205.935-207.404-1.588 56.003c-.362 13.133 10.186 23.976 23.324 23.976h14.904c12.887 0 23.334-10.447 23.334-23.333V127.111z"></path></svg><!-- <i class="ml-2 text-warning fas fa-external-link-square"></i> -->
                        </a>
                    </div>
                </li>
            </ul>

            <form class="form-inline my-2 my-lg-0 flex-fill d-none d-xl-block px-4" action="https://segmentfault.com/search">
                <input class="form-control w-100" id="searchBox" name="q" type="search" value="" placeholder="搜索关键字" aria-label="搜索">
            </form>

            <ul class="navbar-nav navbar-user ml-auto align-items-lg-center">
                                    <li class="nav-item dropdown">
                        <a class="nav-link" href="https://segmentfault.com/ask" id="navbarEdit" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <svg class="svg-inline--fa fa-edit fa-w-18 fa-fw" aria-hidden="true" focusable="false" data-prefix="far" data-icon="edit" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" data-fa-i2svg=""><path fill="currentColor" d="M402.3 344.9l32-32c5-5 13.7-1.5 13.7 5.7V464c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h273.5c7.1 0 10.7 8.6 5.7 13.7l-32 32c-1.5 1.5-3.5 2.3-5.7 2.3H48v352h352V350.5c0-2.1.8-4.1 2.3-5.6zm156.6-201.8L296.3 405.7l-90.4 10c-26.2 2.9-48.5-19.2-45.6-45.6l10-90.4L432.9 17.1c22.9-22.9 59.9-22.9 82.7 0l43.2 43.2c22.9 22.9 22.9 60 .1 82.8zM460.1 174L402 115.9 216.2 301.8l-7.3 65.3 65.3-7.3L460.1 174zm64.8-79.7l-43.2-43.2c-4.1-4.1-10.8-4.1-14.8 0L436 82l58.1 58.1 30.9-30.9c4-4.2 4-10.8-.1-14.9z"></path></svg><!-- <i class="far fa-edit fa-fw"></i> -->
                            <span class="d-lg-none">撰写</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarEdit">
                            <a class="dropdown-item" href="https://segmentfault.com/ask">提问题</a>
                            <a class="dropdown-item" href="https://segmentfault.com/write">写文章</a>
                            <a class="dropdown-item" href="https://segmentfault.com/record">记笔记</a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item d-flex justify-content-between align-items-center" href="https://segmentfault.com/user/draft">草稿
                                                                    <span class="badge badge-pill badge-secondary">25</span>
                                                            </a>
                        </div>
                    </li>
                    <li class="message nav-item dropdown position-relative">
                        <a class="nav-link" href="https://segmentfault.com/user/notifications" id="messageBox" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <svg class="svg-inline--fa fa-bell fa-w-14 fa-fw" aria-hidden="true" focusable="false" data-prefix="far" data-icon="bell" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M439.39 362.29c-19.32-20.76-55.47-51.99-55.47-154.29 0-77.7-54.48-139.9-127.94-155.16V32c0-17.67-14.32-32-31.98-32s-31.98 14.33-31.98 32v20.84C118.56 68.1 64.08 130.3 64.08 208c0 102.3-36.15 133.53-55.47 154.29-6 6.45-8.66 14.16-8.61 21.71.11 16.4 12.98 32 32.1 32h383.8c19.12 0 32-15.6 32.1-32 .05-7.55-2.61-15.27-8.61-21.71zM67.53 368c21.22-27.97 44.42-74.33 44.53-159.42 0-.2-.06-.38-.06-.58 0-61.86 50.14-112 112-112s112 50.14 112 112c0 .2-.06.38-.06.58.11 85.1 23.31 131.46 44.53 159.42H67.53zM224 512c35.32 0 63.97-28.65 63.97-64H160.03c0 35.35 28.65 64 63.97 64z"></path></svg><!-- <i class="far fa-bell fa-fw"></i> -->
                            <span id="messageCount" class="d-lg-none">通知</span><span class="badge badge-pill badge-danger has-unread-count">...</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-right p-0" aria-labelledby="messageBox">
                            <div class="card border-0 messageBox header-box" style="min-width: 22rem;">
                                <div class="card-header bg-transparent text-center border-0">
                                    <div class="btn-group w-100 msg-btn-group" role="group">
                                        <button type="button" data-type="general" class="btn btn-outline-secondary btn-sm active">
                                            <svg class="svg-inline--fa fa-bullhorn fa-w-18" aria-hidden="true" focusable="false" data-prefix="far" data-icon="bullhorn" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" data-fa-i2svg=""><path fill="currentColor" d="M544 184.88V32.01C544 23.26 537.02 0 512.01 0H512c-7.12 0-14.19 2.38-19.98 7.02l-85.03 68.03C364.28 109.19 310.66 128 256 128H64c-35.35 0-64 28.65-64 64v96c0 35.35 28.65 64 64 64l-.48 32c0 39.77 9.26 77.35 25.56 110.94 5.19 10.69 16.52 17.06 28.4 17.06h106.28c26.05 0 41.69-29.84 25.9-50.56-16.4-21.52-26.15-48.36-26.15-77.44 0-11.11 1.62-21.79 4.41-32H256c54.66 0 108.28 18.81 150.98 52.95l85.03 68.03a32.023 32.023 0 0 0 19.98 7.02c24.92 0 32-22.78 32-32V295.13c19.05-11.09 32-31.49 32-55.12.01-23.64-12.94-44.04-31.99-55.13zM127.73 464c-10.76-25.45-16.21-52.31-16.21-80 0-14.22 1.72-25.34 2.6-32h64.91c-2.09 10.7-3.52 21.41-3.52 32 0 28.22 6.58 55.4 19.21 80h-66.99zM240 304H64c-8.82 0-16-7.18-16-16v-96c0-8.82 7.18-16 16-16h176v128zm256 110.7l-59.04-47.24c-42.8-34.22-94.79-55.37-148.96-61.45V173.99c54.17-6.08 106.16-27.23 148.97-61.46L496 65.3v349.4z"></path></svg><!-- <i class="far fa-bullhorn"></i> -->
                                            <svg class="svg-inline--fa fa-circle fa-w-16 text-danger tip-circle d-none" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="circle" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z"></path></svg><!-- <i class="fas fa-circle text-danger tip-circle d-none"></i> -->
                                        </button>
                                        <button type="button" data-type="ranked" class="btn btn-outline-secondary btn-sm">
                                            <svg class="svg-inline--fa fa-trophy-alt fa-w-18" aria-hidden="true" focusable="false" data-prefix="far" data-icon="trophy-alt" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" data-fa-i2svg=""><path fill="currentColor" d="M359.3 138.9l-43.4-6.3-19.4-39.3c-3.5-7-13.5-7.1-17 0l-19.4 39.3-43.4 6.3c-7.8 1.1-10.9 10.7-5.3 16.2l31.4 30.6-7.4 43.2c-1.3 7.7 6.8 13.7 13.8 10l38.8-20.4 38.8 20.4c6.9 3.6 15.1-2.2 13.8-10l-7.4-43.2 31.4-30.6c5.6-5.5 2.5-15.1-5.3-16.2zM448 64V16c0-8.8-7.2-16-16-16H144c-8.8 0-16 7.2-16 16v48H16C7.2 64 0 71.2 0 80v60.8C0 201.1 68.3 266 159.6 283.4c27.4 57.9 68.1 88.2 104.4 97.4V464h-64c-22.1 0-40 17.9-40 40 0 4.4 3.6 8 8 8h240c4.4 0 8-3.6 8-8 0-22.1-17.9-40-40-40h-64v-83.2c36.3-9.3 77-39.5 104.4-97.4C507.5 266.1 576 201.2 576 140.8V80c0-8.8-7.2-16-16-16H448zM48 140.8V112h80c0 39.2 2.1 76.2 12.3 116.8-55.1-18.9-92.3-58.9-92.3-88zM288 336c-53 0-112-78.4-112-216V48h224v72c0 140.5-60.8 216-112 216zm240-195.2c0 29.1-37.2 69.1-92.3 88C445.9 188.2 448 151.1 448 112h80v28.8z"></path></svg><!-- <i class="far fa-trophy-alt"></i> -->
                                            <svg class="svg-inline--fa fa-circle fa-w-16 text-danger tip-circle d-none" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="circle" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z"></path></svg><!-- <i class="fas fa-circle text-danger tip-circle d-none"></i> -->
                                        </button>
                                        <button type="button" data-type="followed" class="btn btn-outline-secondary btn-sm">
                                            <svg class="svg-inline--fa fa-user-plus fa-w-20" aria-hidden="true" focusable="false" data-prefix="far" data-icon="user-plus" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" data-fa-i2svg=""><path fill="currentColor" d="M224 288c79.5 0 144-64.5 144-144S303.5 0 224 0 80 64.5 80 144s64.5 144 144 144zm0-240c52.9 0 96 43.1 96 96s-43.1 96-96 96-96-43.1-96-96 43.1-96 96-96zm89.6 256c-28.7 0-42.5 16-89.6 16-47.1 0-60.8-16-89.6-16C60.2 304 0 364.2 0 438.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-25.6c0-74.2-60.2-134.4-134.4-134.4zM400 464H48v-25.6c0-47.6 38.8-86.4 86.4-86.4 14.6 0 38.3 16 89.6 16 51.7 0 74.9-16 89.6-16 47.6 0 86.4 38.8 86.4 86.4V464zm224-248h-72v-72c0-8.8-7.2-16-16-16h-16c-8.8 0-16 7.2-16 16v72h-72c-8.8 0-16 7.2-16 16v16c0 8.8 7.2 16 16 16h72v72c0 8.8 7.2 16 16 16h16c8.8 0 16-7.2 16-16v-72h72c8.8 0 16-7.2 16-16v-16c0-8.8-7.2-16-16-16z"></path></svg><!-- <i class="far fa-user-plus"></i> -->
                                            <svg class="svg-inline--fa fa-circle fa-w-16 text-danger tip-circle d-none" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="circle" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z"></path></svg><!-- <i class="fas fa-circle text-danger tip-circle d-none"></i> -->
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body general p-0 font-size-14">
                                    <ul class="list-group" data-proto="general" style="height: 360px;overflow-y: auto;">
                                        <div class="sflex-center message-loading" style="height: 100%;">
                                            <div class="spinner-border text-secondary" role="status">
                                                <span class="sr-only">Loading...</span>
                                            </div>
                                        </div>
                                    </ul>
                                </div>
                                <div class="card-body ranked p-0 font-size-14 d-none">
                                    <ul class="list-group" data-proto="ranked" style="height: 360px;overflow-y: auto;">
                                        <div class="sflex-center message-loading" style="height: 100%;">
                                            <div class="spinner-border text-secondary" role="status">
                                                <span class="sr-only">Loading...</span>
                                            </div>
                                        </div>
                                    </ul>
                                </div>
                                <div class="card-body followed p-0 font-size-14 d-none">
                                    <ul class="list-group" data-proto="followed" style="height: 360px;overflow-y: auto;">
                                        <div class="sflex-center message-loading" style="height: 100%;">
                                            <div class="spinner-border text-secondary" role="status">
                                                <span class="sr-only">Loading...</span>
                                            </div>
                                        </div>
                                    </ul>
                                </div>
                                <div class="card-footer bg-transparent d-flex justify-content-between">
                                    <a href="javascript:;" class="text-muted font-size-14 all-view">
                                        <svg class="svg-inline--fa fa-check-double fa-w-14" aria-hidden="true" focusable="false" data-prefix="far" data-icon="check-double" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M444.09 166.99l-27.39-28.37c-2.6-1.96-5.53-2.93-8.8-2.93-3.27 0-5.87.98-7.82 2.93L142.81 396.86l-94.88-94.88c-1.96-2.61-4.55-3.91-7.82-3.91-3.27 0-6.21 1.3-8.8 3.91l-27.4 27.38c-2.6 2.61-3.91 5.55-3.91 8.8s1.31 5.87 3.91 7.82l130.1 131.07c2.6 1.96 5.53 2.94 8.8 2.94 3.27 0 5.87-.98 7.82-2.94L444.08 183.6c2.6-2.61 3.91-5.55 3.91-8.8.01-3.24-1.3-5.86-3.9-7.81zM131.88 285.04c2.62 1.97 5.58 2.96 8.88 2.96s5.92-.99 7.89-2.96L353.34 80.35c2.62-2.64 3.95-5.6 3.95-8.88 0-3.28-1.33-5.92-3.95-7.89l-27.63-28.62c-2.62-1.97-5.58-2.96-8.88-2.96s-5.92.99-7.89 2.96L140.76 204.12l-60.41-60.41c-1.97-2.64-4.59-3.95-7.89-3.95s-6.26 1.31-8.88 3.95l-27.63 27.63c-2.62 2.64-3.95 5.6-3.95 8.88 0 3.29 1.33 5.92 3.95 7.89l95.93 96.93z"></path></svg><!-- <i class="far fa-check-double"></i> -->
                                        全部标记为已读</a>
                                    <a href="https://segmentfault.com/user/notifications" class="text-muted font-size-14" target="_blank">查看全部</a>
                                </div>
                            </div>
                        </div>
                    </li>
                    <li class="letter nav-item dropdown position-relative">
                        <a class="nav-link" href="https://segmentfault.com/user/messages" id="letterBox" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <svg class="svg-inline--fa fa-envelope fa-w-16 fa-fw" aria-hidden="true" focusable="false" data-prefix="far" data-icon="envelope" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M464 64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm0 48v40.805c-22.422 18.259-58.168 46.651-134.587 106.49-16.841 13.247-50.201 45.072-73.413 44.701-23.208.375-56.579-31.459-73.413-44.701C106.18 199.465 70.425 171.067 48 152.805V112h416zM48 400V214.398c22.914 18.251 55.409 43.862 104.938 82.646 21.857 17.205 60.134 55.186 103.062 54.955 42.717.231 80.509-37.199 103.053-54.947 49.528-38.783 82.032-64.401 104.947-82.653V400H48z"></path></svg><!-- <i class="far fa-envelope fa-fw"></i> -->
                            <span id="letterCount" class="d-lg-none">私信</span><span class="badge badge-pill badge-danger has-unread-count">3</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-right p-0" aria-labelledby="letterBox">
                            <div class="card border-0 letterBox header-box" style="min-width: 22rem;">
                                <div class="card-body letter p-0 font-size-14">
                                    <ul class="list-group" style="height: 360px;overflow-y: auto;">
                                        <div class="sflex-center message-loading" style="height: 100%;">
                                            <div class="spinner-border text-secondary" role="status">
                                                <span class="sr-only">Loading...</span>
                                            </div>
                                        </div>
                                    </ul>
                                </div>
                                <div class="card-footer bg-transparent d-flex justify-content-between">
                                    <a href="javascript:;" class="text-muted font-size-14 all-view">
                                        <svg class="svg-inline--fa fa-check-double fa-w-14" aria-hidden="true" focusable="false" data-prefix="far" data-icon="check-double" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M444.09 166.99l-27.39-28.37c-2.6-1.96-5.53-2.93-8.8-2.93-3.27 0-5.87.98-7.82 2.93L142.81 396.86l-94.88-94.88c-1.96-2.61-4.55-3.91-7.82-3.91-3.27 0-6.21 1.3-8.8 3.91l-27.4 27.38c-2.6 2.61-3.91 5.55-3.91 8.8s1.31 5.87 3.91 7.82l130.1 131.07c2.6 1.96 5.53 2.94 8.8 2.94 3.27 0 5.87-.98 7.82-2.94L444.08 183.6c2.6-2.61 3.91-5.55 3.91-8.8.01-3.24-1.3-5.86-3.9-7.81zM131.88 285.04c2.62 1.97 5.58 2.96 8.88 2.96s5.92-.99 7.89-2.96L353.34 80.35c2.62-2.64 3.95-5.6 3.95-8.88 0-3.28-1.33-5.92-3.95-7.89l-27.63-28.62c-2.62-1.97-5.58-2.96-8.88-2.96s-5.92.99-7.89 2.96L140.76 204.12l-60.41-60.41c-1.97-2.64-4.59-3.95-7.89-3.95s-6.26 1.31-8.88 3.95l-27.63 27.63c-2.62 2.64-3.95 5.6-3.95 8.88 0 3.29 1.33 5.92 3.95 7.89l95.93 96.93z"></path></svg><!-- <i class="far fa-check-double"></i> -->
                                        全部标记为已读</a>
                                    <a href="https://segmentfault.com/user/messages" class="text-muted font-size-14" target="_blank">查看全部</a>
                                </div>
                            </div>
                        </div>
                    </li>
                                        <li class="nav-item dropdown">
                        <a class="nav-link py-0" href="https://segmentfault.com/u/uncleze" id="navbarMy" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <img class="rounded-circle d-lg-inline-block" width="32" height="32" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/2587883497-593d7f93950a2_big64" alt="">
                            <span class="d-lg-none">我的</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarMy" style="width: 316px">
                            <h5 class="dropdown-header">
                                <span class="mr-2" style="color:#BF7158">
                                    <svg class="svg-inline--fa fa-dice-d8 fa-w-16" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="dice-d8" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M225.53 2.52L2.36 233.83c-4.21 4.37-2.56 11.71 3.1 13.77l234.13 85.06V8.39c-.01-7.49-8.91-11.21-14.06-5.87zm284.11 231.31L286.47 2.52C281.32-2.82 272.41.9 272.41 8.4v324.27l234.13-85.06c5.66-2.07 7.31-9.42 3.1-13.78zM33.53 310.38l192 199.1c5.15 5.34 14.06 1.62 14.06-5.88V368.29L42.13 296.61c-8.21-2.98-14.72 7.43-8.6 13.77zm436.34-13.77l-197.46 71.68V503.6c0 7.5 8.91 11.22 14.06 5.88l192-199.1c6.12-6.34-.39-16.75-8.6-13.77z"></path></svg><!-- <i class="fas fa-dice-d8"></i> -->
                                    32</span>
                                <span class="d-inline-block">
                                    <svg class="svg-inline--fa fa-circle fa-w-16 medal-circle" style="color: #FFDA23;" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="circle" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z"></path></svg><!-- <i class="fas fa-circle medal-circle" style="color: #FFDA23"></i> -->
                                    0</span>
                                <span class="d-inline-block">
                                    <svg class="svg-inline--fa fa-circle fa-w-16 medal-circle" style="color: #C5C5C5;" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="circle" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z"></path></svg><!-- <i class="fas fa-circle medal-circle" style="color: #C5C5C5"></i> -->
                                    0</span>
                                <span class="d-inline-block">
                                    <svg class="svg-inline--fa fa-circle fa-w-16 medal-circle" style="color: #CD9A62;" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="circle" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z"></path></svg><!-- <i class="fas fa-circle medal-circle" style="color: #CD9A62"></i> -->
                                    1</span>
                            </h5>
                            <div class="dropdown-divider"></div>
                            <div class="row no-gutters">
                                <div class="col-6">
                                    <a class="dropdown-item" href="https://segmentfault.com/u/uncleze/articles">我的文章</a>
                                    <a class="dropdown-item" href="https://segmentfault.com/u/uncleze/notes">我的笔记</a>
                                    <a class="dropdown-item" href="https://segmentfault.com/u/uncleze/bookmarks">我的收藏</a>
                                    <a class="dropdown-item d-flex justify-content-between align-items-center" href="https://segmentfault.com/user/invited">受邀回答
                                                                            </a>
                                    <a class="dropdown-item" href="https://segmentfault.com/experts">付费问答</a>
                                </div>
                                <div class="col-6">
                                    <a class="dropdown-item" href="https://segmentfault.com/u/uncleze">我的主页</a>
                                    <a class="dropdown-item" href="https://segmentfault.com/user/finance">我的资产</a>
                                    <a class="dropdown-item" href="https://segmentfault.com/user/about">个人档案</a>
                                    <a class="dropdown-item" href="https://segmentfault.com/user/settings">个人设置</a>
                                    <a class="dropdown-item" href="https://segmentfault.com/user/logout">退出登录</a>
                                </div>
                            </div>
                            <div class="dropdown-divider"></div>
                            <div class="px-4 py-1 font-size-14">
                                                                <a href="javascript:;" class="text-secondary sf_do" data-dotype="modal" data-api="/iteration/api/appeals/add" data-content="{&quot;type&quot;:&quot;form&quot;,&quot;asyncUrl&quot;:&quot;&quot;,&quot;data&quot;:[{&quot;tagName&quot;:&quot;textarea&quot;,&quot;title&quot;:&quot;&quot;,&quot;name&quot;:&quot;description&quot;,&quot;value&quot;:&quot;&quot;}]}">用户申诉</a>
                                <span class="split-dot"></span>
                                <a href="https://segmentfault.com/g/1570000009280187" class="text-secondary" target="_blank">建议反馈</a>
                                <span class="split-dot"></span>
                                <a href="https://segmentfault.com/user/invitation" class="text-secondary" target="_blank">邀请朋友</a>
                                                            </div>
                        </div>
                    </li>
                            </ul>
        </div>
    </div>
</nav>

    <input id="articleId" value="1190000024453209" class="hidden">
    <div class="d-none d-xl-flex justify-content-center" style="display: none !important;">
        <script type="text/javascript">
          OA_show(2);
        </script><div id="OA_holder_2"><div id="beacon_337b147d56" style="position: absolute; left: 0px; top: 0px; visibility: hidden;"><img src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/lg(1).php" width="0" height="0" alt="" style="width: 0px; height: 0px;"></div>
</div>
    </div>
    <div class="position-relative articledetail-wrap">
        <div class="container my-sm-4 my-1" id="sf-article">
            <div class="row">
                                <div class="col-12 col-xl w-0">
                    
                                                            
                    <div class="card border-0 mb-4">
                        <div class="card-body p-lg-30">
                            <div class="d-flex justify-content-between align-items-center mb-3" id="sf-article_author">
                                <div class="information d-flex align-items-center">
                                    <a class="d-flex align-items-centers mr-1" href="https://segmentfault.com/u/longming_5732dced2bfb7">
                                        <picture class="mr-2 d-sm-block d-none">
                                            <img class="d-inline-block rounded-circle " width="32" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/1244151576-5f4f9a48a168b_big64" aria-hidden="true">
                                        </picture>
                                        <strong class="align-self-center">longming</strong>
                                    </a>
                                    <ul class="list-inline mb-0 authentication-info sflex-center font-size-14">
                                                                                <li class="list-inline-item">
                                            <svg class="svg-inline--fa fa-dice-d8 fa-w-16" style="color: #BF7158;" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="dice-d8" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M225.53 2.52L2.36 233.83c-4.21 4.37-2.56 11.71 3.1 13.77l234.13 85.06V8.39c-.01-7.49-8.91-11.21-14.06-5.87zm284.11 231.31L286.47 2.52C281.32-2.82 272.41.9 272.41 8.4v324.27l234.13-85.06c5.66-2.07 7.31-9.42 3.1-13.78zM33.53 310.38l192 199.1c5.15 5.34 14.06 1.62 14.06-5.88V368.29L42.13 296.61c-8.21-2.98-14.72 7.43-8.6 13.77zm436.34-13.77l-197.46 71.68V503.6c0 7.5 8.91 11.22 14.06 5.88l192-199.1c6.12-6.34-.39-16.75-8.6-13.77z"></path></svg><!-- <i class="fas fa-dice-d8" style="color:#BF7158"></i> -->
                                            <span style="color: #BF7158;font-weight:bold">14</span>
                                        </li>
                                        
                                                                            </ul>
                                </div>

                            </div><div></div>
                            <div class="functional-area-left sticky-top d-none d-xl-flex"><div class="text-center"><div class="btn-group like-group " role="group">
            <button data-type="question" class="func-btn mainLike like-btn btn btn-outline-primary 
                            " data-id="1190000024453209">
                            <svg class="svg-inline--fa fa-thumbs-up fa-w-16" aria-hidden="true" focusable="false" data-prefix="far" data-icon="thumbs-up" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M466.27 286.69C475.04 271.84 480 256 480 236.85c0-44.015-37.218-85.58-85.82-85.58H357.7c4.92-12.81 8.85-28.13 8.85-46.54C366.55 31.936 328.86 0 271.28 0c-61.607 0-58.093 94.933-71.76 108.6-22.747 22.747-49.615 66.447-68.76 83.4H32c-17.673 0-32 14.327-32 32v240c0 17.673 14.327 32 32 32h64c14.893 0 27.408-10.174 30.978-23.95 44.509 1.001 75.06 39.94 177.802 39.94 7.22 0 15.22.01 22.22.01 77.117 0 111.986-39.423 112.94-95.33 13.319-18.425 20.299-43.122 17.34-66.99 9.854-18.452 13.664-40.343 8.99-62.99zm-61.75 53.83c12.56 21.13 1.26 49.41-13.94 57.57 7.7 48.78-17.608 65.9-53.12 65.9h-37.82c-71.639 0-118.029-37.82-171.64-37.82V240h10.92c28.36 0 67.98-70.89 94.54-97.46 28.36-28.36 18.91-75.63 37.82-94.54 47.27 0 47.27 32.98 47.27 56.73 0 39.17-28.36 56.72-28.36 94.54h103.99c21.11 0 37.73 18.91 37.82 37.82.09 18.9-12.82 37.81-22.27 37.81 13.489 14.555 16.371 45.236-5.21 65.62zM88 432c0 13.255-10.745 24-24 24s-24-10.745-24-24 10.745-24 24-24 24 10.745 24 24z"></path></svg><!-- <i class="far fa-thumbs-up"></i> -->
                            <span class="mainLikeNum">3</span>
                        </button></div><button class="func-btn mainBookmark btn btn-outline-secondary 
                                 " data-id="1190000024453209">
                                <svg class="svg-inline--fa fa-bookmark fa-w-12" aria-hidden="true" focusable="false" data-prefix="far" data-icon="bookmark" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" data-fa-i2svg=""><path fill="currentColor" d="M336 0H48C21.49 0 0 21.49 0 48v464l192-112 192 112V48c0-26.51-21.49-48-48-48zm0 428.43l-144-84-144 84V54a6 6 0 0 1 6-6h276c3.314 0 6 2.683 6 5.996V428.43z"></path></svg><!-- <i class="far fa-bookmark"></i> -->
                                
                            </button><a class="func-btn show-column btn btn-outline-secondary
                              " href="https://segmentfault.com/a/1190000024453209#comment-area">
                            <svg class="svg-inline--fa fa-comment-alt-lines fa-w-16" aria-hidden="true" focusable="false" data-prefix="far" data-icon="comment-alt-lines" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M448 0H64C28.7 0 0 28.7 0 64v288c0 35.3 28.7 64 64 64h96v84c0 7.1 5.8 12 12 12 2.4 0 4.9-.7 7.1-2.4L304 416h144c35.3 0 64-28.7 64-64V64c0-35.3-28.7-64-64-64zm16 352c0 8.8-7.2 16-16 16H288l-12.8 9.6L208 428v-60H64c-8.8 0-16-7.2-16-16V64c0-8.8 7.2-16 16-16h384c8.8 0 16 7.2 16 16v288zm-96-216H144c-8.8 0-16 7.2-16 16v16c0 8.8 7.2 16 16 16h224c8.8 0 16-7.2 16-16v-16c0-8.8-7.2-16-16-16zm-96 96H144c-8.8 0-16 7.2-16 16v16c0 8.8 7.2 16 16 16h128c8.8 0 16-7.2 16-16v-16c0-8.8-7.2-16-16-16z"></path></svg><!-- <i class="far fa-comment-alt-lines"></i> -->
                            
                        </a><div class="dropdown dropup d-inline-block">
                        <button class="func-btn btn btn-outline-secondary
                        " id="func_share" data-toggle="dropdown">
                        <svg class="svg-inline--fa fa-share-alt fa-w-14" aria-hidden="true" focusable="false" data-prefix="far" data-icon="share-alt" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M352 320c-25.6 0-48.9 10-66.1 26.4l-98.3-61.5c5.9-18.8 5.9-39.1 0-57.8l98.3-61.5C303.1 182 326.4 192 352 192c53 0 96-43 96-96S405 0 352 0s-96 43-96 96c0 9.8 1.5 19.6 4.4 28.9l-98.3 61.5C144.9 170 121.6 160 96 160c-53 0-96 43-96 96s43 96 96 96c25.6 0 48.9-10 66.1-26.4l98.3 61.5c-2.9 9.4-4.4 19.1-4.4 28.9 0 53 43 96 96 96s96-43 96-96-43-96-96-96zm0-272c26.5 0 48 21.5 48 48s-21.5 48-48 48-48-21.5-48-48 21.5-48 48-48zM96 304c-26.5 0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48zm256 160c-26.5 0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48z"></path></svg><!-- <i class="far fa-share-alt"></i> -->
                        
                        </button>
                        <div class="dropdown-menu shareContent" aria-labelledby="func_share">
                            <div class="text-center mt-2" style="cursor: auto">
                                <div class="qr"><img crossorigin="anonymous" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHYAAAB2CAYAAAAdp2cRAAAG0klEQVR4Xu2da5LaMBCEyZ32/ifYO5Fiy0WtQeKbVkvEOJ2/o3l1z0P2AvlzvV6vl/w7HQJ/bsR+fX29NbHv7++dP/L/eF4N9tE+2aN4yL+aH9lT5Tf/IbaBWohVS2k7r1Y0dRiFkY4lhCbJQ+wkIDtmuqPY7ZBHf2rHrE1bt+7G7+pTxC37zR0bYvdQusS4+iGWEBiUu8S4+hR2OpYQ6shdYlx9CnuYWPX6T5cjVU47mxInf4/6dF5dVUTsCnxLO3aF499gUuIhdo9ApfBCbKPdK8DRlFAKd0XjhNgQW69RteKpYl17pE+ZqTuVVsfseD7m8uReZmhnUyGRfyqEELshQEBThbtyIioduyE0G2jXHumHWEJgEbHkVu0oGtXkT9Wn8zSxaDV87I4loEPs/oMS5b/urKioV895RCRVMOlTB83WJ38r8D3kcywBG2Jff7So3LEq0Op1f/Z5ipcuUyRXC4s6luIl+fCOJcMkVxNzz1M8RBzJQ2znOZUuOyGWSnMvT8cuehybXagarZdLmVjVsHqeRt3Z5Spe6vnu5Uk1pJ4/O3GUn4qXej7EFu8AtPNVuUqUej7Enp1YtSJWn1c7YPblxX0TtBqfiv2fN0+Vg+88E2J9tENsA8N0rF9YTQvpWB/YKV+jdHccEemnqVlw41H13Qmx7AVFiOVXfK9KK8RqjTd8Wu24R0eqfogdpkpTVIk5LLFqYG7i5O9RTqOeaFPjnd1BFJ+bb3fHEtD07nM28G6iaj50noghfEjfzTfEbghSIaZji0BRxRKQRIRqn+xRPNRhqj7ZG8lv6MNs7ughYCmRd8tpRxORbr4j9kNsoUpCbAGk2xG3gotuph0LsUUoQ2wRqO3YtFFMy5wcqfoq0ap/Nx7Xn0ajPtGG3xXPvizRaCMgXKApH5JTfK7cLfTyR2PcREnfTUQFUo3HLSQ3PtJPx3aeu2mCfCyxVBGqnICgjpm9E1V/5P9RToWxGr+W/SUfjQmx+2/DhdgOAtRxrpyApztAOra442gUEpCq/L8hloChHUPEqPou8OTP7fjVHU2rrYV3c8eG2OffdPgNnosPFQIVYqXQQ2zj3TURR3IiJsRSaXZ2NqkRMa78sMRSYAScurPIH1U4EUHxqvp0XpXTnWTajiWgCagQq+3oENupKOoQKkRVn86r8hAbYqlGf+Tlv+5QRdHoptFM0bo7lnYU2af4yD7pz8b3Zm/oS1kEhDuKZidKwFM+RAzZJ/3Z+YbYwcclmlAqkSF2cMdSR522Y1dXoFqRajzqDqfzRDQVCuU7W78Vb+mVojtaKFGyT0AQUeSf7gRqoan+KH/KL8R2dmqIpdIqymnUqR1CFa12EMVHE0T1R7BRfuWOVYF1AyP92UC5/lR8VGLcwrk/7lCiqqPVRBBQlI8qdzuY4iU5xZuOJYQ68hBbBOZoE4D4/lhi6VZIcnfnELCqfXUV0ChUiVXPu/G28Jvy/VgVeEqciFY7XiXOLWTKj+JX4w2xGwJEHMmpkEMstWZHThXvjrbTEDuI712NgJ5dwWrHuERRobj4kb4af/k5VnWsAjG7MNwd5cZDeKnyELshFmK3T1CoFUSjMB3rIrrXn9axZEgdVavtqYVEsLvxkn1XTneW7o51E1NHoVsoIfa5VEp/aCeiCNjVhUL+1Q5x41X9qefTsSpi2/nTEjuIx7CaCiRNEFWuBq6uDrJP9ki/NbGW/AaFGkiI3X/XR8UvxHaec1UgqcMqO/C3T7Knxnfzn45VUbs8/3+t7uVtGbGzDRNWakU/2qN43R2rrgYi9t327s+xBBQRpcpD7P53oAj/kUId+lKWSiRVtGpvBRCvdh4BS/mlY4sMh9jX35jvjmJ3VNJOnG3f9ad2FHWwmt+KQi195qnYSN1jBJxrP8Q+/3ZjiG08vqgd6RZuOrbY2irQdN6VU9j/jFhy7N4K1cSpo9R4yP9qe7Pt3988qRVJQBDw7uWC7M8GarW92fZDLFVoR64WlurGtR9iVcS38y7w5Na1fxhiZ68CdbS5QL6DqFc+WviVHndWX55C7OvSoDtJiN3wW11I6sRQO77yQiYdW/ghagKe5O6oP03HElBqRxAwqj/qeLKn6tP5jxnFBEyIff333MPeikPsHoF0bPFypBZO5bKi2CSiVH/Do1gJunWWElHlNIoJGFWf8qf4KR66XKnym7/SrZgSIzklrspVYug53L1cUfwhdkOAKjTEfshHY6ji3Y5z9d2JdJiOpURcOXWkOxoJSIqf/KuF4p4fwesQHz+ljiUiSE7Arh7t5F8lroJXiG1URTqWWqUjVyt00M1djTrmtB3rAhf94yHwF5luA1NeE61ZAAAAAElFTkSuQmCC" width="118" height="118" style="width: 118px; height: 118px;"></div>
                                扫一扫分享
                            </div>
                            <div class="dropdown-divider"></div>
                        <a class="dropdown-item share_weibo" data-share="weibo" href="http://weibo.com/segmentfault" target="_blank"><svg class="svg-inline--fa fa-weibo fa-w-16 fa-fw" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="weibo" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M407 177.6c7.6-24-13.4-46.8-37.4-41.7-22 4.8-28.8-28.1-7.1-32.8 50.1-10.9 92.3 37.1 76.5 84.8-6.8 21.2-38.8 10.8-32-10.3zM214.8 446.7C108.5 446.7 0 395.3 0 310.4c0-44.3 28-95.4 76.3-143.7C176 67 279.5 65.8 249.9 161c-4 13.1 12.3 5.7 12.3 6 79.5-33.6 140.5-16.8 114 51.4-3.7 9.4 1.1 10.9 8.3 13.1 135.7 42.3 34.8 215.2-169.7 215.2zm143.7-146.3c-5.4-55.7-78.5-94-163.4-85.7-84.8 8.6-148.8 60.3-143.4 116s78.5 94 163.4 85.7c84.8-8.6 148.8-60.3 143.4-116zM347.9 35.1c-25.9 5.6-16.8 43.7 8.3 38.3 72.3-15.2 134.8 52.8 111.7 124-7.4 24.2 29.1 37 37.4 12 31.9-99.8-55.1-195.9-157.4-174.3zm-78.5 311c-17.1 38.8-66.8 60-109.1 46.3-40.8-13.1-58-53.4-40.3-89.7 17.7-35.4 63.1-55.4 103.4-45.1 42 10.8 63.1 50.2 46 88.5zm-86.3-30c-12.9-5.4-30 .3-38 12.9-8.3 12.9-4.3 28 8.6 34 13.1 6 30.8.3 39.1-12.9 8-13.1 3.7-28.3-9.7-34zm32.6-13.4c-5.1-1.7-11.4.6-14.3 5.4-2.9 5.1-1.4 10.6 3.7 12.9 5.1 2 11.7-.3 14.6-5.4 2.8-5.2 1.1-10.9-4-12.9z"></path></svg><!-- <i class="fab fa-weibo fa-fw"></i> --> 新浪微博</a><a class="dropdown-item share_twitter" data-share="twitter" href="https://twitter.com/segment_fault" target="_blank"><svg class="svg-inline--fa fa-twitter fa-w-16 fa-fw" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitter" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg><!-- <i class="fab fa-twitter fa-fw"></i> --> Twitter</a><a class="dropdown-item share_facebook" data-share="facebook" href="javascript:;" target="_blank"><svg class="svg-inline--fa fa-facebook-square fa-w-14 fa-fw" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="facebook-square" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M400 32H48A48 48 0 0 0 0 80v352a48 48 0 0 0 48 48h137.25V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.27c-30.81 0-40.42 19.12-40.42 38.73V256h68.78l-11 71.69h-57.78V480H400a48 48 0 0 0 48-48V80a48 48 0 0 0-48-48z"></path></svg><!-- <i class="fab fa-facebook-square fa-fw"></i> --> Facebook</a></div>
                    </div></div></div>
                            <h1 class="h2 mb-3" id="sf-article_title">
                                <a class="text-body" href="https://segmentfault.com/a/1190000024453209">手把手，搭建前端自动化部署CI / CD 服务 + npm私有库 + 数据 mock 服务</a>
                            </h1>
                            <div class="d-sm-flex d-none flex-wrap align-items-center mb-4" id="sf-article_tags">
                                <div class="m-n1"><a class="m-1 badge-tag" href="https://segmentfault.com/t/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96" data-toggle="popover" data-img="" data-placement="top" data-original-title="前端工程化" data-id="1040000000768704">
                                                                                        前端工程化
                                        </a><a class="m-1 badge-tag" href="https://segmentfault.com/t/%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2" data-toggle="popover" data-img="" data-placement="top" data-original-title="自动部署" data-id="1040000002414709">
                                                                                        自动部署
                                        </a><a class="m-1 badge-tag" href="https://segmentfault.com/t/docker" data-toggle="popover" data-img="https://avatar-static.segmentfault.com/269/397/2693973775-1040000000366352_big64" data-placement="top" data-original-title="docker" data-id="1040000000366352">
                                                                                        docker
                                        </a></div>
                                <div class="font-size-14">
                                                                            <time datetime="2020-09-14T16:42:43+08:00" itemprop="datePublished" class="text-secondary ml-2">发布于
                                            9月14日</time>
                                                                                                                                                                                </div>
                            </div>

                            <script type="text/javascript">
                              OA_show(25);
                            </script><div id="OA_holder_25"><div id="beacon_375a1e99ed" style="position: absolute; left: 0px; top: 0px; visibility: hidden;"><img src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/lg(2).php" width="0" height="0" alt="" style="width: 0px; height: 0px;"></div>
</div>

                            <article class="article fmt article-content" data-id="1190000024453209" data-license="">                                <h2 id="item-1">小团队的前端工程化体系服务搭建</h2><p>​    这个如火如荼的大前端时代，vue、react、angular 、flutter、electron、小程序等技术框架百家争鸣，这些都是我们前端拿来干架吃饭的武器，前端工程化体系也逐渐向小公司小团队普及，做为一个小小前端团队的leader，了解如何去搭建一个基础的前端工程化体系服务环境，来帮助小团队的提高开发体验和提升工作效率，还是有必要的。</p><p>前端工程化体系工作服务环境主要有：<strong>CI / CD</strong>、<strong>npm私有库</strong>、<strong>api mocker server</strong> 等</p><h3 id="item-1-1">小团队工程化服务环境</h3><p>来，老板我们先来看一下我们要完成的这一套工程化服务的简介图</p><h4><strong>简介图</strong></h4><p><span class="img-wrap"><img referrerpolicy="no-referrer" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/1460000024453212" alt="vue-env-all" title="vue-env-all"></span></p><p>东西不多其实就几个</p><p>本地开发：编写 eslint 、stylint 和 prettier 规则文件，配合vscode的保存自动格式化，再严格的话加上git hook 来检测（当然如果是项目中途加入规则的话，不建议采用git hook等全代码的格式化功能，团队开发可能会宕机😂）</p><p>当我们对特定的分支做 push，或者在仓库执行分支合并更新后，就会触发我们的 CI / CD 服务：去自动构建我们的代码（当然可以加上一些单元测试、代码质量检测等），构建成功后自动帮我们部署到对应的开发环境、测试环境，预发布环境，部署线上生产环境的话一般是设置手动更新等，当然还需要快速回滚的功能，CI / CD 服务运行的状态最后都要做通知，通过：邮件、钉钉企业微信等，告诉团队或者相关开发人员构建的结果等</p><h4>知识点大图</h4><p><span class="img-wrap"><img referrerpolicy="no-referrer" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/1460000024453213" alt="FN-basics" title="FN-basics"></span></p><h4>CI / CD 流水线</h4><p>​    CI 代表持续集成（Continuous Integration），CD 代表持续交付（Continuous Delivery）和持续部署（Continuous Deployment）。也可以将它们看作是类似于软件开发生命周期的过程</p><p>​    简单的说，就是在本地更改代码—&gt;git push推送到代码托管—&gt;自动安装依赖，打包测试部署等（开发环境一般自动，生产环境一般是需要手动点击按钮上线）</p><p>说多无益看图</p><p><span class="img-wrap"><img referrerpolicy="no-referrer" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/1460000024453214" alt="vue-ci-desc" title="vue-ci-desc"></span></p><p>CI / CD 流水线工作图</p><p><span class="img-wrap"><img referrerpolicy="no-referrer" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/1460000024453215" alt="CI-CD pipeline" title="CI-CD pipeline"></span></p><p>老实说：test这个阶段暂时是没有做的哈哈哈，不过做小组件库的时候会需要单元测试等，大家知道就好</p><p>自动化流程的必要性：避免很多问题，少解决很多冲突，假设你的前端团队有6个人，每个人电脑的系统、node版本，npm版本都有可能不一样，就算是规定统一了，每个人拉取代码源仓库 build 出来的产物也有可能不一样，这样会产生几个问题</p><ul><li><strong>耗时</strong>：每个人都需要去构建</li><li><strong>易冲突</strong>：当git做pull ,merge,push等的时候一不小心就会产生各种不必要的冲突要去解决，非常的耗时和不愉悦</li><li><strong>缓存失效</strong>：构建出来的静态文件的hash不好控制，容易在客户端失去缓存，即使在webpack中设置了contenthash等等优化<br>例如：一个很大的commit.js，base.js,echat.js vendor.js啊等文件，本来是没有更新的，已经在客户端缓存的了，却在这次更新后hash值莫名奇妙的变化了，再次访问页面后客户端的用户还需要重新去加载它们，浪费资源啊老板</li></ul><p>其实这些问题在大公司，人员完善的团队一般不会遇到，因为会有专人负责这方的搭建，但是你知道的嘛，初始的小团队，那种苦只有体验过的才知道&nbsp;🤣，但是如果你会了，又有点话语权，那这问题就可以迎刃而解了😎</p><p>打造自动化构建部署 CI /CD 流水线服务的工具我们这里用的是<strong>Jenkins</strong></p><h4>Jenkins</h4><p>&lt;div align=center&gt;&lt;img src="https://fn-md-1255398640.cos.ap-guangzhou.myqcloud.com/prj/icon-jenkins.png" alt="jenkins" style="width:60px;" /&gt;&lt;/div&gt;</p><p>​    ci / cd 现在有不少服务，github的<strong>GitHub Actions</strong>，gitlab 的<strong>Gitlab-CI</strong>,gitee的Gitee Go，还有<strong>travis</strong>、<strong>Netlify</strong>等等，我们用<strong>Jenkins</strong>，引用官方的话就是：</p><blockquote>Jenkins是开源CI&amp;CD软件领导者， 提供超过1000个插件来支持构建、部署、自动化， 满足任何项目的需要。</blockquote><p>为了方便部署和迁移等，我们要在docker上安装<a href="https://www.jenkins.io/zh/" rel="nofollow noreferrer" target="_blank">Jenkins</a></p><h4>Docker</h4><p>&lt;div align=center&gt;&lt;img src="https://fn-md-1255398640.cos.ap-guangzhou.myqcloud.com/prj/icon-docker.png" alt="docker" style="width:60px;" /&gt;&lt;/div&gt;</p><p>​    Docker 是一个开源，轻量级的应用容器引擎,以前我们想在window折腾linux系统，在上面部署应用来测试什么的，我们通常会安装一个虚拟机，在虚拟机上安装操作系统啊，应用什么的，搞垮了可以重新来什么的，不影响主机的系统，不过虚拟机比较重，启动慢，现在我们用<strong>docker</strong>，相比于虚拟机装操作系统，Docker是使用容器承载应用程序，轻量，高效，方便快捷的部署</p><p>Docker 由<strong>镜像(Image)</strong>、<strong>容器(Container)</strong>、<strong>仓库(Repository)</strong> 三部分组成。</p><h5><strong>镜像(Image)</strong></h5><p><strong>镜像Image</strong>就是相当于安装操作的系统盘，U盘等等，里面可以包含node、gitlab等等，当然也可以包含完整的centos系统，甚至是centos + jenkins的或者centos + verdaccio(npm 私有库)</p><h5><strong>容器(Container)</strong></h5><p><strong>容器(Container)</strong>就是实际上跑应用的地方啦，可以理解为一个个互相隔离的小虚拟机，你的镜像就是安装在这里</p><h5><strong>仓库(Repository)</strong></h5><p><strong>仓库(Repository)</strong> 用于存放镜像，有点类似的git仓库，docker hub是个公共的仓库，不过在我们这边网速慢，一般把源设置为淘宝源等</p><p>后面我们会用几个docker容器分别安装<strong>jenkins</strong>、<strong>verdaccio</strong>、<strong>yapi</strong>等组成一个单机的小小微服务，现在多多少少知道为什么要用docker了吧</p><h4>Verdaccio</h4><p>&lt;div align=center&gt;&lt;img src="https://fn-md-1255398640.cos.ap-guangzhou.myqcloud.com/prj/icon-verdaccio.png" alt="verdaccio" style="width:60px;" /&gt;</p><p><strong><a href="https://verdaccio.org/docs/zh-CN/what-is-verdaccio" rel="nofollow noreferrer" target="_blank">Verdaccio</a></strong> 是一个 <strong>Node.js</strong>创建的<strong>轻量的私有npm proxy registry</strong> ，小团队用这个够</p><h4>Yapi</h4><p>&lt;div align=center&gt;&lt;img src="https://fn-md-1255398640.cos.ap-guangzhou.myqcloud.com/prj/icon-YAPI.png" alt="yapi" style="width:60px;" /&gt;&lt;/div&gt;</p><p>​    <a href="https://github.com/YMFE/yapi" rel="nofollow noreferrer" target="_blank"><strong>Yapi</strong></a>这是一个api管理平台，前后端分离的时候，api mock显得格外重要，没有api、mock，团队的朋友得在代码中做一堆测试数据，判断条件什么的，后面等接口开发好再删掉测试的数据，在对接接口重新测试，这可一点都不好玩。现在主要的mock系统有<strong>rap2</strong>、<strong>eolinker</strong>，<strong>yapi</strong>等等，我们这里用<strong>yapi</strong>，轻量简单功能好，社区活跃star高，需要<strong>mongoDB</strong>来存数据</p><h4>MongoDB</h4><p>&lt;div align=center&gt;&lt;img src="https://fn-md-1255398640.cos.ap-guangzhou.myqcloud.com/prj/icon-mongoDB.png" alt="mongo" style="width:120px;" /&gt;&lt;/div&gt;</p><p><a href="https://www.mongodb.com/cn" rel="nofollow noreferrer" target="_blank">MongoDB</a>使用C++语言编写的非关系型数据库。特点是高性能、易部署、易使用，存储数据十分方便。这里我们安装是提供给<strong>yapi</strong>用</p><h3 id="item-1-2">Git flow 工作流</h3><p>简单的先说一下我们小团队这里的 git flow，这样好明白我们接下来的 CI / CD 要为我们做什么</p><h4>代码运行的环境</h4><p>一般来说，小公司小团队都会有至少这几个环境：</p><p><span class="img-wrap"><img referrerpolicy="no-referrer" data-src="/img/remote/1460000024453216" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/squares.svg" alt="env" title="env"></span></p><ul><li><strong>本地开发环境</strong>：</li></ul><p>开发人员自测的，可以是自己本地部署的静态服务器，当然也可类似是运行 npm server类似的环境，本地环境运行的代码可以是任何分支的</p><ul><li><strong>dev开发环境</strong>：</li></ul><p>这个环境是用开发分支<strong>dev</strong>产出的代码来部署的，唯一的公用的</p><ul><li><strong>测试&amp;预发布环境</strong>：</li></ul><p>这个环境是用开发分支<strong>release</strong>产出的代码来部署的，唯一的公用的</p><ul><li><strong>线上生产环境</strong>：</li></ul><p>这个环境是用开发分支<strong>master</strong>产出的代码来部署的，唯一的公用的</p><h4>git 分支模型</h4><p>先看一下分支的角色功能</p><p><span class="img-wrap"><img referrerpolicy="no-referrer" data-src="/img/remote/1460000024453217" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/squares.svg" alt="git-flow" title="git-flow"></span></p><h5>分支的策略</h5><p><span class="img-wrap"><img referrerpolicy="no-referrer" data-src="/img/remote/1460000024453218" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/squares.svg" alt="git-flow-1" title="git-flow-1"></span></p><p>dev 是公共的开发分支，不会合并到其他分支去的,7</p><p><span class="img-wrap"><img referrerpolicy="no-referrer" data-src="/img/remote/1460000024453219" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/squares.svg" alt="git-flow-2" title="git-flow-2"></span></p><p>所有的分支都是基于<strong>master</strong>分支检出</p><ul><li>master ：<strong>保护分支</strong>，对应的就是生产环境的分支</li><li>release：<strong>保护分支</strong>，所有开发完成的分支会申请合并到release分支，提供给测试人员测试</li><li>feature-*：<strong>功能分支</strong>，具体功能开发</li><li>dev：<strong>开发分支&amp;脏分支</strong>，对应的是大家共用的开发环境，上面的代码会部署到一个公共的开发环境，供开发人员做自测，应付一些日常、非日常的调试</li><li>hotfix-*：<strong>bug紧急修复分支</strong>，可以直接合并到master，（假如release合并了几个feature分支，正在测试的情况下，发现需要紧急修复的buf，紧急修复测试完毕后，可以直接合并到master，如果合并到release，在由release合并到master，那些正在测试的功能或者还不准备上线的功能就会跟着直接上线了）</li></ul><p>工作流程大概是：</p><p><span class="img-wrap"><img referrerpolicy="no-referrer" data-src="/img/remote/1460000024453220" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/squares.svg" alt="git-workflow" title="git-workflow"></span></p><ol><li>接到需求文档，做评审后分配个每个人或小组的功能开发，相关人员从master 检出功能分支</li><li>开发的时候除了会在本地测试，有需要还会合并到dev分支，在公共的开发环境去自己做测试</li><li>因为在开发功能的期间，可能有hotfix完成合并到master，合并代码的时候习惯merge一下master，防止冲突等</li><li>自测完成之后，申请合并到release，合并成功后部署到测试环境后通知测试人员做测试</li><li>测试通过后，release申请合并到master，准备上线</li><li>如果测试不通过，在功能分支修改后重新merge</li><li>上线成功稳定后删除对应的功能分支，dev 合并最新的master分支</li></ol><h4>CI / CD  的工作</h4><p>当我们本地代码分支合并到dev，push推送到远程git仓库的时候，触发任务<strong>自动</strong>build-&gt;build成功后自动部署发布到<strong>dev开发环境</strong></p><p>当我们在gitee 申请feature分支，合并到release，成功后，触发任务<strong>自动</strong>build-&gt;build成功后自动部署发布到<strong>release测试环境</strong></p><p>当我们申请release分支或&amp;hotfix分支合并到master，成功后，触发任务<strong>自动</strong>build-&gt;build成功后通过<strong>手动部署</strong>发布到正式生产环境（生产环境一般是需要多加一步手动发布，点击个按钮发布等操作）</p><h4>创建仓库</h4><p>上面的环境清楚了，先按照上面的新建一个仓库吧</p><p>你也可以直接拉去我的这里为你准备的初始化仓库 <a href="https://gitee.com/eric-gm/ci-start-vue.git" rel="nofollow noreferrer" target="_blank">https://gitee.com/eric-gm/ci-...</a>，然后放到你自己仓库里</p><h3 id="item-1-3">安装准备</h3><h4>系统要求</h4><p>liunx系统，我用的是：<strong>centos8</strong>, 因为要安装docker，要求内核版本不低于 <strong>3.10</strong><br>这里我是用两台阿里云服务器，一台用来部署jenkins、verdaccio、yapi等做环境部署机，一台做静态资源的服务器装nginx，环境部署机建议<strong>2核4G</strong>起步，如果有安装<strong>Gitlab</strong>等，那可得8G起步了老板，能弄个16G当然也是甚好哈哈哈</p><p>当然不管的内网服务器还是云服务器，配置<strong>SSH</strong>连接能很方便的在本地连接到服务器</p><h4>创建用户</h4><p>在<strong>centos</strong>系统下创建用户，其他系统的老板遇到问题自行百度吧</p><ol><li>以添加用户名为 longming 的用户为例子，输入命令添加用户、添加用户目录、指定 bash 为 shell</li></ol><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="useradd -m -s /bin/bash eric" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="shell hljs"><code class="shell" style="word-break: break-word; white-space: initial;">useradd -m -s /bin/bash eric</code></pre><p><code>-m</code> 自动创建用户的家目录，并将<code>/etc/skel</code>中的文件复制到家目录中</p><p><code>-s</code> 指定用户登入后所使用的 shell</p><ol><li>然后对该用户设置密码，输入命令后会提示输入两次密码</li></ol><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="passwd eric" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="shell hljs"><code class="shell" style="word-break: break-word; white-space: initial;">passwd eric</code></pre><ol><li>查看当前用户列表</li></ol><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="cat /etc/passwd" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="shell hljs"><code class="shell" style="word-break: break-word; white-space: initial;">cat /etc/passwd</code></pre><ol><li>为了方便操作，现在我们要给用 <strong>eric</strong>添加root权限</li></ol><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="#开启 sudoers 文件的写的权限，默认为只读
chmod -v u+w /etc/sudoers
#修改 sudoers
vi /etc/sudoers
   -----------------------------------------------
   # Allow root to run any commands anywhere
   root    ALL=(ALL)       ALL
   eric   ALL=(ALL)       ALL （添加这一行）
   -----------------------------------------------
# 记得关闭 sudoers 文件的写的权限，默认为只读
chmod -v u-w /etc/sudoers" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="shell hljs"><code class="shell"><span class="hljs-meta">#</span><span class="bash">开启 sudoers 文件的写的权限，默认为只读</span>
chmod -v u+w /etc/sudoers
<span class="hljs-meta">#</span><span class="bash">修改 sudoers</span>
vi /etc/sudoers
   -----------------------------------------------
<span class="hljs-meta">   #</span><span class="bash"> Allow root to run any commands anywhere</span>
   root&nbsp; &nbsp; ALL=(ALL)&nbsp; &nbsp; &nbsp; &nbsp;ALL
   eric &nbsp; ALL=(ALL)&nbsp; &nbsp; &nbsp; &nbsp;ALL （添加这一行）
   -----------------------------------------------
<span class="hljs-meta">#</span><span class="bash"> 记得关闭 sudoers 文件的写的权限，默认为只读</span>
chmod -v u-w /etc/sudoers</code></pre><ol><li>用户切换</li></ol><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="# su 用户名，- 作用是改变工作目录 ，- 是 -l的缩写，切换到root用户不需要输入用户名
su - eric
# 接下要为ssh连接做准备了（当然这里你可以用阿里云的控制台配）
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="shell hljs"><code class="shell"><span class="hljs-meta">#</span><span class="bash"> su 用户名，- 作用是改变工作目录 ，- 是 -l的缩写，切换到root用户不需要输入用户名</span>
su - eric
<span class="hljs-meta">#</span><span class="bash"> 接下要为ssh连接做准备了（当然这里你可以用阿里云的控制台配）</span>
</code></pre><ol><li>sshd_conf 控制远程连接的文件</li></ol><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text=" vi /etc/ssh/sshd_config
    -----------------------------------------------

   PermitRootLogin no //阻止root用户登陆
   AllowUsers eric  //允许制定用户使用SSH登陆
   //阻止用户密码SSH登陆,如果设置no，证书还没配置对，你就登陆不上了哈哈哈，别慌阿里云的VNC远程连接还能搞回来哈哈
   PasswordAuthentication no
   -----------------------------------------------" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs yaml"><code> <span class="hljs-string">vi</span> <span class="hljs-string">/etc/ssh/sshd_config</span>
    <span class="hljs-string">-----------------------------------------------</span>

   <span class="hljs-string">PermitRootLogin</span> <span class="hljs-literal">no</span> <span class="hljs-string">//阻止root用户登陆</span>
   <span class="hljs-string">AllowUsers</span> <span class="hljs-string">eric</span>  <span class="hljs-string">//允许制定用户使用SSH登陆</span>
   <span class="hljs-string">//阻止用户密码SSH登陆,如果设置no，证书还没配置对，你就登陆不上了哈哈哈，别慌阿里云的VNC远程连接还能搞回来哈哈</span>
   <span class="hljs-string">PasswordAuthentication</span> <span class="hljs-literal">no</span>
   <span class="hljs-string">-----------------------------------------------</span></code></pre><h4>SSH配置</h4><h5>1 创建密钥</h5><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="#window系统
系统盘/Users/$(yourusername)/.ssh
#mac系统
cd /Users/$(yourusername)/.ssh
#执行命令创建密钥对，一路回车不要输入密钥密码（当然要输入密码也随你）
ssh-keygen -t rsa -f $(yoursshname) -C &quot;your_email@example.com&quot;

#如果是复制过来的目录内容啊 .ssh/ ，那么对.ssh 目录执行就行
sudo chown -R username .ssh " title="" data-original-title="复制"></span>
        </div>
        </div><pre class="shell hljs"><code class="shell"><span class="hljs-meta">#</span><span class="bash">window系统</span>
系统盘/Users/$(yourusername)/.ssh
<span class="hljs-meta">#</span><span class="bash">mac系统</span>
cd /Users/$(yourusername)/.ssh
<span class="hljs-meta">#</span><span class="bash">执行命令创建密钥对，一路回车不要输入密钥密码（当然要输入密码也随你）</span>
ssh-keygen -t rsa -f $(yoursshname) -C "your_email@example.com"
<span class="hljs-meta">
#</span><span class="bash">如果是复制过来的目录内容啊 .ssh/ ，那么对.ssh 目录执行就行</span>
sudo chown -R username .ssh </code></pre><p>解析：</p><ul><li><strong>-t</strong> ：指定密钥类型，默认是 rsa ，可以省略。</li><li><strong>-C</strong>： 设置注释文字，比如邮箱。</li><li><strong>-f</strong>： 指定密钥文件存储文件名，省略的话默认生成 <strong>id_rsa</strong> 和 <strong>id_rsa.pub</strong></li></ul><p><strong>-f</strong>  指定密钥对的文件名这个比较重要，</p><p>因为我们要创建多个密钥对连接对应的主机，这里我创建了几个：<br><strong>gitee-eric</strong> 、<strong>aliyun-env</strong>、<strong>aliyun-nginx</strong> 代表 连接gitee仓库的、连接阿里云环境机的、连接阿里云静态服务器的</p><p>执行完成后.ssh 目录下会出现 <strong>gitee-eric</strong>、<strong>gitee-eric.pub</strong>、<strong>aliyun-env</strong>、<strong>aliyun-env.pub</strong>、<strong>aliyun-nginx</strong>、<strong>aliyun-nginx.pub</strong><br>后缀.pub的，是公钥，要复制到连接的主机去的</p><p>例子：看到这个就是创建成功了一个啦,<strong>记住是在自己的 ssh目录下运行创建哈</strong> 创建的时候一路回车不用输入<strong>passphrase</strong>，大佬的话随意</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="➜  .ssh ssh-keygen -t rsa -f aliyun-env -C &quot;451904906@qq.com&quot;
Generating public/private rsa key pair.
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in aliyun-env.
Your public key has been saved in aliyun-env.pub.
The key fingerprint is:
SHA256:ePnhkUiIHTy8zsdpX1F9MKtC+PJK2F768PjEYuoUFgc 451904906@qq.com
The key&#39;s randomart image is:
+---[RSA 2048]----+
|     oE       oo |
|     o++ .    .oo|
|    . +o+ .  .. .|
|      .= = ...   |
|     o+.S.* ..   |
|     .o==* +.    |
|      oo*.B.     |
|     . = X.      |
|     .o =o+      |
+----[SHA256]-----+
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="shell hljs"><code class="shell">➜  .ssh ssh-keygen -t rsa -f aliyun-env -C "451904906@qq.com"
Generating public/private rsa key pair.
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in aliyun-env.
Your public key has been saved in aliyun-env.pub.
The key fingerprint is:
SHA256:ePnhkUiIHTy8zsdpX1F9MKtC+PJK2F768PjEYuoUFgc 451904906@qq.com
The key's randomart image is:
+---[RSA 2048]----+
|     oE       oo |
|     o++ .    .oo|
|    . +o+ .  .. .|
|      .= = ...   |
|     o+.S.* ..   |
|     .o==* +.    |
|      oo*.B.     |
|     . = X.      |
|     .o =o+      |
+----[SHA256]-----+
</code></pre><h5>2 配置公钥</h5><p>创建完成后复制创建的公钥<strong>aliyun-env.pub</strong></p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text=" #cat公钥aliyun-env.pub的内容，复制它
 .ssh cat aliyun-env.pub" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="shell hljs"><code class="shell"><span class="hljs-meta"> #</span><span class="bash">cat公钥aliyun-env.pub的内容，复制它</span>
 .ssh cat aliyun-env.pub</code></pre><p>现在去登陆到你的环境部署主机，登陆到刚刚创建的用户eric</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="#查看是否进入用户工作目录
pwd 
/home/eric
#在 /home/eric目录下创建 .ssh目录 设置权限700
mkdir ~/.ssh
chmod 700 ~/.ssh
#创建ssh验证文件、设置权限644
vi ~/.ssh/authorized_keys
chmod 644 ~/.ssh/authorized_keys
-----------------------------------------------
#这里复制你的一开始生产的公钥
ssh-rsa askdlajsdkl是什么的反正就是copy
-----------------------------------------------

" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="shell hljs"><code class="shell"><span class="hljs-meta">#</span><span class="bash">查看是否进入用户工作目录</span>
pwd 
/home/eric
<span class="hljs-meta">#</span><span class="bash">在 /home/eric目录下创建 .ssh目录 设置权限700</span>
mkdir ~/.ssh
chmod 700 ~/.ssh
<span class="hljs-meta">#</span><span class="bash">创建ssh验证文件、设置权限644</span>
vi ~/.ssh/authorized_keys
chmod 644 ~/.ssh/authorized_keys
-----------------------------------------------
<span class="hljs-meta">#</span><span class="bash">这里复制你的一开始生产的公钥</span>
ssh-rsa askdlajsdkl是什么的反正就是copy
-----------------------------------------------

</code></pre><p>现在还要配置一下 ssh登陆的配置文件：<strong>/etc/ssh/sshd_config</strong>，允许 <strong>eric</strong>等用户远程登陆</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="sudo vi /etc/ssh/sshd_config

-----------------------------------------------

PermitRootLogin yes //控制root用户登陆与否
AllowUsers eric  //允许制定用户使用SSH登陆，这里我们把用户eric添加进来
PasswordAuthentication yes //阻止用户密码SSH登陆⚠️⚠️⚠️如果设置no，证书还没配置对好，你就登陆不上了哈哈哈，‍别慌阿里的VNC远程连接还能搞回来哈哈
RSAAuthentication yes
PubkeyAuthentication yes

-----------------------------------------------
 " title="" data-original-title="复制"></span>
        </div>
        </div><pre class="shell hljs"><code class="shell">sudo vi /etc/ssh/sshd_config

-----------------------------------------------

PermitRootLogin yes //控制root用户登陆与否
AllowUsers eric  //允许制定用户使用SSH登陆，这里我们把用户eric添加进来
PasswordAuthentication yes //阻止用户密码SSH登陆⚠️⚠️⚠️如果设置no，证书还没配置对好，你就登陆不上了哈哈哈，‍别慌阿里的VNC远程连接还能搞回来哈哈
RSAAuthentication yes
PubkeyAuthentication yes

-----------------------------------------------
 </code></pre><p>保存退出 重启sshd服务</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="sudo systemctl restart sshd" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="shell hljs"><code class="shell" style="word-break: break-word; white-space: initial;">sudo systemctl restart sshd</code></pre><h5>3 连接远程主机</h5><p>现在回到本地，配置ssh的配置文件 .ssh/conf（如果没有就创建一个），配置ssh的host</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="Host env
    HostName 47.115.11.abc
    User eric
    Port 22
    IdentityFile ~/.ssh/aliyun-env" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs properties"><code class="host"><span class="hljs-attr">Host</span> <span class="hljs-string">env</span>
    <span class="hljs-attr">HostName</span> <span class="hljs-string">47.115.11.abc</span>
    <span class="hljs-attr">User</span> <span class="hljs-string">eric</span>
    <span class="hljs-attr">Port</span> <span class="hljs-string">22</span>
    <span class="hljs-attr">IdentityFile</span> <span class="hljs-string">~/.ssh/aliyun-env</span></code></pre><p>配置好测试连接</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="ssh env
#第一次连接会提示添加到 known_hosts信任，选择yes

#看到这里就连接成功啦
Last login: Sun Aug  2 03:12:27 2020 from 113.110.38.101

Welcome to Alibaba Cloud Elastic Compute Service !

[eric@jenkins-t ~]$
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="shell hljs"><code class="shell">ssh env
<span class="hljs-meta">#</span><span class="bash">第一次连接会提示添加到 known_hosts信任，选择yes</span>
<span class="hljs-meta">
#</span><span class="bash">看到这里就连接成功啦</span>
Last login: Sun Aug  2 03:12:27 2020 from 113.110.38.101

Welcome to Alibaba Cloud Elastic Compute Service !

[eric@jenkins-t ~]$
</code></pre><p>连接成功后 禁止root登陆和密码登录吧</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="sudo vi /etc/ssh/sshd_config

-----------------------------------------------

PermitRootLogin no //控制root用户登陆与否
AllowUsers eric  //允许制定用户使用SSH登陆，这里我们把用户eric添加进来
PasswordAuthentication no //阻止用户密码SSH登陆⚠️⚠️⚠️如果设置no，证书还没配置对好，你就登陆不上了哈哈哈，‍别慌阿里的VNC远程连接还能搞回来哈哈
RSAAuthentication yes
PubkeyAuthentication yes
-----------------------------------------------
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="shell hljs"><code class="shell">sudo vi /etc/ssh/sshd_config

-----------------------------------------------

PermitRootLogin no //控制root用户登陆与否
AllowUsers eric  //允许制定用户使用SSH登陆，这里我们把用户eric添加进来
PasswordAuthentication no //阻止用户密码SSH登陆⚠️⚠️⚠️如果设置no，证书还没配置对好，你就登陆不上了哈哈哈，‍别慌阿里的VNC远程连接还能搞回来哈哈
RSAAuthentication yes
PubkeyAuthentication yes
-----------------------------------------------
</code></pre><p>如果使用mac，可以配合alfred的ssh workflow来开始连接远程主机，配置地址可以参考这文章 <a href="https://juejin.im/post/6844903909916426248" rel="nofollow noreferrer" target="_blank">alfred集成ssh+iTerm2</a> </p><p>一般来说对于预发布和生产环境的机器一般都需要设置堡垒机，登陆之前需要获取口令，验证码什么的，这些也可以配合alfred的，我们这边先简化哈</p><p><span class="img-wrap"><img referrerpolicy="no-referrer" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/1460000024453221" alt="alfred wkflow ssh" title="alfred wkflow ssh"></span></p><h3 id="item-1-4">安装使用流程</h3><ol><li>docker ：安装docker，我们的整套服务将分别承载在各个docker容器里</li><li>jenkinsci/blueocean  ：负责 CI / CD任务：自动打包构建部署等一系列自动化任务 （为了流水线的可视化我们镜像拉取的是这个，其实就是jenkins安装了blueocean的插件)</li><li>verdaccio/verdaccio ：npm库</li><li>mongo： 数据库，这里给yapi用的</li><li>yapi：这个镜像得我们来制作</li><li><strong>docker-compose</strong>：上面需要安装的4个应用容器等，到时候会用<strong>docker-compose</strong>统一控制：安装删除、启动停止，容器网络连接等</li></ol><h3 id="item-1-5">Docker</h3><h4><strong>yum设置</strong></h4><p>我们用yum来安装docker，先处理好yum</p><ol><li>先备份你的原镜像文件，以免出错后可以恢复</li></ol><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="shell hljs"><code class="shell" style="word-break: break-word; white-space: initial;">mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup</code></pre><ol><li>下载wget、创建目录、下载阿里云yum源配置</li></ol><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="yum install wget -y
mkdir -p  /etc/yum.repos.d
#注意，这个是要对你的centos版本的，
wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-8.repo
#Centos-7就对7，
wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="shell hljs"><code class="shell">yum install wget -y
mkdir -p  /etc/yum.repos.d
<span class="hljs-meta">#</span><span class="bash">注意，这个是要对你的centos版本的，</span>
wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-8.repo
<span class="hljs-meta">#</span><span class="bash">Centos-7就对7，</span>
wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</code></pre><ol><li>更新yum缓存</li></ol><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="#清除原有yum源缓存
yum clean all
#生成阿里云yum源缓存
yum makecache" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="shell hljs"><code class="shell"><span class="hljs-meta">#</span><span class="bash">清除原有yum源缓存</span>
yum clean all
<span class="hljs-meta">#</span><span class="bash">生成阿里云yum源缓存</span>
yum makecache</code></pre><ol><li>升级本地yum包</li></ol><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="yum update" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="shell hljs"><code class="shell" style="word-break: break-word; white-space: initial;">yum update</code></pre><ol><li>安装 yum-utils，它提供了 yum-config-manager，可用来管理yum源</li></ol><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="yum install -y yum-utils device-mapper-persistent-data lvm2" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="shell hljs"><code class="shell" style="word-break: break-word; white-space: initial;">yum install -y yum-utils device-mapper-persistent-data lvm2</code></pre><ol><li>安装阿里云docker源</li></ol><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="sudo yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="shell hljs"><code class="shell" style="word-break: break-word; white-space: initial;">sudo yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</code></pre><ol><li>更新yum索引</li></ol><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="yum makecache fast
yum clean all" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="shell hljs"><code class="shell">yum makecache fast
yum clean all</code></pre><h4><strong>Docker安装</strong></h4><ol><li>安装docker</li></ol><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="yum -y install docker-ce
#如果出现问题，运行下来两个命令
wget https://download.docker.com/linux/centos/7/x86_64/stable/Packages/containerd.io-1.2.13-3.1.el7.x86_64.rpm
yum -y install ./containerd.io-1.2.13-3.1.el7.x86_64.rpm
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="shell hljs"><code class="shell">yum -y install docker-ce
<span class="hljs-meta">#</span><span class="bash">如果出现问题，运行下来两个命令</span>
wget https://download.docker.com/linux/centos/7/x86_64/stable/Packages/containerd.io-1.2.13-3.1.el7.x86_64.rpm
yum -y install ./containerd.io-1.2.13-3.1.el7.x86_64.rpm
</code></pre><ol><li>查看docker版本</li></ol><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="docker -v" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="shell hljs"><code class="shell" style="word-break: break-word; white-space: initial;">docker -v</code></pre><ol><li>将你的用户添加到 docker 的用户组，添加后退出用户重新登陆才能生效，这是避免以后docker操作总是要 sudo</li></ol><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="sudo usermod -aG docker $(yourname)" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="shell hljs"><code class="shell" style="word-break: break-word; white-space: initial;">sudo usermod -aG docker $(yourname)</code></pre><ol><li>启动docker服务</li></ol><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="sudo service docker start" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="shell hljs"><code class="shell" style="word-break: break-word; white-space: initial;">sudo service docker start</code></pre><ol><li>开机启动<strong>docker</strong>服务</li></ol><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="systemctl enable docker.service" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="shell hljs"><code class="shell" style="word-break: break-word; white-space: initial;">systemctl enable docker.service</code></pre><h4>Docker的基本操作命令</h4><p>镜像操作</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="docker search images_name       # 查看仓库的镜像资料
docker pull images_name         # 下载镜像
docker images                   # 显示本地镜像
docker rmi images_name/image_id # 删除本地镜像" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="shell hljs"><code class="shell">docker search images_name       # 查看仓库的镜像资料
docker pull images_name         # 下载镜像
docker images                   # 显示本地镜像
docker rmi images_name/image_id # 删除本地镜像</code></pre><p>容器的命令</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="docker ps        #查看当前运行的容器
docker ps -a     #查看存在的所有容器
docker stop      #停止容器
docker start     #运行容器
docker restart   #重启容器
docker rm container_id/container_name #删除容器
docker logs [options] container_id/container_name     #查看容器日志，出错或者调试可用
docker exec -it container_id/container_name [/bin/bash 或者 sh]  #进入容器分配一个终端/bin/bash，不存在就用sh
exit #在容器内部 
docker commit container_id/container_name # 将容器" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="shell hljs"><code class="shell">docker ps        #查看当前运行的容器
docker ps -a     #查看存在的所有容器
docker stop      #停止容器
docker start     #运行容器
docker restart   #重启容器
docker rm container_id/container_name #删除容器
docker logs [options] container_id/container_name     #查看容器日志，出错或者调试可用
docker exec -it container_id/container_name [/bin/bash 或者 sh]  #进入容器分配一个终端/bin/bash，不存在就用sh
exit #在容器内部 
docker commit container_id/container_name # 将容器</code></pre><p>卷的操作</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="#查看本地volume
docker volume ls
#删除指定volume
docker volume rm volume_id/volume_name
#删除所有的volume
docker volume prune" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs properties"><code><span class="hljs-comment">#查看本地volume</span>
<span class="hljs-attr">docker</span> <span class="hljs-string">volume ls</span>
<span class="hljs-comment">#删除指定volume</span>
<span class="hljs-attr">docker</span> <span class="hljs-string">volume rm volume_id/volume_name</span>
<span class="hljs-comment">#删除所有的volume</span>
<span class="hljs-attr">docker</span> <span class="hljs-string">volume prune</span></code></pre><p>network（这个我们暂时不用掌握，在<a href="https://segmentfault.com/a/1190000024453209#Docker">Docker Compose 接管</a>的总结里讲）</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="#查看docker中存在的网络
docker network ls

#查看网络的详细信息
docker network inspect

#自定义网络（默认是bridge类型）
docker network create front-net

#将容器web1 和 web2 加入网络，这样容器web1 和 web2 用这个来两个名字就能互相ping同，会自动进行DNS解析
docker network connect front-net web1
docker network connect front-net web2

#断开连接
docker network disconnect front-net web1
docker network disconnect front-net web2" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="shell hljs"><code class="shell"><span class="hljs-meta">#</span><span class="bash">查看docker中存在的网络</span>
docker network ls
<span class="hljs-meta">
#</span><span class="bash">查看网络的详细信息</span>
docker network inspect
<span class="hljs-meta">
#</span><span class="bash">自定义网络（默认是bridge类型）</span>
docker network create front-net
<span class="hljs-meta">
#</span><span class="bash">将容器web1 和 web2 加入网络，这样容器web1 和 web2 用这个来两个名字就能互相ping同，会自动进行DNS解析</span>
docker network connect front-net web1
docker network connect front-net web2
<span class="hljs-meta">
#</span><span class="bash">断开连接</span>
docker network disconnect front-net web1
docker network disconnect front-net web2</code></pre><h3 id="item-1-6">Jenkinsci/BlueOcean</h3><h4>1 Jenkins安装</h4><p>现在我们要使用docker 来安装jenkins了</p><ol><li>我们先下载 <strong>jenkinsci/blueocean</strong> 镜像吧</li></ol><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="#运行这个命令会查看仓库的jenkins镜像资源
docker search jenkins
#运行后你会看到类似这样的
NAME                                   DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED
jenkins                                Official Jenkins Docker image                   4863                [OK]
jenkins/jenkins                        The leading open source automation server       2154
jenkinsci/blueocean                    https://jenkins.io/projects/blueocean           544
jenkinsci/jenkins                      Jenkins Continuous Integration and Delivery …   382
jenkins/jnlp-slave                     a Jenkins agent which can connect to Jenkins…   129                                     [OK]
jenkinsci/jnlp-slave                   A Jenkins slave using JNLP to establish conn…   126                                     [OK]
jenkinsci/slave                        Base Jenkins slave docker image                 65                                      [OK]
jenkins/slave                          base image for a Jenkins Agent, which includ…   43                                      [OK]
jenkinsci/ssh-slave                    A Jenkins SSH Slave docker image                42                                      [OK]
···
#我们选择下载 jenkinsci/blueocean（这个是jenkins集成blueocean的插件，可视化流水线）
docker pull jenkinsci/blueocean
#下载后我们可以运行docker images 命令查看本地镜像
docker images" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="shell hljs"><code class="shell"><span class="hljs-meta">#</span><span class="bash">运行这个命令会查看仓库的jenkins镜像资源</span>
docker search jenkins
<span class="hljs-meta">#</span><span class="bash">运行后你会看到类似这样的</span>
NAME                                   DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED
jenkins                                Official Jenkins Docker image                   4863                [OK]
jenkins/jenkins                        The leading open source automation server       2154
jenkinsci/blueocean                    https://jenkins.io/projects/blueocean           544
jenkinsci/jenkins                      Jenkins Continuous Integration and Delivery …   382
jenkins/jnlp-slave                     a Jenkins agent which can connect to Jenkins…   129                                     [OK]
jenkinsci/jnlp-slave                   A Jenkins slave using JNLP to establish conn…   126                                     [OK]
jenkinsci/slave                        Base Jenkins slave docker image                 65                                      [OK]
jenkins/slave                          base image for a Jenkins Agent, which includ…   43                                      [OK]
jenkinsci/ssh-slave                    A Jenkins SSH Slave docker image                42                                      [OK]
···
<span class="hljs-meta">#</span><span class="bash">我们选择下载 jenkinsci/blueocean（这个是jenkins集成blueocean的插件，可视化流水线）</span>
docker pull jenkinsci/blueocean
<span class="hljs-meta">#</span><span class="bash">下载后我们可以运行docker images 命令查看本地镜像</span>
docker images</code></pre><ol><li>生成jenkins应用的容器</li></ol><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="docker run \
  --name jenkins \
  -d \
  -it \
  -p 8080:8080 \
  -p 50000:50000 \
  -v jenkins:/var/jenkins_home \
  -v /var/run/docker.sock:/var/run/docker.sock \
  -v /etc/localtime:/etc/localtime:ro \
  jenkinsci/blueocean" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="shell hljs"><code class="shell">docker run \
  --name jenkins \
  -d \
  -it \
  -p 8080:8080 \
  -p 50000:50000 \
  -v jenkins:/var/jenkins_home \
  -v /var/run/docker.sock:/var/run/docker.sock \
  -v /etc/localtime:/etc/localtime:ro \
  jenkinsci/blueocean</code></pre><p>我们先来看看命令行都是啥意思</p><ul><li><strong>docker run: </strong>创建一个新容器</li><li><strong>--name jenkins: </strong>将这个容器命名为jenkins（这个后面方便操作）</li><li><strong>-d: </strong>这个参数能让容器到后台运行</li><li><strong>-it:</strong>  <strong>-i</strong> 以交互模式运行容器，<strong>-t</strong> 为容器重新分配一个伪输入终端</li><li><strong>-p:</strong> 端口映射，格式为：<strong>主机(宿主)端口:容器端口</strong></li><li><strong>-v:</strong> 指定一个volume，将容器的/var/jenkins_home的数据持久化保存到名为 jenkins的volume上，这个归主机docker统一管理</li><li><strong>-v /var/run/docker.sock:/var/run/docker.sock:</strong>  jenkins 会用docker容器来做agent，有必要的话把他们缓存下来</li><li><strong>-v /etc/localtime:/etc/localtime:ro  :</strong> 同步容器和主机的时间，ps:这玩意在mac上不好使</li><li><strong>jenkinsci/blueocean:</strong> 这个是<strong>image</strong>镜像文件，docker将以此镜像文件创建一个容器，如果本地不存在会自动拉去线上最新的版本</li></ul><p>这样我们就成功创建运行一个jenkins应用的容器</p><p>运行成功后，如果你是阿里云，你要去添加实例的安全组规则</p><p><span class="img-wrap"><img referrerpolicy="no-referrer" data-src="/img/remote/1460000024453222" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/squares.svg" alt="aliyun-safe-rule" title="aliyun-safe-rule"></span></p><p>因为上面我的jenkins是代理到主机的8080，所以设置阿里云主机</p><p>这样用你的主机的 ip:8080就能看到jenkins的启动页面</p><p><span class="img-wrap"><img referrerpolicy="no-referrer" data-src="/img/remote/1460000024453224" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/squares.svg" alt="jenkins-start" title="jenkins-start"></span></p><p>这个密码 运行查看jenkins容器的日志，拉到最后可以看到</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="docker logs jenkins

*************************************************************
*************************************************************
*************************************************************

Jenkins initial setup is required. An admin user has been created and a password generated.
Please use the following password to proceed to installation:

cb619dcc57574a6592d96asdasdasjasd

This may also be found at: /var/jenkins_home/secrets/initialAdminPassword

*************************************************************
*************************************************************
*************************************************************" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="shell hljs"><code class="shell">docker logs jenkins

*************************************************************
*************************************************************
*************************************************************

Jenkins initial setup is required. An admin user has been created and a password generated.
Please use the following password to proceed to installation:

cb619dcc57574a6592d96asdasdasjasd

This may also be found at: /var/jenkins_home/secrets/initialAdminPassword

*************************************************************
*************************************************************
*************************************************************</code></pre><p><span class="img-wrap"><img referrerpolicy="no-referrer" data-src="/img/remote/1460000024453223" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/squares.svg" alt="jenkins-plugin" title="jenkins-plugin"></span></p><p>耐心的等待安装完成</p><p><span class="img-wrap"><img referrerpolicy="no-referrer" data-src="/img/remote/1460000024453225" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/squares.svg" alt="jenkins-p-install" title="jenkins-p-install"></span></p><p>创建第一个管理用户</p><p><span class="img-wrap"><img referrerpolicy="no-referrer" data-src="/img/remote/1460000024453226" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/squares.svg" alt="jenkins-first-user" title="jenkins-first-user"></span></p><p>老板，看到jenkins了！</p><p><span class="img-wrap"><img referrerpolicy="no-referrer" data-src="/img/remote/1460000024453228" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/squares.svg" alt="jenkins-web" title="jenkins-web"></span></p><p><a href="https://www.jenkins.io/zh/doc/tutorials/" rel="nofollow noreferrer" target="_blank">jenkins的入门教程</a>必须要花时间先看一下，主要了解一下任务啊，声明式和脚本式的两种流水线写法啊，流水线步骤啊</p><h4>2 Jenkins连接Gitee</h4><ol><li>安装插件</li></ol><p>我们要先让jenkins跟git托管仓库连接，gitee、gitlab、github都行，这个我们要安装几个插件</p><ul><li><strong><a href="https://gitee.com/help/articles/4193#article-header0" rel="nofollow noreferrer" target="_blank">Gitee</a></strong></li><li><strong>Multibranch Scan Webhook Trigger</strong></li><li><strong><a href="https://plugins.jenkins.io/generic-webhook-trigger" rel="nofollow noreferrer" target="_blank">Generic Webhook Trigger</a></strong></li></ul><p>安装好后现在先全局配置一下Gitee配置，看<strong><a href="https://gitee.com/help/articles/4193#article-header5" rel="nofollow noreferrer" target="_blank">官方的教程</a></strong></p><p><span class="img-wrap"><img referrerpolicy="no-referrer" data-src="/img/remote/1460000024453227" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/squares.svg" alt="gitee-jenkins-set" title="gitee-jenkins-set"></span></p><ol><li>配置SSH连接gitee</li></ol><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="ssh env    #先连接env服务器

docker ps  #查看正在运行的docker 容器找到jenkins的容器name

docker exec -it jenkins /bin/bash #在运行中的jenkins容器，生成ssh密钥对（看图吧）" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="shell hljs"><code class="shell">ssh env    #先连接env服务器

docker ps  #查看正在运行的docker 容器找到jenkins的容器name

docker exec -it jenkins /bin/bash #在运行中的jenkins容器，生成ssh密钥对（看图吧）</code></pre><p><span class="img-wrap"><img referrerpolicy="no-referrer" data-src="/img/remote/1460000024453230" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/squares.svg" alt="jenkins-gitee-ssh" title="jenkins-gitee-ssh"></span></p><p>还没结束、因为是自定义名字，需要再 ~/.ssh目录下新建一个config配置文件</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="cd ~/.ssh/

vi config
#复制下面的内容
-----------------------------------------------
Host gitee.com
  Preferredauthentications publickey
  IdentityFile ~/.ssh/jenkins-gitee
-----------------------------------------------
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="shell hljs"><code class="shell">cd ~/.ssh/

vi config
<span class="hljs-meta">#</span><span class="bash">复制下面的内容</span>
-----------------------------------------------
Host gitee.com
  Preferredauthentications publickey
  IdentityFile ~/.ssh/jenkins-gitee
-----------------------------------------------
</code></pre><p>这样才能成功执行ssh连接</p><p>生成后的公钥复制在gitee上，个人配置那</p><p><span class="img-wrap"><img referrerpolicy="no-referrer" data-src="/img/remote/1460000024453229" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/squares.svg" alt="jenkins-gitee" title="jenkins-gitee"></span></p><p>创建jenkins链接gitee的凭证，当然也可以在下面新建流水线的时候在添加</p><p><span class="img-wrap"><img referrerpolicy="no-referrer" data-src="/img/remote/1460000024453232" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/squares.svg" alt="jenkins-add-cred" title="jenkins-add-cred"></span></p><h4>3 multi branch pipeline</h4><p>创建流水线任务的时候最好把全局的执行器设置会<strong>3个以上</strong>，不然我们这个仓库触发多有分支构建的时候会不够资源导致失败</p><p><span class="img-wrap"><img referrerpolicy="no-referrer" data-src="/img/remote/1460000024453231" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/squares.svg" alt="execnum" title="execnum"></span></p><p>​        现在我们开始来新建任务吧</p><p><span class="img-wrap"><img referrerpolicy="no-referrer" data-src="/img/remote/1460000024453233" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/squares.svg" alt="jenkins-new-job" title="jenkins-new-job"></span></p><p>按图上设置分支源、设置webhook的token等</p><p><span class="img-wrap"><img referrerpolicy="no-referrer" data-src="/img/remote/1460000024453235" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/squares.svg" alt="job-add" title="job-add"></span></p><p>设置好存，第一次会会自动拉去仓库的代码去执行构建任务</p><p><span class="img-wrap"><img referrerpolicy="no-referrer" data-src="/img/remote/1460000024453234" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/squares.svg" alt="job-start" title="job-start"></span></p><p>点击状态，可以看到分支任务拉去的情况，我们项目的feature分支和hoxfix分支是不作为构建任务的</p><p><span class="img-wrap"><img referrerpolicy="no-referrer" data-src="/img/remote/1460000024453238" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/squares.svg" alt="branch-view" title="branch-view"></span></p><p>这个就是dev分支对应的pipeline任务步骤啦</p><p><span class="img-wrap"><img referrerpolicy="no-referrer" data-src="/img/remote/1460000024453237" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/squares.svg" alt="dev-pipeline" title="dev-pipeline"></span></p><p>因为我们安装的是jenkinsci / blueocean （就是jenkins安装了blueocean插件的集合），这个方便我们对任务的可视化</p><p>点击左侧导航的Blue Ocean<span class="img-wrap"><img referrerpolicy="no-referrer" data-src="/img/remote/1460000024453240" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/squares.svg" alt="Blue-ocean" title="Blue-ocean"></span></p><p><span class="img-wrap"><img referrerpolicy="no-referrer" data-src="/img/remote/1460000024453239" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/squares.svg" alt="blue-ocean-branch" title="blue-ocean-branch"></span></p><p>分别点击 dev、release、master分支，看到</p><p><span class="img-wrap"><img referrerpolicy="no-referrer" data-src="/img/remote/1460000024453241" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/squares.svg" alt="pipeline-dev" title="pipeline-dev"></span></p><p><span class="img-wrap"><img referrerpolicy="no-referrer" data-src="/img/remote/1460000024453242" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/squares.svg" alt="pipeline-release" title="pipeline-release"></span></p><p><span class="img-wrap"><img referrerpolicy="no-referrer" data-src="/img/remote/1460000024453243" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/squares.svg" alt="pipeline-master" title="pipeline-master"></span></p><p>可以注意到我们的分支，在dev和release启动的时候会自动持续交付，到master的时候多了一个选择按钮，因为master是生产环境，我们一般是需要手动部署上线好</p><p>这个几个流水线是基于每个分支的Jenkinsfile来生成运行的</p><h4>4 webhook 设置</h4><p>说道这个刚刚只是新建了仓库后自动拉去分支触发的任务，现在我们要来设置webhook触发。</p><p><strong>webhookURL</strong>:<a href="http://xn--jenkinsurl-cl5pq178a/multibranch-webhook-trigger/invoke?token=vueci" target="_blank">http:你的jenkinsurl/multibran...</a></p><p><span class="img-wrap"><img referrerpolicy="no-referrer" data-src="/img/remote/1460000024453245" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/squares.svg" alt="gitee-webhook" title="gitee-webhook"></span></p><p>现在我们来试一下触发webhook，为了方便我们先不新建功能分支了，直接在dev分支行做push</p><p>我们来给jenkinsfile做点修改吧</p><ol><li>添加新的代码，add，commit，push</li></ol><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="echo “test wehook”" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="shell hljs"><code class="shell" style="word-break: break-word; white-space: initial;">echo “test wehook”</code></pre><p><span class="img-wrap"><img referrerpolicy="no-referrer" data-src="/img/remote/1460000024453244" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/squares.svg" alt="git push" title="git push"></span></p><ol><li>看我们的jenkins blue-ocean界面，dev分支的任务触发了</li></ol><p><span class="img-wrap"><img referrerpolicy="no-referrer" data-src="/img/remote/1460000024453246" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/squares.svg" alt="git-push-trigger" title="git-push-trigger"></span></p><p>等成功后，点击步骤 pre-build 可以看到刚刚添加的echo信息</p><p><span class="img-wrap"><img referrerpolicy="no-referrer" data-src="/img/remote/1460000024453248" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/squares.svg" alt="git push pipeline" title="git push pipeline"></span></p><p>当然也可以新建分支 feature-*，推送到远仓库，请求合并到release分支，合并成功后也会触发release的任务</p><h4><strong>5 pipeline的stage 简介</strong></h4><p>上面大概流程完成了，我们现在来看一下，pipeline上的 pre-build、build-parellel：[ build-dev | build-master | build-release ]、artifacts-manage、deliver、deloy</p><p>这些是流水线pipeline的步骤stage，我们在Jenkinsfile里面自定义的，咦，好像少了test步骤，因为我这里不做自动化测试哈哈哈，需要的慢点自己加上就行</p><p>在设置pipeline的stage前，我们先来明白我们要做什么</p><p><strong>pre-build</strong>：打包前的工作</p><ul><li>设置缓存目录 和 文件</li><li>判断是不是最近构建过，构建过直接调用缓存的包，重新部署就行，不用重新build什么的</li><li>判断需不需要重新安装node_modules包依赖</li></ul><p><strong>build-env</strong>：打包</p><ul><li>按分支运行打包的脚本</li></ul><p><strong>artifacts-manage</strong>：制品管理</p><ul><li>构建后的资源 /dist 打包压缩，到缓存目录或者仓库，归档</li></ul><p><strong>deliver</strong>：交付</p><ul><li>这个步骤一步给开发环境、测试环境，预发布环境用，打包后的代码自动交付到这几个环境</li></ul><p><strong>deploy</strong>：部署</p><ul><li>这个给生产环境用，打包后到这里会设置一个按钮，手动点击再运行部署上线脚本</li></ul><h4>Jenkinsfile详解</h4><p>jenkins通过读取我们项目根目录这个<strong>Jenkinsfile</strong>,来生成相应的流水线任务，这个内容比较多，做成使用目录方便阅读吧</p><p>现在我们要看看这个pipeline的配置文件Jenkinsfile，还是要啰嗦一下，对着<a href="https://www.jenkins.io/zh/doc/tutorials/" rel="nofollow noreferrer" target="_blank">官方教程</a>扫几遍教程+做一次，对着<a href="https://www.jenkins.io/zh/doc/tutorials/" rel="nofollow noreferrer" target="_blank">官方教程</a>扫几遍教程+做一次，对着<a href="https://www.jenkins.io/zh/doc/tutorials/" rel="nofollow noreferrer" target="_blank">官方教程</a>扫几遍教程+做一次，重要的事情我说三遍了，希望老板你能做一遍</p><h5>1 Jenkinsfile 预览</h5><p>我们先来看看<strong>Jenkinsfile</strong></p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="pipeline {
    agent any                            // agent节点，any告诉jenkins 任何可用的agent都能执行                

    environment {
        Name = &#39;Eric&#39;                     // 这个是自定义的顶级pipeline全局变量
    }

    options {
        disableConcurrentBuilds()       // 在多分支的流水线中限制并发
    }

    stages {
        stage(&#39;pre-build&#39;) {           //  自定义步骤 pre-build
            
            when {
                anyOf {               //   多分支才有的判断，一个真就通过过 
                    branch &#39;dev&#39;
                    branch &#39;release&#39;
                    branch &#39;master&#39; 
                }
            }

            agent {                  //    代表阶段运行在一个代理的docker nodejs容器中
                docker {
                    image &#39;node:10.21.0&#39;  
                    // 想在 docker 容器中运行代码，但是也想使用流水线所定义的相同节点或和工作空间，必须设置这个
                    reuseNode true   
                }       
            }

            steps {
                sh &quot;printenv&quot;
                echo &quot;pre-build&quot;
                echo &quot;test webhook&quot;
            }
        }
      
      
        stage(&#39;build-env&#39;) {
            
            when {
                anyOf { 
                    branch &#39;dev&#39;
                    branch &#39;release&#39;
                    branch &#39;master&#39; 
                }
            }
          
              // 如果设置了true 那么我们有任何一个并发步骤失败那就全都都失败，
            // 因为我们是用来做不同分支任务触发时候的构建选择，所以这个不需要
            failFast false        
            
            parallel {

                stage(&#39;build-dev&#39;) {
                                  
                    when {
                        // beforeAgent 是指在进入agent ，如果when的条件对，才进入，错则不进入
                        // 就是可以加快流水线的运行啦
                        beoreAgent true   
                        branch &#39;dev&#39;
                    }
                  
                    agent {
                        docker {
                            image &#39;node:10.21.0&#39; 
                            reuseNode true
                        }       
                    }  
                  
                    steps {
                       echo &quot;build-dev&quot;
                    }
                }

                stage(&#39;build-release&#39;) {

                    when {
                        beforeAgent true
                        branch &#39;release&#39;
                    }
                  
                    agent {
                        docker {
                            image &#39;node:10.21.0&#39; 
                            reuseNode true

                        }       
                    }      

                    steps{
                        echo &quot;build-release&quot;
                    }
                }
                stage(&#39;build-master&#39;) {

                    agent {
                        docker {
                            image &#39;node:10.21.0&#39; 
                            reuseNode true
                        }       
                    }

                    when {
                        beforeAgent true
                        branch &#39;master&#39;
                    }

                    steps {
                      echo &quot;build-master&quot;
                    }
                }
            }
        }

        stage(&quot;artifacts-manage&quot;){

            steps {
               echo &quot;artifacts&quot;
            }
        }

        stage(&#39;deliver&#39;) {

            when {
                beforeAgent true
                anyOf { 
                    branch &#39;dev&#39;
                    branch &#39;release&#39;
                }
            }

            steps {
                echo &quot;start deliver&quot;
            }
        }  
        
        stage(&#39;deploy&#39;) {

            when { 
                beforeAgent true
                branch &#39;master&#39; 
            }

            steps {
                // 这个就是生成一个按钮，我们用来手动发布的
                input message: &quot;Should you deploy?&quot;
                echo &quot;start deloy&quot;
            }

        }       
    }

      //post 就是流水线的运行结果状态啦，我们慢点会在这里设置邮件通知
    post { 
    
        changed{
            echo &#39;I changed!&#39;
        }

        failure{
            echo &#39;I failed!&#39;
        }

        success{
            echo &#39;I success&#39;
        }

        always{
            echo &#39;I always&#39;
        }
        unstable{
            echo &quot;unstable&quot;
        }
        aborted{
            echo &quot;aborted&quot;
        }
    }

}" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="groovy hljs php"><code class="groovy">pipeline {
    agent any                            <span class="hljs-comment">// agent节点，any告诉jenkins 任何可用的agent都能执行                </span>

    environment {
        Name = <span class="hljs-string">'Eric'</span>                     <span class="hljs-comment">// 这个是自定义的顶级pipeline全局变量</span>
    }

    options {
        disableConcurrentBuilds()       <span class="hljs-comment">// 在多分支的流水线中限制并发</span>
    }

    stages {
        stage(<span class="hljs-string">'pre-build'</span>) {           <span class="hljs-comment">//  自定义步骤 pre-build</span>
            
            when {
                anyOf {               <span class="hljs-comment">//   多分支才有的判断，一个真就通过过 </span>
                    branch <span class="hljs-string">'dev'</span>
                    branch <span class="hljs-string">'release'</span>
                    branch <span class="hljs-string">'master'</span> 
                }
            }

            agent {                  <span class="hljs-comment">//    代表阶段运行在一个代理的docker nodejs容器中</span>
                docker {
                    image <span class="hljs-string">'node:10.21.0'</span>  
                    <span class="hljs-comment">// 想在 docker 容器中运行代码，但是也想使用流水线所定义的相同节点或和工作空间，必须设置这个</span>
                    reuseNode <span class="hljs-keyword">true</span>   
                }       
            }

            steps {
                sh <span class="hljs-string">"printenv"</span>
                <span class="hljs-keyword">echo</span> <span class="hljs-string">"pre-build"</span>
                <span class="hljs-keyword">echo</span> <span class="hljs-string">"test webhook"</span>
            }
        }
      
      
        stage(<span class="hljs-string">'build-env'</span>) {
            
            when {
                anyOf { 
                    branch <span class="hljs-string">'dev'</span>
                    branch <span class="hljs-string">'release'</span>
                    branch <span class="hljs-string">'master'</span> 
                }
            }
          
              <span class="hljs-comment">// 如果设置了true 那么我们有任何一个并发步骤失败那就全都都失败，</span>
            <span class="hljs-comment">// 因为我们是用来做不同分支任务触发时候的构建选择，所以这个不需要</span>
            failFast <span class="hljs-keyword">false</span>        
            
            parallel {

                stage(<span class="hljs-string">'build-dev'</span>) {
                                  
                    when {
                        <span class="hljs-comment">// beforeAgent 是指在进入agent ，如果when的条件对，才进入，错则不进入</span>
                        <span class="hljs-comment">// 就是可以加快流水线的运行啦</span>
                        beoreAgent <span class="hljs-keyword">true</span>   
                        branch <span class="hljs-string">'dev'</span>
                    }
                  
                    agent {
                        docker {
                            image <span class="hljs-string">'node:10.21.0'</span> 
                            reuseNode <span class="hljs-keyword">true</span>
                        }       
                    }  
                  
                    steps {
                       <span class="hljs-keyword">echo</span> <span class="hljs-string">"build-dev"</span>
                    }
                }

                stage(<span class="hljs-string">'build-release'</span>) {

                    when {
                        beforeAgent <span class="hljs-keyword">true</span>
                        branch <span class="hljs-string">'release'</span>
                    }
                  
                    agent {
                        docker {
                            image <span class="hljs-string">'node:10.21.0'</span> 
                            reuseNode <span class="hljs-keyword">true</span>

                        }       
                    }      

                    steps{
                        <span class="hljs-keyword">echo</span> <span class="hljs-string">"build-release"</span>
                    }
                }
                stage(<span class="hljs-string">'build-master'</span>) {

                    agent {
                        docker {
                            image <span class="hljs-string">'node:10.21.0'</span> 
                            reuseNode <span class="hljs-keyword">true</span>
                        }       
                    }

                    when {
                        beforeAgent <span class="hljs-keyword">true</span>
                        branch <span class="hljs-string">'master'</span>
                    }

                    steps {
                      <span class="hljs-keyword">echo</span> <span class="hljs-string">"build-master"</span>
                    }
                }
            }
        }

        stage(<span class="hljs-string">"artifacts-manage"</span>){

            steps {
               <span class="hljs-keyword">echo</span> <span class="hljs-string">"artifacts"</span>
            }
        }

        stage(<span class="hljs-string">'deliver'</span>) {

            when {
                beforeAgent <span class="hljs-keyword">true</span>
                anyOf { 
                    branch <span class="hljs-string">'dev'</span>
                    branch <span class="hljs-string">'release'</span>
                }
            }

            steps {
                <span class="hljs-keyword">echo</span> <span class="hljs-string">"start deliver"</span>
            }
        }  
        
        stage(<span class="hljs-string">'deploy'</span>) {

            when { 
                beforeAgent <span class="hljs-keyword">true</span>
                branch <span class="hljs-string">'master'</span> 
            }

            steps {
                <span class="hljs-comment">// 这个就是生成一个按钮，我们用来手动发布的</span>
                input message: <span class="hljs-string">"Should you deploy?"</span>
                <span class="hljs-keyword">echo</span> <span class="hljs-string">"start deloy"</span>
            }

        }       
    }

      <span class="hljs-comment">//post 就是流水线的运行结果状态啦，我们慢点会在这里设置邮件通知</span>
    post { 
    
        changed{
            <span class="hljs-keyword">echo</span> <span class="hljs-string">'I changed!'</span>
        }

        failure{
            <span class="hljs-keyword">echo</span> <span class="hljs-string">'I failed!'</span>
        }

        success{
            <span class="hljs-keyword">echo</span> <span class="hljs-string">'I success'</span>
        }

        always{
            <span class="hljs-keyword">echo</span> <span class="hljs-string">'I always'</span>
        }
        unstable{
            <span class="hljs-keyword">echo</span> <span class="hljs-string">"unstable"</span>
        }
        aborted{
            <span class="hljs-keyword">echo</span> <span class="hljs-string">"aborted"</span>
        }
    }

}</code></pre><p>我们这个脚本是一个声明式流水线，相比脚本式的流程更加清楚明白，也是能更适合生成Blue-Ocean这种可视化的流水线</p><p><strong>读懂上面代码必需要知道的pipeline流水线语法知识点</strong>：</p><ul><li><strong>pipeline</strong>：代表整条流水线，包含整条流水线的逻辑</li><li><strong>environment：</strong> 指令制定一个 键-值对序列，该序列将被定义为所有步骤的环境变量，或者是特定于阶段的步骤， 这取决于 <code>environment</code> 指令在流水线内的位置。</li><li><strong>stages：</strong>stage的容器，stages部分至少有一个stage</li><li><strong>stage：</strong>流水线的阶段、必须指定名字，stage（“名字”）</li><li><strong>steps：</strong>代表阶段中的一个或者多个步骤。一个stage有且只有一个steps</li><li><strong>agent :</strong> 指定流水线的执行位置。流水线中的每个stage都必须在某个地方（物理机、虚拟机、docker容器）执行。agent部分就是负责指定执行环境，pipeline下的agent指定的是所有stage的执行环境</li><li><p><strong>when：</strong> 指令允许流水线根据给定的条件决定是否应该执行阶段。</p><ul><li><strong>beforeAgent</strong> 是指在进入agent ，如果when的条件对才进入，错则不进入，提高构建速度</li><li><strong>branch</strong> 这只适用于多分支流水线。&nbsp;</li><li><strong>expression</strong>当指定的Groovy表达式评估为true时，执行这个阶段, 例如: <code>when { expression { return true } }</code></li><li><strong>anyof</strong> 当至少有一个嵌套条件为真时，执行这个阶段,必须包含至少一个条件，例如: <code>when { anyOf { branch 'master'; branch 'staging' } }</code></li></ul></li><li><strong>post：</strong> 就是流水线的运行结果状态啦，我们慢点会在这里设置邮件通知</li><li><strong>parallel：</strong> 声明式流水线的阶段可以在他们内部声明多隔嵌套阶段, 它们将并行执行。 注意，一个阶段必须只有一个 <code>steps</code> 或 <code>parallel</code> 的阶段。</li></ul><p>更加完整的信息请在<a href="https://www.jenkins.io/zh/doc/book/pipeline/syntax/#%E5%A3%B0%E6%98%8E%E5%BC%8F%E6%B5%81%E6%B0%B4%E7%BA%BF" rel="nofollow noreferrer" target="_blank"><strong>官方文档</strong></a>上查阅吧</p><h5>2 pre-build 阶段</h5><p>接下来我们要开始写<strong>pre-build</strong>步骤的脚本啦啦啦</p><p><strong>pre-build 要实现的功能</strong></p><ul><li>​    判断和新建&amp;更新缓存 目录 &amp; 文件</li><li>​    判断是不是最近构建过，构建过设置回滚标志文件，供后面阶段构建跳过执行、直接调用缓存的包重新部署就行</li><li>​    通过package的缓存和内容的查询对比，判断需不需要删除旧node_modules，运行<code>npm install</code> 重新安装包依赖</li></ul><ol><li>开始之前我们设置几个pipeline的全局变量</li></ol><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="pieline{
  environment {
          cacheDir = &quot;stage&quot; //定义缓存的目录名字
          cachePackage = &quot;${cacheDir}/package.json&quot; //定义缓存的package.json
          cacheCommitIDFile = &quot;${cacheDir}/.commitIDCache.txt&quot; //把成功打包的commitID缓存到这里
                artifactsDir = &quot;${cacheDir}/artifacts&quot; //制品缓存的目录，构建成功的制品我们放这里
                resetFlagFile = &quot;${cacheDir}/.resetFile&quot; //回滚标志的文件
          cacheCommitIDMax = 5         //缓存版本的最大值
   }
  ...
}" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="groovy hljs kotlin"><code class="groovy">pieline{
  environment {
          cacheDir = <span class="hljs-string">"stage"</span> <span class="hljs-comment">//定义缓存的目录名字</span>
          cachePackage = <span class="hljs-string">"<span class="hljs-subst">${cacheDir}</span>/package.json"</span> <span class="hljs-comment">//定义缓存的package.json</span>
          cacheCommitIDFile = <span class="hljs-string">"<span class="hljs-subst">${cacheDir}</span>/.commitIDCache.txt"</span> <span class="hljs-comment">//把成功打包的commitID缓存到这里</span>
                artifactsDir = <span class="hljs-string">"<span class="hljs-subst">${cacheDir}</span>/artifacts"</span> <span class="hljs-comment">//制品缓存的目录，构建成功的制品我们放这里</span>
                resetFlagFile = <span class="hljs-string">"<span class="hljs-subst">${cacheDir}</span>/.resetFile"</span> <span class="hljs-comment">//回滚标志的文件</span>
          cacheCommitIDMax = <span class="hljs-number">5</span>         <span class="hljs-comment">//缓存版本的最大值</span>
   }
  ...
}</code></pre><ol><li>步骤</li></ol><p>stage('pre-build') {           //  自定义步骤 pre-build</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="stage(&#39;pre-build&#39;) {           //  自定义步骤 pre-build

  when {
    anyOf {               //   多分支才有的判断，一个真就通过过 
      branch &#39;dev&#39;
      branch &#39;release&#39;
      branch &#39;master&#39; 
    }
  }

  agent {                  //    代表阶段运行在一个代理的docker nodejs容器中
    docker {
      image &#39;node:10.21.0&#39;  
      // 想在 docker 容器中运行代码，但是也想使用流水线所定义的相同节点或和工作空间，必须设置这个
      reuseNode true   
    }       
  }

  steps {
    sh &quot;printenv&quot; //打印jenkins全局环境变量
    sh &#39;./jenkins/script/pre-build.sh&#39; //我们把主要的功能写在pre-build.sh脚本里面
  }
}" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="groovy hljs kotlin"><code class="groovy">stage(<span class="hljs-string">'pre-build'</span>) {           <span class="hljs-comment">//  自定义步骤 pre-build</span>

  <span class="hljs-keyword">when</span> {
    anyOf {               <span class="hljs-comment">//   多分支才有的判断，一个真就通过过 </span>
      branch <span class="hljs-string">'dev'</span>
      branch <span class="hljs-string">'release'</span>
      branch <span class="hljs-string">'master'</span> 
    }
  }

  agent {                  <span class="hljs-comment">//    代表阶段运行在一个代理的docker nodejs容器中</span>
    docker {
      image <span class="hljs-string">'node:10.21.0'</span>  
      <span class="hljs-comment">// 想在 docker 容器中运行代码，但是也想使用流水线所定义的相同节点或和工作空间，必须设置这个</span>
      reuseNode <span class="hljs-literal">true</span>   
    }       
  }

  steps {
    sh <span class="hljs-string">"printenv"</span> <span class="hljs-comment">//打印jenkins全局环境变量</span>
    sh <span class="hljs-string">'./jenkins/script/pre-build.sh'</span> <span class="hljs-comment">//我们把主要的功能写在pre-build.sh脚本里面</span>
  }
}</code></pre><p>然后新建<strong>pre-build.sh</strong>脚本 jenkins/script/pre-build.sh</p><p>新建好需要执行，给脚本执行权限</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="chmod +x jenkins/script/pre-build.sh" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="shell hljs"><code class="shell" style="word-break: break-word; white-space: initial;">chmod +x jenkins/script/pre-build.sh</code></pre><p><strong>#!/bin/bash</strong>:此脚本使用<strong>/bin/sh</strong>来解释执行</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="#!/bin/bash

isResetID=false                                      #回滚标志判断
cmpFlag=1                                            #package.json文件的对比标志
packageJsonChange=false                              #package.json文件变化标志              

# set -x
#先设置淘宝源加快安装速度，这里我们慢点要替换成我们自己搭建的更快
npm config set registry https://registry.npm.taobao.org

#判断缓存目录存在与否
if [ ! -d $cacheDir ]
    then
        echo &quot;no cache dir&quot;
        mkdir $cacheDir
        cp package.json &quot;$cacheDir/&quot;
        touch $cacheCommitIDFile
        # echo  $GIT_COMMIT &gt; $cacheCommitIDFile #先不用写入
        echo  &quot;npm 安装&quot;
        npm i ||  exit 1
#判断缓存文件存在与否
elif [ ! -f $cachePackage ] || [ ! -f $cacheCommitIDFile ]
    then
        if [ ! -f $cachePackage ]
        then 
            echo &quot;cache file package.json does no exist&quot;
            echo &quot;cp package.json to cache dir&quot;
            cp package.json &quot;$cacheDir/&quot;
        fi

        if [ ! -f $cacheCommitIDFile ]
        then 
            echo &quot;cache file commitIdCache.txt does no exist&quot;
            echo &quot;create commitIdCache.txt to cache dir&quot;
            echo &quot;write the ID to commitIdCache.txt&quot;
            touch $cacheCommitIDFile
        echo  $GIT_COMMIT &gt; $cacheCommitIDFile
        fi

        rm -rf node_modules
        sleep 1
        echo  &quot;npm 安装&quot;
        npm i || exit 1

else 
    echo &quot;cache file exists&quot;

    #这里我们判断一下新提交的commitID是不是有存在于缓存
    for commitId in `cat &quot;$cacheCommitIDFile&quot;`
    do
        if [ $commitId = $GIT_COMMIT ]
        then
            isResetID=true
        fi
    done

    #对比新旧的package.json，看是否有变化
    cmp -s package.json $cachePackage
    cmpFlag=$?
    #compare package.json 
    if [ $cmpFlag != 0 ] 
    then 
        packageJsonChange=true
    fi

    #如果是重复的ID
    if [ $isResetID = true ]
    then
        echo &quot;reset啦啦啦啦&quot;
        #我们还是需要重置一下新的package
        cp -f package.json &quot;$cacheDir/&quot;
        #这里我们要一个创建代表回滚标志的文件,提供给pipeline判断以供跳过不必要的步骤执行，提高执行的速度
        touch ${resetFlagFile}
    # ID不是重复的,而且package.json有更新
    elif [ $packageJsonChange = true ]
    then 
        echo &quot;package 更新&quot;
        cp -f package.json &quot;$cacheDir/&quot;
        rm -rf node_modules
        sleep 1
        npm i || exit 1
    else 
        ehco &quot;啥都不用干哈哈&quot;
    fi

fi
# set +x

" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="shell hljs"><code class="shell"><span class="hljs-meta">#</span><span class="bash">!/bin/bash</span>

isResetID=false                                      #回滚标志判断
cmpFlag=1                                            #package.json文件的对比标志
packageJsonChange=false                              #package.json文件变化标志              
<span class="hljs-meta">
#</span><span class="bash"> <span class="hljs-built_in">set</span> -x</span>
<span class="hljs-meta">#</span><span class="bash">先设置淘宝源加快安装速度，这里我们慢点要替换成我们自己搭建的更快</span>
npm config set registry https://registry.npm.taobao.org
<span class="hljs-meta">
#</span><span class="bash">判断缓存目录存在与否</span>
if [ ! -d $cacheDir ]
    then
        echo "no cache dir"
        mkdir $cacheDir
        cp package.json "$cacheDir/"
        touch $cacheCommitIDFile
        # echo  $GIT_COMMIT &gt; $cacheCommitIDFile #先不用写入
        echo  "npm 安装"
        npm i ||  exit 1
<span class="hljs-meta">#</span><span class="bash">判断缓存文件存在与否</span>
elif [ ! -f $cachePackage ] || [ ! -f $cacheCommitIDFile ]
    then
        if [ ! -f $cachePackage ]
        then 
            echo "cache file package.json does no exist"
            echo "cp package.json to cache dir"
            cp package.json "$cacheDir/"
        fi

        if [ ! -f $cacheCommitIDFile ]
        then 
            echo "cache file commitIdCache.txt does no exist"
            echo "create commitIdCache.txt to cache dir"
            echo "write the ID to commitIdCache.txt"
            touch $cacheCommitIDFile
        echo  $GIT_COMMIT &gt; $cacheCommitIDFile
        fi

        rm -rf node_modules
        sleep 1
        echo  "npm 安装"
        npm i || exit 1

else 
    echo "cache file exists"

    #这里我们判断一下新提交的commitID是不是有存在于缓存
    for commitId in `cat "$cacheCommitIDFile"`
    do
        if [ $commitId = $GIT_COMMIT ]
        then
            isResetID=true
        fi
    done

    #对比新旧的package.json，看是否有变化
    cmp -s package.json $cachePackage
    cmpFlag=$?
    #compare package.json 
    if [ $cmpFlag != 0 ] 
    then 
        packageJsonChange=true
    fi

    #如果是重复的ID
    if [ $isResetID = true ]
    then
        echo "reset啦啦啦啦"
        #我们还是需要重置一下新的package
        cp -f package.json "$cacheDir/"
        #这里我们要一个创建代表回滚标志的文件,提供给pipeline判断以供跳过不必要的步骤执行，提高执行的速度
        touch ${resetFlagFile}
    # ID不是重复的,而且package.json有更新
    elif [ $packageJsonChange = true ]
    then 
        echo "package 更新"
        cp -f package.json "$cacheDir/"
        rm -rf node_modules
        sleep 1
        npm i || exit 1
    else 
        ehco "啥都不用干哈哈"
    fi

fi
<span class="hljs-meta">#</span><span class="bash"> <span class="hljs-built_in">set</span> +x</span>

</code></pre><p>更新push到远程仓库，去jenkins查看构建状态</p><ol><li><p>构建成功后，我们进去工作空间看看，通过web界面或者docker 容器命令行</p><ol><li>通过web 界面很简单，就是点点点</li></ol></li></ol><p><span class="img-wrap"><img referrerpolicy="no-referrer" data-src="/img/remote/1460000024453247" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/squares.svg" alt="dev-space" title="dev-space"></span></p><ol><li>命令行</li></ol><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="#工作空间一般命名是项目名字_分支名
ssh env
docker exec -it jenkins /bin/bash
cd var/jenkins_home/workspace
cd vue-ci-start_dev
ls" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="shell hljs"><code class="shell"><span class="hljs-meta">#</span><span class="bash">工作空间一般命名是项目名字_分支名</span>
ssh env
docker exec -it jenkins /bin/bash
cd var/jenkins_home/workspace
cd vue-ci-start_dev
ls</code></pre><p><span class="img-wrap"><img referrerpolicy="no-referrer" data-src="/img/remote/1460000024453251" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/squares.svg" alt="dev-sp-shell" title="dev-sp-shell"></span></p><p>我们可以看到我们在pre-build 步骤里面，创建的 目录<strong>stage</strong>和文件<strong>stage/package.json</strong>、<strong>stage/.commitIDCache.txt</strong></p><p>当然也有拉取的项目文件和安装的<strong>node_modules</strong>等</p><p><strong>PS：记住这个文件.commitIDCache.txt，我们用来判断有没有重复ID的，当我们打包压缩成功后，我们才会去把本次的commitID写到文件里面去</strong></p><h5>3 build-env 阶段</h5><ul><li>按分支运行打包的脚本</li></ul><p>这里主要是构建我们的应用啦，因为我们有dev、release、master环境的代码需要构建，所以用了stage的parallel,</p><p>当webhook触发SCM触发任务时，我们通过when判断是那个分支就运行哪个分支的构建步骤</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="stage(&#39;build-env&#39;) {

  when {
    anyOf { 
    branch &#39;dev&#39;
    branch &#39;release&#39;
    branch &#39;master&#39; 
    }
  }
// 如果设置了true 那么我们有任何一个并发步骤失败那就全都都失败，
// 因为我们是用来做不同分支任务触发时候的构建选择，所以这个不需要
    failFast false        
  parallel {

    stage(&#39;build-dev&#39;) {
            when {
        // beforeAgent 是指在进入agent ，如果when的条件对，才进入，错则不进入
        // 就是可以加快流水线的运行啦
        beoreAgent true   
        branch &#39;dev&#39;
      }
      agent {
        docker {
        image &#39;node:10.21.0&#39; 
        reuseNode true
        }       
      }  

      steps {
        echo &quot;build-dev&quot;
        sh &quot;./jenkins/script/build-dev.sh&quot;
      }
    }

    stage(&#39;build-release&#39;) {
      when {
        beforeAgent true
        branch &#39;release&#39;
      }

      agent {
        docker {
          image &#39;node:10.21.0&#39; 
          reuseNode true
        }       
      }      

      steps{
          echo &quot;build-release&quot;
        sh &quot;./jenkins/script/build-release.sh&quot;
      }
    }
    stage(&#39;build-master&#39;) { 
      when {
        beforeAgent true
        branch &#39;master&#39;
      }
      
      agent {
        docker {
          image &#39;node:10.21.0&#39; 
          reuseNode true
          }       
        }
      
      steps {
        echo &quot;build-master&quot;
        sh &quot;./jenkins/script/build-master.sh&quot;
      }
    }
  }
}" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="groovy hljs properties"><code class="groovy"><span class="hljs-meta">stage('build-env')</span> <span class="hljs-string">{</span>

  <span class="hljs-attr">when</span> <span class="hljs-string">{</span>
    <span class="hljs-attr">anyOf</span> <span class="hljs-string">{ </span>
    <span class="hljs-attr">branch</span> <span class="hljs-string">'dev'</span>
    <span class="hljs-attr">branch</span> <span class="hljs-string">'release'</span>
    <span class="hljs-attr">branch</span> <span class="hljs-string">'master' </span>
    <span class="hljs-attr">}</span>
  <span class="hljs-attr">}</span>
<span class="hljs-meta">//</span> <span class="hljs-string">如果设置了true 那么我们有任何一个并发步骤失败那就全都都失败，</span>
<span class="hljs-meta">//</span> <span class="hljs-string">因为我们是用来做不同分支任务触发时候的构建选择，所以这个不需要</span>
    <span class="hljs-attr">failFast</span> <span class="hljs-string">false        </span>
  <span class="hljs-attr">parallel</span> <span class="hljs-string">{</span>

    <span class="hljs-meta">stage('build-dev')</span> <span class="hljs-string">{</span>
            <span class="hljs-attr">when</span> <span class="hljs-string">{</span>
        <span class="hljs-meta">//</span> <span class="hljs-string">beforeAgent 是指在进入agent ，如果when的条件对，才进入，错则不进入</span>
        <span class="hljs-meta">//</span> <span class="hljs-string">就是可以加快流水线的运行啦</span>
        <span class="hljs-attr">beoreAgent</span> <span class="hljs-string">true   </span>
        <span class="hljs-attr">branch</span> <span class="hljs-string">'dev'</span>
      <span class="hljs-attr">}</span>
      <span class="hljs-attr">agent</span> <span class="hljs-string">{</span>
        <span class="hljs-attr">docker</span> <span class="hljs-string">{</span>
        <span class="hljs-attr">image</span> <span class="hljs-string">'node:10.21.0' </span>
        <span class="hljs-attr">reuseNode</span> <span class="hljs-string">true</span>
        <span class="hljs-meta">}</span>       <span class="hljs-string"></span>
      <span class="hljs-meta">}</span>  <span class="hljs-string"></span>

      <span class="hljs-attr">steps</span> <span class="hljs-string">{</span>
        <span class="hljs-attr">echo</span> <span class="hljs-string">"build-dev"</span>
        <span class="hljs-attr">sh</span> <span class="hljs-string">"./jenkins/script/build-dev.sh"</span>
      <span class="hljs-attr">}</span>
    <span class="hljs-attr">}</span>

    <span class="hljs-meta">stage('build-release')</span> <span class="hljs-string">{</span>
      <span class="hljs-attr">when</span> <span class="hljs-string">{</span>
        <span class="hljs-attr">beforeAgent</span> <span class="hljs-string">true</span>
        <span class="hljs-attr">branch</span> <span class="hljs-string">'release'</span>
      <span class="hljs-attr">}</span>

      <span class="hljs-attr">agent</span> <span class="hljs-string">{</span>
        <span class="hljs-attr">docker</span> <span class="hljs-string">{</span>
          <span class="hljs-attr">image</span> <span class="hljs-string">'node:10.21.0' </span>
          <span class="hljs-attr">reuseNode</span> <span class="hljs-string">true</span>
        <span class="hljs-meta">}</span>       <span class="hljs-string"></span>
      <span class="hljs-meta">}</span>      <span class="hljs-string"></span>

      <span class="hljs-attr">steps{</span>
          <span class="hljs-attr">echo</span> <span class="hljs-string">"build-release"</span>
        <span class="hljs-attr">sh</span> <span class="hljs-string">"./jenkins/script/build-release.sh"</span>
      <span class="hljs-attr">}</span>
    <span class="hljs-attr">}</span>
    <span class="hljs-meta">stage('build-master')</span> <span class="hljs-string">{ </span>
      <span class="hljs-attr">when</span> <span class="hljs-string">{</span>
        <span class="hljs-attr">beforeAgent</span> <span class="hljs-string">true</span>
        <span class="hljs-attr">branch</span> <span class="hljs-string">'master'</span>
      <span class="hljs-attr">}</span>
      
      <span class="hljs-attr">agent</span> <span class="hljs-string">{</span>
        <span class="hljs-attr">docker</span> <span class="hljs-string">{</span>
          <span class="hljs-attr">image</span> <span class="hljs-string">'node:10.21.0' </span>
          <span class="hljs-attr">reuseNode</span> <span class="hljs-string">true</span>
          <span class="hljs-meta">}</span>       <span class="hljs-string"></span>
        <span class="hljs-attr">}</span>
      
      <span class="hljs-attr">steps</span> <span class="hljs-string">{</span>
        <span class="hljs-attr">echo</span> <span class="hljs-string">"build-master"</span>
        <span class="hljs-attr">sh</span> <span class="hljs-string">"./jenkins/script/build-master.sh"</span>
      <span class="hljs-attr">}</span>
    <span class="hljs-attr">}</span>
  <span class="hljs-attr">}</span>
<span class="hljs-attr">}</span></code></pre><p>在jenkins/script目录下新建三个构建脚本：<strong>build-dev.sh</strong> 、<strong>build-release.sh</strong>、<strong>build-master.sh</strong> </p><p>分别对应dev开发环境的构建、release测试环境的构建、master线上生产环境的构建</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="#build-dev.sh
npm run build-dev || exit 1" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="shell hljs"><code class="shell"><span class="hljs-meta">#</span><span class="bash">build-dev.sh</span>
npm run build-dev || exit 1</code></pre><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="#build-release.sh
npm run build-release || exit 1" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="shell hljs"><code class="shell"><span class="hljs-meta">#</span><span class="bash">build-release.sh</span>
npm run build-release || exit 1</code></pre><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="#build-master.sh
npm run build || exit 1" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="shell hljs"><code class="shell"><span class="hljs-meta">#</span><span class="bash">build-master.sh</span>
npm run build || exit 1</code></pre><p><strong>PS</strong>：记得给脚本执行 <code>chmod +x </code> <strong>给执行权限</strong></p><p>运行的具体脚本是在package.json里面定义srcipt的</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="&quot;scripts&quot;: {
        &quot;serve&quot;: &quot;vue-cli-service serve&quot;,
        &quot;build-dev&quot;: &quot;vue-cli-service build --mode dev&quot;,
        &quot;build-release&quot;: &quot;vue-cli-service build --mode prod&quot;,
        &quot;build&quot;: &quot;vue-cli-service build &quot;,
        &quot;lint&quot;: &quot;vue-cli-service lint&quot;
 }," title="" data-original-title="复制"></span>
        </div>
        </div><pre class="json hljs"><code class="json"><span class="hljs-string">"scripts"</span>: {
        <span class="hljs-attr">"serve"</span>: <span class="hljs-string">"vue-cli-service serve"</span>,
        <span class="hljs-attr">"build-dev"</span>: <span class="hljs-string">"vue-cli-service build --mode dev"</span>,
        <span class="hljs-attr">"build-release"</span>: <span class="hljs-string">"vue-cli-service build --mode prod"</span>,
        <span class="hljs-attr">"build"</span>: <span class="hljs-string">"vue-cli-service build "</span>,
        <span class="hljs-attr">"lint"</span>: <span class="hljs-string">"vue-cli-service lint"</span>
 },</code></pre><p>--mode [mode]就是指加载 根目录下的.env.[mode]文件：例如 <code>--mode dev</code> 就是加载根目录下的 .env.dev文件</p><p>具体可以看<a href="https://cli.vuejs.org/zh/guide/mode-and-env.html" rel="nofollow noreferrer" target="_blank">vue-cli的官方文档</a></p><p>现在测试一下在各个分支的运行打包情况吧</p><h5>4 artifacts-manage 阶段</h5><ul><li>构建后的资源 dist 打包压缩存到缓存目录或者仓库，除了可以下载查阅，也方便分支回滚后快速部署</li><li>我们还设定了制品储存的数量，免得任务多的时候，构建次数一多硬盘空间不够</li></ul><p>我们小团队用的是下面这中最朴素的归档打包方法，当然要逼格你可以自己搭<strong>Nexus</strong>等平台</p><p>到了制品管理阶段啦，我们成功打包后的文件都在根目录的<strong>dist</strong>目录下，这个是webpack控制的，可以改</p><p>Jenkinsfile添加执行脚本代码</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="stage(&quot;artifacts-manage&quot;){
    steps {
      echo &quot;artifacts&quot;
      sh &#39;./jenkins/script/artifacts-manage.sh&#39;
    }
}" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="groovy hljs bash"><code class="groovy">stage(<span class="hljs-string">"artifacts-manage"</span>){
    steps {
      <span class="hljs-built_in">echo</span> <span class="hljs-string">"artifacts"</span>
      sh <span class="hljs-string">'./jenkins/script/artifacts-manage.sh'</span>
    }
}</code></pre><p>在jenkins/script目录下新建脚本:<strong>artifacts-manage.sh</strong>,<code>chmod +x </code> <strong>给执行权限</strong></p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="#!/bin/bash
#set -x

#创建缓存目录
if [ ! -d $artifactsDir ]
then
    mkdir $artifactsDir
fi

#打包压缩 dist 文件
tar -zcvf $artifactsDir/${GIT_COMMIT}_dist.tar.gz dist

FileNum=$(ls -l $artifactsDir | grep ^-  | wc -l)



#更新缓存库的内容
while [ $FileNum -gt $cacheCommitIDMax ]
do
    OldFile=$(ls -rt $artifactsDir/* | head -1)
    echo  &quot;Delete File:$OldFile&quot; 
    rm -f $OldFile
    let &quot;FileNum--&quot;
done

#这里可以把commitID存到之前的缓存文件
CommitIDNum=`cat $cacheCommitIDFile | wc -l`

    if [ $CommitIDNum -ge $cacheCommitIDMax ]
    then
        sed -i &#39;1d&#39; $cacheCommitIDFile
    fi
    echo 
    sleep 1
    echo $GIT_COMMIT &gt;&gt; $cacheCommitIDFile
# set +x" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="shell hljs"><code class="shell"><span class="hljs-meta">#</span><span class="bash">!/bin/bash</span>
<span class="hljs-meta">#</span><span class="bash"><span class="hljs-built_in">set</span> -x</span>
<span class="hljs-meta">
#</span><span class="bash">创建缓存目录</span>
if [ ! -d $artifactsDir ]
then
    mkdir $artifactsDir
fi
<span class="hljs-meta">
#</span><span class="bash">打包压缩 dist 文件</span>
tar -zcvf $artifactsDir/${GIT_COMMIT}_dist.tar.gz dist

FileNum=$(ls -l $artifactsDir | grep ^-  | wc -l)
<span class="hljs-meta">


#</span><span class="bash">更新缓存库的内容</span>
while [ $FileNum -gt $cacheCommitIDMax ]
do
    OldFile=$(ls -rt $artifactsDir/* | head -1)
    echo  "Delete File:$OldFile" 
    rm -f $OldFile
    let "FileNum--"
done
<span class="hljs-meta">
#</span><span class="bash">这里可以把commitID存到之前的缓存文件</span>
CommitIDNum=`cat $cacheCommitIDFile | wc -l`

    if [ $CommitIDNum -ge $cacheCommitIDMax ]
    then
        sed -i '1d' $cacheCommitIDFile
    fi
    echo 
    sleep 1
    echo $GIT_COMMIT &gt;&gt; $cacheCommitIDFile
<span class="hljs-meta">#</span><span class="bash"> <span class="hljs-built_in">set</span> +x</span></code></pre><p>我们再做一次push触发jenkins的流水线，构建好后我们去jenkins任务的工作空间</p><p><span class="img-wrap"><img referrerpolicy="no-referrer" data-src="/img/remote/1460000024453249" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/squares.svg" alt="artifacts-manage" title="artifacts-manage"></span></p><p>我们看到项目跟目录下有打包后生成的 <strong>dist</strong> 文件夹、stage 里面有我们的缓存文件</p><p>查看  .commitIDCache.txt 文件发现了我们把这次的git commit ID  ：<strong>16c0451ba1368ada4e29ad6ac3ffb44f0ddb52a0</strong> 写入在里面了</p><p>再看一下 <strong>stage/artifacts</strong>目录下的文件，发现有我们打包压缩后的文件啦 <strong>16c0451ba1368ada4e29ad6ac3ffb44f0ddb52a0_dist.tar.gz</strong></p><p>因为我们设置了缓存五个版本，我们来测试一下功能：在做5次提交push，看看会不会除去一开始这个缓存的ID和文件，看上图可以看到</p><p>缓存的commit ID 和 文件都更新到了最近的版本，之前第六个版本已删掉啦啦啦😝</p><p>但是这样我们先简单的下载本次成功构建后归档的东西好像还有点麻烦啊，别慌，jenkins还提供了<strong>archiveArtifacts</strong> 步骤</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="stage(&quot;artifacts-manage&quot;){
    steps {
      echo &quot;artifacts&quot;
      sh &#39;./jenkins/script/artifacts-manage.sh&#39;
      archiveArtifacts artifacts:&quot;${artifactsDir}/${GIT_COMMIT}_dist.tar.gz&quot; // 把我们本次构建的压缩文件归档
    }
}" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="groovy hljs kotlin"><code class="groovy">stage(<span class="hljs-string">"artifacts-manage"</span>){
    steps {
      echo <span class="hljs-string">"artifacts"</span>
      sh <span class="hljs-string">'./jenkins/script/artifacts-manage.sh'</span>
      archiveArtifacts artifacts:<span class="hljs-string">"<span class="hljs-subst">${artifactsDir}</span>/<span class="hljs-subst">${GIT_COMMIT}</span>_dist.tar.gz"</span> <span class="hljs-comment">// 把我们本次构建的压缩文件归档</span>
    }
}</code></pre><p>这样我们就能很方便的jenkins的web页面下载啦</p><p><span class="img-wrap"><img referrerpolicy="no-referrer" data-src="/img/remote/1460000024453250" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/squares.svg" alt="artifacts-show" title="artifacts-show"></span></p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="# 用archiveArtifacts归档的文件会等放在这里哈
${JENKINS_HOME}/jobs/${JOB_NAME}/branch/${BRANCH_NAME}/builds/${BUILD_NUMBER}/stage/archive" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="bash hljs"><code class="bash"><span class="hljs-comment"># 用archiveArtifacts归档的文件会等放在这里哈</span>
<span class="hljs-variable">${JENKINS_HOME}</span>/<span class="hljs-built_in">jobs</span>/<span class="hljs-variable">${JOB_NAME}</span>/branch/<span class="hljs-variable">${BRANCH_NAME}</span>/builds/<span class="hljs-variable">${BUILD_NUMBER}</span>/stage/archive</code></pre><h5>5 reset 阶段</h5><ul><li>这个是一个检测回滚操作的时候执行的步骤</li><li>在这里我们需要为 <strong>build-env</strong>、<strong>artifacts-manage</strong>等步骤增加点代码，回滚的时候不需要执行他们<p>还记得我们前面在pipeline的环境设置的变量 <strong>resetFlagFile</strong> 吗，还有在 <a href="https://segmentfault.com/a/1190000024453209#2">pre-build 阶段</a> 如果出现相同的commit ID的操作吗</p></li></ul><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text=" if [ $isResetID = true ]
    then
        #我们还是需要重置一下新的package
        cp -f package.json &quot;$cacheDir/&quot;
        #这里我们要一个创建代表回滚标志的文件,提供给pipeline判断以供跳过不必要的步骤执行，提高执行的速度
        touch ${resetFlagFile}
    # ID不是重复的,而且package.json有更新
    ..." title="" data-original-title="复制"></span>
        </div>
        </div><pre class="shell hljs"><code class="shell"> if [ $isResetID = true ]
    then
        #我们还是需要重置一下新的package
        cp -f package.json "$cacheDir/"
        #这里我们要一个创建代表回滚标志的文件,提供给pipeline判断以供跳过不必要的步骤执行，提高执行的速度
        touch ${resetFlagFile}
    # ID不是重复的,而且package.json有更新
    ...</code></pre><p>检测到相同的commit ID 了，创建这个文件  <code>${resetFlagFile}</code>，用来做什么？当然是做回滚判断标志呀</p><p>在 <strong>build-env</strong>、<strong>artifacts-manage</strong>步骤的when添加</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text=" when {
             beforeAgent true
+     expression{
+         return !(fileExists(&quot;${resetFlagFile}&quot;))
+        }
      ...
  }" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="diff hljs"><code class="diff"> when {
             beforeAgent true
<span class="hljs-addition">+     expression{</span>
<span class="hljs-addition">+         return !(fileExists("${resetFlagFile}"))</span>
<span class="hljs-addition">+        }</span>
      ...
  }</code></pre><p><code>fileExists()</code>是pipelinen内置的方法，判断文件是否存在，返回布尔类型</p><p>现在我们先做一个普通的push再做一次回滚的push来看看效果</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="#先做两次正常的commit push
git log
commit 7f31a184256b326cb353c506125d58b0efe28481 (HEAD -&gt; dev, origin/dev)
Author: longming &lt;451904906@qq.com&gt;
Date:   Thu Aug 6 13:35:32 2020 +0800

正常的提交2

commit acbc3ea45dca16c82a39f2ec6e772eada57229f7
Author: longming &lt;451904906@qq.com&gt;
Date:   Thu Aug 6 13:33:20 2020 +0800

正常的提交" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="shell hljs"><code class="shell"><span class="hljs-meta">#</span><span class="bash">先做两次正常的commit push</span>
git log
commit 7f31a184256b326cb353c506125d58b0efe28481 (HEAD -&gt; dev, origin/dev)
Author: longming &lt;451904906@qq.com&gt;
Date:   Thu Aug 6 13:35:32 2020 +0800

正常的提交2

commit acbc3ea45dca16c82a39f2ec6e772eada57229f7
Author: longming &lt;451904906@qq.com&gt;
Date:   Thu Aug 6 13:33:20 2020 +0800

正常的提交</code></pre><p>在做执行回滚到版本 <code>acbc3ea45dca16c82a39f2ec6e772eada57229f7</code></p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="git reset -hard acbc3ea45dca16c82a39f2ec6e772eada57229f7

git push -f" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="shell hljs"><code class="shell">git reset -hard acbc3ea45dca16c82a39f2ec6e772eada57229f7

git push -f</code></pre><p>进入工作空间，查看stage的.commitIDCache.txt、和artifacts目录下的压缩包，可以看到写入和缓存都成功了</p><p>第二次回滚后文件没改变</p><p><span class="img-wrap"><img referrerpolicy="no-referrer" data-src="/img/remote/1460000024453252" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/squares.svg" alt="push-reset-shell" title="push-reset-shell"></span></p><p>我们来看一Blue Ocean的流水线图</p><p><span class="img-wrap"><img referrerpolicy="no-referrer" data-src="/img/remote/1460000024453253" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/squares.svg" alt="git-push-reset" title="git-push-reset"></span></p><p>我们来看一下，回滚操作中跳过了 <strong>build-env</strong> 和 <strong>artifacts-manage</strong> 这两个阶段,因为不需要再重新去build和缓存了，这样就能做到秒级的回滚啦啦啦</p><p>reset 阶段的代码在这里</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="stage(&quot;reset&quot;){
  when {
    beforeAgent true
    expression{
    return fileExists(&quot;${resetFlagFile}&quot;)
      }
    anyOf { 
      branch &#39;dev&#39;
      branch &#39;release&#39;
      branch &#39;master&#39;
    }
    }
  
  steps {
    echo &quot;是回滚啊啊啊啊&quot;
    //当然我们这里为了方便下载
    archiveArtifacts artifacts:&quot;${artifactsDir}/${GIT_COMMIT}_dist.tar.gz&quot;
  }
}" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="groovy hljs kotlin"><code class="groovy">stage(<span class="hljs-string">"reset"</span>){
  <span class="hljs-keyword">when</span> {
    beforeAgent <span class="hljs-literal">true</span>
    expression{
    <span class="hljs-keyword">return</span> fileExists(<span class="hljs-string">"<span class="hljs-subst">${resetFlagFile}</span>"</span>)
      }
    anyOf { 
      branch <span class="hljs-string">'dev'</span>
      branch <span class="hljs-string">'release'</span>
      branch <span class="hljs-string">'master'</span>
    }
    }
  
  steps {
    echo <span class="hljs-string">"是回滚啊啊啊啊"</span>
    <span class="hljs-comment">//当然我们这里为了方便下载</span>
    archiveArtifacts artifacts:<span class="hljs-string">"<span class="hljs-subst">${artifactsDir}</span>/<span class="hljs-subst">${GIT_COMMIT}</span>_dist.tar.gz"</span>
  }
}</code></pre><h5>6 deliver阶段</h5><p>这个步骤一步给开发环境、测试环境，预发布环境用，打包后的代码自动交付到这几个环境</p><ol><li><strong>安装资源服务器</strong><p>我们这里安装的是Nginx，详细看 <strong><a href="https://segmentfault.com/a/1190000024453209#Nginx">Nginx</a></strong></p></li><li><p><strong>配置SSH</strong></p><p>这个阶段要先配置好我们的jenkins容器 到 需要资源服务器的 ssh，具体看 <strong><a href="https://segmentfault.com/a/1190000024453209#SSH%E9%85%8D%E7%BD%AE">SSH配置</a></strong></p><p>问题来了，部署机怎么来？我是在阿里云🌥梭哈了一台几个月的香港服务器哈哈哈🍖（我们大陆的话，网站要先备案好才能通过）</p><p>我们配置好了jenkins  ssh 连接 资源服务器，host的名字设置为<strong>server</strong></p><p>在jenkins应用容器执行<code>ssh server</code> 就能连接到资源服务器啦</p><p>ps：如果配置连接的用户名，不是要上传目录 /data的拥有者，请最好更改一下权限</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="#切换到root，把/data目录的拥有者给eric，eric是我们这里ssh连接到资源服务器的用户名
chmod -R eric /data" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="shell hljs"><code class="shell"><span class="hljs-meta">#</span><span class="bash">切换到root，把/data目录的拥有者给eric，eric是我们这里ssh连接到资源服务器的用户名</span>
chmod -R eric /data</code></pre></li><li><p><strong>deliver 脚本</strong></p><p>在Jenkinsfile文件添加ssh连接的host name作为环境变量</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="pipeline{
        ...
    environment {
          ···
+       sshHostName = &quot;server&quot;
    }" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="diff hljs"><code class="diff">pipeline{
        ...
    environment {
          ···
<span class="hljs-addition">+       sshHostName = "server"</span>
    }</code></pre></li></ol><p>}</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
deliver stage的代码
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs nginx"><code>
<span class="hljs-attribute">deliver</span> stage的代码
</code></pre><p>stage('deliver') {</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text=" when {
   beforeAgent true
   anyOf { 
     branch &#39;dev&#39;
     branch &#39;release&#39;
   }
 }

 steps {
   echo &quot;start deliver&quot;
   sh &quot;./jenkins/script/deliver.sh&quot;
  }" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs nginx"><code> <span class="hljs-section">when</span> {
   <span class="hljs-attribute">beforeAgent</span> <span class="hljs-literal">true</span>
   anyOf { 
     <span class="hljs-attribute">branch</span> <span class="hljs-string">'dev'</span>
     branch <span class="hljs-string">'release'</span>
   }
 }

 steps {
   <span class="hljs-attribute">echo</span> <span class="hljs-string">"start deliver"</span>
   sh <span class="hljs-string">"./jenkins/script/deliver.sh"</span>
  }</code></pre><p>}  <br>   // 整个pipeline流程结束需要删除回滚标志文件</p><p>post{</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text=" alway{
   
 }" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs css"><code> <span class="hljs-selector-tag">alway</span>{
   
 }</code></pre><p>}</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
新建**deliver.sh**脚本 jenkins/script/deliver.sh
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs markdown"><code>
新建<span class="hljs-strong">**deliver.sh**</span>脚本 jenkins/script/deliver.sh
</code></pre><p>#!/bin/bash<br>   # set -x<br>   #如果是回滚的操作，我们不用再把构建上传一次啦，服务器已经有啦<br>   if [! -d ${resetFlagFile}]<br>   then</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="   # 将本次构建的压缩包上传到资源服务器的指定目录
   scp ${artifactsDir}/${GIT_COMMIT}_dist.tar.gz ${sshHostName}:/data/vueci/${BRANCH_NAME}/ || exit 1" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs ruby"><code>   <span class="hljs-comment"># 将本次构建的压缩包上传到资源服务器的指定目录</span>
   scp ${artifactsDir}/${GIT_COMMIT}_dist.tar.gz ${sshHostName}<span class="hljs-symbol">:/data/vueci/</span>${BRANCH_NAME}/ <span class="hljs-params">||</span> exit <span class="hljs-number">1</span></code></pre><p>fi<br>   # 远程执行服务器上面的脚本解压缩发布<br>   ssh <span class="katex-math-wrap"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi>s</mi><mi>s</mi><mi>h</mi><mi>H</mi><mi>o</mi><mi>s</mi><mi>t</mi><mi>N</mi><mi>a</mi><mi>m</mi><mi>e</mi></mrow><mi mathvariant="normal">/</mi><mi>d</mi><mi>a</mi><mi>t</mi><mi>a</mi><mi mathvariant="normal">/</mi><mi>v</mi><mi>u</mi><mi>e</mi><mi>c</mi><mi>i</mi><mi mathvariant="normal">/</mi><mi>d</mi><mi>e</mi><mi>p</mi><mi>l</mi><mi>o</mi><mi>y</mi><mi mathvariant="normal">.</mi><mi>s</mi><mi>h</mi></mrow><annotation encoding="application/x-tex">{sshHostName} /data/vueci/deploy.sh </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="mord mathnormal">s</span><span class="mord mathnormal">h</span><span class="mord mathnormal" style="margin-right: 0.08125em;">H</span><span class="mord mathnormal">o</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right: 0.10903em;">N</span><span class="mord mathnormal">a</span><span class="mord mathnormal">m</span><span class="mord mathnormal">e</span></span><span class="mord">/</span><span class="mord mathnormal">d</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right: 0.03588em;">v</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mord mathnormal">c</span><span class="mord mathnormal">i</span><span class="mord">/</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right: 0.03588em;">y</span><span class="mord">.</span><span class="mord mathnormal">s</span><span class="mord mathnormal">h</span></span></span></span></span>{BRANCH_NAME}  ${GIT_COMMIT} || exit 1<br>   # set +x</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
新建好需要执行，给脚本执行权限
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs"><code>
新建好需要执行，给脚本执行权限
</code></pre><p>chmod +x jenkins/script/deliver.sh</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
我们还得跑到资源服务器新建一个发布的脚本**/data/vueci/deploy.sh**
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs kotlin"><code>
我们还得跑到资源服务器新建一个发布的脚本**/<span class="hljs-keyword">data</span>/vueci/deploy.sh**
</code></pre><p>tar -zxvf /data/vueci/<span class="katex-math-wrap"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mi mathvariant="normal">/</mi></mrow><annotation encoding="application/x-tex">1/</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">1</span><span class="mord">/</span></span></span></span></span>2_dist.tar.gz -C /data/vueci/$1/</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
新建好需要执行，给脚本执行权限
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs"><code>
新建好需要执行，给脚本执行权限
</code></pre><p>chmod +x /data/vueci/deploy.sh</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
现在来测试一下交付到dev环境吧
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs"><code>
现在来测试一下交付到dev环境吧
</code></pre><p>git checkout dev<br>   #更改点什么<br>   git commit -am "发布到dev环境啦"<br>   git push</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
![dev.wild-fox](https://fn-md-1255398640.cos.ap-guangzhou.myqcloud.com/prj/dev.wild-fox.png)

看到效果了，其实是开发环境哈哈哈随便写的哈哈哈

#### 7 deploy 阶段 

​        到了发布阶段啦，这个是运用在生产环境分支上的，发布前的按钮

这个步骤跟deliver差不多，多一个发布的input，来看一下代码 
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs markdown"><code>
![<span class="hljs-string">dev.wild-fox</span>](<span class="hljs-link">https://fn-md-1255398640.cos.ap-guangzhou.myqcloud.com/prj/dev.wild-fox.png</span>)

看到效果了，其实是开发环境哈哈哈随便写的哈哈哈

<span class="hljs-section">#### 7 deploy 阶段 </span>

​        到了发布阶段啦，这个是运用在生产环境分支上的，发布前的按钮

这个步骤跟deliver差不多，多一个发布的input，来看一下代码 
</code></pre><p>stage('deploy') {</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="when { 
    beforeAgent true
    branch &#39;master&#39; 
}
steps {
    // 这个就是生成一个按钮，我们用来手动发布的
    input message: &quot;Should you deploy?&quot;
    echo &quot;start deloy&quot;
    sh &#39;./jenkins/script/deploy.sh&#39;
} 
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs ruby"><code><span class="hljs-keyword">when</span> { 
    beforeAgent <span class="hljs-literal">true</span>
    branch <span class="hljs-string">'master'</span> 
}
steps {
    <span class="hljs-regexp">//</span> 这个就是生成一个按钮，我们用来手动发布的
    input <span class="hljs-symbol">message:</span> <span class="hljs-string">"Should you deploy?"</span>
    echo <span class="hljs-string">"start deloy"</span>
    sh <span class="hljs-string">'./jenkins/script/deploy.sh'</span>
} 
</code></pre><p>}</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
新建发布脚本**deploy.sh** ,jenkins/script/deploy.sh

给脚本执行权限
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs markdown"><code>
新建发布脚本<span class="hljs-strong">**deploy.sh**</span> ,jenkins/script/deploy.sh

给脚本执行权限
</code></pre><p>chmod +x /data/vueci/deploy.sh</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
deploy.sh 脚本跟 交付的没啥区别（当然一般是正式环境和测试环境执行的脚本的一般是不同的）
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs css"><code>
<span class="hljs-selector-tag">deploy</span><span class="hljs-selector-class">.sh</span> 脚本跟 交付的没啥区别（当然一般是正式环境和测试环境执行的脚本的一般是不同的）
</code></pre><h2 id="item-2">!/bin/bash</h2><h2 id="item-3">set -x</h2><h2 id="item-4">如果是回滚的操作，我们不用再把构建上传一次啦，服务器已经有啦</h2><p>if [ ! -f $resetFlagFile ]<br>then</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="# 将本次构建的压缩包上传到资源服务器的指定目录
scp ${artifactsDir}/${GIT_COMMIT}_dist.tar.gz ${sshHostName}:/data/vueci/${BRANCH_NAME} || exit 1" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs ruby"><code><span class="hljs-comment"># 将本次构建的压缩包上传到资源服务器的指定目录</span>
scp ${artifactsDir}/${GIT_COMMIT}_dist.tar.gz ${sshHostName}<span class="hljs-symbol">:/data/vueci/</span>${BRANCH_NAME} <span class="hljs-params">||</span> exit <span class="hljs-number">1</span></code></pre><p>fi</p><h2 id="item-5">远程执行服务器上面的脚本解压缩发布</h2><p>ssh <span class="katex-math-wrap"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi>s</mi><mi>s</mi><mi>h</mi><mi>H</mi><mi>o</mi><mi>s</mi><mi>t</mi><mi>N</mi><mi>a</mi><mi>m</mi><mi>e</mi></mrow><mi mathvariant="normal">/</mi><mi>d</mi><mi>a</mi><mi>t</mi><mi>a</mi><mi mathvariant="normal">/</mi><mi>v</mi><mi>u</mi><mi>e</mi><mi>c</mi><mi>i</mi><mi mathvariant="normal">/</mi><mi>d</mi><mi>e</mi><mi>p</mi><mi>l</mi><mi>o</mi><mi>y</mi><mi mathvariant="normal">.</mi><mi>s</mi><mi>h</mi></mrow><annotation encoding="application/x-tex">{sshHostName} /data/vueci/deploy.sh </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="mord mathnormal">s</span><span class="mord mathnormal">h</span><span class="mord mathnormal" style="margin-right: 0.08125em;">H</span><span class="mord mathnormal">o</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right: 0.10903em;">N</span><span class="mord mathnormal">a</span><span class="mord mathnormal">m</span><span class="mord mathnormal">e</span></span><span class="mord">/</span><span class="mord mathnormal">d</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right: 0.03588em;">v</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mord mathnormal">c</span><span class="mord mathnormal">i</span><span class="mord">/</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right: 0.03588em;">y</span><span class="mord">.</span><span class="mord mathnormal">s</span><span class="mord mathnormal">h</span></span></span></span></span>{BRANCH_NAME}  ${GIT_COMMIT} || exit 1</p><h2 id="item-6">set +x</h2><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
现在按照最开始的 [**Git flow 工作流**](#Git flow 工作流) 介绍的，我们走个git flow 流程吧

ps:🌏**注意了，我们这里是把dev 当做feature功能分支哈！！！****注意了，我们这里是把dev 当做feature功能分支哈！！！**

**注意了，我们这里是把dev 当做feature功能分支哈！！！**

先切换到dev分支
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs markdown"><code>
现在按照最开始的 [<span class="hljs-string">**Git flow 工作流**</span>](<span class="hljs-link">#Git flow 工作流</span>) 介绍的，我们走个git flow 流程吧

ps:🌏<span class="hljs-strong">**注意了，我们这里是把dev 当做feature功能分支哈！！！**</span><span class="hljs-strong">**注意了，我们这里是把dev 当做feature功能分支哈！！！**</span>

<span class="hljs-strong">**注意了，我们这里是把dev 当做feature功能分支哈！！！**</span>

先切换到dev分支
</code></pre><h2 id="item-7">切换到本地dev</h2><p>git checkout dev</p><h2 id="item-8">更新远程dev，如果有多人协调在这个分支做开发的话</h2><p>git pull</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
我们把之前的显示的内容改一下
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs"><code>
我们把之前的显示的内容改一下
</code></pre><ul><li>&lt;HelloWorld msg="欢迎来到测试环境呀" /&gt;</li><li>&lt;HelloWorld msg="欢迎来到正式环境环境呀" /&gt;</li></ul><h2 id="item-9">一系列的提交操作</h2><p>git status<br>git add .<br>git commit -m "修改下显示内容"<br>git push</p><h2 id="item-10">我们功能分支是从远程master分支checkout出来的，开发过程中可能master上线了其他的功能，需要更新一下</h2><p>git merge origin/master</p><h2 id="item-11">如果合并发生冲突，我们解决好冲突后</h2><p>git status <br>git add .<br>git commit "origin/master"</p><h2 id="item-12">解决好冲突或者没有冲突直接push啦</h2><p>git push</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
现在我们要去远程仓库申请功能合并到release去测试啦

![merge-release](https://fn-md-1255398640.cos.ap-guangzhou.myqcloud.com/prj/merge-release.jpg)

我们看到合并成功后，会触发构建任务啦

### ![release-webhook-web](https://fn-md-1255398640.cos.ap-guangzhou.myqcloud.com/prj/release-webhook-web.jpg)

PS：如果dev 合并 release 有冲突的话，可以先把release 合并到 dev 解决冲突后再申请合并，这样在gitee合并那边就没冲突了

**合并release测试好**

现在我们准备上线，需要把release 合并到 master 分支啦

合并成功后，我们可以看到

![deploy-input](https://fn-md-1255398640.cos.ap-guangzhou.myqcloud.com/prj/deploy-input.jpg)

合并成功后我们停留在deploy阶段，看一下正式环境的代码，还没更新

先我们点击上面**deploy**，或者那个 **继续** 按钮，就能发布啦

![master-deploy](https://fn-md-1255398640.cos.ap-guangzhou.myqcloud.com/prj/master-deploy.jpg)

#### 8 Notice 通知

- 上面的部署啊什么的完成了，可是什么时候完成我们不知道，只有通过不停的去刷网页啊才知道，或者问jenkins的管理者，这样就太麻烦了我们要给任务的完成状态配通知啊

  公司有钉钉或者企业微信的的可以查一下资料配置很简单的，这里我们就讲一下最通用的邮件通知哈

  配置邮件的通知我们要安装几个插件

  **Email Extension**：这个用于邮箱的设置

  **Config File Provider：**提供文件的存储插件，我们用来配置邮箱模板

  本来我是配置了qq邮箱，可是接通知比较慢我换成了网易的163邮箱，当然一般公司都用企业邮箱，配置差不多都一样，看图吧

  1. 邮箱开启SMTP服务

![163-set](https://fn-md-1255398640.cos.ap-guangzhou.myqcloud.com/prj/163-set.png)打开我们的163邮箱开启，这两个SMTP服务，然后获取授权码，复制好待会要用

2. jenkins 配置邮箱

![email-set](https://fn-md-1255398640.cos.ap-guangzhou.myqcloud.com/prj/email-set.jpg)

配置完成之后记得测试一下邮件的发送

3. 配置邮件模板

安装了这个插件之后**Config File Provider**，会在 **系统管理 **的下方看到这个，我们用来配置邮件的模板文件

![config-flie](https://fn-md-1255398640.cos.ap-guangzhou.myqcloud.com/prj/config-flie.png)

点击去可以配置邮件模板文件

![tpl-file-set](https://fn-md-1255398640.cos.ap-guangzhou.myqcloud.com/prj/tpl-file-set.jpg)

因为我们要在成功和失败的构建结束后都要发送邮件通知，所以我们需要两个邮箱模板，

这里我用sketch 设计了简单的邮件模板

![table-design](https://fn-md-1255398640.cos.ap-guangzhou.myqcloud.com/prj/table-design.jpg)

对应邮件的模板代码：

**email-success.tpl**
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs markdown"><code>
现在我们要去远程仓库申请功能合并到release去测试啦

![<span class="hljs-string">merge-release</span>](<span class="hljs-link">https://fn-md-1255398640.cos.ap-guangzhou.myqcloud.com/prj/merge-release.jpg</span>)

我们看到合并成功后，会触发构建任务啦

<span class="hljs-section">### ![release-webhook-web](https://fn-md-1255398640.cos.ap-guangzhou.myqcloud.com/prj/release-webhook-web.jpg)</span>

PS：如果dev 合并 release 有冲突的话，可以先把release 合并到 dev 解决冲突后再申请合并，这样在gitee合并那边就没冲突了

<span class="hljs-strong">**合并release测试好**</span>

现在我们准备上线，需要把release 合并到 master 分支啦

合并成功后，我们可以看到

![<span class="hljs-string">deploy-input</span>](<span class="hljs-link">https://fn-md-1255398640.cos.ap-guangzhou.myqcloud.com/prj/deploy-input.jpg</span>)

合并成功后我们停留在deploy阶段，看一下正式环境的代码，还没更新

先我们点击上面<span class="hljs-strong">**deploy**</span>，或者那个 <span class="hljs-strong">**继续**</span> 按钮，就能发布啦

![<span class="hljs-string">master-deploy</span>](<span class="hljs-link">https://fn-md-1255398640.cos.ap-guangzhou.myqcloud.com/prj/master-deploy.jpg</span>)

<span class="hljs-section">#### 8 Notice 通知</span>
<span class="hljs-bullet">
- </span>上面的部署啊什么的完成了，可是什么时候完成我们不知道，只有通过不停的去刷网页啊才知道，或者问jenkins的管理者，这样就太麻烦了我们要给任务的完成状态配通知啊

  公司有钉钉或者企业微信的的可以查一下资料配置很简单的，这里我们就讲一下最通用的邮件通知哈

  配置邮件的通知我们要安装几个插件

  <span class="hljs-strong">**Email Extension**</span>：这个用于邮箱的设置

  <span class="hljs-strong">**Config File Provider：**</span>提供文件的存储插件，我们用来配置邮箱模板

  本来我是配置了qq邮箱，可是接通知比较慢我换成了网易的163邮箱，当然一般公司都用企业邮箱，配置差不多都一样，看图吧
<span class="hljs-bullet">
  1. </span>邮箱开启SMTP服务

![<span class="hljs-string">163-set</span>](<span class="hljs-link">https://fn-md-1255398640.cos.ap-guangzhou.myqcloud.com/prj/163-set.png</span>)打开我们的163邮箱开启，这两个SMTP服务，然后获取授权码，复制好待会要用
<span class="hljs-bullet">
2. </span>jenkins 配置邮箱

![<span class="hljs-string">email-set</span>](<span class="hljs-link">https://fn-md-1255398640.cos.ap-guangzhou.myqcloud.com/prj/email-set.jpg</span>)

配置完成之后记得测试一下邮件的发送
<span class="hljs-bullet">
3. </span>配置邮件模板

安装了这个插件之后<span class="hljs-strong">**Config File Provider**</span>，会在 <span class="hljs-strong">**系统管理 **</span>的下方看到这个，我们用来配置邮件的模板文件

![<span class="hljs-string">config-flie</span>](<span class="hljs-link">https://fn-md-1255398640.cos.ap-guangzhou.myqcloud.com/prj/config-flie.png</span>)

点击去可以配置邮件模板文件

![<span class="hljs-string">tpl-file-set</span>](<span class="hljs-link">https://fn-md-1255398640.cos.ap-guangzhou.myqcloud.com/prj/tpl-file-set.jpg</span>)

因为我们要在成功和失败的构建结束后都要发送邮件通知，所以我们需要两个邮箱模板，

这里我用sketch 设计了简单的邮件模板

![<span class="hljs-string">table-design</span>](<span class="hljs-link">https://fn-md-1255398640.cos.ap-guangzhou.myqcloud.com/prj/table-design.jpg</span>)

对应邮件的模板代码：

<span class="hljs-strong">**email-success.tpl**</span>
</code></pre><p>&lt;!DOCTYPE html&gt;<br>&lt;html&gt;</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot; /&gt;
    &lt;title&gt;${ENV, var=&quot;JOB_NAME&quot;}-第${BUILD_NUMBER}次构建日志&lt;/title&gt;
    &lt;style&gt;
        html,
        body {
            font-family: &quot;SF Pro SC&quot;, &quot;SF Pro Text&quot;, &quot;SF Pro Icons&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, &quot;Helvetica&quot;, &quot;Arial&quot;, sans-serif;
        }
        .table.success {
            border: 1px solid #ddd;
            color: #4a4a4a;
        }

        .table.success td {
            font-size: 16px;
            overflow: hidden;
            word-break: break-all;
        }

        td.info {
            background-color: #dfb051;
            height: 44px;
            color: #fff;
        }

        td:first-child {
            padding-left: 49px;
            padding-right: 49px;
        }

        td.build-status {
            background-color: #76ac35;
            height: 44px;
            color: #fff;
        }

        .table.success td pre {
            white-space: pre-wrap;
        }

        .success-ico {
            vertical-align: middle;
            margin-left: 10px;
            width: 25px;
            /* height: 30px; */
            /* margin-bottom: 20px; */
        }

        td.info-title {
            color: #76ac35;
            height: 36px;
            font-weight: bold;
            font-size: 16px;
        }

        .table.success ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }
        .table.success ul li {
            list-style: none;
        }


        ul li {
            height: 35px;
            line-height: 35px;
            font-size: 14px;
            white-space: nowrap;
        }

        hr {
            margin-left: 0;
        }
    &lt;/style&gt;
&lt;/head&gt;

&lt;body leftmargin=&quot;8&quot; marginwidth=&quot;0&quot; topmargin=&quot;8&quot; marginheight=&quot;4&quot; offset=&quot;0&quot;&gt;
    &lt;table width=&quot;95%&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; class=&quot;table success&quot;&gt;
        &lt;tr&gt;
            &lt;td class=&quot;info&quot;&gt;(大佬们好呀，本邮件是jenkins自动下发的，请勿回复！)&lt;/td&gt;
        &lt;/tr&gt;
    &lt;/table&gt;

    &lt;br /&gt;

    &lt;table width=&quot;95%&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; class=&quot;table success&quot;&gt;
        &lt;tr&gt;
            &lt;td class=&quot;build-status&quot;&gt;
                构建成功啦
                &lt;img
                    class=&quot;success-ico&quot;
                    src=&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAAAjCAYAAAFp3oPPAAAAAXNSR0IArs4c6QAAA/ZJREFUWAm9mLtPVEEUxlkDAaKhQY1iKyWPAmNhYazUAmOMrZRYGQtii9FWwI4e/wA1JibamKixQChITEisqFgNaGI0FDasv2/unNm5r727sDLJt+f1nTNz53VvtqfHt0ajUTe9ZookgdeIN1ICwwiOSaBhDuRHp+O7JwX5wTm8MY7jlXOg9IO5EC1UYLgWglgDwTAFZ7/pJvFtOx1lInKOR/od6cQH9eOGhSxsliSiK4tcMGYIZhUIr0AdhG4DB2cywOBxY2k+CASbQy2Ba/jcjCETIoqbD6R7GrHQQ3fo4emTEgW/kOq9PjNey0Ct0TDWVdqtJzLXAjtWItaC/Njpp8YRdgj6AHBPHRcJuoJKEDE4vYJv0MdaFkh3n61SYFM0naNeYh62a7FPepEfX5KLkhyEbFYHtmrU+KmzPCPWYwf5PX5dNdL6MRKvo9jELnZQyHF97jWXh6GVcpsU2Quqmu1AXQv5FcS5DZrHo2R44ohbEk67IU4AO6Q6qNKrT0y6jFvqeRLXwV8v57OcQhtyH9gBN4oI8vt4X1FcSzcFVgqDGad44qfcOEbAg5SzwhBfeYGGsWkG+gnwzexYyq+4+dCTPJRH5pSUDdRGM/7RxJ3nK2kvJvtCT7O+Mr/L5+d+UUK7PuXrLK21m1DCW1MRe8MuUbWTtuSL1lTE1vtFSU9lbuNP6Y7Z4644LqaGUZaR9Uf3y55G4l4BnnQ3Sy6xY16SzwDizbasEbVoy1YYTsjTY6S2PfYw0EGMm+zhqEB62ysA4XAHMKp+uKvACplkZG1fSm6jWWKZpOAQMX2BzIDT4C14D3Tf6sT/ACfBWXAOXAZXwQ54BhbZEr+RB2sMQIv2GWyCwhuz3crK93VUr3mXVRWArAX/Azq6NKvqWlx1fX07uRZqSgjaLBr5StP7/zT1A1ZB+j2EYwjonEwXdY9fHwLW9lHCeSrh6xyKZy3/MUAiQXsxak8mDeeWAmZnpU9CuLbLb3+WE9uKA/GsVdXeUr4uTL3/J9ntt+KCR6kzhuf0t6Gp0ofJ7aPsPNuX+tc49JE3Br7EBAI3sSdjX5f1DVbiZVRT/Y9pME5Bfo2C59EfRna31ey14SakcM8wM3pvfgenuj0K6u2CM8zMvtWmv2TPyIGxBVI7HlvH8xfoZlO91LWArePtTpMbHIbdM6kB+YFWfQSQ3lYLHwuu02QS8veM77TlDUx3s6DTmRJ/1jqPJf7cDZx7a0O6QNI78Jh1fRIXMB2O9tQlcBHoxaep/wn0D88q+BTvCezQyNXm1d12Bc56CLRSSIrf2tOtuFUxak0Dvf1bvrVzM1NUmCJD+OfADMh+z2g2NCuaHc3Sgb9n/gFyaAu+lH9E5AAAAABJRU5ErkJggg==&quot;
                /&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td class=&quot;info-title&quot;&gt;
                构建信息
                &lt;!-- &lt;hr size=&quot;2&quot; width=&quot;100%&quot; align=&quot;center&quot; /&gt; --&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;
                &lt;ul&gt;
                    &lt;li&gt;项目名称 ： ${JOB_NAME}&lt;/li&gt;
                    &lt;li&gt;构建编号 ： 第${BUILD_NUMBER}次构建&lt;/li&gt;
                    &lt;li&gt;触发原因 ： ${CAUSE}&lt;/li&gt;
                    &lt;li&gt;构建日志 ： &lt;a href=&quot;${BUILD_URL}console&quot;&gt;${BUILD_URL}console&lt;/a&gt;&lt;/li&gt;
                    &lt;li&gt;工作目录 ： &lt;a href=&quot;${PROJECT_URL}&quot;&gt;${PROJECT_URL}&lt;/a&gt;&lt;/li&gt;
                &lt;/ul&gt;
                &lt;hr size=&quot;2&quot; width=&quot;100%&quot; /&gt;
            &lt;/td&gt;
        &lt;/tr&gt;

        &lt;tr&gt;
            &lt;td class=&quot;info-title&quot;&gt;历史变更记录&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;
                &lt;ul&gt;
                    &lt;li&gt;
                        ${CHANGES_SINCE_LAST_SUCCESS,reverse=true,format=&quot;更新作者：%c&quot;,showPaths=true,changesFormat=&quot;[%a]&quot;,pathFormat=&quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;%p&quot;}
                    &lt;/li&gt;
                    &lt;li&gt;
                        ${CHANGES_SINCE_LAST_SUCCESS,reverse=true,format=&quot;更新信息：%c&quot;,showPaths=true,changesFormat=&quot;%m&quot;,pathFormat=&quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;%p&quot;}
                    &lt;/li&gt;
                &lt;/ul&gt;
                &lt;!-- ${CHANGES_SINCE_LAST_SUCCESS,reverse=true, format=&quot;Changes for Build #%n:&lt;br /&gt;%c&lt;br /&gt;&quot;,showPaths=true,changesFormat=&quot;&lt;pre&gt;[%a]&lt;br /&gt;%m&lt;/pre&gt;&quot;,pathFormat=&quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;%p&quot;} --&gt;

                &lt;!-- &lt;hr size=&quot;2&quot; width=&quot;100%&quot; /&gt; --&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
        &lt;!-- &lt;tr&gt;
        &lt;td class=&quot;info-title&quot;&gt;构建日志(最后100行)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td&gt;&lt;p&gt;&lt;pre&gt;${BUILD_LOG, maxLines=100}&lt;/pre&gt;&lt;/p&gt;&lt;/td&gt;
    &lt;/tr&gt; --&gt;
    &lt;/table&gt;
&lt;/body&gt;" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs xml"><code><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>${ENV, var="JOB_NAME"}-第${BUILD_NUMBER}次构建日志<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-tag">html</span>,
        <span class="hljs-selector-tag">body</span> {
            <span class="hljs-attribute">font-family</span>: <span class="hljs-string">"SF Pro SC"</span>, <span class="hljs-string">"SF Pro Text"</span>, <span class="hljs-string">"SF Pro Icons"</span>, <span class="hljs-string">"PingFang SC"</span>, <span class="hljs-string">"Helvetica Neue"</span>, <span class="hljs-string">"Helvetica"</span>, <span class="hljs-string">"Arial"</span>, sans-serif;
        }
        <span class="hljs-selector-class">.table</span><span class="hljs-selector-class">.success</span> {
            <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ddd</span>;
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#4a4a4a</span>;
        }

        <span class="hljs-selector-class">.table</span><span class="hljs-selector-class">.success</span> <span class="hljs-selector-tag">td</span> {
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>;
            <span class="hljs-attribute">overflow</span>: hidden;
            <span class="hljs-attribute">word-break</span>: break-all;
        }

        <span class="hljs-selector-tag">td</span><span class="hljs-selector-class">.info</span> {
            <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#dfb051</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">44px</span>;
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;
        }

        <span class="hljs-selector-tag">td</span><span class="hljs-selector-pseudo">:first-child</span> {
            <span class="hljs-attribute">padding-left</span>: <span class="hljs-number">49px</span>;
            <span class="hljs-attribute">padding-right</span>: <span class="hljs-number">49px</span>;
        }

        <span class="hljs-selector-tag">td</span><span class="hljs-selector-class">.build-status</span> {
            <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#76ac35</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">44px</span>;
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;
        }

        <span class="hljs-selector-class">.table</span><span class="hljs-selector-class">.success</span> <span class="hljs-selector-tag">td</span> <span class="hljs-selector-tag">pre</span> {
            <span class="hljs-attribute">white-space</span>: pre-wrap;
        }

        <span class="hljs-selector-class">.success-ico</span> {
            <span class="hljs-attribute">vertical-align</span>: middle;
            <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">10px</span>;
            <span class="hljs-attribute">width</span>: <span class="hljs-number">25px</span>;
            <span class="hljs-comment">/* height: 30px; */</span>
            <span class="hljs-comment">/* margin-bottom: 20px; */</span>
        }

        <span class="hljs-selector-tag">td</span><span class="hljs-selector-class">.info-title</span> {
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#76ac35</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">36px</span>;
            <span class="hljs-attribute">font-weight</span>: bold;
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>;
        }

        <span class="hljs-selector-class">.table</span><span class="hljs-selector-class">.success</span> <span class="hljs-selector-tag">ul</span> {
            <span class="hljs-attribute">list-style</span>: none;
            <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
        }
        <span class="hljs-selector-class">.table</span><span class="hljs-selector-class">.success</span> <span class="hljs-selector-tag">ul</span> <span class="hljs-selector-tag">li</span> {
            <span class="hljs-attribute">list-style</span>: none;
        }


        <span class="hljs-selector-tag">ul</span> <span class="hljs-selector-tag">li</span> {
            <span class="hljs-attribute">height</span>: <span class="hljs-number">35px</span>;
            <span class="hljs-attribute">line-height</span>: <span class="hljs-number">35px</span>;
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
            <span class="hljs-attribute">white-space</span>: nowrap;
        }

        <span class="hljs-selector-tag">hr</span> {
            <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">0</span>;
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">leftmargin</span>=<span class="hljs-string">"8"</span> <span class="hljs-attr">marginwidth</span>=<span class="hljs-string">"0"</span> <span class="hljs-attr">topmargin</span>=<span class="hljs-string">"8"</span> <span class="hljs-attr">marginheight</span>=<span class="hljs-string">"4"</span> <span class="hljs-attr">offset</span>=<span class="hljs-string">"0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"95%"</span> <span class="hljs-attr">cellpadding</span>=<span class="hljs-string">"0"</span> <span class="hljs-attr">cellspacing</span>=<span class="hljs-string">"0"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"table success"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"info"</span>&gt;</span>(大佬们好呀，本邮件是jenkins自动下发的，请勿回复！)<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"95%"</span> <span class="hljs-attr">cellpadding</span>=<span class="hljs-string">"0"</span> <span class="hljs-attr">cellspacing</span>=<span class="hljs-string">"0"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"table success"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"build-status"</span>&gt;</span>
                构建成功啦
                <span class="hljs-tag">&lt;<span class="hljs-name">img</span>
                    <span class="hljs-attr">class</span>=<span class="hljs-string">"success-ico"</span>
                    <span class="hljs-attr">src</span>=<span class="hljs-string">"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAAAjCAYAAAFp3oPPAAAAAXNSR0IArs4c6QAAA/ZJREFUWAm9mLtPVEEUxlkDAaKhQY1iKyWPAmNhYazUAmOMrZRYGQtii9FWwI4e/wA1JibamKixQChITEisqFgNaGI0FDasv2/unNm5r727sDLJt+f1nTNz53VvtqfHt0ajUTe9ZookgdeIN1ICwwiOSaBhDuRHp+O7JwX5wTm8MY7jlXOg9IO5EC1UYLgWglgDwTAFZ7/pJvFtOx1lInKOR/od6cQH9eOGhSxsliSiK4tcMGYIZhUIr0AdhG4DB2cywOBxY2k+CASbQy2Ba/jcjCETIoqbD6R7GrHQQ3fo4emTEgW/kOq9PjNey0Ct0TDWVdqtJzLXAjtWItaC/Njpp8YRdgj6AHBPHRcJuoJKEDE4vYJv0MdaFkh3n61SYFM0naNeYh62a7FPepEfX5KLkhyEbFYHtmrU+KmzPCPWYwf5PX5dNdL6MRKvo9jELnZQyHF97jWXh6GVcpsU2Quqmu1AXQv5FcS5DZrHo2R44ohbEk67IU4AO6Q6qNKrT0y6jFvqeRLXwV8v57OcQhtyH9gBN4oI8vt4X1FcSzcFVgqDGad44qfcOEbAg5SzwhBfeYGGsWkG+gnwzexYyq+4+dCTPJRH5pSUDdRGM/7RxJ3nK2kvJvtCT7O+Mr/L5+d+UUK7PuXrLK21m1DCW1MRe8MuUbWTtuSL1lTE1vtFSU9lbuNP6Y7Z4644LqaGUZaR9Uf3y55G4l4BnnQ3Sy6xY16SzwDizbasEbVoy1YYTsjTY6S2PfYw0EGMm+zhqEB62ysA4XAHMKp+uKvACplkZG1fSm6jWWKZpOAQMX2BzIDT4C14D3Tf6sT/ACfBWXAOXAZXwQ54BhbZEr+RB2sMQIv2GWyCwhuz3crK93VUr3mXVRWArAX/Azq6NKvqWlx1fX07uRZqSgjaLBr5StP7/zT1A1ZB+j2EYwjonEwXdY9fHwLW9lHCeSrh6xyKZy3/MUAiQXsxak8mDeeWAmZnpU9CuLbLb3+WE9uKA/GsVdXeUr4uTL3/J9ntt+KCR6kzhuf0t6Gp0ofJ7aPsPNuX+tc49JE3Br7EBAI3sSdjX5f1DVbiZVRT/Y9pME5Bfo2C59EfRna31ey14SakcM8wM3pvfgenuj0K6u2CM8zMvtWmv2TPyIGxBVI7HlvH8xfoZlO91LWArePtTpMbHIbdM6kB+YFWfQSQ3lYLHwuu02QS8veM77TlDUx3s6DTmRJ/1jqPJf7cDZx7a0O6QNI78Jh1fRIXMB2O9tQlcBHoxaep/wn0D88q+BTvCezQyNXm1d12Bc56CLRSSIrf2tOtuFUxak0Dvf1bvrVzM1NUmCJD+OfADMh+z2g2NCuaHc3Sgb9n/gFyaAu+lH9E5AAAAABJRU5ErkJggg=="</span>
                /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"info-title"</span>&gt;</span>
                构建信息
                <span class="hljs-comment">&lt;!-- &lt;hr size="2" width="100%" align="center" /&gt; --&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>项目名称 ： ${JOB_NAME}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>构建编号 ： 第${BUILD_NUMBER}次构建<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>触发原因 ： ${CAUSE}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>构建日志 ： <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"${BUILD_URL}console"</span>&gt;</span>${BUILD_URL}console<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>工作目录 ： <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"${PROJECT_URL}"</span>&gt;</span>${PROJECT_URL}<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">hr</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"2"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"100%"</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"info-title"</span>&gt;</span>历史变更记录<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>
                        ${CHANGES_SINCE_LAST_SUCCESS,reverse=true,format="更新作者：%c",showPaths=true,changesFormat="[%a]",pathFormat="<span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-symbol">&amp;nbsp;</span>%p"}
                    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>
                        ${CHANGES_SINCE_LAST_SUCCESS,reverse=true,format="更新信息：%c",showPaths=true,changesFormat="%m",pathFormat="<span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-symbol">&amp;nbsp;</span>%p"}
                    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
                <span class="hljs-comment">&lt;!-- ${CHANGES_SINCE_LAST_SUCCESS,reverse=true, format="Changes for Build #%n:&lt;br /&gt;%c&lt;br /&gt;",showPaths=true,changesFormat="&lt;pre&gt;[%a]&lt;br /&gt;%m&lt;/pre&gt;",pathFormat="&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;%p"} --&gt;</span>

                <span class="hljs-comment">&lt;!-- &lt;hr size="2" width="100%" /&gt; --&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- &lt;tr&gt;
        &lt;td class="info-title"&gt;构建日志(最后100行)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td&gt;&lt;p&gt;&lt;pre&gt;${BUILD_LOG, maxLines=100}&lt;/pre&gt;&lt;/p&gt;&lt;/td&gt;
    &lt;/tr&gt; --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></code></pre><p>&lt;/html&gt;</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
**email-fail.tpl**
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs markdown"><code>
<span class="hljs-strong">**email-fail.tpl**</span>
</code></pre><p>&lt;!DOCTYPE html&gt;<br>&lt;html&gt;</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot; /&gt;
    &lt;title&gt;${ENV, var=&quot;JOB_NAME&quot;}-第${BUILD_NUMBER}次构建日志&lt;/title&gt;
    &lt;style&gt;
        html,
        body {
            font-family: &quot;SF Pro SC&quot;, &quot;SF Pro Text&quot;, &quot;SF Pro Icons&quot;, &quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, &quot;Helvetica&quot;, &quot;Arial&quot;, sans-serif;
        }
        .table.success {
            border: 1px solid #ddd;
            color: #4a4a4a;
        }

        .table.success td {
            font-size: 16px;
            overflow: hidden;
            word-break: break-all;
        }

        td.info {
            background-color: #dfb051;
            height: 44px;
            color: #fff;
        }

        td:first-child {
            padding-left: 49px;
            padding-right: 49px;
        }

        td.build-status {
            background-color: #76ac35;
            height: 44px;
            color: #fff;
        }

        .table.success td pre {
            white-space: pre-wrap;
        }

        .success-ico {
            vertical-align: middle;
            margin-left: 10px;
            width: 25px;
            /* height: 30px; */
            /* margin-bottom: 20px; */
        }

        td.info-title {
            color: #76ac35;
            height: 36px;
            font-weight: bold;
            font-size: 16px;
        }

        .table.success ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }
        .table.success ul li {
            list-style: none;
        }


        ul li {
            height: 35px;
            line-height: 35px;
            font-size: 14px;
            white-space: nowrap;
        }

        hr {
            margin-left: 0;
        }
    &lt;/style&gt;
&lt;/head&gt;

&lt;body leftmargin=&quot;8&quot; marginwidth=&quot;0&quot; topmargin=&quot;8&quot; marginheight=&quot;4&quot; offset=&quot;0&quot;&gt;
    &lt;table width=&quot;95%&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; class=&quot;table success&quot;&gt;
        &lt;tr&gt;
            &lt;td class=&quot;info&quot;&gt;(大佬们好呀，本邮件是jenkins自动下发的，请勿回复！)&lt;/td&gt;
        &lt;/tr&gt;
    &lt;/table&gt;

    &lt;br /&gt;

    &lt;table width=&quot;95%&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; class=&quot;table success&quot;&gt;
        &lt;tr&gt;
            &lt;td class=&quot;build-status&quot;&gt;
                构建成功啦
                &lt;img
                    class=&quot;success-ico&quot;
                    src=&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAAAjCAYAAAFp3oPPAAAAAXNSR0IArs4c6QAAA/ZJREFUWAm9mLtPVEEUxlkDAaKhQY1iKyWPAmNhYazUAmOMrZRYGQtii9FWwI4e/wA1JibamKixQChITEisqFgNaGI0FDasv2/unNm5r727sDLJt+f1nTNz53VvtqfHt0ajUTe9ZookgdeIN1ICwwiOSaBhDuRHp+O7JwX5wTm8MY7jlXOg9IO5EC1UYLgWglgDwTAFZ7/pJvFtOx1lInKOR/od6cQH9eOGhSxsliSiK4tcMGYIZhUIr0AdhG4DB2cywOBxY2k+CASbQy2Ba/jcjCETIoqbD6R7GrHQQ3fo4emTEgW/kOq9PjNey0Ct0TDWVdqtJzLXAjtWItaC/Njpp8YRdgj6AHBPHRcJuoJKEDE4vYJv0MdaFkh3n61SYFM0naNeYh62a7FPepEfX5KLkhyEbFYHtmrU+KmzPCPWYwf5PX5dNdL6MRKvo9jELnZQyHF97jWXh6GVcpsU2Quqmu1AXQv5FcS5DZrHo2R44ohbEk67IU4AO6Q6qNKrT0y6jFvqeRLXwV8v57OcQhtyH9gBN4oI8vt4X1FcSzcFVgqDGad44qfcOEbAg5SzwhBfeYGGsWkG+gnwzexYyq+4+dCTPJRH5pSUDdRGM/7RxJ3nK2kvJvtCT7O+Mr/L5+d+UUK7PuXrLK21m1DCW1MRe8MuUbWTtuSL1lTE1vtFSU9lbuNP6Y7Z4644LqaGUZaR9Uf3y55G4l4BnnQ3Sy6xY16SzwDizbasEbVoy1YYTsjTY6S2PfYw0EGMm+zhqEB62ysA4XAHMKp+uKvACplkZG1fSm6jWWKZpOAQMX2BzIDT4C14D3Tf6sT/ACfBWXAOXAZXwQ54BhbZEr+RB2sMQIv2GWyCwhuz3crK93VUr3mXVRWArAX/Azq6NKvqWlx1fX07uRZqSgjaLBr5StP7/zT1A1ZB+j2EYwjonEwXdY9fHwLW9lHCeSrh6xyKZy3/MUAiQXsxak8mDeeWAmZnpU9CuLbLb3+WE9uKA/GsVdXeUr4uTL3/J9ntt+KCR6kzhuf0t6Gp0ofJ7aPsPNuX+tc49JE3Br7EBAI3sSdjX5f1DVbiZVRT/Y9pME5Bfo2C59EfRna31ey14SakcM8wM3pvfgenuj0K6u2CM8zMvtWmv2TPyIGxBVI7HlvH8xfoZlO91LWArePtTpMbHIbdM6kB+YFWfQSQ3lYLHwuu02QS8veM77TlDUx3s6DTmRJ/1jqPJf7cDZx7a0O6QNI78Jh1fRIXMB2O9tQlcBHoxaep/wn0D88q+BTvCezQyNXm1d12Bc56CLRSSIrf2tOtuFUxak0Dvf1bvrVzM1NUmCJD+OfADMh+z2g2NCuaHc3Sgb9n/gFyaAu+lH9E5AAAAABJRU5ErkJggg==&quot;
                /&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td class=&quot;info-title&quot;&gt;
                构建信息
                &lt;!-- &lt;hr size=&quot;2&quot; width=&quot;100%&quot; align=&quot;center&quot; /&gt; --&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;
                &lt;ul&gt;
                    &lt;li&gt;项目名称 ： ${JOB_NAME}&lt;/li&gt;
                    &lt;li&gt;构建编号 ： 第${BUILD_NUMBER}次构建&lt;/li&gt;
                    &lt;li&gt;触发原因 ： ${CAUSE}&lt;/li&gt;
                    &lt;li&gt;构建日志 ： &lt;a href=&quot;${BUILD_URL}console&quot;&gt;${BUILD_URL}console&lt;/a&gt;&lt;/li&gt;
                    &lt;li&gt;工作目录 ： &lt;a href=&quot;${PROJECT_URL}&quot;&gt;${PROJECT_URL}&lt;/a&gt;&lt;/li&gt;
                &lt;/ul&gt;
                &lt;hr size=&quot;2&quot; width=&quot;100%&quot; /&gt;
            &lt;/td&gt;
        &lt;/tr&gt;

        &lt;tr&gt;
            &lt;td class=&quot;info-title&quot;&gt;历史变更记录&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;
                &lt;ul&gt;
                    &lt;li&gt;
                        ${CHANGES_SINCE_LAST_SUCCESS,reverse=true,format=&quot;更新作者：%c&quot;,showPaths=true,changesFormat=&quot;[%a]&quot;,pathFormat=&quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;%p&quot;}
                    &lt;/li&gt;
                    &lt;li&gt;
                        ${CHANGES_SINCE_LAST_SUCCESS,reverse=true,format=&quot;更新信息：%c&quot;,showPaths=true,changesFormat=&quot;%m&quot;,pathFormat=&quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;%p&quot;}
                    &lt;/li&gt;
                &lt;/ul&gt;
                &lt;!-- ${CHANGES_SINCE_LAST_SUCCESS,reverse=true, format=&quot;Changes for Build #%n:&lt;br /&gt;%c&lt;br /&gt;&quot;,showPaths=true,changesFormat=&quot;&lt;pre&gt;[%a]&lt;br /&gt;%m&lt;/pre&gt;&quot;,pathFormat=&quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;%p&quot;} --&gt;

                &lt;!-- &lt;hr size=&quot;2&quot; width=&quot;100%&quot; /&gt; --&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
        &lt;!-- &lt;tr&gt;
        &lt;td class=&quot;info-title&quot;&gt;构建日志(最后100行)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td&gt;&lt;p&gt;&lt;pre&gt;${BUILD_LOG, maxLines=100}&lt;/pre&gt;&lt;/p&gt;&lt;/td&gt;
    &lt;/tr&gt; --&gt;
    &lt;/table&gt;
&lt;/body&gt;" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs xml"><code><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>${ENV, var="JOB_NAME"}-第${BUILD_NUMBER}次构建日志<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-tag">html</span>,
        <span class="hljs-selector-tag">body</span> {
            <span class="hljs-attribute">font-family</span>: <span class="hljs-string">"SF Pro SC"</span>, <span class="hljs-string">"SF Pro Text"</span>, <span class="hljs-string">"SF Pro Icons"</span>, <span class="hljs-string">"PingFang SC"</span>, <span class="hljs-string">"Helvetica Neue"</span>, <span class="hljs-string">"Helvetica"</span>, <span class="hljs-string">"Arial"</span>, sans-serif;
        }
        <span class="hljs-selector-class">.table</span><span class="hljs-selector-class">.success</span> {
            <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ddd</span>;
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#4a4a4a</span>;
        }

        <span class="hljs-selector-class">.table</span><span class="hljs-selector-class">.success</span> <span class="hljs-selector-tag">td</span> {
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>;
            <span class="hljs-attribute">overflow</span>: hidden;
            <span class="hljs-attribute">word-break</span>: break-all;
        }

        <span class="hljs-selector-tag">td</span><span class="hljs-selector-class">.info</span> {
            <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#dfb051</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">44px</span>;
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;
        }

        <span class="hljs-selector-tag">td</span><span class="hljs-selector-pseudo">:first-child</span> {
            <span class="hljs-attribute">padding-left</span>: <span class="hljs-number">49px</span>;
            <span class="hljs-attribute">padding-right</span>: <span class="hljs-number">49px</span>;
        }

        <span class="hljs-selector-tag">td</span><span class="hljs-selector-class">.build-status</span> {
            <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#76ac35</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">44px</span>;
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;
        }

        <span class="hljs-selector-class">.table</span><span class="hljs-selector-class">.success</span> <span class="hljs-selector-tag">td</span> <span class="hljs-selector-tag">pre</span> {
            <span class="hljs-attribute">white-space</span>: pre-wrap;
        }

        <span class="hljs-selector-class">.success-ico</span> {
            <span class="hljs-attribute">vertical-align</span>: middle;
            <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">10px</span>;
            <span class="hljs-attribute">width</span>: <span class="hljs-number">25px</span>;
            <span class="hljs-comment">/* height: 30px; */</span>
            <span class="hljs-comment">/* margin-bottom: 20px; */</span>
        }

        <span class="hljs-selector-tag">td</span><span class="hljs-selector-class">.info-title</span> {
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#76ac35</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">36px</span>;
            <span class="hljs-attribute">font-weight</span>: bold;
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>;
        }

        <span class="hljs-selector-class">.table</span><span class="hljs-selector-class">.success</span> <span class="hljs-selector-tag">ul</span> {
            <span class="hljs-attribute">list-style</span>: none;
            <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
        }
        <span class="hljs-selector-class">.table</span><span class="hljs-selector-class">.success</span> <span class="hljs-selector-tag">ul</span> <span class="hljs-selector-tag">li</span> {
            <span class="hljs-attribute">list-style</span>: none;
        }


        <span class="hljs-selector-tag">ul</span> <span class="hljs-selector-tag">li</span> {
            <span class="hljs-attribute">height</span>: <span class="hljs-number">35px</span>;
            <span class="hljs-attribute">line-height</span>: <span class="hljs-number">35px</span>;
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
            <span class="hljs-attribute">white-space</span>: nowrap;
        }

        <span class="hljs-selector-tag">hr</span> {
            <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">0</span>;
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">leftmargin</span>=<span class="hljs-string">"8"</span> <span class="hljs-attr">marginwidth</span>=<span class="hljs-string">"0"</span> <span class="hljs-attr">topmargin</span>=<span class="hljs-string">"8"</span> <span class="hljs-attr">marginheight</span>=<span class="hljs-string">"4"</span> <span class="hljs-attr">offset</span>=<span class="hljs-string">"0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"95%"</span> <span class="hljs-attr">cellpadding</span>=<span class="hljs-string">"0"</span> <span class="hljs-attr">cellspacing</span>=<span class="hljs-string">"0"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"table success"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"info"</span>&gt;</span>(大佬们好呀，本邮件是jenkins自动下发的，请勿回复！)<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"95%"</span> <span class="hljs-attr">cellpadding</span>=<span class="hljs-string">"0"</span> <span class="hljs-attr">cellspacing</span>=<span class="hljs-string">"0"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"table success"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"build-status"</span>&gt;</span>
                构建成功啦
                <span class="hljs-tag">&lt;<span class="hljs-name">img</span>
                    <span class="hljs-attr">class</span>=<span class="hljs-string">"success-ico"</span>
                    <span class="hljs-attr">src</span>=<span class="hljs-string">"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAAAjCAYAAAFp3oPPAAAAAXNSR0IArs4c6QAAA/ZJREFUWAm9mLtPVEEUxlkDAaKhQY1iKyWPAmNhYazUAmOMrZRYGQtii9FWwI4e/wA1JibamKixQChITEisqFgNaGI0FDasv2/unNm5r727sDLJt+f1nTNz53VvtqfHt0ajUTe9ZookgdeIN1ICwwiOSaBhDuRHp+O7JwX5wTm8MY7jlXOg9IO5EC1UYLgWglgDwTAFZ7/pJvFtOx1lInKOR/od6cQH9eOGhSxsliSiK4tcMGYIZhUIr0AdhG4DB2cywOBxY2k+CASbQy2Ba/jcjCETIoqbD6R7GrHQQ3fo4emTEgW/kOq9PjNey0Ct0TDWVdqtJzLXAjtWItaC/Njpp8YRdgj6AHBPHRcJuoJKEDE4vYJv0MdaFkh3n61SYFM0naNeYh62a7FPepEfX5KLkhyEbFYHtmrU+KmzPCPWYwf5PX5dNdL6MRKvo9jELnZQyHF97jWXh6GVcpsU2Quqmu1AXQv5FcS5DZrHo2R44ohbEk67IU4AO6Q6qNKrT0y6jFvqeRLXwV8v57OcQhtyH9gBN4oI8vt4X1FcSzcFVgqDGad44qfcOEbAg5SzwhBfeYGGsWkG+gnwzexYyq+4+dCTPJRH5pSUDdRGM/7RxJ3nK2kvJvtCT7O+Mr/L5+d+UUK7PuXrLK21m1DCW1MRe8MuUbWTtuSL1lTE1vtFSU9lbuNP6Y7Z4644LqaGUZaR9Uf3y55G4l4BnnQ3Sy6xY16SzwDizbasEbVoy1YYTsjTY6S2PfYw0EGMm+zhqEB62ysA4XAHMKp+uKvACplkZG1fSm6jWWKZpOAQMX2BzIDT4C14D3Tf6sT/ACfBWXAOXAZXwQ54BhbZEr+RB2sMQIv2GWyCwhuz3crK93VUr3mXVRWArAX/Azq6NKvqWlx1fX07uRZqSgjaLBr5StP7/zT1A1ZB+j2EYwjonEwXdY9fHwLW9lHCeSrh6xyKZy3/MUAiQXsxak8mDeeWAmZnpU9CuLbLb3+WE9uKA/GsVdXeUr4uTL3/J9ntt+KCR6kzhuf0t6Gp0ofJ7aPsPNuX+tc49JE3Br7EBAI3sSdjX5f1DVbiZVRT/Y9pME5Bfo2C59EfRna31ey14SakcM8wM3pvfgenuj0K6u2CM8zMvtWmv2TPyIGxBVI7HlvH8xfoZlO91LWArePtTpMbHIbdM6kB+YFWfQSQ3lYLHwuu02QS8veM77TlDUx3s6DTmRJ/1jqPJf7cDZx7a0O6QNI78Jh1fRIXMB2O9tQlcBHoxaep/wn0D88q+BTvCezQyNXm1d12Bc56CLRSSIrf2tOtuFUxak0Dvf1bvrVzM1NUmCJD+OfADMh+z2g2NCuaHc3Sgb9n/gFyaAu+lH9E5AAAAABJRU5ErkJggg=="</span>
                /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"info-title"</span>&gt;</span>
                构建信息
                <span class="hljs-comment">&lt;!-- &lt;hr size="2" width="100%" align="center" /&gt; --&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>项目名称 ： ${JOB_NAME}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>构建编号 ： 第${BUILD_NUMBER}次构建<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>触发原因 ： ${CAUSE}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>构建日志 ： <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"${BUILD_URL}console"</span>&gt;</span>${BUILD_URL}console<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>工作目录 ： <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"${PROJECT_URL}"</span>&gt;</span>${PROJECT_URL}<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">hr</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"2"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"100%"</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"info-title"</span>&gt;</span>历史变更记录<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>
                        ${CHANGES_SINCE_LAST_SUCCESS,reverse=true,format="更新作者：%c",showPaths=true,changesFormat="[%a]",pathFormat="<span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-symbol">&amp;nbsp;</span>%p"}
                    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>
                        ${CHANGES_SINCE_LAST_SUCCESS,reverse=true,format="更新信息：%c",showPaths=true,changesFormat="%m",pathFormat="<span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-symbol">&amp;nbsp;</span>%p"}
                    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
                <span class="hljs-comment">&lt;!-- ${CHANGES_SINCE_LAST_SUCCESS,reverse=true, format="Changes for Build #%n:&lt;br /&gt;%c&lt;br /&gt;",showPaths=true,changesFormat="&lt;pre&gt;[%a]&lt;br /&gt;%m&lt;/pre&gt;",pathFormat="&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;%p"} --&gt;</span>

                <span class="hljs-comment">&lt;!-- &lt;hr size="2" width="100%" /&gt; --&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- &lt;tr&gt;
        &lt;td class="info-title"&gt;构建日志(最后100行)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td&gt;&lt;p&gt;&lt;pre&gt;${BUILD_LOG, maxLines=100}&lt;/pre&gt;&lt;/p&gt;&lt;/td&gt;
    &lt;/tr&gt; --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></code></pre><p>&lt;/html&gt;</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
我把着两个文件放在/jenkins 目录下，方便后续的更改或者复制调试啊

那模板设置好了，怎么用？接下来的代码告诉你

配置完模板，我们得再代码上设置一下
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs"><code>
我把着两个文件放在/jenkins 目录下，方便后续的更改或者复制调试啊

那模板设置好了，怎么用？接下来的代码告诉你

配置完模板，我们得再代码上设置一下
</code></pre><p>post {</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="    changed{
        echo &#39;I changed!&#39;
    }

    failure{
        echo &#39;I failed!&#39;
        configFileProvider([configFile(fileId: &#39;email-tmp-fail&#39;, targetLocation: &#39;email-fail.html&#39;, variable: &#39;content&#39;)]) {
           script {
               template = readFile encoding: &#39;UTF-8&#39;, file: &quot;${content}&quot;
               emailext(
                subject: &quot;Job [${env.JOB_NAME}] - Status: fail&quot;,
                body: &quot;&quot;&quot;${template}&quot;&quot;&quot;,
                recipientProviders: [culprits(),requestor(),developers()], 
                to: &quot;eric_longming@163.com&quot;,
               )
           }
       }

    }

    success{
        echo &#39;I success&#39;
        configFileProvider([configFile(fileId: &#39;email-tmp-success&#39;, targetLocation: &#39;email-success.html&#39;, variable: &#39;content&#39;)]) {
           script {
               template = readFile encoding: &#39;UTF-8&#39;, file: &quot;${content}&quot;
               emailext(
                subject: &quot;Job [${env.JOB_NAME}] - Status: Success&quot;,
                body: &quot;&quot;&quot;${template}&quot;&quot;&quot;,
                recipientProviders: [requestor(),developers()], 
                to: &quot;eric_longming@163.com&quot;,
               )
           }
       }
    }

    always{
        echo &#39;I always&#39;
        script{
            if(fileExists(&quot;${resetFlagFile}&quot;)){
                sh &quot;rm -r ${resetFlagFile}&quot;  //回滚标志文件记得删
            }
        }
    }
    unstable{
        echo &quot;unstable&quot;
    }
    aborted{
        echo &quot;aborted&quot;
    }
}
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs python"><code>    changed{
        echo <span class="hljs-string">'I changed!'</span>
    }

    failure{
        echo <span class="hljs-string">'I failed!'</span>
        configFileProvider([configFile(fileId: <span class="hljs-string">'email-tmp-fail'</span>, targetLocation: <span class="hljs-string">'email-fail.html'</span>, variable: <span class="hljs-string">'content'</span>)]) {
           script {
               template = readFile encoding: <span class="hljs-string">'UTF-8'</span>, file: <span class="hljs-string">"${content}"</span>
               emailext(
                subject: <span class="hljs-string">"Job [${env.JOB_NAME}] - Status: fail"</span>,
                body: <span class="hljs-string">"""${template}"""</span>,
                recipientProviders: [culprits(),requestor(),developers()], 
                to: <span class="hljs-string">"eric_longming@163.com"</span>,
               )
           }
       }

    }

    success{
        echo <span class="hljs-string">'I success'</span>
        configFileProvider([configFile(fileId: <span class="hljs-string">'email-tmp-success'</span>, targetLocation: <span class="hljs-string">'email-success.html'</span>, variable: <span class="hljs-string">'content'</span>)]) {
           script {
               template = readFile encoding: <span class="hljs-string">'UTF-8'</span>, file: <span class="hljs-string">"${content}"</span>
               emailext(
                subject: <span class="hljs-string">"Job [${env.JOB_NAME}] - Status: Success"</span>,
                body: <span class="hljs-string">"""${template}"""</span>,
                recipientProviders: [requestor(),developers()], 
                to: <span class="hljs-string">"eric_longming@163.com"</span>,
               )
           }
       }
    }

    always{
        echo <span class="hljs-string">'I always'</span>
        script{
            <span class="hljs-keyword">if</span>(fileExists(<span class="hljs-string">"${resetFlagFile}"</span>)){
                sh <span class="hljs-string">"rm -r ${resetFlagFile}"</span>  //回滚标志文件记得删
            }
        }
    }
    unstable{
        echo <span class="hljs-string">"unstable"</span>
    }
    aborted{
        echo <span class="hljs-string">"aborted"</span>
    }
}
</code></pre><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
- **configFileProvider**：是我们安装插件的方法

  - **fileId：** 是刚刚我们设置的邮箱模板文件的ID
  - **targetLocation：**  是我们的模板文件编译后放的地方，这里是根目录的 emali-fail.html
  - **variable：** 就是模板编译文件

- readFile 是pipeline 内置的读文件的方法

- **emailext：** 是插件 Email Extension的方法

  - subject：String类型，邮件的主题。

  - body：String类型，邮件的内容

  - from：发件人邮箱（默认就是我们配置的）

  - to：String类型，收件人

  - recipientProviders：List类型，收件人列表类型

    |  类型名称  | helper方法名 |                             描述                             |
    | :--------: | :----------: | :----------------------------------------------------------: |
    |  Culprits  |  culprits()  | 引发构建失败的人。最后一次构建成功和最后一次构建失败之间的变更提交者列表 |
    | Developers | developers() |             此次构建所涉及的变更的所有提交者列表             |
    | Requestor  | requestor()  |             请求构建的人，一般指手动触发构建的人             |

我来触发一个失败和成功的构建测试看看邮件通知的功能

![email-send](https://fn-md-1255398640.cos.ap-guangzhou.myqcloud.com/prj/email-send.jpg)

当然也能配置钉钉和企业微信的通知，还有http自定义的通知等

## Verdaccio

作为一个积极上进的小开发团队，当然必须要有自己的npm私有库啊

这里我们选择了verdaccio，一个开源轻量的npm私服，他还有官方的docker镜像

### 1 docker 安装 Verdaccio 
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs markdown"><code><span class="hljs-bullet">
- </span><span class="hljs-strong">**configFileProvider**</span>：是我们安装插件的方法
<span class="hljs-bullet">
  - </span><span class="hljs-strong">**fileId：**</span> 是刚刚我们设置的邮箱模板文件的ID
<span class="hljs-bullet">  - </span><span class="hljs-strong">**targetLocation：**</span>  是我们的模板文件编译后放的地方，这里是根目录的 emali-fail.html
<span class="hljs-bullet">  - </span><span class="hljs-strong">**variable：**</span> 就是模板编译文件
<span class="hljs-bullet">
- </span>readFile 是pipeline 内置的读文件的方法
<span class="hljs-bullet">
- </span><span class="hljs-strong">**emailext：**</span> 是插件 Email Extension的方法
<span class="hljs-bullet">
  - </span>subject：String类型，邮件的主题。
<span class="hljs-bullet">
  - </span>body：String类型，邮件的内容
<span class="hljs-bullet">
  - </span>from：发件人邮箱（默认就是我们配置的）
<span class="hljs-bullet">
  - </span>to：String类型，收件人
<span class="hljs-bullet">
  - </span>recipientProviders：List类型，收件人列表类型

<span class="hljs-code">    |  类型名称  | helper方法名 |                             描述                             |</span>
<span class="hljs-code">    | :--------: | :----------: | :----------------------------------------------------------: |</span>
<span class="hljs-code">    |  Culprits  |  culprits()  | 引发构建失败的人。最后一次构建成功和最后一次构建失败之间的变更提交者列表 |</span>
<span class="hljs-code">    | Developers | developers() |             此次构建所涉及的变更的所有提交者列表             |</span>
<span class="hljs-code">    | Requestor  | requestor()  |             请求构建的人，一般指手动触发构建的人             |</span>

我来触发一个失败和成功的构建测试看看邮件通知的功能

![<span class="hljs-string">email-send</span>](<span class="hljs-link">https://fn-md-1255398640.cos.ap-guangzhou.myqcloud.com/prj/email-send.jpg</span>)

当然也能配置钉钉和企业微信的通知，还有http自定义的通知等

<span class="hljs-section">## Verdaccio</span>

作为一个积极上进的小开发团队，当然必须要有自己的npm私有库啊

这里我们选择了verdaccio，一个开源轻量的npm私服，他还有官方的docker镜像

<span class="hljs-section">### 1 docker 安装 Verdaccio </span>
</code></pre><h2 id="item-13">查看官方的verdaccio镜像源</h2><p>docker search verdaccio</p><h2 id="item-14">看到官方镜像源叫 verdaccio/verdaccio，我们下载下来</h2><p>docker pull verdaccio/verdaccio</p><h2 id="item-15">我们先在我们用户工作目录下，新建一个verdaccio目录</h2><p>cd ~<br>mkdir verdaccio<br>cd verdaccio<br>mkdir conf<br>mkdir storage,<br>mkdir plugins</p><h2 id="item-16">进入conf，创建verdaccio需要的配置文件</h2><p>cd conf<br>vi config.yaml</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
config.yaml内容如下
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs lua"><code>
<span class="hljs-built_in">config</span>.yaml内容如下
</code></pre><h2 id="item-17">This is the config file used for the docker images.</h2><h2 id="item-18">It allows all users to do anything, so don't use it on production systems.</h2><h2 id="item-19">Do not configure host and port under <code>listen</code> in this file</h2><h2 id="item-20">as it will be ignored when using docker.</h2><h2 id="item-21">see <a href="https://github.com/verdaccio/verdaccio/blob/master/wiki/docker.md#docker-and-custom-port-configuration" rel="nofollow noreferrer" target="_blank">https://github.com/verdaccio/...</a></h2><h2 id="item-22">Look here for more config file examples:</h2><h2 id="item-23"><a href="https://github.com/verdaccio/verdaccio/tree/master/conf" rel="nofollow noreferrer" target="_blank">https://github.com/verdaccio/...</a></h2><h2 id="item-24">path to a directory with all packages</h2><p>storage: /verdaccio/storage</p><p>auth:<br>  htpasswd:</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="file: /verdaccio/conf/htpasswd
# Maximum amount of users allowed to register, defaults to &quot;+inf&quot;.
# You can set this to -1 to disable registration.
#max_users: 1000
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs shell"><code>file: /verdaccio/conf/htpasswd
<span class="hljs-meta">#</span><span class="bash"> Maximum amount of users allowed to register, defaults to <span class="hljs-string">"+inf"</span>.</span>
<span class="hljs-meta">#</span><span class="bash"> You can <span class="hljs-built_in">set</span> this to -1 to <span class="hljs-built_in">disable</span> registration.</span>
<span class="hljs-meta">#</span><span class="bash">max_users: 1000</span>
</code></pre><h2 id="item-25">a list of other known repositories we can talk to</h2><p>uplinks:<br>  npmjs:</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="url: https://registry.npm.taobao.org
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs less"><code><span class="hljs-attribute">url</span>: <span class="hljs-attribute">https</span>:<span class="hljs-comment">//registry.npm.taobao.org</span>
</code></pre><p>packages:</p><p>'@<em>/</em>':</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="# scoped packages
access: $all
publish: $all
proxy: npmjs
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs yaml"><code><span class="hljs-comment"># scoped packages</span>
<span class="hljs-attr">access:</span> <span class="hljs-string">$all</span>
<span class="hljs-attr">publish:</span> <span class="hljs-string">$all</span>
<span class="hljs-attr">proxy:</span> <span class="hljs-string">npmjs</span>
</code></pre><p>'**':</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="# allow all users (including non-authenticated users) to read and
# publish all packages
#
# you can specify usernames/groupnames (depending on your auth plugin)
# and three keywords: &quot;$all&quot;, &quot;$anonymous&quot;, &quot;$authenticated&quot;
access: $all

# allow all known users to publish packages
# (anyone can register by default, remember?)
publish: $all

# if package is not available locally, proxy requests to &#39;npmjs&#39; registry
proxy: npmjs
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs shell"><code><span class="hljs-meta">#</span><span class="bash"> allow all users (including non-authenticated users) to <span class="hljs-built_in">read</span> and</span>
<span class="hljs-meta">#</span><span class="bash"> publish all packages</span>
<span class="hljs-meta">#</span>
<span class="hljs-meta">#</span><span class="bash"> you can specify usernames/groupnames (depending on your auth plugin)</span>
<span class="hljs-meta">#</span><span class="bash"> and three keywords: <span class="hljs-string">"<span class="hljs-variable">$all</span>"</span>, <span class="hljs-string">"<span class="hljs-variable">$anonymous</span>"</span>, <span class="hljs-string">"<span class="hljs-variable">$authenticated</span>"</span></span>
access: $all
<span class="hljs-meta">
#</span><span class="bash"> allow all known users to publish packages</span>
<span class="hljs-meta">#</span><span class="bash"> (anyone can register by default, remember?)</span>
publish: $all
<span class="hljs-meta">
#</span><span class="bash"> <span class="hljs-keyword">if</span> package is not available locally, proxy requests to <span class="hljs-string">'npmjs'</span> registry</span>
proxy: npmjs
</code></pre><h2 id="item-26">To use <code>npm audit</code> uncomment the following section</h2><p>middlewares:<br>  audit:</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="enabled: true
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs yaml"><code><span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
</code></pre><h2 id="item-27">log settings</h2><p>logs:</p><ul><li>{type: stdout, format: pretty, level: trace}</li></ul><p>#- {type: file, path: verdaccio.log, level: info}</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
创建verdaccio容器应用
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs"><code>
创建verdaccio容器应用
</code></pre><h2 id="item-28">创建+运行verdaccio容器</h2><p>docker run \<br>  --name verdaccio \<br>  -d \<br>  -it \<br>  -p 4873:4873 \<br>  -v ~/verdaccio/storage:/verdaccio/storage \<br>  -v ~/verdaccio/conf:/verdaccio/conf \<br>  -v ~/verdaccio/plugins:/verdaccio/plugins \<br>  -v /etc/localtime:/etc/localtime:ro \<br>  verdaccio/verdaccio</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
- **docker run:**  创建一个新容器

- **--name verdaccio:** 将这个容器命名为jenkins（这个后面方便操作）

- **-d:**这个参数能让容器到后台运行

- **-it:**  **-i** 以交互模式运行容器，**-t** 为容器重新分配一个伪输入终端

- **-p:**端口映射，格式为：**主机(宿主)端口:容器端口**

- **-v:**在这里是是挂载模式，规则是设置的宿主文件挂载到容器内部，容器内容不管有什么内容都会被替换成宿主挂载目录的文件

  而且设置的挂载目录不能为空

- **-v /etc/localtime:/etc/localtime:ro :** 同步容器和主机的时间，ps:这玩意在mac上不好使

- **verdaccio/verdaccio:** 这个是**image**镜像文件，docker将以此镜像文件创建一个容器，如果本地不存在会自动拉去线上最新的版本

  创建生成容器后我们打印容器创建的信息可以看到" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs markdown"><code><span class="hljs-bullet">
- </span><span class="hljs-strong">**docker run:**</span>  创建一个新容器
<span class="hljs-bullet">
- </span><span class="hljs-strong">**--name verdaccio:**</span> 将这个容器命名为jenkins（这个后面方便操作）
<span class="hljs-bullet">
- </span><span class="hljs-strong">**-d:**</span>这个参数能让容器到后台运行
<span class="hljs-bullet">
- </span><span class="hljs-strong">**-it:**</span>  <span class="hljs-strong">**-i**</span> 以交互模式运行容器，<span class="hljs-strong">**-t**</span> 为容器重新分配一个伪输入终端
<span class="hljs-bullet">
- </span><span class="hljs-strong">**-p:**</span>端口映射，格式为：<span class="hljs-strong">**主机(宿主)端口:容器端口**</span>
<span class="hljs-bullet">
- </span><span class="hljs-strong">**-v:**</span>在这里是是挂载模式，规则是设置的宿主文件挂载到容器内部，容器内容不管有什么内容都会被替换成宿主挂载目录的文件

  而且设置的挂载目录不能为空
<span class="hljs-bullet">
- </span><span class="hljs-strong">**-v /etc/localtime:/etc/localtime:ro :**</span> 同步容器和主机的时间，ps:这玩意在mac上不好使
<span class="hljs-bullet">
- </span><span class="hljs-strong">**verdaccio/verdaccio:**</span> 这个是<span class="hljs-strong">**image**</span>镜像文件，docker将以此镜像文件创建一个容器，如果本地不存在会自动拉去线上最新的版本

  创建生成容器后我们打印容器创建的信息可以看到</code></pre><h2 id="item-29">查看容器运行日志</h2><p>docker logs verdaccio<br> warn --- config file  - /verdaccio/conf/config.yaml<br> warn --- Verdaccio started<br> ...<br> ...<br> ...<br> warn --- Plugin successfully loaded: verdaccio-htpasswd<br> warn --- Plugin successfully loaded: verdaccio-audit<br> warn --- http address - <a href="http://0.0.0.0/" rel="nofollow noreferrer" target="_blank">http://0.0.0.0</a>:4873/ - verdaccio/4.8.1</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
看到端口是4873，上面我们生成容器的时候，我们也是配置了4873的端口映射，去阿里云配置了添加4873端口的安全组规则后，我们打开网站 http://yourip:4873  

![verdaccio-web](https://fn-md-1255398640.cos.ap-guangzhou.myqcloud.com/prj/verdaccio-web.png)

### **2 配置和注册**

从刚才的log 可以看到docker的verdaccio容器的配置文件是指向 `/verdaccio/conf/config.yaml`     

这个容器没有 /bin/bash，只有sh，我们进入容器看看配置文件
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs markdown"><code>
看到端口是4873，上面我们生成容器的时候，我们也是配置了4873的端口映射，去阿里云配置了添加4873端口的安全组规则后，我们打开网站 http://yourip:4873  

![<span class="hljs-string">verdaccio-web</span>](<span class="hljs-link">https://fn-md-1255398640.cos.ap-guangzhou.myqcloud.com/prj/verdaccio-web.png</span>)

<span class="hljs-section">### **2 配置和注册**</span>

从刚才的log 可以看到docker的verdaccio容器的配置文件是指向 <span class="hljs-code">`/verdaccio/conf/config.yaml`</span>     

这个容器没有 /bin/bash，只有sh，我们进入容器看看配置文件
</code></pre><h2 id="item-30">进入docker容器，用sh做交互</h2><p>docker exec -it verdaccio /bin/sh</p><h2 id="item-31">cd到配置目录下</h2><p>cd /verdaccio/conf</p><h2 id="item-32">查看默认的配置文件</h2><p>cat config.yaml</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
详细的配置文件可以查看[官网的教程](https://verdaccio.org/docs/zh-CN/configuration)

1. 默认的储存目录：verdaccio默认使用内置本地文件模式存储
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs markdown"><code>
详细的配置文件可以查看[<span class="hljs-string">官网的教程</span>](<span class="hljs-link">https://verdaccio.org/docs/zh-CN/configuration</span>)
<span class="hljs-bullet">
1. </span>默认的储存目录：verdaccio默认使用内置本地文件模式存储
</code></pre><p>storage: /verdaccio/storage/data</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
2. 插件存放的目录：
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs yaml"><code>
<span class="hljs-number">2</span><span class="hljs-string">.</span> <span class="hljs-string">插件存放的目录：</span>
</code></pre><p>plugins: /verdaccio/plugins</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
3. 认证 :默认的授权是基于`htpasswd` 并且是内置的。您可以通过[plugins](https://verdaccio.org/docs/zh-CN/plugins)来修改此行为
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs markdown"><code><span class="hljs-bullet">
3. </span>认证 :默认的授权是基于<span class="hljs-code">`htpasswd`</span> 并且是内置的。您可以通过[<span class="hljs-string">plugins</span>](<span class="hljs-link">https://verdaccio.org/docs/zh-CN/plugins</span>)来修改此行为
</code></pre><p>auth:<br>  htpasswd:</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="file:  /verdaccio/storage/htpasswd
#max_users : 10000" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs less"><code><span class="hljs-attribute">file</span>:  /verdaccio/storage/htpasswd
#<span class="hljs-attribute">max_users </span>: <span class="hljs-number">10000</span></code></pre><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
4. 上行链路`uplinks,这里我们做了几个源的添加
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs yaml"><code>
<span class="hljs-number">4</span><span class="hljs-string">.</span> <span class="hljs-string">上行链路`uplinks,这里我们做了几个源的添加</span>
</code></pre><p>uplinks:<br>  npmjs:</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="url: https://registry.npmjs.org/" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs less"><code style="word-break: break-word; white-space: initial;"><span class="hljs-attribute">url</span>: <span class="hljs-attribute">https</span>:<span class="hljs-comment">//registry.npmjs.org/</span></code></pre><p>yarn:</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="  url: https://registry.yarnpkg.com/" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs less"><code style="word-break: break-word; white-space: initial;">  <span class="hljs-attribute">url</span>: <span class="hljs-attribute">https</span>:<span class="hljs-comment">//registry.yarnpkg.com/</span></code></pre><p>cnmp:</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="  url: http://r.cnpmjs.org/" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs less"><code style="word-break: break-word; white-space: initial;">  <span class="hljs-attribute">url</span>: <span class="hljs-attribute">http</span>:<span class="hljs-comment">//r.cnpmjs.org/</span></code></pre><p>taobao:</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="  url: https://registry.npm.taobao.org/" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs less"><code style="word-break: break-word; white-space: initial;">  <span class="hljs-attribute">url</span>: <span class="hljs-attribute">https</span>:<span class="hljs-comment">//registry.npm.taobao.org/</span></code></pre><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
5. 包的访问
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs yaml"><code>
<span class="hljs-number">5</span><span class="hljs-string">.</span> <span class="hljs-string">包的访问</span>
</code></pre><p>packages:<br>  'wild-fox-*':</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="  access: $all
publish: $authenticated
unpublish: $authenticated" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs ruby"><code>  <span class="hljs-symbol">access:</span> $all
<span class="hljs-symbol">publish:</span> $authenticated
<span class="hljs-symbol">unpublish:</span> $authenticated</code></pre><p>'**':</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="access: $all
publish: $authenticated
unpublish: $authenticated
proxy:   taobao" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs yaml"><code><span class="hljs-attr">access:</span> <span class="hljs-string">$all</span>
<span class="hljs-attr">publish:</span> <span class="hljs-string">$authenticated</span>
<span class="hljs-attr">unpublish:</span> <span class="hljs-string">$authenticated</span>
<span class="hljs-attr">proxy:</span>   <span class="hljs-string">taobao</span></code></pre><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
- `wild-fox-*`: 这个前缀的包都能下载，只有认证的用户能发布，不设置上行链路

- `&quot;**&quot;`: 所有的包都能下载，只有认证的用户能发布，本地如果没有就到设置的上行链路 taobao 去获取

- `access` 表示哪一类用户可以对匹配的项目进行安装(install)

- `publish` 表示哪一类用户可以对匹配的项目进行发布(publish)

- `unpublish` 表示哪一类用户可以对匹配的项目进行下架(unpublish)

  权限类型

- `$all` 表示所有人都可以执行对应的操作

- `$authenticated` 表示只有通过验证的人可以执行对应操作

- `$anonymous` 表示只有匿名者可以进行对应操作

6. 是否禁止用 npm adduser 

   如果是内网的话，一般就不需要，当然也随你,在认真的配置下面设置
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs markdown"><code><span class="hljs-bullet">
- </span><span class="hljs-code">`wild-fox-*`</span>: 这个前缀的包都能下载，只有认证的用户能发布，不设置上行链路
<span class="hljs-bullet">
- </span><span class="hljs-code">`"**"`</span>: 所有的包都能下载，只有认证的用户能发布，本地如果没有就到设置的上行链路 taobao 去获取
<span class="hljs-bullet">
- </span><span class="hljs-code">`access`</span> 表示哪一类用户可以对匹配的项目进行安装(install)
<span class="hljs-bullet">
- </span><span class="hljs-code">`publish`</span> 表示哪一类用户可以对匹配的项目进行发布(publish)
<span class="hljs-bullet">
- </span><span class="hljs-code">`unpublish`</span> 表示哪一类用户可以对匹配的项目进行下架(unpublish)

  权限类型
<span class="hljs-bullet">
- </span><span class="hljs-code">`$all`</span> 表示所有人都可以执行对应的操作
<span class="hljs-bullet">
- </span><span class="hljs-code">`$authenticated`</span> 表示只有通过验证的人可以执行对应操作
<span class="hljs-bullet">
- </span><span class="hljs-code">`$anonymous`</span> 表示只有匿名者可以进行对应操作
<span class="hljs-bullet">
6. </span>是否禁止用 npm adduser 

   如果是内网的话，一般就不需要，当然也随你,在认真的配置下面设置
</code></pre><p>auth:<br>  htpasswd:</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text=" ···
#禁止用户登陆 
max_users: -1 " title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs yaml"><code> <span class="hljs-string">···</span>
<span class="hljs-comment">#禁止用户登陆 </span>
<span class="hljs-attr">max_users:</span> <span class="hljs-number">-1</span> </code></pre><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
7. 添加账户
   - 没有禁止用户登录的话，直接用 adduser 就好
   - verdaccio 的认证是基于 [verdaccio-htpasswd](https://www.npmjs.com/package/verdaccio-htpasswd)，可以通过官方提供的工具来生成 [www.htaccesstools.com/htpasswd-ge…](http://www.htaccesstools.com/htpasswd-generator/)，将生成的段字符串添加到 `htpasswd` 中即可。

### 3 使用

为了方便npm源的切换，我们本地安装`nrm`
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs markdown"><code><span class="hljs-bullet">
7. </span>添加账户
<span class="hljs-bullet">   - </span>没有禁止用户登录的话，直接用 adduser 就好
<span class="hljs-bullet">   - </span>verdaccio 的认证是基于 [<span class="hljs-string">verdaccio-htpasswd</span>](<span class="hljs-link">https://www.npmjs.com/package/verdaccio-htpasswd</span>)，可以通过官方提供的工具来生成 [<span class="hljs-string">www.htaccesstools.com/htpasswd-ge…</span>](<span class="hljs-link">http://www.htaccesstools.com/htpasswd-generator/</span>)，将生成的段字符串添加到 <span class="hljs-code">`htpasswd`</span> 中即可。

<span class="hljs-section">### 3 使用</span>

为了方便npm源的切换，我们本地安装<span class="hljs-code">`nrm`</span>
</code></pre><p>npm install -g nrm</p><h2 id="item-33">查看现在可以的源， *表示现在使用源</h2><h3 id="item-33-7">nrm ls</h3><ul><li>npm -------- <a href="https://registry.npmjs.org/" rel="nofollow noreferrer" target="_blank">https://registry.npmjs.org/</a><br>yarn ------- <a href="https://registry.yarnpkg.com/" rel="nofollow noreferrer" target="_blank">https://registry.yarnpkg.com/</a><br>cnpm ------- <a href="http://r.cnpmjs.org/" rel="nofollow noreferrer" target="_blank">http://r.cnpmjs.org/</a><br>taobao ----- <a href="https://registry.npm.taobao.org/" rel="nofollow noreferrer" target="_blank">https://registry.npm.taobao.org/</a><br>nj --------- <a href="https://registry.nodejitsu.com/" rel="nofollow noreferrer" target="_blank">https://registry.nodejitsu.com/</a><br>npmMirror -- <a href="https://skimdb.npmjs.com/registry/" rel="nofollow noreferrer" target="_blank">https://skimdb.npmjs.com/regi...</a><br>edunpm ----- <a href="http://registry.enpmjs.org/" rel="nofollow noreferrer" target="_blank">http://registry.enpmjs.org/</a></li></ul><hr><h2 id="item-34">我们现在需要添加一个我们刚刚搭建的源库</h2><h2 id="item-35">nrm add &lt;registry&gt; &lt;url&gt;</h2><p>nrm add verdaccio <a href="http://yourip/" rel="nofollow noreferrer" target="_blank">http://yourip</a>:4873/</p><h2 id="item-36">添加后我们要使用它</h2><p>nrm use verdaccio</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
切换到我们的verdaccio后，我们先来登陆我们在这里注册的账号，我这里是 `eric`
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs ruby"><code>
切换到我们的verdaccio后，我们先来登陆我们在这里注册的账号，我这里是 <span class="hljs-string">`eric`</span>
</code></pre><h2 id="item-37">在我的用户目录下新建一个文件夹</h2><p>mkdir npm-vue-ci</p><h2 id="item-38">初始化</h2><p>npm init</p><h2 id="item-39">可以添加一个README.md 和 .npmignore,.npmignore这个是可以设计忽略需要上传的文件</h2><p>touch README.md<br>touch .npmignore</p><h2 id="item-40">随便写点东西我们测试一下发布</h2><p>npm publish</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
发布成功后我们可以在web界面上看到

![npm-vue-ci](https://fn-md-1255398640.cos.ap-guangzhou.myqcloud.com/prj/npm-vue-ci.png)

还要测试一下退出登录后的下载和下架
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs markdown"><code>
发布成功后我们可以在web界面上看到

![<span class="hljs-string">npm-vue-ci</span>](<span class="hljs-link">https://fn-md-1255398640.cos.ap-guangzhou.myqcloud.com/prj/npm-vue-ci.png</span>)

还要测试一下退出登录后的下载和下架
</code></pre><h2 id="item-41">退出登录</h2><p>npm logout</p><h2 id="item-42">不要在目录npm-vue-ci，去其他的目录下</h2><p>npm install npm-vue-ci</p><h2 id="item-43">没登录的状态下，这个曹操作必须是失败</h2><p>npm unpublish</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
当然我们能用之前安装的nginx来做个反向代理，我们设置我们的verdaccio域名为 **npm.wild-fox.cn**,在步骤[pre-build](#2 pre-build 阶段)的脚本中
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs markdown"><code>
当然我们能用之前安装的nginx来做个反向代理，我们设置我们的verdaccio域名为 <span class="hljs-strong">**npm.wild-fox.cn**</span>,在步骤[<span class="hljs-string">pre-build</span>](<span class="hljs-link">#2 pre-build 阶段</span>)的脚本中
</code></pre><ul><li>npm config set registry <a href="https://registry.npm.taobao.org/" rel="nofollow noreferrer" target="_blank">https://registry.npm.taobao.org</a></li><li>npm config set registry <a href="http://npm.wild-fox.cn/" rel="nofollow noreferrer" target="_blank">http://npm.wild-fox.cn</a></li></ul><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
这里有个要注意的🤣，我mac本地自己搭的verdaccio没问题，可能是因为服务器的网络慢，所以代理私有服务器的下载的时候总会出现第一次安装失败，所以我们在[pre-build](#2 pre-build 阶段) 的安装阶段的npm i 都需要做点
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs markdown"><code>
这里有个要注意的🤣，我mac本地自己搭的verdaccio没问题，可能是因为服务器的网络慢，所以代理私有服务器的下载的时候总会出现第一次安装失败，所以我们在[<span class="hljs-string">pre-build</span>](<span class="hljs-link">#2 pre-build 阶段</span>) 的安装阶段的npm i 都需要做点
</code></pre><ul><li>npm i || exit 1</li><li>npm i || npm i || exit 1</li></ul><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="


## Mongo

### 1 docker 安装 mongo
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs http"><code>

<span class="shell"><span class="hljs-meta">
#</span><span class="bash"><span class="hljs-comment"># Mongo</span></span>
<span class="hljs-meta">
#</span><span class="bash"><span class="hljs-comment">## 1 docker 安装 mongo</span></span>
</span></code></pre><h2 id="item-44">查看源</h2><p>docker search mongo</p><h2 id="item-45">下载源</h2><p>docker pull mongo</p><h2 id="item-46">创建+运行verdaccio容器</h2><p>docker run \<br>  --name mongo \<br>  -u mongo \<br>  -d \<br>  -it \<br>  -p 27017:27017 \</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="-v mongodb:/data/db \" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs kotlin"><code style="word-break: break-word; white-space: initial;">-v mongodb:/<span class="hljs-keyword">data</span>/db \</code></pre><p>-v /etc/localtime:/etc/localtime:ro \<br>  mongo --auth</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
### 2 新建用户和数据库

我们先进入数据库
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs shell"><code><span class="hljs-meta">
#</span><span class="bash"><span class="hljs-comment">## 2 新建用户和数据库</span></span>

我们先进入数据库
</code></pre><h2 id="item-47">进入admin</h2><p>docker exec -it mongo mongo admin</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
创建admin用户数据库
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs"><code>
创建admin用户数据库
</code></pre><h2 id="item-48">因为新的mongo 默认没有admin数据库，需要自己造一个还有管理员用户</h2><p>use admin<br>db.createUser({ user: 'admin', pwd: 'admin123456', roles: [ { role: "userAdminAnyDatabase", db: "admin" } ] });</p><h2 id="item-49">创建好后需要开启验证</h2><p>db.auth("admin","admin123456");</p><h2 id="item-50">因为这个数据库，现在安装是提供给yapi的，我们需要新建一个数据库和它的数据库管理员用户</h2><p>use yapi<br>db.createUser({ user: 'eric', pwd: 'eric123456', roles: [ { role: "readWrite", db: "yapi" } ] });</p><h2 id="item-51">开启验证,一次验证多个用户可能会失败，可以退出后再进来先验证admin，在重新验证普通用户</h2><p>db.auth("eric","eric123456");</p><h2 id="item-52">测试一下数据的写入</h2><p>db.test.save({name:"eric"});<br>db.test.find();</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
我们mongo的镜像还有一个路径可以放这些初始化用户的脚本，后面在[docker-compose 接管](#docker-compose 接管])那会用这种方式

### 3 mongodb知识点

用户权限列表
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs markdown"><code>
我们mongo的镜像还有一个路径可以放这些初始化用户的脚本，后面在[<span class="hljs-string">docker-compose 接管</span>](<span class="hljs-link">#docker-compose 接管]</span>)那会用这种方式

<span class="hljs-section">### 3 mongodb知识点</span>

用户权限列表
</code></pre><p>Read：允许用户读取指定数据库</p><p>readWrite：允许用户读写指定数据库</p><p>dbAdmin：允许用户在指定数据库中执行管理函数，如索引创建、删除，查看统计或访问system.profile</p><p>userAdmin：允许用户向system.users集合写入，可以找指定数据库里创建、删除和管理用户</p><p>clusterAdmin：只在admin数据库中可用，赋予用户所有分片和复制集相关函数的管理权限。</p><p>readAnyDatabase：只在admin数据库中可用，赋予用户所有数据库的读权限</p><p>readWriteAnyDatabase：只在admin数据库中可用，赋予用户所有数据库的读写权限</p><p>userAdminAnyDatabase：只在admin数据库中可用，赋予用户所有数据库的userAdmin权限</p><p>dbAdminAnyDatabase：只在admin数据库中可用，赋予用户所有数据库的dbAdmin权限。</p><p>root：只在admin数据库中可用。超级账号，超级权限</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
操作
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs"><code>
操作
</code></pre><h2 id="item-53">查看系统用户列表.pretty() 用这个方法美化列表</h2><p>db.system.users.find().pretty()</p><h2 id="item-54">删除数据库。</h2><p>db.dropDatabase()</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
## Yapi

这个镜像得我们来制作，这里我们只是做个最简单的套子，让大家知道怎么简单的用Dockerfile 制作镜像

这里主要是创建一个镜像，然后还需要自己进入容器运行可视化部署，这里先入个门嘛，后面在[docker-compose 接管](#docker-compose 接管]) 我们用稍微复杂点的Dockerfile 和一些脚本完成快速部署

### 用Dockerfile 制作镜像

我们先连在环境服务器的工作目录下新进一个文件存放 docker 的一些文件
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs markdown"><code>
<span class="hljs-section">## Yapi</span>

这个镜像得我们来制作，这里我们只是做个最简单的套子，让大家知道怎么简单的用Dockerfile 制作镜像

这里主要是创建一个镜像，然后还需要自己进入容器运行可视化部署，这里先入个门嘛，后面在[<span class="hljs-string">docker-compose 接管</span>](<span class="hljs-link">#docker-compose 接管]</span>) 我们用稍微复杂点的Dockerfile 和一些脚本完成快速部署

<span class="hljs-section">### 用Dockerfile 制作镜像</span>

我们先连在环境服务器的工作目录下新进一个文件存放 docker 的一些文件
</code></pre><h2 id="item-55">连接环境服务器</h2><p>ssh env</p><h2 id="item-56">进入用户目录，创建存放我们的docker数据的目录</h2><p>cd ~<br>mkdir docker-data</p><h2 id="item-57">进入docker数据目录，创建yai目录，在其目录下新建Dockerfile文件</h2><p>cd docker_data<br>mkdir yapi<br>cd yapi<br>vi Dockerfile</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
用 centos镜像做基础镜像当然是熟悉，容易入手，

在后面会**alpine** 做基础镜像来构建能有效减少镜像大小，不过步骤和方式会有些差异
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs markdown"><code>
用 centos镜像做基础镜像当然是熟悉，容易入手，

在后面会<span class="hljs-strong">**alpine**</span> 做基础镜像来构建能有效减少镜像大小，不过步骤和方式会有些差异
</code></pre><h2 id="item-58">我们创建的镜像基于centos镜像</h2><p>FROM centos</p><h2 id="item-59">镜像的作者</h2><p>LABEL MAINTAINER="longming@451904906@qq.com"</p><h2 id="item-60">设置环境变量，这里没有用到哈哈哈</h2><p>ENV WELCOME="Welcome to yapi"</p><h2 id="item-61">yapi需要安装git，和 node</h2><p>RUN yum install -y git<br>RUN curl --silent --location <a href="https://rpm.nodesource.com/setup_10.x" rel="nofollow noreferrer" target="_blank">https://rpm.nodesource.com/se...</a> | bash -<br>RUN yum install -y nodejs</p><h2 id="item-62">安装yapi</h2><p>RUN npm install -g yapi-cli --registry <a href="https://registry.npm.taobao.org/" rel="nofollow noreferrer" target="_blank">https://registry.npm.taobao.org</a></p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
现在我们用Dockerfile来创建我们的yapi镜像吧
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs"><code>
现在我们用Dockerfile来创建我们的yapi镜像吧
</code></pre><h2 id="item-63">要在~ /docker-data/yapi 目录哈</h2><h2 id="item-64">-t 指定镜像的名字和tag，. 表示在当前目录下需要Dockerfile</h2><p>docker build -t="yapi/wild:latest" .</p><h2 id="item-65">查看本地的镜像</h2><h3 id="item-65-8">docker images</h3><p>REPOSITORY            TAG                 IMAGE ID            CREATED             SIZE<br>yapi/wild             latest              7198cf86d306        30 seconds ago      483MB</p><h3 id="item-65-9">...</h3><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
### 创建yapi的容器
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs shell"><code><span class="hljs-meta">
#</span><span class="bash"><span class="hljs-comment">## 创建yapi的容器</span></span>
</code></pre><p>docker run \<br>--name yapi \<br>-d \<br>-it \<br>-p 9090:9090 \<br>-p 3000:3000 \<br>-v yapi:/my-yapi \<br>-v /etc/localtime:/etc/localtime:ro \<br>yapi/wild</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
- **9090**端口是部署的界面

- **3000**端口是我们将在部署界面设置的应用启动端口

- **/my-yapi**  是我们将在部署界面设置的部署目录

  我们用 服务器的 ip:9090可以看到（阿里云记得添加安全组）

![yapi-pre](https://fn-md-1255398640.cos.ap-guangzhou.myqcloud.com/prj/yapi-pre.jpg)

等待安装部署

![yapi-success](https://fn-md-1255398640.cos.ap-guangzhou.myqcloud.com/prj/yapi-success.png)

成功后可以看到哦这个网站默认的账号和密码，还有如何启动

&gt; 初始化管理员账号成功,账号名：&quot;eric-longming@163.com&quot;，密码：&quot;ymfe.org&quot;
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs markdown"><code><span class="hljs-bullet">
- </span><span class="hljs-strong">**9090**</span>端口是部署的界面
<span class="hljs-bullet">
- </span><span class="hljs-strong">**3000**</span>端口是我们将在部署界面设置的应用启动端口
<span class="hljs-bullet">
- </span><span class="hljs-strong">**/my-yapi**</span>  是我们将在部署界面设置的部署目录

  我们用 服务器的 ip:9090可以看到（阿里云记得添加安全组）

![<span class="hljs-string">yapi-pre</span>](<span class="hljs-link">https://fn-md-1255398640.cos.ap-guangzhou.myqcloud.com/prj/yapi-pre.jpg</span>)

等待安装部署

![<span class="hljs-string">yapi-success</span>](<span class="hljs-link">https://fn-md-1255398640.cos.ap-guangzhou.myqcloud.com/prj/yapi-success.png</span>)

成功后可以看到哦这个网站默认的账号和密码，还有如何启动

<span class="hljs-quote">&gt; 初始化管理员账号成功,账号名："eric-longming@163.com"，密码："ymfe.org"</span>
</code></pre><h2 id="item-66">进入我们的部署路径</h2><p>cd /my-yapi<br>node vendors/server/app.js</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
这样我们用ip:3000访问就能看到

![yapi-start](https://fn-md-1255398640.cos.ap-guangzhou.myqcloud.com/prj/yapi-start.png)

成功啦，接下来我们再做一下nginx的反向代理就好了

3 . 创建docker network 进行容器的通信
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs markdown"><code>
这样我们用ip:3000访问就能看到

![<span class="hljs-string">yapi-start</span>](<span class="hljs-link">https://fn-md-1255398640.cos.ap-guangzhou.myqcloud.com/prj/yapi-start.png</span>)

成功啦，接下来我们再做一下nginx的反向代理就好了

3 . 创建docker network 进行容器的通信
</code></pre><h2 id="item-67">创建一个网络，默认是bridge类型的，这个也是docker网络中最常用的</h2><p>docker network create my-net</p><h2 id="item-68">将我们需要的mongo容器和yapi容器加入此网络</h2><p>docker network connect my-net mongo<br>docker network connect my-net yapi</p><h2 id="item-69">查看网络的详情</h2><p>docker network inspect my-net</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
## Nginx

我们这里只做最简洁的安装使用教程，具体Nginx学习可以看这位大佬的文章 [**Nginx 从入门到实践，万字详解！**](https://juejin.im/post/6844904144235413512#heading-11) 好文啊，推荐

### 安装

这里我们先不用docker安装哈

- 先创建有root权限的用户 eric 。具体看 **[创建用户](#创建用户)**
- SSH配置 本地连接，方便本地连接操作嘛。具体看 [**SSH配置**](#SSH配置)
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs markdown"><code>
<span class="hljs-section">## Nginx</span>

我们这里只做最简洁的安装使用教程，具体Nginx学习可以看这位大佬的文章 [<span class="hljs-string">**Nginx 从入门到实践，万字详解！**</span>](<span class="hljs-link">https://juejin.im/post/6844904144235413512#heading-11</span>) 好文啊，推荐

<span class="hljs-section">### 安装</span>

这里我们先不用docker安装哈
<span class="hljs-bullet">
- </span>先创建有root权限的用户 eric 。具体看 <span class="hljs-strong">**[创建用户](#创建用户)**</span>
<span class="hljs-bullet">- </span>SSH配置 本地连接，方便本地连接操作嘛。具体看 [<span class="hljs-string">**SSH配置**</span>](<span class="hljs-link">#SSH配置</span>)
</code></pre><h2 id="item-70">查看yum的nginx</h2><p>yum list | grep nginx</p><h2 id="item-71">yum安装</h2><p>sudo yum install -y nginx</p><h2 id="item-72">设置开机启动</h2><p>sudo systemctl enable nginx</p><h2 id="item-73">启动nginx</h2><p>sudo systemctl start nginx</p><h2 id="item-74">查看nginx启动状态</h2><p>sudo systemctl status nginx</p><h2 id="item-75">停止你的nginx服务器</h2><p>sudo systemctl stop nginx</p><h2 id="item-76">修改了nginx的配置的话需要重载一下配置</h2><p>sudo systemctl reload nginx</p><h2 id="item-77">配置文件在这个目录下</h2><p>/etc/nginx/<br>/etc/nginx/nginx.conf<br>/etc/nginx/conf.d/</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
- 一般服务器需要修改一下防火墙，使外部能够访问，阿里的服务器则不用
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs markdown"><code><span class="hljs-bullet">
- </span>一般服务器需要修改一下防火墙，使外部能够访问，阿里的服务器则不用
</code></pre><p>sudo firewall-cmd --permanent --zone=public --add-service=http<br>sudo firewall-cmd --permanent --zone=public --add-service=https<br>sudo firewall-cmd --reload</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
### 基本配置
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs shell"><code><span class="hljs-meta">
#</span><span class="bash"><span class="hljs-comment">## 基本配置</span></span>
</code></pre><h3 id="item-77-10">vi /etc/nginx/nginx.conf</h3><h2 id="item-78">For more information on configuration, see:</h2><h2 id="item-79">* Official English Documentation: <a href="http://nginx.org/en/docs/" rel="nofollow noreferrer" target="_blank">http://nginx.org/en/docs/</a></h2><h2 id="item-80">* Official Russian Documentation: <a href="http://nginx.org/ru/docs/" rel="nofollow noreferrer" target="_blank">http://nginx.org/ru/docs/</a></h2><p>user nginx;                                            # 运行用户，默认即是nginx，可以不进行设置<br>worker_processes auto;                                 # Nginx 进程数，一般设置为和 CPU 核数一样<br>error_log /var/log/nginx/error.log;                    # Nginx 的错误日志存放目录<br>pid /run/nginx.pid;                                    # Nginx 服务启动时的 pid 存放位置</p><h2 id="item-81">Load dynamic modules. See /usr/share/doc/nginx/README.dynamic.</h2><p>include /usr/share/nginx/modules/*.conf;</p><h2 id="item-82">配置影响 Nginx 服务器或与用户的网络连接</h2><p>events {</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="worker_connections 1024;                           # 每个进程允许最大并发数" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs yaml"><code style="word-break: break-word; white-space: initial;"><span class="hljs-string">worker_connections</span> <span class="hljs-number">1024</span><span class="hljs-string">;</span>                           <span class="hljs-comment"># 每个进程允许最大并发数</span></code></pre><p>}</p><h2 id="item-83">配置使用最频繁的部分，代理、缓存、日志定义等绝大多数功能和第三方模块的配置都在这里设置</h2><p>http {</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="    # 设置日志模式
log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;
                  &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;
                  &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;

access_log  /var/log/nginx/access.log  main;      # Nginx访问日志存放位置

sendfile            on;                           # 开启高效传输模式
tcp_nopush          on;                           # 减少网络报文段的数量
tcp_nodelay         on;
keepalive_timeout   65;                           # 保持连接的时间，也叫超时时间，单位秒
types_hash_max_size 2048;

include             /etc/nginx/mime.types;        # 文件扩展名与类型映射表
default_type        application/octet-stream;     # 默认文件类型

# Load modular configuration files from the /etc/nginx/conf.d directory.
# See http://nginx.org/en/docs/ngx_core_module.html#include
# for more information.
include /etc/nginx/conf.d/*.conf;                 # 加载子配置项,我会把很多设置都放这里

# 配置虚拟主机的相关参数，一个 http 块中可以有多个 server 块，一个server模块可以有多个location
# 我们将多个server放在/etc/nginx/conf.d/*.conf
# 下面的server注释掉是因为我将吧server单独做成配置文件 include 进来" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs nginx"><code>    <span class="hljs-comment"># 设置日志模式</span>
<span class="hljs-attribute">log_format</span>  main  <span class="hljs-string">'<span class="hljs-variable">$remote_addr</span> - <span class="hljs-variable">$remote_user</span> [<span class="hljs-variable">$time_local</span>] "<span class="hljs-variable">$request</span>" '</span>
                  <span class="hljs-string">'<span class="hljs-variable">$status</span> <span class="hljs-variable">$body_bytes_sent</span> "<span class="hljs-variable">$http_referer</span>" '</span>
                  <span class="hljs-string">'"<span class="hljs-variable">$http_user_agent</span>" "<span class="hljs-variable">$http_x_forwarded_for</span>"'</span>;

<span class="hljs-attribute">access_log</span>  /var/log/nginx/access.log  main;      <span class="hljs-comment"># Nginx访问日志存放位置</span>

<span class="hljs-attribute">sendfile</span>            <span class="hljs-literal">on</span>;                           <span class="hljs-comment"># 开启高效传输模式</span>
<span class="hljs-attribute">tcp_nopush</span>          <span class="hljs-literal">on</span>;                           <span class="hljs-comment"># 减少网络报文段的数量</span>
<span class="hljs-attribute">tcp_nodelay</span>         <span class="hljs-literal">on</span>;
<span class="hljs-attribute">keepalive_timeout</span>   <span class="hljs-number">65</span>;                           <span class="hljs-comment"># 保持连接的时间，也叫超时时间，单位秒</span>
<span class="hljs-attribute">types_hash_max_size</span> <span class="hljs-number">2048</span>;

<span class="hljs-attribute">include</span>             /etc/nginx/mime.types;        <span class="hljs-comment"># 文件扩展名与类型映射表</span>
<span class="hljs-attribute">default_type</span>        application/octet-stream;     <span class="hljs-comment"># 默认文件类型</span>

<span class="hljs-comment"># Load modular configuration files from the /etc/nginx/conf.d directory.</span>
<span class="hljs-comment"># See http://nginx.org/en/docs/ngx_core_module.html#include</span>
<span class="hljs-comment"># for more information.</span>
<span class="hljs-attribute">include</span> /etc/nginx/conf.d/<span class="hljs-regexp">*.conf</span>;                 <span class="hljs-comment"># 加载子配置项,我会把很多设置都放这里</span>

<span class="hljs-comment"># 配置虚拟主机的相关参数，一个 http 块中可以有多个 server 块，一个server模块可以有多个location</span>
<span class="hljs-comment"># 我们将多个server放在/etc/nginx/conf.d/*.conf</span>
<span class="hljs-comment"># 下面的server注释掉是因为我将吧server单独做成配置文件 include 进来</span></code></pre><p>#   server {<br> #      listen       80;<br> #      server_name  www.wild-fox.cn; # 这个是购买的域名<br> #      root         /data/vueci/master/dist;<br> #<br> #      # Load configuration files for the default server block.<br> #      include /etc/nginx/default.d/*.conf;<br> #<br> #      location / {<br> #       }<br> #<br> #       error_page 404 /404.html;<br> #          location = /40x.html {<br> #      }<br> #<br> #      error_page 500 502 503 504 /50x.html;<br> #          location = /50x.html {<br> #      }<br> #  }</p><h3 id="item-83-11">}</h3><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
我们先就把所有环境都设置到 `/etc/nginx/conf.d/*.conf`

新建配置文件 :

- **gzip.conf：**这个是用来开启服务器 gzip 功能的配置
- **dev.wild-fox.cn.conf：** 这个是用来配置dev 开发环境的
- **release.wild-fox.cn.conf：** 这个是用来配置release 测试环境的
- **master.wild-fox.cn.conf：** 这个是用来配置master 线上生产环境的
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs markdown"><code>
我们先就把所有环境都设置到 <span class="hljs-code">`/etc/nginx/conf.d/*.conf`</span>

新建配置文件 :
<span class="hljs-bullet">
- </span><span class="hljs-strong">**gzip.conf：**</span>这个是用来开启服务器 gzip 功能的配置
<span class="hljs-bullet">- </span><span class="hljs-strong">**dev.wild-fox.cn.conf：**</span> 这个是用来配置dev 开发环境的
<span class="hljs-bullet">- </span><span class="hljs-strong">**release.wild-fox.cn.conf：**</span> 这个是用来配置release 测试环境的
<span class="hljs-bullet">- </span><span class="hljs-strong">**master.wild-fox.cn.conf：**</span> 这个是用来配置master 线上生产环境的
</code></pre><h2 id="item-84">gzip.conf</h2><p>gzip on;<br>gzip_types text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript;<br>gzip_static on;<br>gzip_proxied any;<br>gzip_vary on;<br>gzip_comp_level 6;<br>gzip_buffers 16 8k;</p><h2 id="item-85">gzip_min_length 1k;</h2><p>gzip_http_version 1.1;</p><h2 id="item-86">dev.wild-fox.cn.conf</h2><p>server {</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="    listen       80;
    server_name  dev.wild-fox.cn;
    root         /data/vueci/dev/dist;

    # Load configuration files for the default server block.
    include /etc/nginx/default.d/*.conf;

    location / {
    }

    error_page 404 /404.html;
        location = /40x.html {
    }

    error_page 500 502 503 504 /50x.html;
        location = /50x.html {
    }" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs nginx"><code>    <span class="hljs-attribute">listen</span>       <span class="hljs-number">80</span>;
    <span class="hljs-attribute">server_name</span>  dev.wild-fox.cn;
    <span class="hljs-attribute">root</span>         /data/vueci/dev/dist;

    <span class="hljs-comment"># Load configuration files for the default server block.</span>
    <span class="hljs-attribute">include</span> /etc/nginx/default.d/<span class="hljs-regexp">*.conf</span>;

    <span class="hljs-attribute">location</span> / {
    }

    <span class="hljs-attribute">error_page</span> <span class="hljs-number">404</span> /<span class="hljs-number">404</span>.html;
        <span class="hljs-attribute">location</span> = /40x.html {
    }

    <span class="hljs-attribute">error_page</span> <span class="hljs-number">500</span> <span class="hljs-number">502</span> <span class="hljs-number">503</span> <span class="hljs-number">504</span> /50x.html;
        <span class="hljs-attribute">location</span> = /50x.html {
    }</code></pre><p>}</p><h2 id="item-87">release.wild-fox.cn.conf</h2><p>server {</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="    listen       80;
    server_name  release.wild-fox.cn;
    root         /data/vueci/release/dist;

    # Load configuration files for the default server block.
    include /etc/nginx/default.d/*.conf;

    location / {
    }

    error_page 404 /404.html;
        location = /40x.html {
    }

    error_page 500 502 503 504 /50x.html;
        location = /50x.html {
    }" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs nginx"><code>    <span class="hljs-attribute">listen</span>       <span class="hljs-number">80</span>;
    <span class="hljs-attribute">server_name</span>  release.wild-fox.cn;
    <span class="hljs-attribute">root</span>         /data/vueci/release/dist;

    <span class="hljs-comment"># Load configuration files for the default server block.</span>
    <span class="hljs-attribute">include</span> /etc/nginx/default.d/<span class="hljs-regexp">*.conf</span>;

    <span class="hljs-attribute">location</span> / {
    }

    <span class="hljs-attribute">error_page</span> <span class="hljs-number">404</span> /<span class="hljs-number">404</span>.html;
        <span class="hljs-attribute">location</span> = /40x.html {
    }

    <span class="hljs-attribute">error_page</span> <span class="hljs-number">500</span> <span class="hljs-number">502</span> <span class="hljs-number">503</span> <span class="hljs-number">504</span> /50x.html;
        <span class="hljs-attribute">location</span> = /50x.html {
    }</code></pre><p>}</p><h2 id="item-88">master.wild-fox.cn.conf</h2><p>server {</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="    listen       80;
    server_name  www.wild-fox.cn;
    root         /data/vueci/master/dist;

    # Load configuration files for the default server block.
    include /etc/nginx/default.d/*.conf;

    location / {
    }

    error_page 404 /404.html;
        location = /40x.html {
    }

    error_page 500 502 503 504 /50x.html;
        location = /50x.html {
    }" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs nginx"><code>    <span class="hljs-attribute">listen</span>       <span class="hljs-number">80</span>;
    <span class="hljs-attribute">server_name</span>  www.wild-fox.cn;
    <span class="hljs-attribute">root</span>         /data/vueci/master/dist;

    <span class="hljs-comment"># Load configuration files for the default server block.</span>
    <span class="hljs-attribute">include</span> /etc/nginx/default.d/<span class="hljs-regexp">*.conf</span>;

    <span class="hljs-attribute">location</span> / {
    }

    <span class="hljs-attribute">error_page</span> <span class="hljs-number">404</span> /<span class="hljs-number">404</span>.html;
        <span class="hljs-attribute">location</span> = /40x.html {
    }

    <span class="hljs-attribute">error_page</span> <span class="hljs-number">500</span> <span class="hljs-number">502</span> <span class="hljs-number">503</span> <span class="hljs-number">504</span> /50x.html;
        <span class="hljs-attribute">location</span> = /50x.html {
    }</code></pre><p>}</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
配置好后我们要重新reload一次
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs"><code>
配置好后我们要重新reload一次
</code></pre><p>sudo systemctl reload nginx</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
设置好了，我们还得去做一下域名解析才能范围

![DNS](https://fn-md-1255398640.cos.ap-guangzhou.myqcloud.com/prj/DNS.png)

解析好了我们把构建后的代码放到相应的目录就能范围了

## Docker Compose 接管

### 简介

​    前面我们一共用了jenkins、verdaccio、mongo、yapi等容器，可能后面会再加几个，例如gitlab、nexus啊等等，一两个还好，如果我们要换服务器，还需要一个一个安装的话那就有点麻烦了，所以我们要借助 **docker-compose**，几个命令就能在新的服务器上快速部署之前所有应用容器

&gt; `Compose` 定位是 「定义和运行多个 Docker 容器的应用（Defining and running multi-container Docker applications）」

**我们先把之前的jenkins、verdaccio、mongo、yapi的容器全选删了，之前容器挂载的数据卷就保留着 jenkins的吧**

我们先进入我们的环境服务器，拉去docker-compose的代码，启动服务
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs markdown"><code>
设置好了，我们还得去做一下域名解析才能范围

![<span class="hljs-string">DNS</span>](<span class="hljs-link">https://fn-md-1255398640.cos.ap-guangzhou.myqcloud.com/prj/DNS.png</span>)

解析好了我们把构建后的代码放到相应的目录就能范围了

<span class="hljs-section">## Docker Compose 接管</span>

<span class="hljs-section">### 简介</span>

​    前面我们一共用了jenkins、verdaccio、mongo、yapi等容器，可能后面会再加几个，例如gitlab、nexus啊等等，一两个还好，如果我们要换服务器，还需要一个一个安装的话那就有点麻烦了，所以我们要借助 <span class="hljs-strong">**docker-compose**</span>，几个命令就能在新的服务器上快速部署之前所有应用容器

<span class="hljs-quote">&gt; `Compose` 定位是 「定义和运行多个 Docker 容器的应用（Defining and running multi-container Docker applications）」</span>

<span class="hljs-strong">**我们先把之前的jenkins、verdaccio、mongo、yapi的容器全选删了，之前容器挂载的数据卷就保留着 jenkins的吧**</span>

我们先进入我们的环境服务器，拉去docker-compose的代码，启动服务
</code></pre><p>ssh env<br>pwd</p><h2 id="item-89">把env-docker-compose的项目拉去下来</h2><p>git clone git@gitee.com:eric-gm/env-docker-compose.git</p><h2 id="item-90">目录结构是这样</h2><p>├── docker-compose.yml<br>├── mongo<br>│&nbsp;&nbsp; └── initdb.js<br>├── verdaccio<br>│&nbsp;&nbsp; ├── config.yaml<br>│&nbsp;&nbsp; └── Dockerfile<br>└── yapi</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="├── config.json
├── Dockerfile
├── entrypoint.sh
└── wait-for-it.sh
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs css"><code>├── <span class="hljs-selector-tag">config</span><span class="hljs-selector-class">.json</span>
├── <span class="hljs-selector-tag">Dockerfile</span>
├── <span class="hljs-selector-tag">entrypoint</span><span class="hljs-selector-class">.sh</span>
└── <span class="hljs-selector-tag">wait-for-it</span><span class="hljs-selector-class">.sh</span>
</code></pre><h2 id="item-91">进入项目，docker-compose启动服务</h2><p>cd env-docker-compose<br>docker-compose up -d</p><h2 id="item-92">这样就启动和部署了之前的jenkins、verdaccio、mongo 和yapi来</h2><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
### 安装

1. 安装额外依赖包
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs yaml"><code>
<span class="hljs-comment">### 安装</span>

<span class="hljs-number">1</span><span class="hljs-string">.</span> <span class="hljs-string">安装额外依赖包</span>
</code></pre><p>sudo yum install -y epel-release</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
2. 安装 python-pip
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs yaml"><code>
<span class="hljs-number">2</span><span class="hljs-string">.</span> <span class="hljs-string">安装</span> <span class="hljs-string">python-pip</span>
</code></pre><h2 id="item-93">centos7的话，yum的源有这个</h2><p>sudo yum install -y python-pip</p><h2 id="item-94">centos8，yum的源没有pip，我们自己安装</h2><p>sudo dnf install python3<br>sudo pip3 install --upgrade pip</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
3. 安装 Docker Compose
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs yaml"><code>
<span class="hljs-number">3</span><span class="hljs-string">.</span> <span class="hljs-string">安装</span> <span class="hljs-string">Docker</span> <span class="hljs-string">Compose</span>
</code></pre><p>sudo pip install docker-compose</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
4. 升级 python 包
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs yaml"><code>
<span class="hljs-number">4</span><span class="hljs-string">.</span> <span class="hljs-string">升级</span> <span class="hljs-string">python</span> <span class="hljs-string">包</span>
</code></pre><p>sudo yum upgrade python*</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
5. 验证安装
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs yaml"><code>
<span class="hljs-number">5</span><span class="hljs-string">.</span> <span class="hljs-string">验证安装</span>
</code></pre><p>docker-compose -v</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
6. 如果需要卸载的话
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs yaml"><code>
<span class="hljs-number">6</span><span class="hljs-string">.</span> <span class="hljs-string">如果需要卸载的话</span>
</code></pre><p>sudo pip uninstall docker-compose</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
### 定义和运行容器

那具体是怎样定义容器创建部署来着，我们先介绍一下

先介绍一下docker-compose.yml

&gt; 它允许用户通过一个单独的 `docker-compose.yml` 模板文件（YAML 格式）来定义一组相关联的应用容器为一个项目（project）。

`Compose` 中有两个重要的概念：

- 服务 (`service`)：一个应用的容器，实际上可以包括若干运行相同镜像的容器实例。
- 项目 (`project`)：由一组关联的应用容器组成的一个完整业务单元，在 `docker-compose.yml` 文件中定义。

具体来看一下我们的docker-compose.yaml文件
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs markdown"><code>
<span class="hljs-section">### 定义和运行容器</span>

那具体是怎样定义容器创建部署来着，我们先介绍一下

先介绍一下docker-compose.yml

<span class="hljs-quote">&gt; 它允许用户通过一个单独的 `docker-compose.yml` 模板文件（YAML 格式）来定义一组相关联的应用容器为一个项目（project）。</span>

<span class="hljs-code">`Compose`</span> 中有两个重要的概念：
<span class="hljs-bullet">
- </span>服务 (<span class="hljs-code">`service`</span>)：一个应用的容器，实际上可以包括若干运行相同镜像的容器实例。
<span class="hljs-bullet">- </span>项目 (<span class="hljs-code">`project`</span>)：由一组关联的应用容器组成的一个完整业务单元，在 <span class="hljs-code">`docker-compose.yml`</span> 文件中定义。

具体来看一下我们的docker-compose.yaml文件
</code></pre><p>version: "3.8"<br>services:<br>  jenkins:</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="image: jenkinsci/blueocean
container_name: jenkins
ports:
  - 8080:8080
  - 50000:50000
volumes:
  - jenkins:/var/jenkins_home
  - /private/etc/localtime:/etc/localtime:ro
  #- /private/etc/localtime:/etc/localtime:ro
networks:
  - front-net" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs less"><code><span class="hljs-attribute">image</span>: jenkinsci/blueocean
<span class="hljs-attribute">container_name</span>: jenkins
<span class="hljs-attribute">ports</span>:
  - <span class="hljs-number">8080</span>:<span class="hljs-number">8080</span>
  - <span class="hljs-number">50000</span>:<span class="hljs-number">50000</span>
<span class="hljs-attribute">volumes</span>:
  - <span class="hljs-attribute">jenkins</span>:/var/jenkins_home
  - /private/etc/<span class="hljs-attribute">localtime</span>:/etc/<span class="hljs-attribute">localtime</span>:ro
  #- /private/etc/<span class="hljs-attribute">localtime</span>:/etc/<span class="hljs-attribute">localtime</span>:ro
<span class="hljs-attribute">networks</span>:
  - front-net</code></pre><p>verdaccio:</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="build: ./verdaccio/
image: verdaccio/wild:latest
container_name: verdaccio
ports:
  - 4873:4873
volumes:
  - verdaccio:/verdaccio
  # - /private/etc/localtime:/etc/localtime:ro
networks:
  - front-net" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs less"><code><span class="hljs-attribute">build</span>: ./verdaccio/
<span class="hljs-attribute">image</span>: verdaccio/<span class="hljs-attribute">wild</span>:latest
<span class="hljs-attribute">container_name</span>: verdaccio
<span class="hljs-attribute">ports</span>:
  - <span class="hljs-number">4873</span>:<span class="hljs-number">4873</span>
<span class="hljs-attribute">volumes</span>:
  - <span class="hljs-attribute">verdaccio</span>:/verdaccio
  # - /private/etc/<span class="hljs-attribute">localtime</span>:/etc/<span class="hljs-attribute">localtime</span>:ro
<span class="hljs-attribute">networks</span>:
  - front-net</code></pre><p>yapi:</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="build: ./yapi/
image: yapi/wild:latest
container_name: yapi
restart: always
ports:
  - 9090:9090
  - 3000:3000
depends_on:
  - mongo
volumes:
  - yapi:/my-yapi
  # - /private/etc/localtime:/etc/localtime:ro
entrypoint: &quot;bash /wait-for-it.sh mongo:27017 -- entrypoint.sh&quot;
networks:
  - back-net" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs less"><code><span class="hljs-attribute">build</span>: ./yapi/
<span class="hljs-attribute">image</span>: yapi/<span class="hljs-attribute">wild</span>:latest
<span class="hljs-attribute">container_name</span>: yapi
<span class="hljs-attribute">restart</span>: always
<span class="hljs-attribute">ports</span>:
  - <span class="hljs-number">9090</span>:<span class="hljs-number">9090</span>
  - <span class="hljs-number">3000</span>:<span class="hljs-number">3000</span>
<span class="hljs-attribute">depends_on</span>:
  - mongo
<span class="hljs-attribute">volumes</span>:
  - <span class="hljs-attribute">yapi</span>:/my-yapi
  # - /private/etc/<span class="hljs-attribute">localtime</span>:/etc/<span class="hljs-attribute">localtime</span>:ro
<span class="hljs-attribute">entrypoint</span>: <span class="hljs-string">"bash /wait-for-it.sh mongo:27017 -- entrypoint.sh"</span>
<span class="hljs-attribute">networks</span>:
  - back-net</code></pre><p>mongo:</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="image: mongo:latest
container_name: mongo
restart: always
environment:
  # 在这里输入 MongoDB 的 root 用户与密码，如果使用了此项，则不需要 --auth 参数
  - MONGO_INITDB_ROOT_USERNAME=root
  - MONGO_INITDB_ROOT_PASSWORD=root123456
ports:
  - 27017:27017
volumes:
  - mongodb:/data/db
  - ./mongo/:/docker-entrypoint-initdb.d/:ro
  # - /private/etc/localtime:/etc/localtime:ro
command: mongod
networks:
  - back-net" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs yaml"><code><span class="hljs-attr">image:</span> <span class="hljs-string">mongo:latest</span>
<span class="hljs-attr">container_name:</span> <span class="hljs-string">mongo</span>
<span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>
<span class="hljs-attr">environment:</span>
  <span class="hljs-comment"># 在这里输入 MongoDB 的 root 用户与密码，如果使用了此项，则不需要 --auth 参数</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">MONGO_INITDB_ROOT_USERNAME=root</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">MONGO_INITDB_ROOT_PASSWORD=root123456</span>
<span class="hljs-attr">ports:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-number">27017</span><span class="hljs-string">:27017</span>
<span class="hljs-attr">volumes:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">mongodb:/data/db</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">./mongo/:/docker-entrypoint-initdb.d/:ro</span>
  <span class="hljs-comment"># - /private/etc/localtime:/etc/localtime:ro</span>
<span class="hljs-attr">command:</span> <span class="hljs-string">mongod</span>
<span class="hljs-attr">networks:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">back-net</span></code></pre><p>volumes:<br>  jenkins:</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="name: jenkins" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs less"><code style="word-break: break-word; white-space: initial;"><span class="hljs-attribute">name</span>: jenkins</code></pre><p>verdaccio:</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="name: verdaccio" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs less"><code style="word-break: break-word; white-space: initial;"><span class="hljs-attribute">name</span>: verdaccio</code></pre><p>mongodb:</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="name: mongodb" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs less"><code style="word-break: break-word; white-space: initial;"><span class="hljs-attribute">name</span>: mongodb</code></pre><p>yapi:</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="name: yapi
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs less"><code><span class="hljs-attribute">name</span>: yapi
</code></pre><p>networks:<br>  back-net:<br>  front-net:</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
- **version：** 这个是对应 **Docker Engine** 的 ，我们的docker是 `Docker version 19.03.12`，所以对应的3.8
- **services:** 这个就是对应我们的服务，这里定义了这几个服务jenkins、verdaccio、mongo、yapi等，这个是我们重点要看的

### services 配置解析

因为篇幅不想太长，这里之说配置文件上涉及到的配置哈，更具体的可以查看这一篇文章 [docker-compose 编排指南 (v3.8)](https://juejin.im/post/6854573209799360519#heading-14)

#### 1 build

该选项被用于构建，yapi 和 verdaccio 两个服务我们只做根据dockerfile 制作的镜像，就需要用这个，jenkins 和 mongo服务是采用网上的镜像就不需要

build，**指定上下文的目录目录下的 dockerfile文件来构建** 当然你也可以自己指定上下文，和 dockerfile的别名等等等

这里的yapi 和verdaccio镜像的构建跟之前的不一样哈，

- yapi镜像：是通过代码构建自动部署的（之前是可视化部署）具体可以看 **./yapi/Dockerfile**
- verdaccio是直接把配置文件拷贝到容器内部去初始创建的

#### 2 image

build的镜像指定的名字，或者仓库的镜像名字（本地没有会自动去线上拉取的）

#### 3 container_name

这个就是容器的名字啦

#### 4 ports

暴露端口到宿主机，格式 HOST:CONTAINER

#### 5 environment

添加环境变量。可以使用一个数组或者一个字典。任何布尔量：true, false, yes, no 等等都必须用引号包围为字符串字面量，也会覆盖dockerfile中的ENV

特别注意：

在mongo服务里面这样设置，就会创建一个root管理员用户，会自动开启了验证
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs markdown"><code><span class="hljs-bullet">
- </span><span class="hljs-strong">**version：**</span> 这个是对应 <span class="hljs-strong">**Docker Engine**</span> 的 ，我们的docker是 <span class="hljs-code">`Docker version 19.03.12`</span>，所以对应的3.8
<span class="hljs-bullet">- </span><span class="hljs-strong">**services:**</span> 这个就是对应我们的服务，这里定义了这几个服务jenkins、verdaccio、mongo、yapi等，这个是我们重点要看的

<span class="hljs-section">### services 配置解析</span>

因为篇幅不想太长，这里之说配置文件上涉及到的配置哈，更具体的可以查看这一篇文章 [<span class="hljs-string">docker-compose 编排指南 (v3.8)</span>](<span class="hljs-link">https://juejin.im/post/6854573209799360519#heading-14</span>)

<span class="hljs-section">#### 1 build</span>

该选项被用于构建，yapi 和 verdaccio 两个服务我们只做根据dockerfile 制作的镜像，就需要用这个，jenkins 和 mongo服务是采用网上的镜像就不需要

build，<span class="hljs-strong">**指定上下文的目录目录下的 dockerfile文件来构建**</span> 当然你也可以自己指定上下文，和 dockerfile的别名等等等

这里的yapi 和verdaccio镜像的构建跟之前的不一样哈，
<span class="hljs-bullet">
- </span>yapi镜像：是通过代码构建自动部署的（之前是可视化部署）具体可以看 <span class="hljs-strong">**./yapi/Dockerfile**</span>
<span class="hljs-bullet">- </span>verdaccio是直接把配置文件拷贝到容器内部去初始创建的

<span class="hljs-section">#### 2 image</span>

build的镜像指定的名字，或者仓库的镜像名字（本地没有会自动去线上拉取的）

<span class="hljs-section">#### 3 container_name</span>

这个就是容器的名字啦

<span class="hljs-section">#### 4 ports</span>

暴露端口到宿主机，格式 HOST:CONTAINER

<span class="hljs-section">#### 5 environment</span>

添加环境变量。可以使用一个数组或者一个字典。任何布尔量：true, false, yes, no 等等都必须用引号包围为字符串字面量，也会覆盖dockerfile中的ENV

特别注意：

在mongo服务里面这样设置，就会创建一个root管理员用户，会自动开启了验证
</code></pre><p>environment:</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="  # 在这里输入 MongoDB 的 root 用户与密码，如果使用了此项，则不需要 --auth 参数
  - MONGO_INITDB_ROOT_USERNAME=root
  - MONGO_INITDB_ROOT_PASSWORD=root123456" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs markdown"><code>  # 在这里输入 MongoDB 的 root 用户与密码，如果使用了此项，则不需要 --auth 参数
<span class="hljs-bullet">  - </span>MONGO<span class="hljs-emphasis">_INITDB_</span>ROOT_USERNAME=root
<span class="hljs-bullet">  - </span>MONGO<span class="hljs-emphasis">_INITDB_</span>ROOT_PASSWORD=root123456</code></pre><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
#### 5 volumes

挂载宿主机路径或者命名卷,在顶级 `volumes` 中定义一个命名卷，并在一个服务的 `volumes` 列表中引用它。

特别注意一下：在mongo服务的volumes这里
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs ruby"><code>
<span class="hljs-comment">#### 5 volumes</span>

挂载宿主机路径或者命名卷,在顶级 <span class="hljs-string">`volumes`</span> 中定义一个命名卷，并在一个服务的 <span class="hljs-string">`volumes`</span> 列表中引用它。

特别注意一下：在mongo服务的volumes这里
</code></pre><p>./mongo/:/docker-entrypoint-initdb.d/:ro</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
我们是吧  ./mongo的 initdb.js 挂载到 mongo容器的/docker-entrypoint-initdb.d 目录（是官方的容器提供的哈），容器初始化的时候调用里面的文件去初始化数据库，根据文件名的排序前后调用运行，支持 .sh 和 js,相比之前的进入容器去在创建用户数据库什么的方便多了吧

#### 6 command

覆盖容器内默认的 `command`

#### 7 entrypoint

覆盖 dockerfile 中定义的默认的 entrypoint 值

在yapi服务中的配置
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs shell"><code>
我们是吧  ./mongo的 initdb.js 挂载到 mongo容器的/docker-entrypoint-initdb.d 目录（是官方的容器提供的哈），容器初始化的时候调用里面的文件去初始化数据库，根据文件名的排序前后调用运行，支持 .sh 和 js,相比之前的进入容器去在创建用户数据库什么的方便多了吧
<span class="hljs-meta">
#</span><span class="bash"><span class="hljs-comment">### 6 command</span></span>

覆盖容器内默认的 `command`
<span class="hljs-meta">
#</span><span class="bash"><span class="hljs-comment">### 7 entrypoint</span></span>

覆盖 dockerfile 中定义的默认的 entrypoint 值

在yapi服务中的配置
</code></pre><p>entrypoint: "bash /wait-for-it.sh mongo:27017 -- entrypoint.sh"</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
wait-for-it.sh 是github上开源的，因为我们这个yapi需要连接mongodb，所以我们要检测到 端口 mongo：27017 启动能连接了，在执行

entrypoit.sh 去部署或启动yapi（初次是部署，接下来是启动）

#### 8 depends_on

表示服务之间的依赖关系。服务依赖引发如下的行为：

 比如我们的yapi 依赖 mongo服务，当我们用docker-compose 启动yapi的时候会先启动mongo服务，在启动yapi，关闭的时候先关闭yapi，在关闭mongo，注意启动只是容器的启动，并不是容器内应用和数据的启动，所以我们需要用到 **wait-for-it.sh** 来辅助

#### 9 network

要加入的网络。目标网络是在 `docker-compose.yml` 顶级的 `networks` 项中定义的。

#### 10 restart

`no` 是默认的重启策略。此时无论容器怎么退出、怎么失败也不会被自动重启。

指定 `always` 时任何情况下容器都会被重启。

### volumes

这个是用来定义数据卷给 服务services用的，如果同名的volume存在，就只是使用它，不存在就创建，

但如果只是这样定义：
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs perl"><code>
<span class="hljs-keyword">wait</span>-<span class="hljs-keyword">for</span>-it.sh 是github上开源的，因为我们这个yapi需要连接mongodb，所以我们要检测到 端口 mongo：<span class="hljs-number">27017</span> 启动能连接了，在执行

entrypoit.sh 去部署或启动yapi（初次是部署，接下来是启动）

<span class="hljs-comment">#### 8 depends_on</span>

表示服务之间的依赖关系。服务依赖引发如下的行为：

 比如我们的yapi 依赖 mongo服务，当我们用docker-compose 启动yapi的时候会先启动mongo服务，在启动yapi，关闭的时候先关闭yapi，在关闭mongo，注意启动只是容器的启动，并不是容器内应用和数据的启动，所以我们需要用到 **<span class="hljs-keyword">wait</span>-<span class="hljs-keyword">for</span>-it.sh** 来辅助

<span class="hljs-comment">#### 9 network</span>

要加入的网络。目标网络是在 <span class="hljs-string">`docker-compose.yml`</span> 顶级的 <span class="hljs-string">`networks`</span> 项中定义的。

<span class="hljs-comment">#### 10 restart</span>

<span class="hljs-string">`no`</span> 是默认的重启策略。此时无论容器怎么退出、怎么失败也不会被自动重启。

指定 <span class="hljs-string">`always`</span> 时任何情况下容器都会被重启。

<span class="hljs-comment">### volumes</span>

这个是用来定义数据卷给 服务services用的，如果同名的volume存在，就只是使用它，不存在就创建，

但如果只是这样定义：
</code></pre><p>volumes:</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="jenkins:" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs less"><code style="word-break: break-word; white-space: initial;"><span class="hljs-attribute">jenkins</span>:</code></pre><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
你会发现生成的volumes名字是 env-docker-compose_jenkins，就想我们docker-compose.yaml的所在的目录名+ &quot;_&quot;+jenkins，

这里我们用 name 来命名它为：jenkins，和我们最开始创建jenkins容器使用的volume同名，会自动去引用这个卷，这样就不用重新去安装插件配置什么的啦，当然你想折腾的话随你
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs swift"><code>
你会发现生成的volumes名字是 env-docker-compose_jenkins，就想我们docker-compose.yaml的所在的目录名+ <span class="hljs-string">"_"</span>+jenkins，

这里我们用 name 来命名它为：jenkins，和我们最开始创建jenkins容器使用的volume同名，会自动去引用这个卷，这样就不用重新去安装插件配置什么的啦，当然你想折腾的话随你
</code></pre><p>volumes:<br>  jenkins:</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="name: jenkins" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs less"><code style="word-break: break-word; white-space: initial;"><span class="hljs-attribute">name</span>: jenkins</code></pre><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
### network

顶级章节 `networks` 使得你可以配置想要创建和使用的网络（Compose内网）

我们默认创建的网络是bridge类型的，这个也是docker 容器最常用的网络类型

它生产的名字跟volume一样，不过我们这里不需要去自定义它的名字，当然你想也行啊老板
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs ruby"><code>
<span class="hljs-comment">### network</span>

顶级章节 <span class="hljs-string">`networks`</span> 使得你可以配置想要创建和使用的网络（Compose内网）

我们默认创建的网络是bridge类型的，这个也是docker 容器最常用的网络类型

它生产的名字跟volume一样，不过我们这里不需要去自定义它的名字，当然你想也行啊老板
</code></pre><p>networks:<br>  back-net:<br>  front-net:</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
例如我们在yapi 和 mongo 两个服务都加入了通个网络 front-net，那我们yapi容器直接可以通过 ping mongo（服务名）连接到 mongo的容器，mongo容器内 ping yapi 也行

你可以注意到 在yapi服务中，我们就直接用了 **mongo:27017**去连接检测 mongo服务端口的启动，而不是 ip:27017
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs less"><code>
例如我们在<span class="hljs-selector-tag">yapi</span> 和 <span class="hljs-selector-tag">mongo</span> 两个服务都加入了通个网络 <span class="hljs-selector-tag">front-net</span>，那我们<span class="hljs-selector-tag">yapi</span>容器直接可以通过 <span class="hljs-selector-tag">ping</span> <span class="hljs-selector-tag">mongo</span>（服务名）连接到 <span class="hljs-selector-tag">mongo</span>的容器，<span class="hljs-selector-tag">mongo</span>容器内 <span class="hljs-selector-tag">ping</span> <span class="hljs-selector-tag">yapi</span> 也行

你可以注意到 在<span class="hljs-selector-tag">yapi</span>服务中，我们就直接用了 **<span class="hljs-selector-tag">mongo</span><span class="hljs-selector-pseudo">:27017</span>**去连接检测 <span class="hljs-selector-tag">mongo</span>服务端口的启动，而不是 <span class="hljs-selector-tag">ip</span><span class="hljs-selector-pseudo">:27017</span>
</code></pre><p>entrypoint: "bash /wait-for-it.sh mongo:27017 -- entrypoint.sh"</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
为什么不用ip呢，因为容器分配到的ip不是固定的，会变的。

### compose 基本命令

这里只做用到的一点基础命令，其他的可以看官网的说明

#### 1 up

格式：`docker-compose up -d` ，加`-d`是后台运行

会根据当前目录下的docker-compose.yaml,构建镜像，创建服务

#### 2 down

格式：docker-compose down 

此命令将会停止 `up` 命令所启动的容器，并移除网络

#### 3 start

格式为 `docker-compose start [SERVICE...]`

启动已经存在的服务容器。

#### 4 stop

格式为 `docker-compose stop [options] [SERVICE...]`

停止已经处于运行状态的容器，但不删除它。通过 `docker-compose start` 可以再次启动这些容器。

选项：

- `-t, --timeout TIMEOUT` 停止容器时候的超时（默认为 10 秒）。

#### 5 restart

格式为 `docker-compose restart [options] [SERVICE...]`。

重启项目中的服务。

选项：

- `-t, --timeout TIMEOUT` 指定重启前停止容器的超时（默认为 10 秒）。

#### 6 logs

格式为 `docker-compose logs [options] [SERVICE...]`。

查看服务容器的输出。默认情况下，docker-compose 将对不同的服务输出使用不同的颜色来区分。可以通过 `--no-color` 来关闭颜色。

该命令在调试问题的时候十分有用。

## volume 备份 和 迁移

那么问题来了，我们要去其他的服务器部署这一套服务，有了docker-compose 可以快速部署应用，那之前的数据呢？怎么搞过来？？？

别慌，几步就能搞定

1. 我们的数据都存在docker 管理的volume对吧，我们备份和回复需要这几步
2. 把所有的volume打包好搞到新服务器
3. 在新的服务器，创建同名的volumes，把打包的数据解压后放对应的volume的目录就好了

查看docker 存储的volume都在哪
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs markdown"><code>
为什么不用ip呢，因为容器分配到的ip不是固定的，会变的。

<span class="hljs-section">### compose 基本命令</span>

这里只做用到的一点基础命令，其他的可以看官网的说明

<span class="hljs-section">#### 1 up</span>

格式：<span class="hljs-code">`docker-compose up -d`</span> ，加<span class="hljs-code">`-d`</span>是后台运行

会根据当前目录下的docker-compose.yaml,构建镜像，创建服务

<span class="hljs-section">#### 2 down</span>

格式：docker-compose down 

此命令将会停止 <span class="hljs-code">`up`</span> 命令所启动的容器，并移除网络

<span class="hljs-section">#### 3 start</span>

格式为 <span class="hljs-code">`docker-compose start [SERVICE...]`</span>

启动已经存在的服务容器。

<span class="hljs-section">#### 4 stop</span>

格式为 <span class="hljs-code">`docker-compose stop [options] [SERVICE...]`</span>

停止已经处于运行状态的容器，但不删除它。通过 <span class="hljs-code">`docker-compose start`</span> 可以再次启动这些容器。

选项：
<span class="hljs-bullet">
- </span><span class="hljs-code">`-t, --timeout TIMEOUT`</span> 停止容器时候的超时（默认为 10 秒）。

<span class="hljs-section">#### 5 restart</span>

格式为 <span class="hljs-code">`docker-compose restart [options] [SERVICE...]`</span>。

重启项目中的服务。

选项：
<span class="hljs-bullet">
- </span><span class="hljs-code">`-t, --timeout TIMEOUT`</span> 指定重启前停止容器的超时（默认为 10 秒）。

<span class="hljs-section">#### 6 logs</span>

格式为 <span class="hljs-code">`docker-compose logs [options] [SERVICE...]`</span>。

查看服务容器的输出。默认情况下，docker-compose 将对不同的服务输出使用不同的颜色来区分。可以通过 <span class="hljs-code">`--no-color`</span> 来关闭颜色。

该命令在调试问题的时候十分有用。

<span class="hljs-section">## volume 备份 和 迁移</span>

那么问题来了，我们要去其他的服务器部署这一套服务，有了docker-compose 可以快速部署应用，那之前的数据呢？怎么搞过来？？？

别慌，几步就能搞定
<span class="hljs-bullet">
1. </span>我们的数据都存在docker 管理的volume对吧，我们备份和回复需要这几步
<span class="hljs-bullet">2. </span>把所有的volume打包好搞到新服务器
<span class="hljs-bullet">3. </span>在新的服务器，创建同名的volumes，把打包的数据解压后放对应的volume的目录就好了

查看docker 存储的volume都在哪
</code></pre><h2 id="item-95">查看现存有的volume 执行 docker volume inspect yapi</h2><p>docker volume inspect yapi</p><hr><p>...<br>Mountpoint": "/var/lib/docker/volumes/yapi/_data",</p><h3 id="item-95-12">...</h3><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
我们发现docker 管理的 volumes都在   `/var/lib/volumes` 目录下，还想什么呢，打包他啊
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs swift"><code>
我们发现docker 管理的 volumes都在   `/<span class="hljs-keyword">var</span>/lib/volumes` 目录下，还想什么呢，打包他啊
</code></pre><p>docker run --rm -it \<br>-v ~/volume-backup:/backup \<br>-v /var/lib/docker:/docker \<br>busybox \<br>tar cfz /backup/volume.tgz  -C /docker/volumes/ .</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
上面这个命令中，我们运行了一个轻量级的container——busybox，并挂载了两个目录：

- (host) ~/volume-backup =&gt; (container) /backup
- (host) /var/lib/docker/ =&gt; (container) /docker

这样就是把 `/var/lib/volumes`目录打包成 **volume.tgz** 

新服务器下载打包后的  **volume.tgz** 
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs sql"><code>
上面这个命令中，我们运行了一个轻量级的container——busybox，并挂载了两个目录：

- (host) ~/volume-<span class="hljs-keyword">backup</span> =&gt; (<span class="hljs-keyword">container</span>) /<span class="hljs-keyword">backup</span>
- (host) /<span class="hljs-keyword">var</span>/lib/docker/ =&gt; (<span class="hljs-keyword">container</span>) /docker

这样就是把 <span class="hljs-string">`/var/lib/volumes`</span>目录打包成 **volume.tgz** 

新服务器下载打包后的  **volume.tgz** 
</code></pre><p>cd ~<br>mkdir docker<br>cd docker <br>mkdir volumes<br>scp env:~/volume-backup/volume.tgz ~/docker/volumes</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
下载好解压缩
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs"><code>
下载好解压缩
</code></pre><p>cd ~/docker/volumes<br>tar zxvf volume.tgz</p><h2 id="item-96">解压后可能会有多余的东西，我们只需要 下面这几个文件夹的文件，移动我们归档到其他文件夹吧</h2><h2 id="item-97">jenkins  mongodb   verdaccio   yapi</h2><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
先运行`docker-compose up -d` ，这样在新的服务器会构建镜像和创建之前的volumes初始化数据卷

再运行 `docker-compose down` 或者 `docker-compose stop` 

，在导入数据到相应的volumes中
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs ruby"><code>
先运行<span class="hljs-string">`docker-compose up -d`</span> ，这样在新的服务器会构建镜像和创建之前的volumes初始化数据卷

再运行 <span class="hljs-string">`docker-compose down`</span> 或者 <span class="hljs-string">`docker-compose stop`</span> 

，在导入数据到相应的volumes中
</code></pre><p>docker run --rm -it \<br>-v /var/lib/docker:/docker \<br>-v ~/volume-backup:/volume-backup \<br>busybox \<br>cp -r /volume-backup/ /docker/volumes</p><div class="widget-codetool" style="display:none;">
        <div class="widget-codetool--inner">
        <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
        <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
这样就把数据还原啦，最后再启动`docker-compose up` 或者 `docker-compose restart`

## 附录
" title="" data-original-title="复制"></span>
        </div>
        </div><pre class="hljs ruby"><code>
这样就把数据还原啦，最后再启动<span class="hljs-string">`docker-compose up`</span> 或者 <span class="hljs-string">`docker-compose restart`</span>

<span class="hljs-comment">## 附录</span>
</code></pre>                            </article>

                            
                            <script type="text/javascript">
                              OA_show(3);
                            </script><div id="OA_holder_3"><div class="d-none d-lg-flex justify-content-center">
<script async="" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/f(6).txt"></script>
<!-- 中部横幅广告位 -->
<ins class="adsbygoogle" style="display:inline-block;width:728px;height:90px" data-ad-client="ca-pub-6330872677300335" data-ad-slot="5598290435" data-adsbygoogle-status="done"><ins id="aswift_0_expand" style="display:inline-table;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:728px;background-color:transparent;"><ins id="aswift_0_anchor" style="display:block;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:728px;background-color:transparent;"></ins></ins></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script><div id="beacon_fe4bb7661c" style="position: absolute; left: 0px; top: 0px; visibility: hidden;"><img src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/lg(3).php" width="0" height="0" alt="" style="width: 0px; height: 0px;"></div></div>
</div>

                            <div class="text-secondary font-size-14 mt-3 mb-5 d-flex justify-content-between row">
                                                                    <div class="col-6 text-secondary" id="sf-article_metas" data-viewsword="1896">阅读
                                        1.9k
                                        <span class="split-dot"></span>
                                        <time datetime="2020-09-14T16:42:43+08:00" itemprop="datePublished">发布于
                                            9月14日</time>
                                    </div>
                                                                <div class="operation col-6 text-right">
                                                                                                                                                                                                                        
                                                                                                                                                        <a class="text-secondary sf_do" href="javascript:;" data-dotype="modal" data-content="{&quot;type&quot;:&quot;form&quot;,&quot;asyncUrl&quot;:&quot;\/iteration\/api\/reason\/article\/report?id=1190000024453209&quot;,&quot;data&quot;:null}" data-api="/iteration/api/article/1190000024453209/report">
                                            <span>举报</span>
                                        </a>
                                                                    </div>
                            </div>

                            <div class="functional-area-bottom"><div class="text-center"><div class="btn-group like-group mr-2" role="group">
            <button data-type="question" class="func-btn mainLike like-btn btn btn-outline-primary 
                            " data-id="1190000024453209">
                            <svg class="svg-inline--fa fa-thumbs-up fa-w-16" aria-hidden="true" focusable="false" data-prefix="far" data-icon="thumbs-up" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M466.27 286.69C475.04 271.84 480 256 480 236.85c0-44.015-37.218-85.58-85.82-85.58H357.7c4.92-12.81 8.85-28.13 8.85-46.54C366.55 31.936 328.86 0 271.28 0c-61.607 0-58.093 94.933-71.76 108.6-22.747 22.747-49.615 66.447-68.76 83.4H32c-17.673 0-32 14.327-32 32v240c0 17.673 14.327 32 32 32h64c14.893 0 27.408-10.174 30.978-23.95 44.509 1.001 75.06 39.94 177.802 39.94 7.22 0 15.22.01 22.22.01 77.117 0 111.986-39.423 112.94-95.33 13.319-18.425 20.299-43.122 17.34-66.99 9.854-18.452 13.664-40.343 8.99-62.99zm-61.75 53.83c12.56 21.13 1.26 49.41-13.94 57.57 7.7 48.78-17.608 65.9-53.12 65.9h-37.82c-71.639 0-118.029-37.82-171.64-37.82V240h10.92c28.36 0 67.98-70.89 94.54-97.46 28.36-28.36 18.91-75.63 37.82-94.54 47.27 0 47.27 32.98 47.27 56.73 0 39.17-28.36 56.72-28.36 94.54h103.99c21.11 0 37.73 18.91 37.82 37.82.09 18.9-12.82 37.81-22.27 37.81 13.489 14.555 16.371 45.236-5.21 65.62zM88 432c0 13.255-10.745 24-24 24s-24-10.745-24-24 10.745-24 24-24 24 10.745 24 24z"></path></svg><!-- <i class="far fa-thumbs-up"></i> -->
                            <span class="ml-1">赞</span> <span class="mainLikeNum">3</span>
                        </button></div><button class="func-btn mainBookmark btn btn-outline-secondary 
                                mr-2 " data-id="1190000024453209">
                                <svg class="svg-inline--fa fa-bookmark fa-w-12" aria-hidden="true" focusable="false" data-prefix="far" data-icon="bookmark" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" data-fa-i2svg=""><path fill="currentColor" d="M336 0H48C21.49 0 0 21.49 0 48v464l192-112 192 112V48c0-26.51-21.49-48-48-48zm0 428.43l-144-84-144 84V54a6 6 0 0 1 6-6h276c3.314 0 6 2.683 6 5.996V428.43z"></path></svg><!-- <i class="far fa-bookmark"></i> -->
                                <span class="ml-1">收藏</span> <span class="bookmarkNum">2</span>
                            </button><div class="dropdown dropup d-inline-block">
                        <button class="func-btn btn btn-outline-secondary
                        " id="func_share" data-toggle="dropdown">
                        <svg class="svg-inline--fa fa-share-alt fa-w-14" aria-hidden="true" focusable="false" data-prefix="far" data-icon="share-alt" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M352 320c-25.6 0-48.9 10-66.1 26.4l-98.3-61.5c5.9-18.8 5.9-39.1 0-57.8l98.3-61.5C303.1 182 326.4 192 352 192c53 0 96-43 96-96S405 0 352 0s-96 43-96 96c0 9.8 1.5 19.6 4.4 28.9l-98.3 61.5C144.9 170 121.6 160 96 160c-53 0-96 43-96 96s43 96 96 96c25.6 0 48.9-10 66.1-26.4l98.3 61.5c-2.9 9.4-4.4 19.1-4.4 28.9 0 53 43 96 96 96s96-43 96-96-43-96-96-96zm0-272c26.5 0 48 21.5 48 48s-21.5 48-48 48-48-21.5-48-48 21.5-48 48-48zM96 304c-26.5 0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48zm256 160c-26.5 0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48z"></path></svg><!-- <i class="far fa-share-alt"></i> -->
                        <span class="ml-1 show-row">分享</span>
                        </button>
                        <div class="dropdown-menu shareContent" aria-labelledby="func_share">
                            <div class="text-center mt-2" style="cursor: auto">
                                <div class="qr"><img crossorigin="anonymous" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHYAAAB2CAYAAAAdp2cRAAAG0klEQVR4Xu2da5LaMBCEyZ32/ifYO5Fiy0WtQeKbVkvEOJ2/o3l1z0P2AvlzvV6vl/w7HQJ/bsR+fX29NbHv7++dP/L/eF4N9tE+2aN4yL+aH9lT5Tf/IbaBWohVS2k7r1Y0dRiFkY4lhCbJQ+wkIDtmuqPY7ZBHf2rHrE1bt+7G7+pTxC37zR0bYvdQusS4+iGWEBiUu8S4+hR2OpYQ6shdYlx9CnuYWPX6T5cjVU47mxInf4/6dF5dVUTsCnxLO3aF499gUuIhdo9ApfBCbKPdK8DRlFAKd0XjhNgQW69RteKpYl17pE+ZqTuVVsfseD7m8uReZmhnUyGRfyqEELshQEBThbtyIioduyE0G2jXHumHWEJgEbHkVu0oGtXkT9Wn8zSxaDV87I4loEPs/oMS5b/urKioV895RCRVMOlTB83WJ38r8D3kcywBG2Jff7So3LEq0Op1f/Z5ipcuUyRXC4s6luIl+fCOJcMkVxNzz1M8RBzJQ2znOZUuOyGWSnMvT8cuehybXagarZdLmVjVsHqeRt3Z5Spe6vnu5Uk1pJ4/O3GUn4qXej7EFu8AtPNVuUqUej7Enp1YtSJWn1c7YPblxX0TtBqfiv2fN0+Vg+88E2J9tENsA8N0rF9YTQvpWB/YKV+jdHccEemnqVlw41H13Qmx7AVFiOVXfK9KK8RqjTd8Wu24R0eqfogdpkpTVIk5LLFqYG7i5O9RTqOeaFPjnd1BFJ+bb3fHEtD07nM28G6iaj50noghfEjfzTfEbghSIaZji0BRxRKQRIRqn+xRPNRhqj7ZG8lv6MNs7ughYCmRd8tpRxORbr4j9kNsoUpCbAGk2xG3gotuph0LsUUoQ2wRqO3YtFFMy5wcqfoq0ap/Nx7Xn0ajPtGG3xXPvizRaCMgXKApH5JTfK7cLfTyR2PcREnfTUQFUo3HLSQ3PtJPx3aeu2mCfCyxVBGqnICgjpm9E1V/5P9RToWxGr+W/SUfjQmx+2/DhdgOAtRxrpyApztAOra442gUEpCq/L8hloChHUPEqPou8OTP7fjVHU2rrYV3c8eG2OffdPgNnosPFQIVYqXQQ2zj3TURR3IiJsRSaXZ2NqkRMa78sMRSYAScurPIH1U4EUHxqvp0XpXTnWTajiWgCagQq+3oENupKOoQKkRVn86r8hAbYqlGf+Tlv+5QRdHoptFM0bo7lnYU2af4yD7pz8b3Zm/oS1kEhDuKZidKwFM+RAzZJ/3Z+YbYwcclmlAqkSF2cMdSR522Y1dXoFqRajzqDqfzRDQVCuU7W78Vb+mVojtaKFGyT0AQUeSf7gRqoan+KH/KL8R2dmqIpdIqymnUqR1CFa12EMVHE0T1R7BRfuWOVYF1AyP92UC5/lR8VGLcwrk/7lCiqqPVRBBQlI8qdzuY4iU5xZuOJYQ68hBbBOZoE4D4/lhi6VZIcnfnELCqfXUV0ChUiVXPu/G28Jvy/VgVeEqciFY7XiXOLWTKj+JX4w2xGwJEHMmpkEMstWZHThXvjrbTEDuI712NgJ5dwWrHuERRobj4kb4af/k5VnWsAjG7MNwd5cZDeKnyELshFmK3T1CoFUSjMB3rIrrXn9axZEgdVavtqYVEsLvxkn1XTneW7o51E1NHoVsoIfa5VEp/aCeiCNjVhUL+1Q5x41X9qefTsSpi2/nTEjuIx7CaCiRNEFWuBq6uDrJP9ki/NbGW/AaFGkiI3X/XR8UvxHaec1UgqcMqO/C3T7Knxnfzn45VUbs8/3+t7uVtGbGzDRNWakU/2qN43R2rrgYi9t327s+xBBQRpcpD7P53oAj/kUId+lKWSiRVtGpvBRCvdh4BS/mlY4sMh9jX35jvjmJ3VNJOnG3f9ad2FHWwmt+KQi195qnYSN1jBJxrP8Q+/3ZjiG08vqgd6RZuOrbY2irQdN6VU9j/jFhy7N4K1cSpo9R4yP9qe7Pt3988qRVJQBDw7uWC7M8GarW92fZDLFVoR64WlurGtR9iVcS38y7w5Na1fxhiZ68CdbS5QL6DqFc+WviVHndWX55C7OvSoDtJiN3wW11I6sRQO77yQiYdW/ghagKe5O6oP03HElBqRxAwqj/qeLKn6tP5jxnFBEyIff333MPeikPsHoF0bPFypBZO5bKi2CSiVH/Do1gJunWWElHlNIoJGFWf8qf4KR66XKnym7/SrZgSIzklrspVYug53L1cUfwhdkOAKjTEfshHY6ji3Y5z9d2JdJiOpURcOXWkOxoJSIqf/KuF4p4fwesQHz+ljiUiSE7Arh7t5F8lroJXiG1URTqWWqUjVyt00M1djTrmtB3rAhf94yHwF5luA1NeE61ZAAAAAElFTkSuQmCC" width="118" height="118" style="width: 118px; height: 118px;"></div>
                                扫一扫分享
                            </div>
                            <div class="dropdown-divider"></div>
                        <a class="dropdown-item share_weibo" data-share="weibo" href="http://weibo.com/segmentfault" target="_blank"><svg class="svg-inline--fa fa-weibo fa-w-16 fa-fw" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="weibo" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M407 177.6c7.6-24-13.4-46.8-37.4-41.7-22 4.8-28.8-28.1-7.1-32.8 50.1-10.9 92.3 37.1 76.5 84.8-6.8 21.2-38.8 10.8-32-10.3zM214.8 446.7C108.5 446.7 0 395.3 0 310.4c0-44.3 28-95.4 76.3-143.7C176 67 279.5 65.8 249.9 161c-4 13.1 12.3 5.7 12.3 6 79.5-33.6 140.5-16.8 114 51.4-3.7 9.4 1.1 10.9 8.3 13.1 135.7 42.3 34.8 215.2-169.7 215.2zm143.7-146.3c-5.4-55.7-78.5-94-163.4-85.7-84.8 8.6-148.8 60.3-143.4 116s78.5 94 163.4 85.7c84.8-8.6 148.8-60.3 143.4-116zM347.9 35.1c-25.9 5.6-16.8 43.7 8.3 38.3 72.3-15.2 134.8 52.8 111.7 124-7.4 24.2 29.1 37 37.4 12 31.9-99.8-55.1-195.9-157.4-174.3zm-78.5 311c-17.1 38.8-66.8 60-109.1 46.3-40.8-13.1-58-53.4-40.3-89.7 17.7-35.4 63.1-55.4 103.4-45.1 42 10.8 63.1 50.2 46 88.5zm-86.3-30c-12.9-5.4-30 .3-38 12.9-8.3 12.9-4.3 28 8.6 34 13.1 6 30.8.3 39.1-12.9 8-13.1 3.7-28.3-9.7-34zm32.6-13.4c-5.1-1.7-11.4.6-14.3 5.4-2.9 5.1-1.4 10.6 3.7 12.9 5.1 2 11.7-.3 14.6-5.4 2.8-5.2 1.1-10.9-4-12.9z"></path></svg><!-- <i class="fab fa-weibo fa-fw"></i> --> 新浪微博</a><a class="dropdown-item share_twitter" data-share="twitter" href="https://twitter.com/segment_fault" target="_blank"><svg class="svg-inline--fa fa-twitter fa-w-16 fa-fw" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitter" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg><!-- <i class="fab fa-twitter fa-fw"></i> --> Twitter</a><a class="dropdown-item share_facebook" data-share="facebook" href="javascript:;" target="_blank"><svg class="svg-inline--fa fa-facebook-square fa-w-14 fa-fw" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="facebook-square" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M400 32H48A48 48 0 0 0 0 80v352a48 48 0 0 0 48 48h137.25V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.27c-30.81 0-40.42 19.12-40.42 38.73V256h68.78l-11 71.69h-57.78V480H400a48 48 0 0 0 48-48V80a48 48 0 0 0-48-48z"></path></svg><!-- <i class="fab fa-facebook-square fa-fw"></i> --> Facebook</a></div>
                    </div></div></div>

                            <div class="text-center mb-5 mt-3 text-secondary font-size-14">

                                本作品系原创，
                                                                                                                        <a target="_blank" class="text-secondary" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">采用《署名-非商业性使用-禁止演绎
                                                4.0 国际》许可协议</a>
                                                                                                                                        </div>
                            <hr class="mb-0">
                            <div class="article-author d-flex flex-sm-row align-items-center pt-4 row">
                                <div class="d-flex align-items-center flex-grow-1 author-left col-sm-9 col-12">
                                    <a href="https://segmentfault.com/u/longming_5732dced2bfb7">
                                        <img class="rounded-circle mr-3" width="64" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/1244151576-5f4f9a48a168b_big64" aria-hidden="true">
                                    </a>
                                    <div>
                                        <h5>
                                            <a class="text-body" href="https://segmentfault.com/u/longming_5732dced2bfb7">longming</a>
                                        </h5>
                                        <ul class="list-inline mb-0 authentication-info">
                                                                                        <li class="list-inline-item">
                                                <svg class="svg-inline--fa fa-dice-d8 fa-w-16" style="color: #BF7158;" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="dice-d8" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M225.53 2.52L2.36 233.83c-4.21 4.37-2.56 11.71 3.1 13.77l234.13 85.06V8.39c-.01-7.49-8.91-11.21-14.06-5.87zm284.11 231.31L286.47 2.52C281.32-2.82 272.41.9 272.41 8.4v324.27l234.13-85.06c5.66-2.07 7.31-9.42 3.1-13.78zM33.53 310.38l192 199.1c5.15 5.34 14.06 1.62 14.06-5.88V368.29L42.13 296.61c-8.21-2.98-14.72 7.43-8.6 13.77zm436.34-13.77l-197.46 71.68V503.6c0 7.5 8.91 11.22 14.06 5.88l192-199.1c6.12-6.34-.39-16.75-8.6-13.77z"></path></svg><!-- <i class="fas fa-dice-d8" style="color:#BF7158"></i> -->
                                                <span style="color: #BF7158; font-size:16px; font-weight:bold">14</span>
                                            </li>
                                                                                    </ul>
                                    </div>
                                </div>
                                <div class="author-right flex-shrink-0 col-sm-3 col-12 text-sm-right text-left mt-sm-0 mt-3">
                                                                                                                <button type="button" class="btn btn-primary follow-user sf_do" data-dotype="post" data-content="{&quot;type&quot;:&quot;state&quot;,&quot;state&quot;:false,&quot;true&quot;:&quot;\u5173\u6ce8\u4f5c\u8005&quot;,&quot;false&quot;:&quot;\u5df2\u7ecf\u5173\u6ce8&quot;}" data-api="/iteration/api/user/1030000005103587/follow">关注作者
                                        </button>
                                                                    </div>
                            </div>
                        </div>
                    </div>

                                                            <div id="comment-area" class="my-4" data-type="article" data-id="1190000024453209" data-page="1" data-user="{&quot;avatarUrl&quot;:&quot;https:\/\/avatar-static.segmentfault.com\/258\/788\/2587883497-593d7f93950a2_big64&quot;}"><div class="d-flex justify-content-between mb-2">
                <div id="comment-total" class="h5 mb-0">0 条评论</div>
                <div>
                    <a href="javascript:;" class="sort text-dark" data-sort="default">得票</a><span class="split-dot"></span><a href="javascript:;" class="sort text-secondary" data-sort="desc">时间</a>
                </div>
            </div><div class="card border-0">
                <div class="card-body">
                    <div class="media">
                        <img src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/2587883497-593d7f93950a2_big64" class="rounded-circle mr-3" width="38" aria-hidden="true">
                        <form class="media-body" action="https://segmentfault.com/api/article/1190000024453209/comments/add">
                            <div class="form-group">
                                <textarea autoheight="true" class="form-control comment-text" rows="1" placeholder="撰写评论 ..." style="overflow: hidden; overflow-wrap: break-word; resize: none; height: 38px;" name="text"></textarea>
                            </div>
                            <div class="d-flex justify-content-end">
                                <button data-js-replay-submit-btn="" type="button" submit-type="comment" class="btn btn-primary float-right" disabled="">提交评论</button>
                                <input type="hidden" name="objectId" value="1190000024453209" autocomplete="off">
                            </div>
                        </form>
                    </div>
                    <div id="comment-body"></div><div class="sflex-center comment-pagination"></div>
                </div>
            </div></div>
                                        <h5 class="mt-4">推荐阅读</h5>
                    <div class="card border-0 mb-4">
                        <div class="list-group list-group-flush" id="paradigm-article-related"><a href="https://segmentfault.com/a/1190000002413526?utm_source=sf-related" target="_blank" class="list-group-item list-group-item-action py-3">
                                <h5 class="text-body">Web前后端分离开发思路</h5>
                                <p class="mb-2 text-truncate text-secondary">开发一个Web应用的时候我们一般都会简单地分为前端工程师和后端工程师（注：在一些比较复杂的系统中，前端可以细分为外观和逻辑，后端可以分为CGI和Server）。前端工程师负责浏览器端用户交互界面和逻辑等，后端...</p>
                                <p class="text-secondary mb-0 font-size-14">
                                    <span class="text-primary">戴嘉华</span>
                                    <span class="split-dot"></span> 阅读 28.6k
                                    <span class="split-dot"></span> 26 赞
                                    <span class="split-dot"></span> 10 评论
                                </p>
                            </a><a href="https://segmentfault.com/a/1190000021964736?utm_source=sf-related" target="_blank" class="list-group-item list-group-item-action py-3">
                                <h5 class="text-body">前端高级进阶：使用 docker 高效部署你的前端应用</h5>
                                <p class="mb-2 text-truncate text-secondary">这是山月关于高级前端进阶暨前端工程系列文章的第 M 篇文章 (M 随便打的，毕竟也不知道能写多少篇)，关于前 M-1 篇文章，可以从我的 github repo shfshanyue/blog 中找到，如果点进去的话可以捎带~点个赞~，如果...</p>
                                <p class="text-secondary mb-0 font-size-14">
                                    <span class="text-primary">shanyue</span>
                                    <span class="split-dot"></span> 阅读 2.4k
                                    <span class="split-dot"></span> 18 赞
                                    
                                </p>
                            </a><a href="https://segmentfault.com/a/1190000005756376?utm_source=sf-related" target="_blank" class="list-group-item list-group-item-action py-3">
                                <h5 class="text-body">前端工程化工具初选</h5>
                                <p class="mb-2 text-truncate text-secondary">面对日益纷杂的前端工具，作为新人常感无从下手。经过一番检索和简单对比，再结合自己的喜好，筛选了将要学习和使用的工具，以适应日益工程化、专业化的 Web 前端开发工作。</p>
                                <p class="text-secondary mb-0 font-size-14">
                                    <span class="text-primary">奋进的小莫</span>
                                    <span class="split-dot"></span> 阅读 7.4k
                                    <span class="split-dot"></span> 17 赞
                                    
                                </p>
                            </a><a href="https://segmentfault.com/a/1190000023663451?utm_source=sf-related" target="_blank" class="list-group-item list-group-item-action py-3">
                                <h5 class="text-body">如何使用华为云服务一键构建部署发布前端和Node.js服务</h5>
                                <p class="mb-2 text-truncate text-secondary">例如你有10个项目,前后端都要同时发布,那么就需要多次合并代码、构建,重复很多动作..而且还要去关心构建机器环境是不是变了?配置是否能扛住同时构建多个应用,人为的操作次数多了,就很难保证万无一失</p>
                                <p class="text-secondary mb-0 font-size-14">
                                    <span class="text-primary">Peter谭老师</span>
                                    <span class="split-dot"></span> 阅读 11.1k
                                    <span class="split-dot"></span> 15 赞
                                    <span class="split-dot"></span> 5 评论
                                </p>
                            </a><a href="https://segmentfault.com/a/1190000005594760?utm_source=sf-related" target="_blank" class="list-group-item list-group-item-action py-3">
                                <h5 class="text-body">精益 React 学习指南 （Lean React）- 2.1 前端工程化概述 </h5>
                                <p class="mb-2 text-truncate text-secondary">在前端开发的初始阶段，开发者通常只用关 html, css, javascript。但是现代化的前端开发已经不仅仅是业务代码本身，真正的前端开发环境涉及很多方面的需求，如：</p>
                                <p class="text-secondary mb-0 font-size-14">
                                    <span class="text-primary">陈学家_6174</span>
                                    <span class="split-dot"></span> 阅读 7.8k
                                    <span class="split-dot"></span> 14 赞
                                    <span class="split-dot"></span> 4 评论
                                </p>
                            </a><a href="https://segmentfault.com/a/1190000021858533?utm_source=sf-related" target="_blank" class="list-group-item list-group-item-action py-3">
                                <h5 class="text-body">微前端在美团外卖的实践</h5>
                                <p class="mb-2 text-truncate text-secondary">微前端是一种利用微件拆分来达到工程拆分治理的方案，可以解决工程膨胀、开发维护困难等问题。随着前端业务场景越来越复杂，微前端这个概念最近被提起得越来越多，业界也有很多团队开始探索实践并在业务中进行了...</p>
                                <p class="text-secondary mb-0 font-size-14">
                                    <span class="text-primary">美团技术团队</span>
                                    <span class="split-dot"></span> 阅读 1.1k
                                    <span class="split-dot"></span> 12 赞
                                    
                                </p>
                            </a><a href="https://segmentfault.com/a/1190000009815823?utm_source=sf-related" target="_blank" class="list-group-item list-group-item-action py-3">
                                <h5 class="text-body">前端工程化总结</h5>
                                <p class="mb-2 text-truncate text-secondary">为什么会出现前端工程化这个概念？当前端业务日益复杂化和多元化，就会出现许多问题。比如说：如何提高开发效率？如何保证项目的可维护性？如何提高项目的开发质量？多人合作，架构分层，模块设计，解耦，抽象，...</p>
                                <p class="text-secondary mb-0 font-size-14">
                                    <span class="text-primary">阿升</span>
                                    <span class="split-dot"></span> 阅读 1.6k
                                    <span class="split-dot"></span> 3 赞
                                    
                                </p>
                            </a><a href="https://segmentfault.com/a/1190000020967166?utm_source=sf-related" target="_blank" class="list-group-item list-group-item-action py-3">
                                <h5 class="text-body">前端部署发展史</h5>
                                <p class="mb-2 text-truncate text-secondary">前端一说起刀耕火种，那肯定紧随着前端工程化这一话题。随着 react/vue/angular，es6+，webpack，babel，typescript 以及 node 的发展，前端已经在逐渐替代过去 script 引 cdn 开发的方式了，掀起了工程化这一大...</p>
                                <p class="text-secondary mb-0 font-size-14">
                                    <span class="text-primary">shanyue</span>
                                    <span class="split-dot"></span> 阅读 1.3k
                                    <span class="split-dot"></span> 3 赞
                                    
                                </p>
                            </a></div>
                    </div>

                </div>

                                <div class="col-12 col-xl-auto">
                    <div class="w-xl-300">
                        
                        <div id="first-ad" class="card border-0 overflow-hidden d-none d-xl-flex justify-content-center align-items-center float-ads mb-4" data-fix="" style="top: 0px; margin-top: 82px; width: 300px;">
                            <script type="text/javascript">
                              OA_show(1);
                            </script><div id="OA_holder_1"><div style="line-height: 0"><script async="" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/f(6).txt"></script>
<!-- 文章详情 - 侧栏矩形 -->
<ins class="adsbygoogle" style="display:inline-block;width:300px;height:250px" data-ad-client="ca-pub-6330872677300335" data-ad-slot="6800875204" data-adsbygoogle-status="done"><ins id="aswift_1_expand" style="display:inline-table;border:none;height:250px;margin:0;padding:0;position:relative;visibility:visible;width:300px;background-color:transparent;" tabindex="0" title="Advertisement" aria-label="Advertisement"><ins id="aswift_1_anchor" style="display:block;border:none;height:250px;margin:0;padding:0;position:relative;visibility:visible;width:300px;background-color:transparent;"><iframe id="aswift_1" name="aswift_1" style="left:0;position:absolute;top:0;border:0;width:300px;height:250px;" sandbox="allow-forms allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-top-navigation-by-user-activation" width="300" height="250" frameborder="0" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/ads.html" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" data-google-container-id="a!2" data-google-query-id="COn4ieT17e0CFYgGlgodglgJ2w" data-load-complete="true"></iframe></ins></ins></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script><div id="beacon_5d5c52ffca" style="position: absolute; left: 0px; top: 0px; visibility: hidden;"><img src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/lg(4).php" width="0" height="0" alt="" style="width: 0px; height: 0px;"></div></div>
</div>
                        </div>
                        <!-- / 矩形广告位 -->

                        <div class="card border-0 d-none d-xl-flex mb-4">
                            <div class="card-body">
                                <div class="text-center mb-3">
                                    <div class="mb25 hidden-md hidden-sm hidden-xs">
    <img src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/20201227.png" alt="Planets" usemap="#gridsMap" width="255" height="136">
    <map name="gridsMap" id="gridsMap"><area shape="rect" target="_blank" onmouseover="SFGridAd.d(this)" onmouseout="SFGridAd.e(this)" coords="238,119,255,136" href="https://segmentfault.com/sponsor/1750000022197859/redirect" stitle="萌搜 小众搜索引擎"><area shape="rect" target="_blank" onmouseover="SFGridAd.d(this)" onmouseout="SFGridAd.e(this)" coords="51,85,153,102" href="https://segmentfault.com/sponsor/1750000023565095/redirect" stitle="零代码搭建CRM、OA、ERP、进销存等各类管理系统"><area shape="rect" target="_blank" onmouseover="SFGridAd.d(this)" onmouseout="SFGridAd.e(this)" coords="153,85,170,102" href="https://segmentfault.com/sponsor/1750000023948580/redirect" stitle="免费开源的内网穿透软件，支持安卓和iOS，永久免费，欢迎fork，star"><area shape="rect" target="_blank" onmouseover="SFGridAd.d(this)" onmouseout="SFGridAd.e(this)" coords="51,51,204,68" href="https://segmentfault.com/sponsor/1750000038464102/redirect" stitle="MeEdu - 开源知识付费系统"><area shape="rect" target="_blank" onmouseover="SFGridAd.d(this)" onmouseout="SFGridAd.e(this)" coords="0,119,68,136" href="https://segmentfault.com/sponsor/1750000038554675/redirect" stitle="站长论坛"></map>
    <div style="text-align: center;"><a style="color:#9E9E9E; font-size:12px" href="https://segmentfault.com/sponsor">广告位促销，月曝光三千万，10 元/天</a></div>
        <script async="" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/20201227.js.下载"></script>
</div>
                                </div>

                                <div class="side-promote-link">
                                    <script type="text/javascript">
                                      OA_show(7);
                                      OA_show(9);
                                      OA_show(10);
                                      OA_show(15);
                                      OA_show(16);
                                    </script><div id="OA_holder_7"><a href="https://sponsor.segmentfault.com/ck.php?oaparams=2__bannerid=439__zoneid=7__cb=10957e43ed__oadest=https%3A%2F%2Fke.sifou.com%2Fcourse%2F1650000037651959%3Futm_source%3Dsegmentfault%26utm_medium%3Dbanner_Tlink" target="_blank"><strong>前端性能优化设计12问</strong><br>
<small style="color: #6c757d">前端性能优化,面试的必问题目</small></a><div id="beacon_10957e43ed" style="position: absolute; left: 0px; top: 0px; visibility: hidden;"><img src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/lg(5).php" width="0" height="0" alt="" style="width: 0px; height: 0px;"></div>
</div><div id="OA_holder_9"><a href="https://sponsor.segmentfault.com/ck.php?oaparams=2__bannerid=440__zoneid=9__cb=a9dd9ffabc__oadest=https%3A%2F%2Fke.sifou.com%2Fcourse%2F1650000037773462%3Futm_source%3Dsegmentfault%26utm_medium%3Dbanner_Tlink" target="_blank"><strong>Python 业务开发常见错误案例集</strong><br>
<small style="color: #6c757d">教你避开 Python 开发中的常见坑点</small></a><div id="beacon_a9dd9ffabc" style="position: absolute; left: 0px; top: 0px; visibility: hidden;"><img src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/lg(6).php" width="0" height="0" alt="" style="width: 0px; height: 0px;"></div>
</div><div id="OA_holder_10"><a href="https://sponsor.segmentfault.com/ck.php?oaparams=2__bannerid=386__zoneid=10__cb=da1a86b330__oadest=https%3A%2F%2Fke.sifou.com%2Fcourse%2F1650000023477528%3Futm_source%3Dsegmentfault%26utm_medium%3Dbanner_Tlink" target="_blank"><strong>带你从零到一全面掌握前端「新宠」</strong><br>
<small style="color: #6c757d">TypeScript从入门到实践「2020 版」</small></a><div id="beacon_da1a86b330" style="position: absolute; left: 0px; top: 0px; visibility: hidden;"><img src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/lg(7).php" width="0" height="0" alt="" style="width: 0px; height: 0px;"></div>
</div><div id="OA_holder_15"><a href="https://sponsor.segmentfault.com/ck.php?oaparams=2__bannerid=400__zoneid=15__cb=9ff686e979__oadest=https%3A%2F%2Fke.sifou.com%2Fcourse%2F1650000023864436%3Futm_source%3Dsegmentfault%26utm_medium%3Dbanner_Tlink" target="_blank"><strong>自顶向下学 React 源码</strong><br>
<small style="color: #6c757d">从理念到架构到实现到代码，透彻理解 </small></a><div id="beacon_9ff686e979" style="position: absolute; left: 0px; top: 0px; visibility: hidden;"><img src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/lg(8).php" width="0" height="0" alt="" style="width: 0px; height: 0px;"></div>
</div><div id="OA_holder_16"><a href="https://sponsor.segmentfault.com/ck.php?oaparams=2__bannerid=401__zoneid=16__cb=9a710767b0__oadest=https%3A%2F%2Fke.sifou.com%2Fcourse%2F1650000037474720%3Futm_source%3Dsegmentfault%26utm_medium%3Dbanner_Tlink" target="_blank"><strong>专家带你构建一个高性能秒杀系统</strong><br>
<small style="color: #6c757d">大厂电商 Java 秒杀系统架构实战</small></a><div id="beacon_9a710767b0" style="position: absolute; left: 0px; top: 0px; visibility: hidden;"><img src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/lg(9).php" width="0" height="0" alt="" style="width: 0px; height: 0px;"></div>
</div>
                                </div>
                            </div>
                        </div>
                        <!-- / 格子广告、链接广告 -->

                        <div class="card border-0 overflow-hidden d-none d-xl-flex mb-4" data-article-nav="" style="top: auto; margin-top: auto;">
                            <div class="card-body py-3">
                                <h6 class="nav-header py-1 mb-0 position-relative bg-white collapsed" style="" for="collapseTarget" data-toggle="collapse" href="#collapseTarget" aria-expanded="false" aria-controls="collapseTarget">
                                    <span class="right">▶</span>
                                    <span class="down hidden">▼</span>
                                    目录
                                </h6>
                                <div class="collapse" id="collapseTarget">
                                    <nav id="article-nav-list" data-article-nav-list="" class="font-size-14 ss-container"><div class="ss-wrapper"><div class="ss-content"><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-1" href="javascript:;" data-offsettop="0">小团队的前端工程化体系服务搭建</a><a class="nav-link text-secondary py-0 pr-0 my-1 text-truncate" scroll-href="#item-1-1" href="javascript:;" data-offsettop="0">小团队工程化服务环境</a><a class="nav-link text-secondary py-0 pr-0 my-1 text-truncate" scroll-href="#item-1-2" href="javascript:;" data-offsettop="0">Git flow 工作流</a><a class="nav-link text-secondary py-0 pr-0 my-1 text-truncate" scroll-href="#item-1-3" href="javascript:;" data-offsettop="0">安装准备</a><a class="nav-link text-secondary py-0 pr-0 my-1 text-truncate" scroll-href="#item-1-4" href="javascript:;" data-offsettop="0">安装使用流程</a><a class="nav-link text-secondary py-0 pr-0 my-1 text-truncate" scroll-href="#item-1-5" href="javascript:;" data-offsettop="0">Docker</a><a class="nav-link text-secondary py-0 pr-0 my-1 text-truncate" scroll-href="#item-1-6" href="javascript:;" data-offsettop="0">Jenkinsci/BlueOcean</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-2" href="javascript:;" data-offsettop="0">!/bin/bash</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-3" href="javascript:;" data-offsettop="0">set -x</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-4" href="javascript:;" data-offsettop="0">如果是回滚的操作，我们不用再把构建上传一次啦，服务器已经有啦</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-5" href="javascript:;" data-offsettop="0">远程执行服务器上面的脚本解压缩发布</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-6" href="javascript:;" data-offsettop="0">set +x</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-7" href="javascript:;" data-offsettop="0">切换到本地dev</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-8" href="javascript:;" data-offsettop="0">更新远程dev，如果有多人协调在这个分支做开发的话</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-9" href="javascript:;" data-offsettop="0">一系列的提交操作</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-10" href="javascript:;" data-offsettop="0">我们功能分支是从远程master分支checkout出来的，开发过程中可能master上线了其他的功能，需要更新一下</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-11" href="javascript:;" data-offsettop="0">如果合并发生冲突，我们解决好冲突后</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-12" href="javascript:;" data-offsettop="0">解决好冲突或者没有冲突直接push啦</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-13" href="javascript:;" data-offsettop="0">查看官方的verdaccio镜像源</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-14" href="javascript:;" data-offsettop="0">看到官方镜像源叫 verdaccio/verdaccio，我们下载下来</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-15" href="javascript:;" data-offsettop="0">我们先在我们用户工作目录下，新建一个verdaccio目录</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-16" href="javascript:;" data-offsettop="0">进入conf，创建verdaccio需要的配置文件</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-17" href="javascript:;" data-offsettop="0">This is the config file used for the docker images.</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-18" href="javascript:;" data-offsettop="0">It allows all users to do anything, so don't use it on production systems.</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-19" href="javascript:;" data-offsettop="0">Do not configure host and port under listen in this file</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-20" href="javascript:;" data-offsettop="0">as it will be ignored when using docker.</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-21" href="javascript:;" data-offsettop="0">see https://github.com/verdaccio/...</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-22" href="javascript:;" data-offsettop="0">Look here for more config file examples:</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-23" href="javascript:;" data-offsettop="0">https://github.com/verdaccio/...</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-24" href="javascript:;" data-offsettop="0">path to a directory with all packages</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-25" href="javascript:;" data-offsettop="0">a list of other known repositories we can talk to</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-26" href="javascript:;" data-offsettop="0">To use npm audit uncomment the following section</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-27" href="javascript:;" data-offsettop="0">log settings</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-28" href="javascript:;" data-offsettop="0">创建+运行verdaccio容器</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-29" href="javascript:;" data-offsettop="0">查看容器运行日志</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-30" href="javascript:;" data-offsettop="0">进入docker容器，用sh做交互</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-31" href="javascript:;" data-offsettop="0">cd到配置目录下</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-32" href="javascript:;" data-offsettop="0">查看默认的配置文件</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-33" href="javascript:;" data-offsettop="0">查看现在可以的源， *表示现在使用源</a><a class="nav-link text-secondary py-0 pr-0 my-1 text-truncate" scroll-href="#item-33-7" href="javascript:;" data-offsettop="0">nrm ls</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-34" href="javascript:;" data-offsettop="0">我们现在需要添加一个我们刚刚搭建的源库</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-35" href="javascript:;" data-offsettop="0">nrm add <registry> <url></url></registry></a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-36" href="javascript:;" data-offsettop="0">添加后我们要使用它</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-37" href="javascript:;" data-offsettop="0">在我的用户目录下新建一个文件夹</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-38" href="javascript:;" data-offsettop="0">初始化</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-39" href="javascript:;" data-offsettop="0">可以添加一个README.md 和 .npmignore,.npmignore这个是可以设计忽略需要上传的文件</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-40" href="javascript:;" data-offsettop="0">随便写点东西我们测试一下发布</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-41" href="javascript:;" data-offsettop="0">退出登录</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-42" href="javascript:;" data-offsettop="0">不要在目录npm-vue-ci，去其他的目录下</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-43" href="javascript:;" data-offsettop="0">没登录的状态下，这个曹操作必须是失败</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-44" href="javascript:;" data-offsettop="0">查看源</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-45" href="javascript:;" data-offsettop="0">下载源</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-46" href="javascript:;" data-offsettop="0">创建+运行verdaccio容器</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-47" href="javascript:;" data-offsettop="0">进入admin</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-48" href="javascript:;" data-offsettop="0">因为新的mongo 默认没有admin数据库，需要自己造一个还有管理员用户</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-49" href="javascript:;" data-offsettop="0">创建好后需要开启验证</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-50" href="javascript:;" data-offsettop="0">因为这个数据库，现在安装是提供给yapi的，我们需要新建一个数据库和它的数据库管理员用户</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-51" href="javascript:;" data-offsettop="0">开启验证,一次验证多个用户可能会失败，可以退出后再进来先验证admin，在重新验证普通用户</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-52" href="javascript:;" data-offsettop="0">测试一下数据的写入</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-53" href="javascript:;" data-offsettop="0">查看系统用户列表.pretty() 用这个方法美化列表</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-54" href="javascript:;" data-offsettop="0">删除数据库。</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-55" href="javascript:;" data-offsettop="0">连接环境服务器</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-56" href="javascript:;" data-offsettop="0">进入用户目录，创建存放我们的docker数据的目录</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-57" href="javascript:;" data-offsettop="0">进入docker数据目录，创建yai目录，在其目录下新建Dockerfile文件</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-58" href="javascript:;" data-offsettop="0">我们创建的镜像基于centos镜像</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-59" href="javascript:;" data-offsettop="0">镜像的作者</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-60" href="javascript:;" data-offsettop="0">设置环境变量，这里没有用到哈哈哈</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-61" href="javascript:;" data-offsettop="0">yapi需要安装git，和 node</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-62" href="javascript:;" data-offsettop="0">安装yapi</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-63" href="javascript:;" data-offsettop="0">要在~ /docker-data/yapi 目录哈</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-64" href="javascript:;" data-offsettop="0">-t 指定镜像的名字和tag，. 表示在当前目录下需要Dockerfile</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-65" href="javascript:;" data-offsettop="0">查看本地的镜像</a><a class="nav-link text-secondary py-0 pr-0 my-1 text-truncate" scroll-href="#item-65-8" href="javascript:;" data-offsettop="0">docker images</a><a class="nav-link text-secondary py-0 pr-0 my-1 text-truncate" scroll-href="#item-65-9" href="javascript:;" data-offsettop="0">...</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-66" href="javascript:;" data-offsettop="0">进入我们的部署路径</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-67" href="javascript:;" data-offsettop="0">创建一个网络，默认是bridge类型的，这个也是docker网络中最常用的</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-68" href="javascript:;" data-offsettop="0">将我们需要的mongo容器和yapi容器加入此网络</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-69" href="javascript:;" data-offsettop="0">查看网络的详情</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-70" href="javascript:;" data-offsettop="0">查看yum的nginx</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-71" href="javascript:;" data-offsettop="0">yum安装</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-72" href="javascript:;" data-offsettop="0">设置开机启动</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-73" href="javascript:;" data-offsettop="0">启动nginx</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-74" href="javascript:;" data-offsettop="0">查看nginx启动状态</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-75" href="javascript:;" data-offsettop="0">停止你的nginx服务器</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-76" href="javascript:;" data-offsettop="0">修改了nginx的配置的话需要重载一下配置</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-77" href="javascript:;" data-offsettop="0">配置文件在这个目录下</a><a class="nav-link text-secondary py-0 pr-0 my-1 text-truncate" scroll-href="#item-77-10" href="javascript:;" data-offsettop="0">vi /etc/nginx/nginx.conf</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-78" href="javascript:;" data-offsettop="0">For more information on configuration, see:</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-79" href="javascript:;" data-offsettop="0">* Official English Documentation: http://nginx.org/en/docs/</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-80" href="javascript:;" data-offsettop="0">* Official Russian Documentation: http://nginx.org/ru/docs/</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-81" href="javascript:;" data-offsettop="0">Load dynamic modules. See /usr/share/doc/nginx/README.dynamic.</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-82" href="javascript:;" data-offsettop="0">配置影响 Nginx 服务器或与用户的网络连接</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-83" href="javascript:;" data-offsettop="0">配置使用最频繁的部分，代理、缓存、日志定义等绝大多数功能和第三方模块的配置都在这里设置</a><a class="nav-link text-secondary py-0 pr-0 my-1 text-truncate" scroll-href="#item-83-11" href="javascript:;" data-offsettop="0">}</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-84" href="javascript:;" data-offsettop="0">gzip.conf</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-85" href="javascript:;" data-offsettop="0">gzip_min_length 1k;</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-86" href="javascript:;" data-offsettop="0">dev.wild-fox.cn.conf</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-87" href="javascript:;" data-offsettop="0">release.wild-fox.cn.conf</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-88" href="javascript:;" data-offsettop="0">master.wild-fox.cn.conf</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-89" href="javascript:;" data-offsettop="0">把env-docker-compose的项目拉去下来</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-90" href="javascript:;" data-offsettop="0">目录结构是这样</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-91" href="javascript:;" data-offsettop="0">进入项目，docker-compose启动服务</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-92" href="javascript:;" data-offsettop="0">这样就启动和部署了之前的jenkins、verdaccio、mongo 和yapi来</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-93" href="javascript:;" data-offsettop="0">centos7的话，yum的源有这个</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-94" href="javascript:;" data-offsettop="0">centos8，yum的源没有pip，我们自己安装</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-95" href="javascript:;" data-offsettop="0">查看现存有的volume 执行 docker volume inspect yapi</a><a class="nav-link text-secondary py-0 pr-0 my-1 text-truncate" scroll-href="#item-95-12" href="javascript:;" data-offsettop="0">...</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-96" href="javascript:;" data-offsettop="0">解压后可能会有多余的东西，我们只需要 下面这几个文件夹的文件，移动我们归档到其他文件夹吧</a><a class="nav-link text-secondary p-0 my-1 text-truncate" scroll-href="#item-97" href="javascript:;" data-offsettop="0">jenkins  mongodb   verdaccio   yapi</a></div></div><div class="ss-scroll" style="right: 0px;"></div></nav>
                                </div>
                            </div>
                        </div>
                        <!-- / 目录 -->
                        <div id="second-ad" class="card border-0 overflow-hidden d-none d-xl-flex justify-content-center align-items-center" data-fix="" style="top: 250px; margin-top: 106px; width: 300px;">
                            <script type="text/javascript">
                              OA_show(31);
                            </script><div id="OA_holder_31"><div class="rounded overflow-hidden"><a href="https://sponsor.segmentfault.com/ck.php?oaparams=2__bannerid=334__zoneid=31__cb=116afb3386__oadest=https%3A%2F%2Fsegmentfault.com%2Fa%2F1190000020336555" target="_blank"><img src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/bb270f7c8f4604f08f8530813cc9e40c.png" width="300" height="100" alt="程序员求职攻略" title="程序员求职攻略" border="0"></a><div id="beacon_116afb3386" style="position: absolute; left: 0px; top: 0px; visibility: hidden;"><img src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/lg(10).php" width="0" height="0" alt="" style="width: 0px; height: 0px;"></div></div>
</div>
                        </div>
                        <!-- / 公众号广告位 -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
      var ARTICLE = {
        articleId: 1190000024453209,
        title: "手把手，搭建前端自动化部署CI / CD 服务 + npm私有库 + 数据 mock 服务",
        isLiked: false,
        votes: 3,
        isBookmarked: false,
        bookmarks: 2,
        canReward: false
      };
    </script>

                        







<script type="text/javascript">
  OA_show(4);
</script><div id="OA_holder_4"><div id="beacon_cf67453998" style="position: absolute; left: 0px; top: 0px; visibility: hidden;"><img src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/lg(11).php" width="0" height="0" alt="" style="width: 0px; height: 0px;"></div>
</div>

<footer id="footer" class="bg-white py-5 font-size-14">
    <div class="container">
        <div class="row">
            <dl class="col-4 col-md-2">
                <dt class="h6">产品</dt>
                                <dd class="my-1"><a class="text-secondary" href="https://segmentfault.com/questions/hottest?utm_source=sf-footer" target="_blank">热门问答</a></dd>
                                <dd class="my-1"><a class="text-secondary" href="https://segmentfault.com/blogs/hottest?utm_source=sf-footer" target="_blank">热门专栏</a></dd>
                                <dd class="my-1"><a class="text-secondary" href="https://segmentfault.com/lives?utm_source=sf-footer" target="_blank">热门课程</a></dd>
                                <dd class="my-1"><a class="text-secondary" href="https://segmentfault.com/events?utm_source=sf-footer" target="_blank">最新活动</a></dd>
                                <dd class="my-1"><a class="text-secondary" href="https://segmentfault.com/groups?utm_source=sf-footer" target="_blank">技术圈</a></dd>
                                <dd class="my-1"><a class="text-secondary" href="https://segmentfault.com/groups?tab=jobs&amp;utm_source=sf-footer" target="_blank">酷工作</a></dd>
                                <dd class="my-1"><a class="text-secondary" href="https://segmentfault.com/app?utm_source=sf-footer" target="_blank">移动客户端</a></dd>
                            </dl>

            <dl class="col-4 col-md-2">
                <dt class="h6">课程</dt>
                                <dd class="my-1"><a class="text-secondary" href="https://segmentfault.com/lives/edu?tag=java&amp;sort=hottest&amp;utm_source=sf-footer" target="_blank">Java 开发课程</a></dd>
                                <dd class="my-1"><a class="text-secondary" href="https://segmentfault.com/lives/edu?tag=php&amp;sort=hottest&amp;utm_source=sf-footer" target="_blank">PHP 开发课程</a></dd>
                                <dd class="my-1"><a class="text-secondary" href="https://segmentfault.com/lives/edu?tag=python&amp;sort=hottest&amp;utm_source=sf-footer" target="_blank">Python 开发课程</a></dd>
                                <dd class="my-1"><a class="text-secondary" href="https://segmentfault.com/lives/edu?category=1&amp;sort=hottest&amp;utm_source=sf-footer" target="_blank">前端开发课程</a></dd>
                                <dd class="my-1"><a class="text-secondary" href="https://segmentfault.com/lives/study?category=3&amp;sort=hottest&amp;utm_source=sf-footer" target="_blank">移动开发课程</a></dd>
                            </dl>

            <dl class="col-4 col-md-2 ">
                <dt class="h6">资源</dt>
                                <dd class="my-1"><a class="text-secondary" href="https://segmentfault.com/weekly?utm_source=sf-footer" target="_blank">每周精选</a></dd>
                                <dd class="my-1"><a class="text-secondary" href="https://segmentfault.com/users?utm_source=sf-footer" target="_blank">用户排行榜</a></dd>
                                <dd class="my-1"><a class="text-secondary" href="https://segmentfault.com/badges?utm_source=sf-footer" target="_blank">徽章</a></dd>
                                <dd class="my-1"><a class="text-secondary" href="https://segmentfault.com/faq?utm_source=sf-footer" target="_blank">帮助中心</a></dd>
                                <dd class="my-1"><a class="text-secondary" href="https://segmentfault.com/repu?utm_source=sf-footer" target="_blank">声望与权限</a></dd>
                                <dd class="my-1"><a class="text-secondary" href="https://segmentfault.com/community?utm_source=sf-footer" target="_blank">社区服务中心</a></dd>
                            </dl>

            <dl class="col-4 col-md-2">
                <dt class="h6">合作</dt>
                                <dd class="my-1"><a class="text-secondary" href="https://about.segmentfault.com/?utm_source=sf-footer" target="_blank">关于我们</a></dd>
                                <dd class="my-1"><a class="text-secondary" href="https://business.segmentfault.com/ads?utm_source=sf-footer" target="_blank">广告投放</a></dd>
                                <dd class="my-1"><a class="text-secondary" href="https://segmentfault.com/groups?tab=jobs&amp;utm_source=sf-footer" target="_blank">职位发布</a></dd>
                                <dd class="my-1"><a class="text-secondary" href="https://jinshuju.net/f/HK5r9K?utm_source=sf-footer" target="_blank">讲师招募</a></dd>
                                <dd class="my-1"><a class="text-secondary" href="https://about.segmentfault.com/contact.html?utm_source=sf-footer" target="_blank">联系我们</a></dd>
                                <dd class="my-1"><a class="text-secondary" href="https://segmentfault.com/link?utm_source=sf-footer" target="_blank">合作伙伴</a></dd>
                            </dl>

            <dl class="col-4 col-md-2">
                <dt class="h6">关注</dt>
                                <dd class="my-1"><a class="text-secondary" href="https://segmentfault.com/blog/segmentfault?utm_source=sf-footer" target="_blank">产品技术日志</a></dd>
                                <dd class="my-1"><a class="text-secondary" href="https://segmentfault.com/blog/community_admin?utm_source=sf-footer" target="_blank">社区运营日志</a></dd>
                                <dd class="my-1"><a class="text-secondary" href="https://segmentfault.com/blog/segmentfault_news?utm_source=sf-footer" target="_blank">市场运营日志</a></dd>
                                <dd class="my-1"><a class="text-secondary" href="https://segmentfault.com/blog/segmentfault_team?utm_source=sf-footer" target="_blank">团队日志</a></dd>
                                <dd class="my-1"><a class="text-secondary" href="https://segmentfault.com/blog/interview?utm_source=sf-footer" target="_blank">社区访谈</a></dd>
                            </dl>

            <dl class="col-4 col-md-2" id="license">
                <dt class="h6">条款</dt>
                                <dd class="my-1"><a class="text-secondary" href="https://segmentfault.com/tos?utm_source=sf-footer" target="_blank">服务条款</a></dd>
                                <dd class="my-1"><a class="text-secondary" href="https://segmentfault.com/privacy?utm_source=sf-footer" target="_blank">隐私政策</a></dd>
                                <dd class="my-1">
                    <a class="text-secondary" href="https://segmentfault.com/app?utm_source=sf-footer">下载 App</a>
                </dd>
                <dd class="my-1">
                    <div class="weixin-qrcode ml-n1" title="微信公众号"></div>
                </dd>
            </dl>
        </div>
        <hr class="mt-2 mb-4">
        <div class="row">
            <div class="col-md-8">
                <div class="text-secondary">
                    <p class="mb-1">Copyright © 2011-2020 SegmentFault.</p>
                    <p class="mb-1">
                        <a class="text-secondary mr-2" target="_blank" href="http://beian.miit.gov.cn/" rel="nofollow">浙ICP备15005796号-2</a>
                        <a class="text-secondary mr-2" target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33010602002000" rel="nofollow">浙公网安备33010602002000号</a>
                        杭州堆栈科技有限公司版权所有
                    </p>
                    <div style="width: 100px">
                        <a id="seal_knowsafe" href="https://www.knowsafe.com/" sid="fa5bfd40493bf2d889a06f32db929207" slang="zh" sdomain="https://seal.knowsafe.com" target="_blank" style="display: none;">iTrust</a><script src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/itrustcert.js.下载" charset="utf-8" type="text/javascript"></script><a target="_blank" href="https://seal.knowsafe.com/seal/itrustcert?id=fa5bfd40493bf2d889a06f32db929207&amp;lang=zh" title="iTrust"><img style="width: 114px; height: 40px;" border="0" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/zh.svg"></a>
                    </div>
                </div>
            </div>
            <div class="col-md-4 text-right">
                <div class="shareContent ">
                <a class="share_weixin" data-share="weixin" href="javascript:;" data-original-title="" title=""><svg class="svg-inline--fa fa-weixin fa-w-18 fa-fw" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="weixin" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" data-fa-i2svg=""><path fill="currentColor" d="M385.2 167.6c6.4 0 12.6.3 18.8 1.1C387.4 90.3 303.3 32 207.7 32 100.5 32 13 104.8 13 197.4c0 53.4 29.3 97.5 77.9 131.6l-19.3 58.6 68-34.1c24.4 4.8 43.8 9.7 68.2 9.7 6.2 0 12.1-.3 18.3-.8-4-12.9-6.2-26.6-6.2-40.8-.1-84.9 72.9-154 165.3-154zm-104.5-52.9c14.5 0 24.2 9.7 24.2 24.4 0 14.5-9.7 24.2-24.2 24.2-14.8 0-29.3-9.7-29.3-24.2.1-14.7 14.6-24.4 29.3-24.4zm-136.4 48.6c-14.5 0-29.3-9.7-29.3-24.2 0-14.8 14.8-24.4 29.3-24.4 14.8 0 24.4 9.7 24.4 24.4 0 14.6-9.6 24.2-24.4 24.2zM563 319.4c0-77.9-77.9-141.3-165.4-141.3-92.7 0-165.4 63.4-165.4 141.3S305 460.7 397.6 460.7c19.3 0 38.9-5.1 58.6-9.9l53.4 29.3-14.8-48.6C534 402.1 563 363.2 563 319.4zm-219.1-24.5c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.8 0 24.4 9.7 24.4 19.3 0 10-9.7 19.6-24.4 19.6zm107.1 0c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.5 0 24.4 9.7 24.4 19.3.1 10-9.9 19.6-24.4 19.6z"></path></svg><!-- <i class="fab fa-weixin fa-fw"></i> --> </a><a class="share_weibo" data-share="weibo" href="http://weibo.com/segmentfault" target="_blank"><svg class="svg-inline--fa fa-weibo fa-w-16 fa-fw" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="weibo" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M407 177.6c7.6-24-13.4-46.8-37.4-41.7-22 4.8-28.8-28.1-7.1-32.8 50.1-10.9 92.3 37.1 76.5 84.8-6.8 21.2-38.8 10.8-32-10.3zM214.8 446.7C108.5 446.7 0 395.3 0 310.4c0-44.3 28-95.4 76.3-143.7C176 67 279.5 65.8 249.9 161c-4 13.1 12.3 5.7 12.3 6 79.5-33.6 140.5-16.8 114 51.4-3.7 9.4 1.1 10.9 8.3 13.1 135.7 42.3 34.8 215.2-169.7 215.2zm143.7-146.3c-5.4-55.7-78.5-94-163.4-85.7-84.8 8.6-148.8 60.3-143.4 116s78.5 94 163.4 85.7c84.8-8.6 148.8-60.3 143.4-116zM347.9 35.1c-25.9 5.6-16.8 43.7 8.3 38.3 72.3-15.2 134.8 52.8 111.7 124-7.4 24.2 29.1 37 37.4 12 31.9-99.8-55.1-195.9-157.4-174.3zm-78.5 311c-17.1 38.8-66.8 60-109.1 46.3-40.8-13.1-58-53.4-40.3-89.7 17.7-35.4 63.1-55.4 103.4-45.1 42 10.8 63.1 50.2 46 88.5zm-86.3-30c-12.9-5.4-30 .3-38 12.9-8.3 12.9-4.3 28 8.6 34 13.1 6 30.8.3 39.1-12.9 8-13.1 3.7-28.3-9.7-34zm32.6-13.4c-5.1-1.7-11.4.6-14.3 5.4-2.9 5.1-1.4 10.6 3.7 12.9 5.1 2 11.7-.3 14.6-5.4 2.8-5.2 1.1-10.9-4-12.9z"></path></svg><!-- <i class="fab fa-weibo fa-fw"></i> --> </a><a class="share_github" data-share="github" href="https://github.com/SegmentFault" target="_blank"><svg class="svg-inline--fa fa-github fa-w-16 fa-fw" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" data-fa-i2svg=""><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg><!-- <i class="fab fa-github fa-fw"></i> --> </a><a class="share_twitter" data-share="twitter" href="https://twitter.com/segment_fault" target="_blank"><svg class="svg-inline--fa fa-twitter fa-w-16 fa-fw" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitter" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg><!-- <i class="fab fa-twitter fa-fw"></i> --> </a></div>
            </div>
        </div>
    </div>
</footer>
                    
<script>
  window.serverTime = 1609063800000;
</script>

<script>
  (function (w) {
    w.SF = {
      staticUrl: "https://assets.segmentfault.com/v-5fdaf840/"
    };
    w.SF.token = (function () {
    var _0eD1ry = '5'//'Oz'
+//'mSB'
'6de'+//'Ex'
'2c'+//'aF8'
'9'+//'T'
'e'+''///*'25X'*/'25X'
+''///*'1'*/'1'
+'b5'//'f'
+'a'//'dz'
+//'yp'
'5'+//'P'
'3'+/* 'V'//'V' */''+'1r'//'1r'
+'9'//'J6'
+//'6n'
'2c'+'9c'//'WQN'
+//'8M'
'5'+//'c'
'15'+'b6'//'952'
+//'VU'
'09'+//'vAO'
'9'+//'8eW'
'51'+'45'//'j'
+//'I6w'
'6'+'eDi'//'eDi'
+/* 'vL'//'vL' */''+/* '4b0'//'4b0' */''+'L8'//'L8'
+'rL'//'rL'
+'B'//'B'
+''///*'L'*/'L'
+//'l7'
'7', _0suie = [[13,15],[31,34],[31,33],[31,33],[31,32]];

    for (var i = 0; i < _0suie.length; i ++) {
        _0eD1ry = _0eD1ry.substring(0, _0suie[i][0]) + _0eD1ry.substring(_0suie[i][1]);
    }

    return _0eD1ry;
})();;

          w.SF.userId = 1030000008487499;
        })(window);

        var lock = {
    type: "",
    text: '',
    table: {"ban_post":[1,"\u4f60\u5df2\u7ecf\u88ab\u7981\u8a00, \u65e0\u6cd5\u8fdb\u884c\u6b64\u64cd\u4f5c, \u5982\u6709\u7591\u4e49\u8bf7\u63d0\u4ea4\u7533\u8bc9, \u6216\u8005\u53d1\u90ae\u4ef6\u5230pr@segmentfault.com"]}
  };

    var ddosMode = false;
  
    (function (currentUrl) {
    if (typeof URL != 'undefined') {
      var baseUrl = new URL('https://segmentfault.com');

      if (baseUrl.protocol != currentUrl.protocol || baseUrl.host != currentUrl.host) {
        window.location.href = baseUrl.protocol + '//' + baseUrl.host
          + currentUrl.pathname + currentUrl.search + currentUrl.hash;
      }
    }
  })(window.location);
  </script>

<script src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/jquery.js.下载"></script>
<script src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/vendors.js.下载"></script>
  <script src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/detail.bundle.js.下载"></script>

    <script>
      if (!!navigator.userAgent.match(/MicroMessenger/i)) {
        $.getScript(`https://res.wx.qq.com/open/js/jweixin-1.2.0.js`, function () {
          var share = {"title":"\u624b\u628a\u624b\uff0c\u642d\u5efa\u524d\u7aef\u81ea\u52a8\u5316\u90e8\u7f72CI \/ CD \u670d\u52a1 + npm\u79c1\u6709\u5e93 + \u6570\u636e mock \u670d\u52a1","desc":"\u200b \u8fd9\u4e2a\u5982\u706b\u5982\u837c\u7684\u5927\u524d\u7aef\u65f6\u4ee3\uff0cvue\u3001react\u3001angular \u3001flutter\u3001electron\u3001\u5c0f\u7a0b\u5e8f\u7b49\u6280\u672f\u6846\u67b6\u767e\u5bb6\u4e89\u9e23\uff0c\u8fd9\u4e9b\u90fd\u662f\u6211\u4eec\u524d\u7aef\u62ff\u6765\u5e72\u67b6\u5403\u996d\u7684\u6b66\u5668\uff0c\u524d\u7aef\u5de5\u7a0b\u5316\u4f53\u7cfb\u4e5f\u9010\u6e10\u5411\u5c0f\u516c\u53f8\u5c0f\u56e2\u961f\u666e\u53ca\uff0c\u505a\u4e3a\u4e00\u4e2a\u5c0f\u5c0f\u524d\u7aef\u56e2\u961f\u7684leader\uff0c\u4e86\u89e3\u5982\u4f55\u53bb\u642d\u5efa\u4e00\u4e2a\u57fa\u7840\u7684\u524d\u7aef\u5de5\u7a0b\u5316\u4f53\u7cfb\u670d\u52a1\u73af\u5883\uff0c\u6765\u5e2e\u52a9\u5c0f\u56e2\u961f\u7684\u63d0\u9ad8\u5f00\u53d1\u4f53\u9a8c\u548c\u63d0\u5347\u5de5\u4f5c\u6548\u7387\uff0c\u8fd8\u662f\u6709...","link":"https:\/\/segmentfault.com\/a\/1190000024453209","imgUrl":"https:\/\/segmentfault.com\/img\/remote\/1460000024453212"};
          share.title += ' - SegmentFault 思否';
          share.imgUrl = "https://assets.segmentfault.com/v-5fdaf840/global/img/static/touch-icon.png";
          $.getJSON('/api/util/weixin/jsapi', function (o) {
            methods = o.data.jsApiList.slice();

            wx.config(o.data);
            wx.error(console.error);
            wx.ready(function () {
              methods.forEach(function (method) {
                wx[method](share);
              });
            });
          });
        })
      }
    </script>

<script>
  var _hmt = _hmt || [];
  (function () {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?e23800c454aa573c0ccb16b52665ac26";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script>




<iframe id="p_analyse_iframe" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/saved_resource(1).html" style="display: none;"></iframe>
    <div class="is-active ImageView p-4" style="display: none;">
        <div class="ImageView-inner" style="overflow: auto;">
            <img src="https://segmentfault.com/a/1190000024453209" class="ImageView-img" alt="preview" style="max-width: 100%">
        </div>
    </div><div id="fixedTools" class="position-fixed d-none d-xl-flex" style="right: 24px; bottom: 24px">
            <button type="button" class="btn btn-light" title="回顶部">▲</button>
        </div><div id="atwho-container"><div id="atwho-ground-329943a91609063801756"><div class="atwho-view" id="at-view-64"><ul class="atwho-view-ul"></ul></div></div></div><ins class="adsbygoogle adsbygoogle-noablate" data-adsbygoogle-status="done" style="display: none !important;"><ins id="aswift_2_expand" style="display:inline-table;border:none;height:0px;margin:0;padding:0;position:relative;visibility:visible;width:0px;background-color:transparent;" tabindex="0" title="Advertisement" aria-label="Advertisement"><ins id="aswift_2_anchor" style="display:block;border:none;height:0px;margin:0;padding:0;position:relative;visibility:visible;width:0px;background-color:transparent;"><iframe id="aswift_2" name="aswift_2" style="left:0;position:absolute;top:0;border:0;width:undefinedpx;height:undefinedpx;" sandbox="allow-forms allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-top-navigation-by-user-activation" frameborder="0" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/ads(1).html" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" data-google-container-id="a!2" data-load-complete="true"></iframe></ins></ins></ins><iframe id="google_osd_static_frame_481990932527" name="google_osd_static_frame" style="display: none; width: 0px; height: 0px;" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/saved_resource(2).html"></iframe></body><iframe id="google_esf" name="google_esf" src="./(...) 手把手，搭建前端自动化部署CI _ CD 服务 + npm私有库 + 数据 mock 服务_个人文章 - SegmentFault 思否_files/zrt_lookup.html" data-ad-client="ca-pub-6330872677300335" style="display: none;"></iframe></html>